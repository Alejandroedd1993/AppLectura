/*! For license information please see main.4b5d44ad.js.LICENSE.txt */
(()=>{"use strict";var e={306:(e,t,n)=>{n.d(t,{rJ:()=>nl,vN:()=>Jo,kd:()=>pc,H9:()=>il,x7:()=>lc,GG:()=>uc,aU:()=>cl,AB:()=>Yl,aQ:()=>fc,My:()=>Xl,P:()=>ql,O5:()=>bc,BN:()=>hc,mZ:()=>dc,wP:()=>wc});var i,s,r=n(1741),a=n(6863),o=n(2226),l=n(498),c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},u={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const i=Array(16);if("string"===typeof t)for(var s=0;s<16;++s)i[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;s<16;++s)i[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];let r,a=e.g[3];r=t+(a^n&(s^a))+i[0]+3614090360&4294967295,r=a+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[1]+3905402710&4294967295,a=t+(r<<12&4294967295|r>>>20),r=s+(n^a&(t^n))+i[2]+606105819&4294967295,r=n+(t^(s=a+(r<<17&4294967295|r>>>15))&(a^t))+i[3]+3250441966&4294967295,r=t+(a^(n=s+(r<<22&4294967295|r>>>10))&(s^a))+i[4]+4118548399&4294967295,r=a+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[5]+1200080426&4294967295,a=t+(r<<12&4294967295|r>>>20),r=s+(n^a&(t^n))+i[6]+2821735955&4294967295,r=n+(t^(s=a+(r<<17&4294967295|r>>>15))&(a^t))+i[7]+4249261313&4294967295,r=t+(a^(n=s+(r<<22&4294967295|r>>>10))&(s^a))+i[8]+1770035416&4294967295,r=a+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[9]+2336552879&4294967295,a=t+(r<<12&4294967295|r>>>20),r=s+(n^a&(t^n))+i[10]+4294925233&4294967295,r=n+(t^(s=a+(r<<17&4294967295|r>>>15))&(a^t))+i[11]+2304563134&4294967295,r=t+(a^(n=s+(r<<22&4294967295|r>>>10))&(s^a))+i[12]+1804603682&4294967295,r=a+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[13]+4254626195&4294967295,a=t+(r<<12&4294967295|r>>>20),r=s+(n^a&(t^n))+i[14]+2792965006&4294967295,r=n+(t^(s=a+(r<<17&4294967295|r>>>15))&(a^t))+i[15]+1236535329&4294967295,r=t+(s^a&((n=s+(r<<22&4294967295|r>>>10))^s))+i[1]+4129170786&4294967295,r=a+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[6]+3225465664&4294967295,a=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(a^t))+i[11]+643717713&4294967295,r=n+(a^t&((s=a+(r<<14&4294967295|r>>>18))^a))+i[0]+3921069994&4294967295,r=t+(s^a&((n=s+(r<<20&4294967295|r>>>12))^s))+i[5]+3593408605&4294967295,r=a+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[10]+38016083&4294967295,a=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(a^t))+i[15]+3634488961&4294967295,r=n+(a^t&((s=a+(r<<14&4294967295|r>>>18))^a))+i[4]+3889429448&4294967295,r=t+(s^a&((n=s+(r<<20&4294967295|r>>>12))^s))+i[9]+568446438&4294967295,r=a+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[14]+3275163606&4294967295,a=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(a^t))+i[3]+4107603335&4294967295,r=n+(a^t&((s=a+(r<<14&4294967295|r>>>18))^a))+i[8]+1163531501&4294967295,r=t+(s^a&((n=s+(r<<20&4294967295|r>>>12))^s))+i[13]+2850285829&4294967295,r=a+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[2]+4243563512&4294967295,a=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(a^t))+i[7]+1735328473&4294967295,r=n+(a^t&((s=a+(r<<14&4294967295|r>>>18))^a))+i[12]+2368359562&4294967295,r=t+((n=s+(r<<20&4294967295|r>>>12))^s^a)+i[5]+4294588738&4294967295,r=a+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[8]+2272392833&4294967295,a=t+(r<<11&4294967295|r>>>21),r=s+(a^t^n)+i[11]+1839030562&4294967295,r=n+((s=a+(r<<16&4294967295|r>>>16))^a^t)+i[14]+4259657740&4294967295,r=t+((n=s+(r<<23&4294967295|r>>>9))^s^a)+i[1]+2763975236&4294967295,r=a+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[4]+1272893353&4294967295,a=t+(r<<11&4294967295|r>>>21),r=s+(a^t^n)+i[7]+4139469664&4294967295,r=n+((s=a+(r<<16&4294967295|r>>>16))^a^t)+i[10]+3200236656&4294967295,r=t+((n=s+(r<<23&4294967295|r>>>9))^s^a)+i[13]+681279174&4294967295,r=a+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[0]+3936430074&4294967295,a=t+(r<<11&4294967295|r>>>21),r=s+(a^t^n)+i[3]+3572445317&4294967295,r=n+((s=a+(r<<16&4294967295|r>>>16))^a^t)+i[6]+76029189&4294967295,r=t+((n=s+(r<<23&4294967295|r>>>9))^s^a)+i[9]+3654602809&4294967295,r=a+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[12]+3873151461&4294967295,a=t+(r<<11&4294967295|r>>>21),r=s+(a^t^n)+i[15]+530742520&4294967295,r=n+((s=a+(r<<16&4294967295|r>>>16))^a^t)+i[2]+3299628645&4294967295,r=t+(s^((n=s+(r<<23&4294967295|r>>>9))|~a))+i[0]+4096336452&4294967295,r=a+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[7]+1126891415&4294967295,a=t+(r<<10&4294967295|r>>>22),r=s+(t^(a|~n))+i[14]+2878612391&4294967295,r=n+(a^((s=a+(r<<15&4294967295|r>>>17))|~t))+i[5]+4237533241&4294967295,r=t+(s^((n=s+(r<<21&4294967295|r>>>11))|~a))+i[12]+1700485571&4294967295,r=a+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[3]+2399980690&4294967295,a=t+(r<<10&4294967295|r>>>22),r=s+(t^(a|~n))+i[10]+4293915773&4294967295,r=n+(a^((s=a+(r<<15&4294967295|r>>>17))|~t))+i[1]+2240044497&4294967295,r=t+(s^((n=s+(r<<21&4294967295|r>>>11))|~a))+i[8]+1873313359&4294967295,r=a+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[15]+4264355552&4294967295,a=t+(r<<10&4294967295|r>>>22),r=s+(t^(a|~n))+i[6]+2734768916&4294967295,r=n+(a^((s=a+(r<<15&4294967295|r>>>17))|~t))+i[13]+1309151649&4294967295,r=t+(s^((n=s+(r<<21&4294967295|r>>>11))|~a))+i[4]+4149444226&4294967295,r=a+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[11]+3174756917&4294967295,a=t+(r<<10&4294967295|r>>>22),r=s+(t^(a|~n))+i[2]+718787259&4294967295,r=n+(a^((s=a+(r<<15&4294967295|r>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(r<<21&4294967295|r>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+a&4294967295}function r(e,t){this.h=t;const n=[];let i=!0;for(let s=e.length-1;s>=0;s--){const r=0|e[s];i&&r==t||(n[s]=r,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}(t,(function(){this.blockSize=-1})),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const i=t-this.blockSize,s=this.C;let r=this.h,a=0;for(;a<t;){if(0==r)for(;a<=i;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(s[r++]=e.charCodeAt(a++),r==this.blockSize){n(this,s),r=0;break}}else for(;a<t;)if(s[r++]=e[a++],r==this.blockSize){n(this,s),r=0;break}}this.h=r,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let i=0;i<32;i+=8)e[t++]=this.g[n]>>>i&255;return e};var a={};function o(e){return-128<=e&&e<128?function(e,t){var n=a;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new r([0|e],e<0?-1:0)})):new r([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return g(l(-e));const t=[];let n=1;for(let i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var c=o(0),h=o(1),d=o(16777216);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return-1==e.h}function g(e){const t=e.g.length,n=[];for(let i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(h)}function m(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new y(c,c);if(f(e))return t=b(g(e),t),new y(g(t.g),g(t.h));if(f(t))return t=b(e,g(t)),new y(g(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=h,i=t;i.l(e)<=0;)n=w(n),i=w(i);var s=_(n,1),r=_(i,1);for(i=_(i,2),n=_(n,2);!p(i);){var a=r.add(i);a.l(e)<=0&&(s=s.add(n),r=a),i=_(i,1),n=_(n,1)}return t=m(e,s.j(t)),new y(s,t)}for(s=c;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),i=(i=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,i-48),a=(r=l(n)).j(t);f(a)||a.l(e)>0;)a=(r=l(n-=i)).j(t);p(r)&&(r=h),s=s.add(r),e=m(e,a)}return new y(s,e)}function w(e){const t=e.g.length+1,n=[];for(let i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function _(e,t){const n=t>>5;t%=32;const i=e.g.length-n,s=[];for(let r=0;r<i;r++)s[r]=t>0?e.i(r+n)>>>t|e.i(r+n+1)<<32-t:e.i(r+n);return new r(s,e.h)}(e=r.prototype).m=function(){if(f(this))return-g(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const i=this.i(n);e+=(i>=0?i:4294967296+i)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(f(this))return"-"+g(this).toString(e);const t=l(Math.pow(e,6));var n=this;let i="";for(;;){const s=b(n,t).g;let r=(((n=m(n,s.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(p(n=s))return r+i;for(;r.length<6;)r="0"+r;i=r+i}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return f(e=m(this,e))?-1:p(e)?0:1},e.abs=function(){return f(this)?g(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let i=0;for(let s=0;s<=t;s++){let t=i+(65535&this.i(s))+(65535&e.i(s)),r=(t>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=r>>>16,t&=65535,r&=65535,n[s]=r<<16|t}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(p(this)||p(e))return c;if(f(this))return f(e)?g(this).j(g(e)):g(g(this).j(e));if(f(e))return g(this.j(g(e)));if(this.l(d)<0&&e.l(d)<0)return l(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){const s=this.i(i)>>>16,r=65535&this.i(i),a=e.i(t)>>>16,o=65535&e.i(t);n[2*i+2*t]+=r*o,v(n,2*i+2*t),n[2*i+2*t+1]+=s*o,v(n,2*i+2*t+1),n[2*i+2*t+1]+=r*a,v(n,2*i+2*t+1),n[2*i+2*t+2]+=s*a,v(n,2*i+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new r(n,0)},e.B=function(e){return b(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,s=u.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=l,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return g(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const i=l(Math.pow(n,8));let s=c;for(let a=0;a<t.length;a+=8){var r=Math.min(8,t.length-a);const e=parseInt(t.substring(a,a+r),n);r<8?(r=l(Math.pow(n,r)),s=s.j(r).add(l(e))):(s=s.j(i),s=s.add(l(e)))}return s},i=u.Integer=r}).apply("undefined"!==typeof c?c:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var h,d,p,f,g,m,v,y,b="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},w={};(function(){var e,t=Object.defineProperty;var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof b&&b];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,i){if(i)e:{var s=n;e=e.split(".");for(var r=0;r<e.length-1;r++){var a=e[r];if(!(a in s))break e;s=s[a]}(i=i(r=s[e=e[e.length-1]]))!=r&&null!=i&&t(s,e,{configurable:!0,writable:!0,value:i})}}i("Symbol.dispose",(function(e){return e||Symbol("Symbol.dispose")})),i("Array.prototype.values",(function(e){return e||function(){return this[Symbol.iterator]()}})),i("Object.entries",(function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}}));var s=s||{},r=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){return(l=o).apply(null,arguments)}function c(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}var _="undefined"!==typeof AsyncContext&&"function"===typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function E(e){const t=e.length;if(t>0){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function S(e,t){for(let i=1;i<arguments.length;i++){const t=arguments[i];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const i=t.length||0;e.length=n+i;for(let s=0;s<i;s++)e[n+s]=t[s]}else e.push(t)}}function C(e){r.setTimeout((()=>{throw e}),0)}function T(){var e=R;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var x=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new k),(e=>e.reset()));class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let I,P=!1,R=new class{constructor(){this.h=this.g=null}add(e,t){const n=x.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},D=()=>{const e=Promise.resolve(void 0);I=()=>{e.then(M)}};function M(){for(var e;e=T();){try{e.h.call(e.g)}catch(n){C(n)}var t=x;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}P=!1}function N(){this.u=this.u,this.C=this.C}function L(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},L.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};r.addEventListener("test",e,t),r.removeEventListener("test",e,t)}catch(n){}return e}();function F(e){return/^[\s\xa0]*$/.test(e)}function U(e,t){L.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}u(U,L),U.prototype.init=function(e,t){const n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&U.Z.h.call(this)},U.prototype.h=function(){U.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var z="closure_listenable_"+(1e6*Math.random()|0),V=0;function B(e,t,n,i,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=s,this.key=++V,this.da=this.fa=!1}function j(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function H(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function $(e){const t={};for(const n in e)t[n]=e[n];return t}const q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function W(e,t){let n,i;for(let s=1;s<arguments.length;s++){for(n in i=arguments[s],i)e[n]=i[n];for(let t=0;t<q.length;t++)n=q[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function G(e){this.src=e,this.g={},this.h=0}function K(e,t){const n=t.type;if(n in e.g){var i,s=e.g[n],r=Array.prototype.indexOf.call(s,t,void 0);(i=r>=0)&&Array.prototype.splice.call(s,r,1),i&&(j(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function X(e,t,n,i){for(let s=0;s<e.length;++s){const r=e[s];if(!r.da&&r.listener==t&&r.capture==!!n&&r.ha==i)return s}return-1}G.prototype.add=function(e,t,n,i,s){const r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);const a=X(e,t,i,s);return a>-1?(t=e[a],n||(t.fa=!1)):((t=new B(t,this.src,r,!!i,s)).fa=n,e.push(t)),t};var Q="closure_lm_"+(1e6*Math.random()|0),Y={};function J(e,t,n,i,s){if(i&&i.once)return te(e,t,n,i,s);if(Array.isArray(t)){for(let r=0;r<t.length;r++)J(e,t[r],n,i,s);return null}return n=le(n),e&&e[z]?e.J(t,n,a(i)?!!i.capture:!!i,s):Z(e,t,n,!1,i,s)}function Z(e,t,n,i,s,r){if(!t)throw Error("Invalid event type");const o=a(s)?!!s.capture:!!s;let l=ae(e);if(l||(e[Q]=l=new G(e)),(n=l.add(t,n,i,o,r)).proxy)return n;if(i=function(){function e(n){return t.call(e.src,e.listener,n)}const t=re;return e}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)O||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),i,s);else if(e.attachEvent)e.attachEvent(se(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function te(e,t,n,i,s){if(Array.isArray(t)){for(let r=0;r<t.length;r++)te(e,t[r],n,i,s);return null}return n=le(n),e&&e[z]?e.K(t,n,a(i)?!!i.capture:!!i,s):Z(e,t,n,!0,i,s)}function ne(e,t,n,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)ne(e,t[r],n,i,s);else i=a(i)?!!i.capture:!!i,n=le(n),e&&e[z]?(e=e.i,(r=String(t).toString())in e.g&&((n=X(t=e.g[r],n,i,s))>-1&&(j(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[r],e.h--)))):e&&(e=ae(e))&&(t=e.g[t.toString()],e=-1,t&&(e=X(t,n,i,s)),(n=e>-1?t[e]:null)&&ie(n))}function ie(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[z])K(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(se(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=ae(t))?(K(n,e),0==n.h&&(n.src=null,t[Q]=null)):j(e)}}}function se(e){return e in Y?Y[e]:Y[e]="on"+e}function re(e,t){if(e.da)e=!0;else{t=new U(t,this);const n=e.listener,i=e.ha||e.src;e.fa&&ie(e),e=n.call(i,t)}return e}function ae(e){return(e=e[Q])instanceof G?e:null}var oe="__closure_events_fn_"+(1e9*Math.random()>>>0);function le(e){return"function"===typeof e?e:(e[oe]||(e[oe]=function(t){return e.handleEvent(t)}),e[oe])}function ce(){N.call(this),this.i=new G(this),this.M=this,this.G=null}function ue(e,t){var n,i=e.G;if(i)for(n=[];i;i=i.G)n.push(i);if(e=e.M,i=t.type||t,"string"===typeof t)t=new L(t,e);else if(t instanceof L)t.target=t.target||e;else{var s=t;W(t=new L(i,e),s)}let r,a;if(s=!0,n)for(a=n.length-1;a>=0;a--)r=t.g=n[a],s=he(r,i,!0,t)&&s;if(r=t.g=e,s=he(r,i,!0,t)&&s,s=he(r,i,!1,t)&&s,n)for(a=0;a<n.length;a++)r=t.g=n[a],s=he(r,i,!1,t)&&s}function he(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let s=!0;for(let r=0;r<t.length;++r){const a=t[r];if(a&&!a.da&&a.capture==n){const t=a.listener,n=a.ha||a.src;a.fa&&K(e.i,a),s=!1!==t.call(n,i)&&s}}return s&&!i.defaultPrevented}function de(e){e.g=function(e,t){if("function"!==typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return Number(t)>2147483647?-1:r.setTimeout(e,t||0)}((()=>{e.g=null,e.i&&(e.i=!1,de(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(ce,N),ce.prototype[z]=!0,ce.prototype.removeEventListener=function(e,t,n,i){ne(this,e,t,n,i)},ce.prototype.N=function(){if(ce.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)j(n[e]);delete e.g[t],e.h--}}this.G=null},ce.prototype.J=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ce.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class pe extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:de(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function fe(e){N.call(this),this.h=e,this.g={}}u(fe,N);var ge=[];function me(e){H(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ie(e)}),e),e.g={}}fe.prototype.N=function(){fe.Z.N.call(this),me(this)},fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ve=r.JSON.stringify,ye=r.JSON.parse,be=class{stringify(e){return r.JSON.stringify(e,void 0)}parse(e){return r.JSON.parse(e,void 0)}};function we(){}function _e(){}var Ae={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ee(){L.call(this,"d")}function Se(){L.call(this,"c")}u(Ee,L),u(Se,L);var Ce={},Te=null;function xe(){return Te=Te||new ce}function ke(e){L.call(this,Ce.Ia,e)}function Ie(e){const t=xe();ue(t,new ke(t))}function Pe(e,t){L.call(this,Ce.STAT_EVENT,e),this.stat=t}function Re(e){const t=xe();ue(t,new Pe(t,e))}function De(e,t){L.call(this,Ce.Ja,e),this.size=t}function Me(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return r.setTimeout((function(){e()}),t)}function Ne(){this.g=!0}function Le(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const r=JSON.parse(t);if(r)for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(n.length<2)){var i=n[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let e=1;e<i.length;e++)i[e]=""}}}return ve(r)}catch(r){return t}}(e,n)+(i?" "+i:"")}))}Ce.Ia="serverreachability",u(ke,L),Ce.STAT_EVENT="statevent",u(Pe,L),Ce.Ja="timingevent",u(De,L),Ne.prototype.ua=function(){this.g=!1},Ne.prototype.info=function(){};var Oe,Fe={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ue={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ze(){}function Ve(e){return encodeURIComponent(String(e))}function Be(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function je(e,t,n,i){this.j=e,this.i=t,this.l=n,this.S=i||1,this.V=new fe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new He}function He(){this.i=null,this.g="",this.h=!1}u(ze,we),ze.prototype.g=function(){return new XMLHttpRequest},Oe=new ze;var $e={},qe={};function We(e,t,n){e.M=1,e.A=vt(dt(t)),e.u=n,e.R=!0,Ge(e,null)}function Ge(e,t){e.F=Date.now(),Qe(e),e.B=dt(e.A);var n=e.B,i=e.S;Array.isArray(i)||(i=[String(i)]),Rt(n.i,"t",i),e.C=0,n=e.j.L,e.h=new He,e.g=yn(e.j,n?t:null,!e.u),e.P>0&&(e.O=new pe(l(e.Y,e,e.g),e.P)),t=e.V,n=e.g,i=e.ba;var s="readystatechange";Array.isArray(s)||(s&&(ge[0]=s.toString()),s=ge);for(let r=0;r<s.length;r++){const e=J(n,s[r],i||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?$(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),Ie(),function(e,t,n,i,s,r){e.info((function(){if(e.g)if(r){var a="",o=r.split("&");for(let e=0;e<o.length;e++){var l=o[e].split("=");if(l.length>1){const e=l[0];l=l[1];const t=e.split("_");a=t.length>=2&&"type"==t[1]?a+(e+"=")+l+"&":a+(e+"=redacted&")}}}else a=null;else a=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+"\n"+n+"\n"+a}))}(e.i,e.v,e.B,e.l,e.S,e.u)}function Ke(e){return!!e.g&&("GET"==e.v&&2!=e.M&&e.j.Aa)}function Xe(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?qe:(n=Number(t.substring(n,i)),isNaN(n)?$e:(i+=1)+n>t.length?qe:(t=t.slice(i,i+n),e.C=i+n,t))}function Qe(e){e.T=Date.now()+e.H,Ye(e,e.H)}function Ye(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=Me(l(e.aa,e),t)}function Je(e){e.D&&(r.clearTimeout(e.D),e.D=null)}function Ze(e){0==e.j.I||e.K||pn(e.j,e)}function et(e){Je(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,me(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function tt(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||at(n.h,e)))if(!e.L&&at(n.h,e)&&3==n.I){try{var i=n.Ba.g.parse(t)}catch(u){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;dn(n),tn(n)}cn(n),Re(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=Me(l(n.Va,n),6e3));rt(n.h)<=1&&n.ta&&(n.ta=void 0)}else gn(n,11)}else if((e.L||n.g==e)&&dn(n),!F(t))for(s=n.Ba.g.parse(t),t=0;t<s.length;t++){let l=s[t];const u=l[0];if(!(u<=n.K))if(n.K=u,l=l[1],2==n.I)if("c"==l[0]){n.M=l[1],n.ba=l[2];const t=l[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const s=l[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const u=l[5];null!=u&&"number"===typeof u&&u>0&&(i=1.5*u,n.O=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=i.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(ot(r,r.h),r.h=null))}if(i.G){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.wa=e,mt(i.J,i.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var a=e;if((i=n).na=vn(i,i.L?i.ba:null,i.W),a.L){lt(i.h,a);var o=a,c=i.O;c&&(o.H=c),o.D&&(Je(o),Qe(o)),i.g=a}else ln(i);n.i.length>0&&sn(n)}else"stop"!=l[0]&&"close"!=l[0]||gn(n,7);else 3==n.I&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?gn(n,7):en(n):"noop"!=l[0]&&n.l&&n.l.qa(l),n.A=0)}Ie()}catch(u){}}je.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Qt(e)?t.j():this.Y(e)},je.prototype.Y=function(e){try{if(e==this.g)e:{const l=Qt(this.g),c=this.g.ya();this.g.ca();if(!(l<3)&&(3!=l||this.g&&(this.h.h||this.g.la()||Yt(this.g)))){this.K||4!=l||7==c||Ie(),Je(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Ke(e))return e.g.la();const t=Yt(e.g);if(""===t)return"";let n="";const i=t.length,s=4==Qt(e.g);if(!e.h.i){if("undefined"===typeof TextDecoder)return et(e),Ze(e),"";e.h.i=new r.TextDecoder}for(let r=0;r<i;r++)e.h.h=!0,n+=e.h.i.decode(t[r],{stream:!(s&&r==i-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,i,s,r,a){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+r+" "+a}))}(this.i,this.v,this.B,this.l,this.S,l,t),this.o){if(this.U&&!this.L){t:{if(this.g){var i,s=this.g;if((i=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(i)){var a=i;break t}}a=null}if(!(e=a)){this.o=!1,this.m=3,Re(12),et(this),Ze(this);break e}Le(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,tt(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Xe(this,n),t==qe){4==l&&(this.m=4,Re(14),e=!1),Le(this.i,this.l,null,"[Incomplete Response]");break}if(t==$e){this.m=4,Re(15),Le(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}Le(this.i,this.l,t,null),tt(this,t)}if(Ke(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=l||0!=n.length||this.h.h||(this.m=1,Re(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var o=this.j;o.g==this&&o.aa&&!o.P&&(o.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),un(o),o.P=!0,Re(11))}}else Le(this.i,this.l,n,"[Invalid Chunked Response]"),et(this),Ze(this)}else Le(this.i,this.l,n,null),tt(this,n);4==l&&et(this),this.o&&!this.K&&(4==l?pn(this.j,this):(this.o=!1,Qe(this)))}else(function(e){const t={};e=(e.g&&Qt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(F(e[i]))continue;var n=Be(e[i]);const s=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const r=t[s]||[];t[s]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,Re(12)):(this.m=0,Re(13)),et(this),Ze(this)}}}catch(ee){}},je.prototype.cancel=function(){this.K=!0,et(this)},je.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.B),2!=this.M&&(Ie(),Re(17)),et(this),this.m=2,Ze(this)):Ye(this,this.T-e)};var nt=class{constructor(e,t){this.g=e,this.map=t}};function it(e){this.l=e||10,r.PerformanceNavigationTiming?e=(e=r.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function st(e){return!!e.h||!!e.g&&e.g.size>=e.j}function rt(e){return e.h?1:e.g?e.g.size:0}function at(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function ot(e,t){e.g?e.g.add(t):e.h=t}function lt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ct(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return E(e.i)}it.prototype.cancel=function(){if(this.i=ct(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ut=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ht(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof ht?(this.l=e.l,pt(this,e.j),this.o=e.o,this.g=e.g,ft(this,e.u),this.h=e.h,gt(this,Dt(e.i)),this.m=e.m):e&&(t=String(e).match(ut))?(this.l=!1,pt(this,t[1]||"",!0),this.o=yt(t[2]||""),this.g=yt(t[3]||"",!0),ft(this,t[4]),this.h=yt(t[5]||"",!0),gt(this,t[6]||"",!0),this.m=yt(t[7]||"")):(this.l=!1,this.i=new Tt(null,this.l))}function dt(e){return new ht(e)}function pt(e,t,n){e.j=n?yt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ft(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function gt(e,t,n){t instanceof Tt?(e.i=t,function(e,t){t&&!e.j&&(xt(e),e.i=null,e.g.forEach((function(e,t){const n=t.toLowerCase();t!=n&&(kt(this,t),Rt(this,n,e))}),e)),e.j=t}(e.i,e.l)):(n||(t=bt(t,St)),e.i=new Tt(t,e.l))}function mt(e,t,n){e.i.set(t,n)}function vt(e){return mt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function yt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function bt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,wt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function wt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ht.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(bt(t,_t,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(bt(t,_t,!0),"@"),e.push(Ve(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(bt(n,"/"==n.charAt(0)?Et:At,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",bt(n,Ct)),e.join("")},ht.prototype.resolve=function(e){const t=dt(this);let n=!!e.j;n?pt(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var i=e.h;if(n)ft(t,e.u);else if(n=!!e.h){if("/"!=i.charAt(0))if(this.g&&!this.h)i="/"+i;else{var s=t.h.lastIndexOf("/");-1!=s&&(i=t.h.slice(0,s+1)+i)}if(".."==(s=i)||"."==s)i="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){i=0==s.lastIndexOf("/",0),s=s.split("/");const e=[];for(let t=0;t<s.length;){const n=s[t++];"."==n?i&&t==s.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),i&&t==s.length&&e.push("")):(e.push(n),i=!0)}i=e.join("/")}else i=s}return n?t.h=i:n=""!==e.i.toString(),n?gt(t,Dt(e.i)):n=!!e.m,n&&(t.m=e.m),t};var _t=/[#\/\?@]/g,At=/[#\?:]/g,Et=/[#\?]/g,St=/[#\?@]/g,Ct=/#/g;function Tt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function xt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const i=e[n].indexOf("=");let s,r=null;i>=0?(s=e[n].substring(0,i),r=e[n].substring(i+1)):s=e[n],t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function kt(e,t){xt(e),t=Mt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function It(e,t){return xt(e),t=Mt(e,t),e.g.has(t)}function Pt(e,t){xt(e);let n=[];if("string"===typeof t)It(e,t)&&(n=n.concat(e.g.get(Mt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function Rt(e,t,n){kt(e,t),n.length>0&&(e.i=null,e.g.set(Mt(e,t),E(n)),e.h+=n.length)}function Dt(e){const t=new Tt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function Mt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Nt(e,t,n,i,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),i(n)}catch(r){}}function Lt(){this.g=new be}function Ot(e){this.i=e.Sb||null,this.h=e.ab||!1}function Ft(e,t){ce.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Ut(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function zt(e){e.readyState=4,e.l=null,e.j=null,e.B=null,Vt(e)}function Vt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Bt(e){let t="";return H(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function jt(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Bt(n),"string"===typeof e?null!=n&&Ve(n):mt(e,t,n))}function Ht(e){ce.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=Tt.prototype).add=function(e,t){xt(this),this.i=null,e=Mt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){xt(this),this.g.forEach((function(n,i){n.forEach((function(n){e.call(t,n,i,this)}),this)}),this)},e.set=function(e,t){return xt(this),this.i=null,It(this,e=Mt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=Pt(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let i=0;i<t.length;i++){var n=t[i];const s=Ve(n);n=Pt(this,n);for(let t=0;t<n.length;t++){let i=s;""!==n[t]&&(i+="="+Ve(n[t])),e.push(i)}}return this.i=e.join("&")},u(Ot,we),Ot.prototype.g=function(){return new Ft(this.i,this.h)},u(Ft,ce),(e=Ft.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,Vt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||r).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,zt(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Vt(this)),this.g&&(this.readyState=3,Vt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if("undefined"!==typeof r.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ut(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?zt(this):Vt(this),3==this.readyState&&Ut(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,zt(this))},e.Na=function(e){this.g&&(this.response=e,zt(this))},e.ga=function(){this.g&&zt(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Ft.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Ht,ce);var $t=/^https?$/i,qt=["POST","PUT"];function Wt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Gt(e),Xt(e)}function Gt(e){e.A||(e.A=!0,ue(e,"complete"),ue(e,"error"))}function Kt(e){if(e.h&&"undefined"!=typeof s)if(e.v&&4==Qt(e))setTimeout(e.Ca.bind(e),0);else if(ue(e,"readystatechange"),4==Qt(e)){e.h=!1;try{const s=e.ca();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===s){let t=String(e.D).match(ut)[1]||null;!t&&r.self&&r.self.location&&(t=r.self.location.protocol.slice(0,-1)),i=!$t.test(t?t.toLowerCase():"")}n=i}if(n)ue(e,"complete"),ue(e,"success");else{e.o=6;try{var a=Qt(e)>2?e.g.statusText:""}catch(o){a=""}e.l=a+" ["+e.ca()+"]",Gt(e)}}finally{Xt(e)}}}function Xt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const i=e.g;e.g=null,t||ue(e,"ready");try{i.onreadystatechange=null}catch(n){}}}function Qt(e){return e.g?e.g.readyState:0}function Yt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Jt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Zt(e){this.za=0,this.i=[],this.j=new Ne,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Jt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Jt("baseRetryDelayMs",5e3,e),this.Za=Jt("retryDelaySeedMs",1e4,e),this.Ta=Jt("forwardChannelMaxRetries",2,e),this.va=Jt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new it(e&&e.concurrentRequestLimit),this.Ba=new Lt,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function en(e){if(nn(e),3==e.I){var t=e.V++,n=dt(e.J);if(mt(n,"SID",e.M),mt(n,"RID",t),mt(n,"TYPE","terminate"),an(e,n),(t=new je(e,e.j,t)).M=2,t.A=vt(dt(n)),n=!1,r.navigator&&r.navigator.sendBeacon)try{n=r.navigator.sendBeacon(t.A.toString(),"")}catch(i){}!n&&r.Image&&((new Image).src=t.A,n=!0),n||(t.g=yn(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Qe(t)}mn(e)}function tn(e){e.g&&(un(e),e.g.cancel(),e.g=null)}function nn(e){tn(e),e.v&&(r.clearTimeout(e.v),e.v=null),dn(e),e.h.cancel(),e.m&&("number"===typeof e.m&&r.clearTimeout(e.m),e.m=null)}function sn(e){if(!st(e.h)&&!e.m){e.m=!0;var t=e.Ea;I||D(),P||(I(),P=!0),R.add(t,e),e.D=0}}function rn(e,t){var n;n=t?t.l:e.V++;const i=dt(e.J);mt(i,"SID",e.M),mt(i,"RID",n),mt(i,"AID",e.K),an(e,i),e.u&&e.o&&jt(i,e.u,e.o),n=new je(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=on(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),ot(e.h,n),We(n,i,t)}function an(e,t){e.H&&H(e.H,(function(e,n){mt(t,n,e)})),e.l&&H({},(function(e,n){mt(t,n,e)}))}function on(e,t,n){n=Math.min(e.i.length,n);const i=e.l?l(e.l.Ka,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let c=0;c<n;c++){var r=s[c].g;const n=s[c].map;if((r-=t)<0)t=Math.max(0,s[c].g-100),l=!1;else try{r="req"+r+"_"||0;try{var o=n instanceof Map?n:Object.entries(n);for(const[t,n]of o){let i=n;a(n)&&(i=ve(n)),e.push(r+t+"="+encodeURIComponent(i))}}catch(A){throw e.push(r+"type="+encodeURIComponent("_badmap")),A}}catch(A){i&&i(n)}}if(l){o=e.join("&");break e}}o=void 0}return e=e.i.splice(0,n),t.G=e,o}function ln(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;I||D(),P||(I(),P=!0),R.add(t,e),e.A=0}}function cn(e){return!(e.g||e.v||e.A>=3)&&(e.Y++,e.v=Me(l(e.Da,e),fn(e,e.A)),e.A++,!0)}function un(e){null!=e.B&&(r.clearTimeout(e.B),e.B=null)}function hn(e){e.g=new je(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=dt(e.na);mt(t,"RID","rpc"),mt(t,"SID",e.M),mt(t,"AID",e.K),mt(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&mt(t,"TO",e.ia),mt(t,"TYPE","xmlhttp"),an(e,t),e.u&&e.o&&jt(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=vt(dt(t)),n.u=null,n.R=!0,Ge(n,e)}function dn(e){null!=e.C&&(r.clearTimeout(e.C),e.C=null)}function pn(e,t){var n=null;if(e.g==t){dn(e),un(e),e.g=null;var i=2}else{if(!at(e.h,t))return;n=t.G,lt(e.h,t),i=1}if(0!=e.I)if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;ue(i=xe(),new De(i,n)),sn(e)}else ln(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&function(e,t){return!(rt(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.G.concat(e.i),!0):!(1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta))&&(e.m=Me(l(e.Ea,e,t),fn(e,e.D)),e.D++,!0))}(e,t)||2==i&&cn(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),s){case 1:gn(e,5);break;case 4:gn(e,10);break;case 3:gn(e,6);break;default:gn(e,2)}}function fn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function gn(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.bb,e),i=e.Ua;const t=!i;i=new ht(i||"//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||pt(i,"https"),vt(i),t?function(e,t){const n=new Ne;if(r.Image){const i=new Image;i.onload=c(Nt,n,"TestLoadImage: loaded",!0,t,i),i.onerror=c(Nt,n,"TestLoadImage: error",!1,t,i),i.onabort=c(Nt,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=c(Nt,n,"TestLoadImage: timeout",!1,t,i),r.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){new Ne;const n=new AbortController,i=setTimeout((()=>{n.abort(),Nt(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(i),e.ok?Nt(0,0,!0,t):Nt(0,0,!1,t)})).catch((()=>{clearTimeout(i),Nt(0,0,!1,t)}))}(i.toString(),n)}else Re(2);e.I=0,e.l&&e.l.pa(t),mn(e),nn(e)}function mn(e){if(e.I=0,e.ja=[],e.l){const t=ct(e.h);0==t.length&&0==e.i.length||(S(e.ja,t),S(e.ja,e.i),e.h.i.length=0,E(e.i),e.i.length=0),e.l.oa()}}function vn(e,t,n){var i=n instanceof ht?dt(n):new ht(n);if(""!=i.g)t&&(i.g=t+"."+i.g),ft(i,i.u);else{var s=r.location;i=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;const e=new ht(null);i&&pt(e,i),t&&(e.g=t),s&&ft(e,s),n&&(e.h=n),i=e}return n=e.G,t=e.wa,n&&t&&mt(i,n,t),mt(i,"VER",e.ka),an(e,i),i}function yn(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Ht(new Ot({ab:n})):new Ht(e.ma)).Fa(e.L),t}function bn(){}function wn(){}function _n(e,t){ce.call(this),this.g=new Zt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!F(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!F(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Sn(this)}function An(e){Ee.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function En(){Se.call(this),this.status=1}function Sn(e){this.g=e}(e=Ht.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Oe.g(),this.g.onreadystatechange=_(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(a){return void Wt(this,a)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!==typeof i.keys||"function"!==typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),s=r.FormData&&e instanceof r.FormData,!(Array.prototype.indexOf.call(qt,t,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,o]of n)this.g.setRequestHeader(r,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(a){Wt(this,a)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,ue(this,"complete"),ue(this,"abort"),Xt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xt(this,!0)),Ht.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Kt(this):this.Xa())},e.Xa=function(){Kt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Qt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ye(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Zt.prototype).ka=8,e.I=1,e.connect=function(e,t,n,i){Re(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.J=vn(this,null,this.W),sn(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const s=new je(this,this.j,e);let r=this.o;if(this.U&&(r?(r=$(r),W(r,this.U)):r=this.U),null!==this.u||this.R||(s.J=r,r=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"===typeof(i=i.map.__data__)?i.length:void 0))break;if((t+=i)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=on(this,s,t),mt(n=dt(this.J),"RID",e),mt(n,"CVER",22),this.G&&mt(n,"X-HTTP-Session-Id",this.G),an(this,n),r&&(this.R?t="headers="+Ve(Bt(r))+"&"+t:this.u&&jt(n,this.u,r)),ot(this.h,s),this.Ra&&mt(n,"TYPE","init"),this.S?(mt(n,"$req",t),mt(n,"SID","null"),s.U=!0,We(s,n,null)):We(s,n,t),this.I=2}}else 3==this.I&&(e?rn(this,e):0==this.i.length||st(this.h)||rn(this))},e.Da=function(){if(this.v=null,hn(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=Me(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Re(10),tn(this),hn(this))},e.Va=function(){null!=this.C&&(this.C=null,tn(this),cn(this),Re(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),Re(2)):(this.j.info("Failed to ping google.com"),Re(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=bn.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},wn.prototype.g=function(e,t){return new _n(e,t)},u(_n,ce),_n.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){en(this.g)},_n.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ve(e),e=n);t.i.push(new nt(t.Ya++,e)),3==t.I&&sn(t)},_n.prototype.N=function(){this.g.l=null,delete this.j,en(this.g),delete this.g,_n.Z.N.call(this)},u(An,Ee),u(En,Se),u(Sn,bn),Sn.prototype.ra=function(){ue(this.g,"a")},Sn.prototype.qa=function(e){ue(this.g,new An(e))},Sn.prototype.pa=function(e){ue(this.g,new En)},Sn.prototype.oa=function(){ue(this.g,"b")},wn.prototype.createWebChannel=wn.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,y=w.createWebChannelTransport=function(){return new wn},v=w.getStatEventTarget=function(){return xe()},m=w.Event=Ce,g=w.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Fe.NO_ERROR=0,Fe.TIMEOUT=8,Fe.HTTP_ERROR=6,f=w.ErrorCode=Fe,Ue.COMPLETE="complete",p=w.EventType=Ue,_e.EventType=Ae,Ae.OPEN="a",Ae.CLOSE="b",Ae.ERROR="c",Ae.MESSAGE="d",ce.prototype.listen=ce.prototype.J,d=w.WebChannel=_e,w.FetchXmlHttpFactory=Ot,Ht.prototype.listenOnce=Ht.prototype.K,Ht.prototype.getLastError=Ht.prototype.Ha,Ht.prototype.getLastErrorCode=Ht.prototype.ya,Ht.prototype.getStatus=Ht.prototype.ca,Ht.prototype.getResponseJson=Ht.prototype.La,Ht.prototype.getResponseText=Ht.prototype.la,Ht.prototype.send=Ht.prototype.ea,Ht.prototype.setWithCredentials=Ht.prototype.Fa,h=w.XhrIo=Ht}).apply("undefined"!==typeof b?b:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const _="@firebase/firestore",A="4.9.2";class E{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}E.UNAUTHENTICATED=new E(null),E.GOOGLE_CREDENTIALS=new E("google-credentials-uid"),E.FIRST_PARTY=new E("first-party-uid"),E.MOCK_USER=new E("mock-user");let S="12.3.0";const C=new o.Vy("@firebase/firestore");function T(){return C.logLevel}function x(e){if(C.logLevel<=o.$b.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(P);C.debug(`Firestore (${S}): ${e}`,...s)}}function k(e){if(C.logLevel<=o.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(P);C.error(`Firestore (${S}): ${e}`,...s)}}function I(e){if(C.logLevel<=o.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(P);C.warn(`Firestore (${S}): ${e}`,...s)}}function P(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function R(e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,D(e,i,n)}function D(e,t,n){let i=`FIRESTORE (${S}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(e){i+=" CONTEXT: "+n}throw k(i),new Error(i)}function M(e,t,n,i){let s="Unexpected state";"string"==typeof n?s=n:i=n,e||D(t,s,i)}function N(e,t){return e}const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends l.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class F{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class U{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class z{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(E.UNAUTHENTICATED)))}shutdown(){}}class V{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class B{constructor(e){this.t=e,this.currentUser=E.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){M(void 0===this.o,42304);let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new F;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new F,e.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await i(this.currentUser)}))},a=e=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),r())};this.t.onInit((e=>a(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new F)}}),0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(M("string"==typeof t.accessToken,31837,{l:t}),new U(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return M(null===e||"string"==typeof e,2055,{h:e}),new E(e)}}class j{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=E.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class H{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new j(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(E.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ${constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class q{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,r.xZ)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){M(void 0===this.o,3512);const n=e=>{null!=e.error&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,x("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const i=e=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((e=>i(e))),setTimeout((()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?i(e):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new $(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(M("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new $(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function W(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}class G{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=W(40);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function K(e,t){return e<t?-1:e>t?1:0}function X(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.charAt(i),s=t.charAt(i);if(n!==s)return J(n)===J(s)?K(n,s):J(n)?1:-1}return K(e.length,t.length)}const Q=55296,Y=57343;function J(e){const t=e.charCodeAt(0);return t>=Q&&t<=Y}function Z(e,t,n){return e.length===t.length&&e.every(((e,i)=>n(e,t[i])))}const ee="__name__";class te{constructor(e,t,n){void 0===t?t=0:t>e.length&&R(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&R(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===te.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof te?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=te.compareSegments(e.get(i),t.get(i));if(0!==n)return n}return K(e.length,t.length)}static compareSegments(e,t){const n=te.isNumericId(e),i=te.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?te.extractNumericId(e).compare(te.extractNumericId(t)):X(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return i.fromString(e.substring(4,e.length-2))}}class ne extends te{construct(e,t,n){return new ne(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n){if(s.indexOf("//")>=0)throw new O(L.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);e.push(...s.split("/").filter((e=>e.length>0)))}return new ne(e)}static emptyPath(){return new ne([])}}const ie=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class se extends te{construct(e,t,n){return new se(e,t,n)}static isValidIdentifier(e){return ie.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),se.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ee}static keyField(){return new se([ee])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new O(L.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let r=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new O(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new O(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(r=!r,i++):"."!==t||r?(n+=t,i++):(s(),i++)}if(s(),r)throw new O(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new se(t)}static emptyPath(){return new se([])}}class re{constructor(e){this.path=e}static fromPath(e){return new re(ne.fromString(e))}static fromName(e){return new re(ne.fromString(e).popFirst(5))}static empty(){return new re(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ne.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new re(new ne(e.slice()))}}function ae(e,t,n){if(!n)throw new O(L.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function oe(e){if(!re.isDocumentKey(e))throw new O(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function le(e){if(re.isDocumentKey(e))throw new O(L.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ce(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ue(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":R(12329,{type:typeof e})}function he(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new O(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ue(e);throw new O(L.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function de(e,t){if(t<=0)throw new O(L.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function pe(e,t){const n={typeString:e};return t&&(n.value=t),n}function fe(e,t){if(!ce(e))throw new O(L.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in t)if(t[i]){const s=t[i].typeString,r="value"in t[i]?{value:t[i].value}:void 0;if(!(i in e)){n=`JSON missing required field: '${i}'`;break}const a=e[i];if(s&&typeof a!==s){n=`JSON field '${i}' must be a ${s}.`;break}if(void 0!==r&&a!==r.value){n=`Expected '${i}' field to equal '${r.value}'`;break}}if(n)throw new O(L.INVALID_ARGUMENT,n);return!0}const ge=-62135596800,me=1e6;class ve{static now(){return ve.fromMillis(Date.now())}static fromDate(e){return ve.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*me);return new ve(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ge)throw new O(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/me}_compareTo(e){return this.seconds===e.seconds?K(this.nanoseconds,e.nanoseconds):K(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ve._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(fe(e,ve._jsonSchema))return new ve(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ge;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ve._jsonSchemaVersion="firestore/timestamp/1.0",ve._jsonSchema={type:pe("string",ve._jsonSchemaVersion),seconds:pe("number"),nanoseconds:pe("number")};class ye{static fromTimestamp(e){return new ye(e)}static min(){return new ye(new ve(0,0))}static max(){return new ye(new ve(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const be=-1;class we{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}we.UNKNOWN_ID=-1;function _e(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,s=ye.fromTimestamp(1e9===i?new ve(n+1,0):new ve(n,i));return new Ee(s,re.empty(),t)}function Ae(e){return new Ee(e.readTime,e.key,be)}class Ee{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ee(ye.min(),re.empty(),be)}static max(){return new Ee(ye.max(),re.empty(),be)}}function Se(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=re.comparator(e.documentKey,t.documentKey),0!==n?n:K(e.largestBatchId,t.largestBatchId))}const Ce="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Te{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function xe(e){if(e.code!==L.FAILED_PRECONDITION||e.message!==Ce)throw e;x("LocalStore","Unexpectedly lost primary lease")}class ke{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&R(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ke(((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ke?t:ke.resolve(t)}catch(e){return ke.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ke.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ke.reject(t)}static resolve(e){return new ke(((t,n)=>{t(e)}))}static reject(e){return new ke(((t,n)=>{n(e)}))}static waitFor(e){return new ke(((t,n)=>{let i=0,s=0,r=!1;e.forEach((e=>{++i,e.next((()=>{++s,r&&s===i&&t()}),(e=>n(e)))})),r=!0,s===i&&t()}))}static or(e){let t=ke.resolve(!1);for(const n of e)t=t.next((e=>e?ke.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,i)=>{n.push(t.call(this,e,i))})),this.waitFor(n)}static mapArray(e,t){return new ke(((n,i)=>{const s=e.length,r=new Array(s);let a=0;for(let o=0;o<s;o++){const l=o;t(e[l]).next((e=>{r[l]=e,++a,a===s&&n(r)}),(e=>i(e)))}}))}static doWhile(e,t){return new ke(((n,i)=>{const s=()=>{!0===e()?t().next((()=>{s()}),i):n()};s()}))}}function Ie(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Pe(e){return"IndexedDbTransactionError"===e.name}class Re{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Re.ce=-1;const De=-1;function Me(e){return null==e}function Ne(e){return 0===e&&1/e==-1/0}function Le(e){return"number"==typeof e&&Number.isInteger(e)&&!Ne(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Oe="\x01";function Fe(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=ze(t)),t=Ue(e.get(n),t);return ze(t)}function Ue(e,t){let n=t;const i=e.length;for(let s=0;s<i;s++){const t=e.charAt(s);switch(t){case"\0":n+="\x01\x10";break;case Oe:n+="\x01\x11";break;default:n+=t}}return n}function ze(e){return e+Oe+"\x01"}const Ve="remoteDocuments",Be="owner",je="mutationQueues",He="mutations";const $e="documentMutations",qe="remoteDocumentsV14",We="remoteDocumentGlobal",Ge="targets",Ke="targetDocuments",Xe="targetGlobal",Qe="collectionParents",Ye="clientMetadata",Je="bundles",Ze="namedQueries",et="indexConfiguration",tt="indexState",nt="indexEntries",it="documentOverlays",st="globals",rt=[je,He,$e,Ve,Ge,Be,Xe,Ke,Ye,We,Qe,Je,Ze],at=[je,He,$e,qe,Ge,Be,Xe,Ke,Ye,We,Qe,Je,Ze,it],ot=at,lt=[...ot,et,tt,nt];function ct(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ut(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ht(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class dt{constructor(e,t){this.comparator=e,this.root=t||ft.EMPTY}insert(e,t){return new dt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ft.BLACK,null,null))}remove(e){return new dt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ft.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pt(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pt(this.root,e,this.comparator,!1)}getReverseIterator(){return new pt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pt(this.root,e,this.comparator,!0)}}class pt{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ft{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:ft.RED,this.left=null!=i?i:ft.EMPTY,this.right=null!=s?s:ft.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new ft(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ft.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return ft.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ft.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ft.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw R(43730,{key:this.key,value:this.value});if(this.right.isRed())throw R(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw R(27949);return e+(this.isRed()?0:1)}}ft.EMPTY=null,ft.RED=!0,ft.BLACK=!1,ft.EMPTY=new class{constructor(){this.size=0}get key(){throw R(57766)}get value(){throw R(16141)}get color(){throw R(16727)}get left(){throw R(29726)}get right(){throw R(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new ft(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class gt{constructor(e){this.comparator=e,this.data=new dt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new mt(this.data.getIterator())}getIteratorFrom(e){return new mt(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof gt))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new gt(this.comparator);return t.data=e,t}}class mt{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class vt{constructor(e){this.fields=e,e.sort(se.comparator)}static empty(){return new vt([])}unionWith(e){let t=new gt(se.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new vt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Z(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class yt extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class bt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new yt("Invalid base64 string: "+e):e}}(e);return new bt(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new bt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return K(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}bt.EMPTY_BYTE_STRING=new bt("");const wt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _t(e){if(M(!!e,39018),"string"==typeof e){let t=0;const n=wt.exec(e);if(M(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:At(e.seconds),nanos:At(e.nanos)}}function At(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Et(e){return"string"==typeof e?bt.fromBase64String(e):bt.fromUint8Array(e)}const St="server_timestamp",Ct="__type__",Tt="__previous_value__",xt="__local_write_time__";function kt(e){const t=(e?.mapValue?.fields||{})[Ct]?.stringValue;return t===St}function It(e){const t=e.mapValue.fields[Tt];return kt(t)?It(t):t}function Pt(e){const t=_t(e.mapValue.fields[xt].timestampValue);return new ve(t.seconds,t.nanos)}class Rt{constructor(e,t,n,i,s,r,a,o,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c}}const Dt="(default)";class Mt{constructor(e,t){this.projectId=e,this.database=t||Dt}static empty(){return new Mt("","")}get isDefaultDatabase(){return this.database===Dt}isEqual(e){return e instanceof Mt&&e.projectId===this.projectId&&e.database===this.database}}const Nt="__type__",Lt="__max__",Ot={mapValue:{fields:{__type__:{stringValue:Lt}}}},Ft="__vector__",Ut="value";function zt(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?kt(e)?4:nn(e)?9007199254740991:en(e)?10:11:R(28295,{value:e})}function Vt(e,t){if(e===t)return!0;const n=zt(e);if(n!==zt(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Pt(e).isEqual(Pt(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=_t(e.timestampValue),i=_t(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Et(e.bytesValue).isEqual(Et(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return At(e.geoPointValue.latitude)===At(t.geoPointValue.latitude)&&At(e.geoPointValue.longitude)===At(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return At(e.integerValue)===At(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=At(e.doubleValue),i=At(t.doubleValue);return n===i?Ne(n)===Ne(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Z(e.arrayValue.values||[],t.arrayValue.values||[],Vt);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(ct(n)!==ct(i))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===i[s]||!Vt(n[s],i[s])))return!1;return!0}(e,t);default:return R(52216,{left:e})}}function Bt(e,t){return void 0!==(e.values||[]).find((e=>Vt(e,t)))}function jt(e,t){if(e===t)return 0;const n=zt(e),i=zt(t);if(n!==i)return K(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return K(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=At(e.integerValue||e.doubleValue),i=At(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return Ht(e.timestampValue,t.timestampValue);case 4:return Ht(Pt(e),Pt(t));case 5:return X(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Et(e),i=Et(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let s=0;s<n.length&&s<i.length;s++){const e=K(n[s],i[s]);if(0!==e)return e}return K(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=K(At(e.latitude),At(t.latitude));return 0!==n?n:K(At(e.longitude),At(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return $t(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},i=t.fields||{},s=n[Ut]?.arrayValue,r=i[Ut]?.arrayValue,a=K(s?.values?.length||0,r?.values?.length||0);return 0!==a?a:$t(s,r)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Ot.mapValue&&t===Ot.mapValue)return 0;if(e===Ot.mapValue)return 1;if(t===Ot.mapValue)return-1;const n=e.fields||{},i=Object.keys(n),s=t.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let a=0;a<i.length&&a<r.length;++a){const e=X(i[a],r[a]);if(0!==e)return e;const t=jt(n[i[a]],s[r[a]]);if(0!==t)return t}return K(i.length,r.length)}(e.mapValue,t.mapValue);default:throw R(23264,{he:n})}}function Ht(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return K(e,t);const n=_t(e),i=_t(t),s=K(n.seconds,i.seconds);return 0!==s?s:K(n.nanos,i.nanos)}function $t(e,t){const n=e.values||[],i=t.values||[];for(let s=0;s<n.length&&s<i.length;++s){const e=jt(n[s],i[s]);if(e)return e}return K(n.length,i.length)}function qt(e){return Wt(e)}function Wt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=_t(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Et(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return re.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=Wt(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const s of t)i?i=!1:n+=",",n+=`${s}:${Wt(e.fields[s])}`;return n+"}"}(e.mapValue):R(61005,{value:e})}function Gt(e){switch(zt(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=It(e);return t?16+Gt(t):16;case 5:return 2*e.stringValue.length;case 6:return Et(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+Gt(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return ut(e.fields,((e,n)=>{t+=e.length+Gt(n)})),t}(e.mapValue);default:throw R(13486,{value:e})}}function Kt(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Xt(e){return!!e&&"integerValue"in e}function Qt(e){return!!e&&"arrayValue"in e}function Yt(e){return!!e&&"nullValue"in e}function Jt(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Zt(e){return!!e&&"mapValue"in e}function en(e){const t=(e?.mapValue?.fields||{})[Nt]?.stringValue;return t===Ft}function tn(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return ut(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=tn(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=tn(e.arrayValue.values[n]);return t}return{...e}}function nn(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Lt}class sn{constructor(e){this.value=e}static empty(){return new sn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Zt(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=tn(t)}setAll(e){let t=se.emptyPath(),n={},i=[];e.forEach(((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=s.popLast()}e?n[s.lastSegment()]=tn(e):i.push(s.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Zt(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Vt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Zt(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){ut(t,((t,n)=>e[t]=n));for(const i of n)delete e[i]}clone(){return new sn(tn(this.value))}}function rn(e){const t=[];return ut(e.fields,((e,n)=>{const i=new se([e]);if(Zt(n)){const e=rn(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)})),new vt(t)}class an{constructor(e,t,n,i,s,r,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=a}static newInvalidDocument(e){return new an(e,0,ye.min(),ye.min(),ye.min(),sn.empty(),0)}static newFoundDocument(e,t,n,i){return new an(e,1,t,ye.min(),n,i,0)}static newNoDocument(e,t){return new an(e,2,t,ye.min(),ye.min(),sn.empty(),0)}static newUnknownDocument(e,t){return new an(e,3,t,ye.min(),ye.min(),sn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ye.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=sn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=sn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ye.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof an&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new an(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class on{constructor(e,t){this.position=e,this.inclusive=t}}function ln(e,t,n){let i=0;for(let s=0;s<e.position.length;s++){const r=t[s],a=e.position[s];if(i=r.field.isKeyField()?re.comparator(re.fromName(a.referenceValue),n.key):jt(a,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function cn(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Vt(e.position[n],t.position[n]))return!1;return!0}class un{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function hn(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class dn{}class pn extends dn{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new _n(e,t,n):"array-contains"===t?new Cn(e,n):"in"===t?new Tn(e,n):"not-in"===t?new xn(e,n):"array-contains-any"===t?new kn(e,n):new pn(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new An(e,n):new En(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(jt(t,this.value)):null!==t&&zt(this.value)===zt(t)&&this.matchesComparison(jt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return R(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class fn extends dn{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new fn(e,t)}matches(e){return gn(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function gn(e){return"and"===e.op}function mn(e){return vn(e)&&gn(e)}function vn(e){for(const t of e.filters)if(t instanceof fn)return!1;return!0}function yn(e){if(e instanceof pn)return e.field.canonicalString()+e.op.toString()+qt(e.value);if(mn(e))return e.filters.map((e=>yn(e))).join(",");{const t=e.filters.map((e=>yn(e))).join(",");return`${e.op}(${t})`}}function bn(e,t){return e instanceof pn?function(e,t){return t instanceof pn&&e.op===t.op&&e.field.isEqual(t.field)&&Vt(e.value,t.value)}(e,t):e instanceof fn?function(e,t){return t instanceof fn&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,i)=>e&&bn(n,t.filters[i])),!0)}(e,t):void R(19439)}function wn(e){return e instanceof pn?function(e){return`${e.field.canonicalString()} ${e.op} ${qt(e.value)}`}(e):e instanceof fn?function(e){return e.op.toString()+" {"+e.getFilters().map(wn).join(" ,")+"}"}(e):"Filter"}class _n extends pn{constructor(e,t,n){super(e,t,n),this.key=re.fromName(n.referenceValue)}matches(e){const t=re.comparator(e.key,this.key);return this.matchesComparison(t)}}class An extends pn{constructor(e,t){super(e,"in",t),this.keys=Sn("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class En extends pn{constructor(e,t){super(e,"not-in",t),this.keys=Sn("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Sn(e,t){return(t.arrayValue?.values||[]).map((e=>re.fromName(e.referenceValue)))}class Cn extends pn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qt(t)&&Bt(t.arrayValue,this.value)}}class Tn extends pn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Bt(this.value.arrayValue,t)}}class xn extends pn{constructor(e,t){super(e,"not-in",t)}matches(e){if(Bt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Bt(this.value.arrayValue,t)}}class kn extends pn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qt(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Bt(this.value.arrayValue,e)))}}class In{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=a,this.Te=null}}function Pn(e){return new In(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Rn(e){const t=N(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>yn(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Me(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>qt(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>qt(e))).join(",")),t.Te=e}return t.Te}function Dn(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!hn(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!bn(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!cn(e.startAt,t.startAt)&&cn(e.endAt,t.endAt)}function Mn(e){return re.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Nn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ln(e,t,n,i,s,r,a,o){return new Nn(e,t,n,i,s,r,a,o)}function On(e){return new Nn(e)}function Fn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Un(e){return null!==e.collectionGroup}function zn(e){const t=N(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const s of t.explicitOrderBy)t.Ie.push(s),e.add(s.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",i=function(e){let t=new gt(se.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);i.forEach((i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new un(i,n))})),e.has(se.keyField().canonicalString())||t.Ie.push(new un(se.keyField(),n))}return t.Ie}function Vn(e){const t=N(e);return t.Ee||(t.Ee=Bn(t,zn(e))),t.Ee}function Bn(e,t){if("F"===e.limitType)return Pn(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new un(e.field,t)}));const n=e.endAt?new on(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new on(e.startAt.position,e.startAt.inclusive):null;return Pn(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}function jn(e,t){const n=e.filters.concat([t]);return new Nn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Hn(e,t,n){return new Nn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function $n(e,t){return Dn(Vn(e),Vn(t))&&e.limitType===t.limitType}function qn(e){return`${Rn(Vn(e))}|lt:${e.limitType}`}function Wn(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>wn(e))).join(", ")}]`),Me(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>qt(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>qt(e))).join(",")),`Target(${t})`}(Vn(e))}; limitType=${e.limitType})`}function Gn(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):re.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of zn(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=ln(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,zn(e),t))&&!(e.endAt&&!function(e,t,n){const i=ln(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,zn(e),t))}(e,t)}function Kn(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Xn(e){return(t,n)=>{let i=!1;for(const s of zn(e)){const e=Qn(s,t,n);if(0!==e)return e;i=i||s.field.isKeyField()}return 0}}function Qn(e,t,n){const i=e.field.isKeyField()?re.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),s=n.data.field(e);return null!==i&&null!==s?jt(i,s):R(42886)}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return R(19790,{direction:e.dir})}}class Yn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ut(this.inner,((t,n)=>{for(const[i,s]of n)e(i,s)}))}isEmpty(){return ht(this.inner)}size(){return this.innerSize}}const Jn=new dt(re.comparator);function Zn(){return Jn}const ei=new dt(re.comparator);function ti(){let e=ei;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)e=e.insert(s.key,s);return e}function ni(e){let t=ei;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function ii(){return ri()}function si(){return ri()}function ri(){return new Yn((e=>e.toString()),((e,t)=>e.isEqual(t)))}const ai=new dt(re.comparator),oi=new gt(re.comparator);function li(){let e=oi;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)e=e.add(s);return e}const ci=new gt(K);function ui(){return ci}function hi(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ne(t)?"-0":t}}function di(e){return{integerValue:""+e}}function pi(e,t){return Le(t)?di(t):hi(e,t)}class fi{constructor(){this._=void 0}}function gi(e,t,n){return e instanceof yi?function(e,t){const n={fields:{[Ct]:{stringValue:St},[xt]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&kt(t)&&(t=It(t)),t&&(n.fields[Tt]=t),{mapValue:n}}(n,t):e instanceof bi?wi(e,t):e instanceof _i?Ai(e,t):function(e,t){const n=vi(e,t),i=Si(n)+Si(e.Ae);return Xt(n)&&Xt(e.Ae)?di(i):hi(e.serializer,i)}(e,t)}function mi(e,t,n){return e instanceof bi?wi(e,t):e instanceof _i?Ai(e,t):n}function vi(e,t){return e instanceof Ei?function(e){return Xt(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class yi extends fi{}class bi extends fi{constructor(e){super(),this.elements=e}}function wi(e,t){const n=Ci(t);for(const i of e.elements)n.some((e=>Vt(e,i)))||n.push(i);return{arrayValue:{values:n}}}class _i extends fi{constructor(e){super(),this.elements=e}}function Ai(e,t){let n=Ci(t);for(const i of e.elements)n=n.filter((e=>!Vt(e,i)));return{arrayValue:{values:n}}}class Ei extends fi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Si(e){return At(e.integerValue||e.doubleValue)}function Ci(e){return Qt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ti{constructor(e,t){this.field=e,this.transform=t}}class xi{constructor(e,t){this.version=e,this.transformResults=t}}class ki{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ki}static exists(e){return new ki(void 0,e)}static updateTime(e){return new ki(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ii(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Pi{}function Ri(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Bi(e.key,ki.none()):new Oi(e.key,e.data,ki.none());{const n=e.data,i=sn.empty();let s=new gt(se.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),s=s.add(e)}return new Fi(e.key,i,new vt(s.toArray()),ki.none())}}function Di(e,t,n){e instanceof Oi?function(e,t,n){const i=e.value.clone(),s=zi(e.fieldTransforms,t,n.transformResults);i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof Fi?function(e,t,n){if(!Ii(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=zi(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(Ui(e)),s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Mi(e,t,n,i){return e instanceof Oi?function(e,t,n,i){if(!Ii(e.precondition,t))return n;const s=e.value.clone(),r=Vi(e.fieldTransforms,i,t);return s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,i):e instanceof Fi?function(e,t,n,i){if(!Ii(e.precondition,t))return n;const s=Vi(e.fieldTransforms,i,t),r=t.data;return r.setAll(Ui(e)),r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,i):function(e,t,n){return Ii(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Ni(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),s=vi(i.transform,e||null);null!=s&&(null===n&&(n=sn.empty()),n.set(i.field,s))}return n||null}function Li(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Z(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof bi&&t instanceof bi||e instanceof _i&&t instanceof _i?Z(e.elements,t.elements,Vt):e instanceof Ei&&t instanceof Ei?Vt(e.Ae,t.Ae):e instanceof yi&&t instanceof yi}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Oi extends Pi{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Fi extends Pi{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ui(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}})),t}function zi(e,t,n){const i=new Map;M(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){const r=e[s],a=r.transform,o=t.data.field(r.field);i.set(r.field,mi(a,o,n[s]))}return i}function Vi(e,t,n){const i=new Map;for(const s of e){const e=s.transform,r=n.data.field(s.field);i.set(s.field,gi(e,r,t))}return i}class Bi extends Pi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ji extends Pi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Hi{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const t=this.mutations[i];t.key.isEqual(e.key)&&Di(t,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Mi(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Mi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=si();return this.mutations.forEach((i=>{const s=e.get(i.key),r=s.overlayedDocument;let a=this.applyToLocalView(r,s.mutatedFields);a=t.has(i.key)?null:a;const o=Ri(r,a);null!==o&&n.set(i.key,o),r.isValidDocument()||r.convertToNoDocument(ye.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),li())}isEqual(e){return this.batchId===e.batchId&&Z(this.mutations,e.mutations,((e,t)=>Li(e,t)))&&Z(this.baseMutations,e.baseMutations,((e,t)=>Li(e,t)))}}class $i{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){M(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=ai;const s=e.mutations;for(let r=0;r<s.length;r++)i=i.insert(s[r].key,n[r].version);return new $i(e,t,n,i)}}class qi{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Wi{constructor(e,t){this.count=e,this.unchangedNames=t}}var Gi,Ki;function Xi(e){switch(e){case L.OK:return R(64938);case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0;default:return R(15467,{code:e})}}function Qi(e){if(void 0===e)return k("GRPC error has no .code"),L.UNKNOWN;switch(e){case Gi.OK:return L.OK;case Gi.CANCELLED:return L.CANCELLED;case Gi.UNKNOWN:return L.UNKNOWN;case Gi.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case Gi.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case Gi.INTERNAL:return L.INTERNAL;case Gi.UNAVAILABLE:return L.UNAVAILABLE;case Gi.UNAUTHENTICATED:return L.UNAUTHENTICATED;case Gi.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case Gi.NOT_FOUND:return L.NOT_FOUND;case Gi.ALREADY_EXISTS:return L.ALREADY_EXISTS;case Gi.PERMISSION_DENIED:return L.PERMISSION_DENIED;case Gi.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case Gi.ABORTED:return L.ABORTED;case Gi.OUT_OF_RANGE:return L.OUT_OF_RANGE;case Gi.UNIMPLEMENTED:return L.UNIMPLEMENTED;case Gi.DATA_LOSS:return L.DATA_LOSS;default:return R(39323,{code:e})}}(Ki=Gi||(Gi={}))[Ki.OK=0]="OK",Ki[Ki.CANCELLED=1]="CANCELLED",Ki[Ki.UNKNOWN=2]="UNKNOWN",Ki[Ki.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ki[Ki.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ki[Ki.NOT_FOUND=5]="NOT_FOUND",Ki[Ki.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ki[Ki.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ki[Ki.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ki[Ki.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ki[Ki.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ki[Ki.ABORTED=10]="ABORTED",Ki[Ki.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ki[Ki.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ki[Ki.INTERNAL=13]="INTERNAL",Ki[Ki.UNAVAILABLE=14]="UNAVAILABLE",Ki[Ki.DATA_LOSS=15]="DATA_LOSS";let Yi=null;function Ji(){return new TextEncoder}const Zi=new i([4294967295,4294967295],0);function es(e){const t=Ji().encode(e),n=new s;return n.update(t),new Uint8Array(n.digest())}function ts(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),r=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new i([n,s],0),new i([r,a],0)]}class ns{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new is(`Invalid padding: ${t}`);if(n<0)throw new is(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new is(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new is(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=i.fromNumber(this.ge)}ye(e,t,n){let s=e.add(t.multiply(i.fromNumber(n)));return 1===s.compare(Zi)&&(s=new i([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=es(e),[n,i]=ts(t);for(let s=0;s<this.hashCount;s++){const e=this.ye(n,i,s);if(!this.we(e))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),r=new ns(s,i,t);return n.forEach((e=>r.insert(e))),r}insert(e){if(0===this.ge)return;const t=es(e),[n,i]=ts(t);for(let s=0;s<this.hashCount;s++){const e=this.ye(n,i,s);this.Se(e)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class is extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ss{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,rs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ss(ye.min(),i,new dt(K),Zn(),li())}}class rs{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new rs(n,t,li(),li(),li())}}class as{constructor(e,t,n,i){this.be=e,this.removedTargetIds=t,this.key=n,this.De=i}}class os{constructor(e,t){this.targetId=e,this.Ce=t}}class ls{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bt.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class cs{constructor(){this.ve=0,this.Fe=ds(),this.Me=bt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=li(),t=li(),n=li();return this.Fe.forEach(((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:R(38017,{changeType:s})}})),new rs(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=ds()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,M(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class us{constructor(e){this.Ge=e,this.ze=new Map,this.je=Zn(),this.Je=hs(),this.He=hs(),this.Ye=new dt(K)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:R(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((e,n)=>{this.rt(n)&&t(n)}))}st(e){const t=e.targetId,n=e.Ce.count,i=this.ot(t);if(i){const s=i.target;if(Mn(s))if(0===n){const e=new re(s.path);this.et(t,e,an.newNoDocument(e,ye.min()))}else M(1===n,20013,{expectedCount:n});else{const i=this._t(t);if(i!==n){const n=this.ut(e),s=n?this.ct(n,e,i):1;if(0!==s){this.it(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}Yi?.lt(function(e,t,n,i,s){const r={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},a=t.unchangedNames;return a&&(r.bloomFilter={applied:0===s,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>i?.mightContain(e)??!1}),r}(i,e.Ce,this.Ge.ht(),n,s))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let r,a;try{r=Et(n).toUint8Array()}catch(e){if(e instanceof yt)return I("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new ns(r,i,s)}catch(e){return I(e instanceof is?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.ge?null:a}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let i=0;return n.forEach((n=>{const s=this.Ge.ht(),r=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.mightContain(r)||(this.et(t,n,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((n,i)=>{const s=this.ot(i);if(s){if(n.current&&Mn(s.target)){const t=new re(s.target.path);this.It(t).has(i)||this.Et(i,t)||this.et(i,t,an.newNoDocument(t,e))}n.Be&&(t.set(i,n.ke()),n.qe())}}));let n=li();this.He.forEach(((e,t)=>{let i=!0;t.forEachWhile((e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)})),i&&(n=n.add(e))})),this.je.forEach(((t,n)=>n.setReadTime(e)));const i=new ss(e,t,this.Ye,this.je,n);return this.je=Zn(),this.Je=hs(),this.He=hs(),this.Ye=new dt(K),i}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new cs,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new gt(K),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new gt(K),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||x("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new cs),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function hs(){return new dt(re.comparator)}function ds(){return new dt(re.comparator)}const ps={asc:"ASCENDING",desc:"DESCENDING"},fs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gs={and:"AND",or:"OR"};class ms{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function vs(e,t){return e.useProto3Json||Me(t)?t:{value:t}}function ys(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function bs(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ws(e,t){return ys(e,t.toTimestamp())}function _s(e){return M(!!e,49232),ye.fromTimestamp(function(e){const t=_t(e);return new ve(t.seconds,t.nanos)}(e))}function As(e,t){return Es(e,t).canonicalString()}function Es(e,t){const n=function(e){return new ne(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Ss(e){const t=ne.fromString(e);return M($s(t),10190,{key:t.toString()}),t}function Cs(e,t){return As(e.databaseId,t.path)}function Ts(e,t){const n=Ss(t);if(n.get(1)!==e.databaseId.projectId)throw new O(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new O(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new re(Ps(n))}function xs(e,t){return As(e.databaseId,t)}function ks(e){const t=Ss(e);return 4===t.length?ne.emptyPath():Ps(t)}function Is(e){return new ne(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ps(e){return M(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Rs(e,t,n){return{name:Cs(e,t),fields:n.value.mapValue.fields}}function Ds(e,t){let n;if(t instanceof Oi)n={update:Rs(e,t.key,t.value)};else if(t instanceof Bi)n={delete:Cs(e,t.key)};else if(t instanceof Fi)n={update:Rs(e,t.key,t.data),updateMask:Hs(t.fieldMask)};else{if(!(t instanceof ji))return R(16599,{Vt:t.type});n={verify:Cs(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof yi)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof bi)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof _i)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ei)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw R(20930,{transform:t.transform})}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:ws(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:R(27497)}(e,t.precondition)),n}function Ms(e,t){return{documents:[xs(e,t.path)]}}function Ns(e,t){const n={structuredQuery:{}},i=t.path;let s;null!==t.collectionGroup?(s=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=xs(e,s);const r=function(e){if(0!==e.length)return js(fn.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const a=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Vs(e.field),direction:Fs(e.dir)}}(e)))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=vs(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:s}}function Ls(e){let t=ks(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){M(1===i,65062);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=Os(e);return t instanceof fn&&mn(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map((e=>function(e){return new un(Bs(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,Me(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new on(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new on(n,t)}(n.endAt)),Ln(t,s,a,r,o,"F",l,c)}function Os(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Bs(e.unaryFilter.field);return pn.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Bs(e.unaryFilter.field);return pn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Bs(e.unaryFilter.field);return pn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Bs(e.unaryFilter.field);return pn.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return R(61313);default:return R(60726)}}(e):void 0!==e.fieldFilter?function(e){return pn.create(Bs(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return R(58110);default:return R(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return fn.create(e.compositeFilter.filters.map((e=>Os(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return R(1026)}}(e.compositeFilter.op))}(e):R(30097,{filter:e})}function Fs(e){return ps[e]}function Us(e){return fs[e]}function zs(e){return gs[e]}function Vs(e){return{fieldPath:e.canonicalString()}}function Bs(e){return se.fromServerFormat(e.fieldPath)}function js(e){return e instanceof pn?function(e){if("=="===e.op){if(Jt(e.value))return{unaryFilter:{field:Vs(e.field),op:"IS_NAN"}};if(Yt(e.value))return{unaryFilter:{field:Vs(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Jt(e.value))return{unaryFilter:{field:Vs(e.field),op:"IS_NOT_NAN"}};if(Yt(e.value))return{unaryFilter:{field:Vs(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vs(e.field),op:Us(e.op),value:e.value}}}(e):e instanceof fn?function(e){const t=e.getFilters().map((e=>js(e)));return 1===t.length?t[0]:{compositeFilter:{op:zs(e.op),filters:t}}}(e):R(54877,{filter:e})}function Hs(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function $s(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class qs{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ye.min(),r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ye.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:bt.EMPTY_BYTE_STRING,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new qs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new qs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new qs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new qs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ws{constructor(e){this.yt=e}}function Gs(e){const t=Ls({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Hn(t,t.limit,"L"):t}class Ks{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(At(e.integerValue));else if("doubleValue"in e){const n=At(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Ne(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=_t(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Et(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?nn(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):en(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):R(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const i of Object.keys(n))this.Ot(i,t),this.Ct(n[i],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const i=Ut,s=n[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(At(s)),this.Ot(i,t),this.Ct(n[i],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const i of n)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),re.fromName(e).path.forEach((e=>{this.Ft(t,60),this.Ut(e,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Ks.Kt=new Ks;class Xs{constructor(){this.Cn=new Qs}addToCollectionParentIndex(e,t){return this.Cn.add(t),ke.resolve()}getCollectionParents(e,t){return ke.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ke.resolve()}deleteFieldIndex(e,t){return ke.resolve()}deleteAllFieldIndexes(e){return ke.resolve()}createTargetIndexes(e,t){return ke.resolve()}getDocumentsMatchingTarget(e,t){return ke.resolve(null)}getIndexType(e,t){return ke.resolve(0)}getFieldIndexes(e,t){return ke.resolve([])}getNextCollectionGroupToUpdate(e){return ke.resolve(null)}getMinOffset(e,t){return ke.resolve(Ee.min())}getMinOffsetFromCollectionGroup(e,t){return ke.resolve(Ee.min())}updateCollectionGroup(e,t,n){return ke.resolve()}updateIndexEntries(e,t){return ke.resolve()}}class Qs{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new gt(ne.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new gt(ne.comparator)).toArray()}}new Uint8Array(0);const Ys={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Js=41943040;class Zs{static withCacheSize(e){return new Zs(e,Zs.DEFAULT_COLLECTION_PERCENTILE,Zs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Zs.DEFAULT_COLLECTION_PERCENTILE=10,Zs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zs.DEFAULT=new Zs(Js,Zs.DEFAULT_COLLECTION_PERCENTILE,Zs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zs.DISABLED=new Zs(-1,0,0);class er{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new er(0)}static cr(){return new er(-1)}}const tr="LruGarbageCollector",nr=1048576;function ir(e,t){let[n,i]=e,[s,r]=t;const a=K(n,s);return 0===a?K(i,r):a}class sr{constructor(e){this.Ir=e,this.buffer=new gt(ir),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();ir(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class rr{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){x(tr,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Pe(e)?x(tr,"Ignoring IndexedDB error during garbage collection: ",e):await xe(e)}await this.Vr(3e5)}))}}class ar{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return ke.resolve(Re.ce);const n=new sr(t);return this.mr.forEachTarget(e,(e=>n.Ar(e.sequenceNumber))).next((()=>this.mr.pr(e,(e=>n.Ar(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector","Garbage collection skipped; disabled"),ke.resolve(Ys)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ys):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,s,r,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,r=Date.now(),this.nthSequenceNumber(e,i)))).next((i=>(n=i,a=Date.now(),this.removeTargets(e,n,t)))).next((t=>(s=t,l=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),T()<=o.$b.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-u}ms\n\tDetermined least recently used ${i} in `+(a-r)+"ms\n"+`\tRemoved ${s} targets in `+(l-a)+"ms\n"+`\tRemoved ${e} documents in `+(c-l)+"ms\n"+`Total Duration: ${c-u}ms`),ke.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e}))))}}function or(e,t){return new ar(e,t)}class lr{constructor(){this.changes=new Yn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,an.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ke.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class cr{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ur{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(n=i,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Mi(n.mutation,e,vt.empty(),ve.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,li()).next((()=>t))))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:li();const i=ii();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,n).next((e=>{let t=ti();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=ii();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,li())))}populateOverlays(e,t,n){const i=[];return n.forEach((e=>{t.has(e)||i.push(e)})),this.documentOverlayCache.getOverlays(e,i).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,i){let s=Zn();const r=ri(),a=ri();return t.forEach(((e,t)=>{const a=n.get(t.key);i.has(t.key)&&(void 0===a||a.mutation instanceof Fi)?s=s.insert(t.key,t):void 0!==a?(r.set(t.key,a.mutation.getFieldMask()),Mi(a.mutation,t,a.mutation.getFieldMask(),ve.now())):r.set(t.key,vt.empty())})),this.recalculateAndSaveOverlays(e,s).next((e=>(e.forEach(((e,t)=>r.set(e,t))),t.forEach(((e,t)=>a.set(e,new cr(t,r.get(e)??null)))),a)))}recalculateAndSaveOverlays(e,t){const n=ri();let i=new dt(((e,t)=>e-t)),s=li();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const s of e)s.keys().forEach((e=>{const r=t.get(e);if(null===r)return;let a=n.get(e)||vt.empty();a=s.applyToLocalView(r,a),n.set(e,a);const o=(i.get(s.batchId)||li()).add(e);i=i.insert(s.batchId,o)}))})).next((()=>{const r=[],a=i.getReverseIterator();for(;a.hasNext();){const i=a.getNext(),o=i.key,l=i.value,c=si();l.forEach((e=>{if(!s.has(e)){const i=Ri(t.get(e),n.get(e));null!==i&&c.set(e,i),s=s.add(e)}})),r.push(this.documentOverlayCache.saveOverlays(e,o,c))}return ke.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,i){return function(e){return re.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Un(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next((s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):ke.resolve(ii());let a=be,o=s;return r.next((t=>ke.forEach(t,((t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),s.get(t)?ke.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{o=o.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,s))).next((()=>this.computeViews(e,o,t,li()))).next((e=>({batchId:a,changes:ni(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new re(t)).next((e=>{let t=ti();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let r=ti();return this.indexManager.getCollectionParents(e,s).next((a=>ke.forEach(a,(a=>{const o=function(e,t){return new Nn(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(s));return this.getDocumentsMatchingCollectionQuery(e,o,n,i).next((e=>{e.forEach(((e,t)=>{r=r.insert(e,t)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i)))).next((e=>{s.forEach(((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,an.newInvalidDocument(i)))}));let n=ti();return e.forEach(((e,i)=>{const r=s.get(e);void 0!==r&&Mi(r.mutation,i,vt.empty(),ve.now()),Gn(t,i)&&(n=n.insert(e,i))})),n}))}}class hr{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ke.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:_s(e.createTime)}}(t)),ke.resolve()}getNamedQuery(e,t){return ke.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(e){return{name:e.name,query:Gs(e.bundledQuery),readTime:_s(e.readTime)}}(t)),ke.resolve()}}class dr{constructor(){this.overlays=new dt(re.comparator),this.qr=new Map}getOverlay(e,t){return ke.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ii();return ke.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,i)=>{this.St(e,t,i)})),ke.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.qr.get(n);return void 0!==i&&(i.forEach((e=>this.overlays=this.overlays.remove(e))),this.qr.delete(n)),ke.resolve()}getOverlaysForCollection(e,t,n){const i=ii(),s=t.length+1,r=new re(t.child("")),a=this.overlays.getIteratorFrom(r);for(;a.hasNext();){const e=a.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return ke.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new dt(((e,t)=>e-t));const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=ii(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=ii(),o=s.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((e,t)=>a.set(e,t))),!(a.size()>=i)););return ke.resolve(a)}St(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new qi(t,n));let s=this.qr.get(t);void 0===s&&(s=li(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}}class pr{constructor(){this.sessionToken=bt.EMPTY_BYTE_STRING}getSessionToken(e){return ke.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ke.resolve()}}class fr{constructor(){this.Qr=new gt(gr.$r),this.Ur=new gt(gr.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new gr(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Gr(new gr(e,t))}zr(e,t){e.forEach((e=>this.removeReference(e,t)))}jr(e){const t=new re(new ne([])),n=new gr(t,e),i=new gr(t,e+1),s=[];return this.Ur.forEachInRange([n,i],(e=>{this.Gr(e),s.push(e.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new re(new ne([])),n=new gr(t,e),i=new gr(t,e+1);let s=li();return this.Ur.forEachInRange([n,i],(e=>{s=s.add(e.key)})),s}containsKey(e){const t=new gr(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class gr{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return re.comparator(e.key,t.key)||K(e.Yr,t.Yr)}static Kr(e,t){return K(e.Yr,t.Yr)||re.comparator(e.key,t.key)}}class mr{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new gt(gr.$r)}checkEmpty(e){return ke.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Hi(s,t,n,i);this.mutationQueue.push(r);for(const a of i)this.Zr=this.Zr.add(new gr(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return ke.resolve(r)}lookupMutationBatch(e,t){return ke.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.ei(n),s=i<0?0:i;return ke.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ke.resolve(0===this.mutationQueue.length?De:this.tr-1)}getAllMutationBatches(e){return ke.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new gr(t,0),i=new gr(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,i],(e=>{const t=this.Xr(e.Yr);s.push(t)})),ke.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new gt(K);return t.forEach((e=>{const t=new gr(e,0),i=new gr(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,i],(e=>{n=n.add(e.Yr)}))})),ke.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;re.isDocumentKey(s)||(s=s.child(""));const r=new gr(new re(s),0);let a=new gt(K);return this.Zr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(a=a.add(e.Yr)),!0)}),r),ke.resolve(this.ti(a))}ti(e){const t=[];return e.forEach((e=>{const n=this.Xr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){M(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return ke.forEach(t.mutations,(i=>{const s=new gr(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new gr(t,0),i=this.Zr.firstAfterOrEqual(n);return ke.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ke.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class vr{constructor(e){this.ri=e,this.docs=new dt(re.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,r=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ke.resolve(n?n.document.mutableCopy():an.newInvalidDocument(t))}getEntries(e,t){let n=Zn();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():an.newInvalidDocument(e))})),ke.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Zn();const r=t.path,a=new re(r.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||Se(Ae(a),n)<=0||(i.has(a.key)||Gn(t,a))&&(s=s.insert(a.key,a.mutableCopy()))}return ke.resolve(s)}getAllFromCollectionGroup(e,t,n,i){R(9500)}ii(e,t){return ke.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new yr(this)}getSize(e){return ke.resolve(this.size)}}class yr extends lr{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)})),ke.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class br{constructor(e){this.persistence=e,this.si=new Yn((e=>Rn(e)),Dn),this.lastRemoteSnapshotVersion=ye.min(),this.highestTargetId=0,this.oi=0,this._i=new fr,this.targetCount=0,this.ai=er.ur()}forEachTarget(e,t){return this.si.forEach(((e,n)=>t(n))),ke.resolve()}getLastRemoteSnapshotVersion(e){return ke.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ke.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ke.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),ke.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new er(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ke.resolve()}updateTargetData(e,t){return this.Pr(t),ke.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ke.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.si.forEach(((r,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.si.delete(r),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)})),ke.waitFor(s).next((()=>i))}getTargetCount(e){return ke.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return ke.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),ke.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((t=>{s.push(i.markPotentiallyOrphaned(e,t))})),ke.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ke.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return ke.resolve(n)}containsKey(e,t){return ke.resolve(this._i.containsKey(t))}}class wr{constructor(e,t){this.ui={},this.overlays={},this.ci=new Re(0),this.li=!1,this.li=!0,this.hi=new pr,this.referenceDelegate=e(this),this.Pi=new br(this),this.indexManager=new Xs,this.remoteDocumentCache=function(e){return new vr(e)}((e=>this.referenceDelegate.Ti(e))),this.serializer=new Ws(t),this.Ii=new hr(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dr,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new mr(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){x("MemoryPersistence","Starting transaction:",e);const i=new _r(this.ci.next());return this.referenceDelegate.Ei(),n(i).next((e=>this.referenceDelegate.di(i).next((()=>e)))).toPromise().then((e=>(i.raiseOnCommittedEvent(),e)))}Ai(e,t){return ke.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class _r extends Te{constructor(e){super(),this.currentSequenceNumber=e}}class Ar{constructor(e){this.persistence=e,this.Ri=new fr,this.Vi=null}static mi(e){return new Ar(e)}get fi(){if(this.Vi)return this.Vi;throw R(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),ke.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),ke.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ke.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((e=>this.fi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.fi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ke.forEach(this.fi,(n=>{const i=re.fromPath(n);return this.gi(e,i).next((e=>{e||t.removeEntry(i,ye.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return ke.or([()=>ke.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Er{constructor(e,t){this.persistence=e,this.pi=new Yn((e=>Fe(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=or(this,t)}static mi(e,t){return new Er(e,t)}Ei(){}di(e){return ke.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}wr(e){let t=0;return this.pr(e,(e=>{t++})).next((()=>t))}pr(e,t){return ke.forEach(this.pi,((n,i)=>this.br(e,n,i).next((e=>e?ke.resolve():t(i)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,(i=>this.br(e,i,t).next((e=>{e||(n++,s.removeEntry(i,ye.min()))})))).next((()=>s.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ke.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ke.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Gt(e.data.value)),t}br(e,t,n){return ke.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return ke.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Sr{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=li(),i=li();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Sr(e,t.fromCache,n,i)}}class Cr{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Tr{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(0,l.nr)()?8:Ie((0,l.ZQ)())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ys(e,t).next((e=>{s.result=e})).next((()=>{if(!s.result)return this.ws(e,t,i,n).next((e=>{s.result=e}))})).next((()=>{if(s.result)return;const n=new Cr;return this.Ss(e,t,n).next((i=>{if(s.result=i,this.Vs)return this.bs(e,t,n,i.size)}))})).next((()=>s.result))}bs(e,t,n,i){return n.documentReadCount<this.fs?(T()<=o.$b.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",Wn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ke.resolve()):(T()<=o.$b.DEBUG&&x("QueryEngine","Query:",Wn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(T()<=o.$b.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",Wn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Vn(t))):ke.resolve())}ys(e,t){if(Fn(t))return ke.resolve(null);let n=Vn(t);return this.indexManager.getIndexType(e,n).next((i=>0===i?null:(null!==t.limit&&1===i&&(t=Hn(t,null,"F"),n=Vn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((i=>{const s=li(...i);return this.ps.getDocuments(e,s).next((i=>this.indexManager.getMinOffset(e,n).next((n=>{const r=this.Ds(t,i);return this.Cs(t,r,s,n.readTime)?this.ys(e,Hn(t,null,"F")):this.vs(e,r,t,n)}))))})))))}ws(e,t,n,i){return Fn(t)||i.isEqual(ye.min())?ke.resolve(null):this.ps.getDocuments(e,n).next((s=>{const r=this.Ds(t,s);return this.Cs(t,r,n,i)?ke.resolve(null):(T()<=o.$b.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Wn(t)),this.vs(e,r,t,_e(i,be)).next((e=>e)))}))}Ds(e,t){let n=new gt(Xn(e));return t.forEach(((t,i)=>{Gn(e,i)&&(n=n.add(i))})),n}Cs(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,n){return T()<=o.$b.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",Wn(t)),this.ps.getDocumentsMatchingQuery(e,t,Ee.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const xr="LocalStore",kr=3e8;class Ir{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new dt(K),this.xs=new Yn((e=>Rn(e)),Dn),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ur(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function Pr(e,t,n,i){return new Ir(e,t,n,i)}async function Rr(e,t){const n=N(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next((s=>(i=s,n.Bs(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const s=[],r=[];let a=li();for(const e of i){s.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next((e=>({Ls:e,removedBatchIds:s,addedBatchIds:r})))}))}))}function Dr(e){const t=N(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function Mr(e,t,n){let i=li(),s=li();return n.forEach((e=>i=i.add(e))),t.getEntries(e,i).next((e=>{let i=Zn();return n.forEach(((n,r)=>{const a=e.get(n);r.isFoundDocument()!==a.isFoundDocument()&&(s=s.add(n)),r.isNoDocument()&&r.version.isEqual(ye.min())?(t.removeEntry(n,r.readTime),i=i.insert(n,r)):!a.isValidDocument()||r.version.compareTo(a.version)>0||0===r.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(r),i=i.insert(n,r)):x(xr,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",r.version)})),{ks:i,qs:s}}))}function Nr(e,t){const n=N(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=De),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Lr(e,t){const n=N(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let i;return n.Pi.getTargetData(e,t).next((s=>s?(i=s,ke.resolve(i)):n.Pi.allocateTargetId(e).next((s=>(i=new qs(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,i).next((()=>i)))))))})).then((e=>{const i=n.Ms.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e}))}async function Or(e,t,n){const i=N(e),s=i.Ms.get(t),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,(e=>i.persistence.referenceDelegate.removeTarget(e,s)))}catch(e){if(!Pe(e))throw e;x(xr,`Failed to update sequence numbers for target ${t}: ${e}`)}i.Ms=i.Ms.remove(t),i.xs.delete(s.target)}function Fr(e,t,n){const i=N(e);let s=ye.min(),r=li();return i.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const i=N(e),s=i.xs.get(n);return void 0!==s?ke.resolve(i.Ms.get(s)):i.Pi.getTargetData(t,n)}(i,e,Vn(t)).next((t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(e,t.targetId).next((e=>{r=e}))})).next((()=>i.Fs.getDocumentsMatchingQuery(e,t,n?s:ye.min(),n?r:li()))).next((e=>(Ur(i,Kn(t),e),{documents:e,Qs:r})))))}function Ur(e,t,n){let i=e.Os.get(t)||ye.min();n.forEach(((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)})),e.Os.set(t,i)}class zr{constructor(){this.activeTargetIds=ui()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Vr{constructor(){this.Mo=new zr,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new zr,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Br{Oo(e){}shutdown(){}}const jr="ConnectivityMonitor";class Hr{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){x(jr,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){x(jr,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let $r=null;function qr(){return null===$r?$r=268435456+Math.round(2147483648*Math.random()):$r++,"0x"+$r.toString(16)}const Wr="RestConnection",Gr={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Kr{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===Dt?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,s){const r=qr(),a=this.zo(e,t.toUriEncodedString());x(Wr,`Sending RPC '${e}' ${r}:`,a,n);const o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,i,s);const{host:c}=new URL(a),u=(0,l.zJ)(c);return this.Jo(e,a,o,n,u).then((t=>(x(Wr,`Received RPC '${e}' ${r}: `,t),t)),(t=>{throw I(Wr,`RPC '${e}' ${r} failed with error: `,t,"url: ",a,"request:",n),t}))}Ho(e,t,n,i,s,r){return this.Go(e,t,n,i,s)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+S,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}zo(e,t){const n=Gr[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class Xr{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Qr="WebChannelConnection";class Yr extends Kr{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,s){const r=qr();return new Promise(((s,a)=>{const o=new h;o.setWithCredentials(!0),o.listenOnce(p.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case f.NO_ERROR:const t=o.getResponseJson();x(Qr,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),s(t);break;case f.TIMEOUT:x(Qr,`RPC '${e}' ${r} timed out`),a(new O(L.DEADLINE_EXCEEDED,"Request time out"));break;case f.HTTP_ERROR:const n=o.getStatus();if(x(Qr,`RPC '${e}' ${r} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(t)>=0?t:L.UNKNOWN}(t.status);a(new O(e,t.message))}else a(new O(L.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new O(L.UNAVAILABLE,"Connection failed."));break;default:R(9055,{l_:e,streamId:r,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{x(Qr,`RPC '${e}' ${r} completed.`)}}));const l=JSON.stringify(i);x(Qr,`RPC '${e}' ${r} sending request:`,i),o.send(t,"POST",l,n,15)}))}T_(e,t,n){const i=qr(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=y(),a=v(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const c=s.join("");x(Qr,`Creating RPC '${e}' stream ${i}: ${c}`,o);const u=r.createWebChannel(c,o);this.I_(u);let h=!1,p=!1;const f=new Xr({Yo:t=>{p?x(Qr,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(h||(x(Qr,`Opening RPC '${e}' stream ${i} transport.`),u.open(),h=!0),x(Qr,`RPC '${e}' stream ${i} sending:`,t),u.send(t))},Zo:()=>u.close()}),b=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return b(u,d.EventType.OPEN,(()=>{p||(x(Qr,`RPC '${e}' stream ${i} transport opened.`),f.o_())})),b(u,d.EventType.CLOSE,(()=>{p||(p=!0,x(Qr,`RPC '${e}' stream ${i} transport closed`),f.a_(),this.E_(u))})),b(u,d.EventType.ERROR,(t=>{p||(p=!0,I(Qr,`RPC '${e}' stream ${i} transport errored. Name:`,t.name,"Message:",t.message),f.a_(new O(L.UNAVAILABLE,"The operation could not be completed")))})),b(u,d.EventType.MESSAGE,(t=>{if(!p){const n=t.data[0];M(!!n,16349);const s=n,r=s?.error||s[0]?.error;if(r){x(Qr,`RPC '${e}' stream ${i} received error:`,r);const t=r.status;let n=function(e){const t=Gi[e];if(void 0!==t)return Qi(t)}(t),s=r.message;void 0===n&&(n=L.INTERNAL,s="Unknown error status: "+t+" with message "+r.message),p=!0,f.a_(new O(n,s)),u.close()}else x(Qr,`RPC '${e}' stream ${i} received:`,n),f.u_(n)}})),b(a,m.STAT_EVENT,(t=>{t.stat===g.PROXY?x(Qr,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===g.NOPROXY&&x(Qr,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.__()}),0),f}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Jr(){return"undefined"!=typeof document?document:null}function Zr(e){return new ms(e,!0)}class ea{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&x("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const ta="PersistentStream";class na{constructor(e,t,n,i,s,r,a,o){this.Mi=e,this.S_=n,this.b_=i,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ea(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===L.RESOURCE_EXHAUSTED?(k(t.toString()),k("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===L.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((e=>{let[n,i]=e;this.D_===t&&this.G_(n,i)}),(t=>{e((()=>{const e=new O(L.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((e=>{n((()=>this.z_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.F_?this.J_(e):this.onNext(e)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return x(ta,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(x(ta,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ia extends na{constructor(e,t,n,i,s,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:R(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],r=function(e,t){return e.useProto3Json?(M(void 0===t||"string"==typeof t,58123),bt.fromBase64String(t||"")):(M(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),bt.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?L.UNKNOWN:Qi(e.code);return new O(t,e.message||"")}(a);n=new ls(i,s,r,o||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const s=Ts(e,i.document.name),r=_s(i.document.updateTime),a=i.document.createTime?_s(i.document.createTime):ye.min(),o=new sn({mapValue:{fields:i.document.fields}}),l=an.newFoundDocument(s,r,a,o),c=i.targetIds||[],u=i.removedTargetIds||[];n=new as(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const s=Ts(e,i.document),r=i.readTime?_s(i.readTime):ye.min(),a=an.newNoDocument(s,r),o=i.removedTargetIds||[];n=new as([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const s=Ts(e,i.document),r=i.removedTargetIds||[];n=new as([],r,s,null)}else{if(!("filter"in t))return R(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:i=0,unchangedNames:s}=e,r=new Wi(i,s),a=e.targetId;n=new os(a,r)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ye.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ye.min():t.readTime?_s(t.readTime):ye.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=Is(this.serializer),t.addTarget=function(e,t){let n;const i=t.target;if(n=Mn(i)?{documents:Ms(e,i)}:{query:Ns(e,i).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=bs(e,t.resumeToken);const i=vs(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(ye.min())>0){n.readTime=ys(e,t.snapshotVersion.toTimestamp());const i=vs(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return R(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=Is(this.serializer),t.removeTarget=e,this.q_(t)}}class sa extends na{constructor(e,t,n,i,s,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return M(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,M(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){M(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(M(void 0!==t,14353),e.map((e=>function(e,t){let n=e.updateTime?_s(e.updateTime):_s(t);return n.isEqual(ye.min())&&(n=_s(t)),new xi(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=_s(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Is(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Ds(this.serializer,e)))};this.q_(t)}}class ra{}class aa extends ra{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new O(L.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((s=>{let[r,a]=s;return this.connection.Go(e,Es(t,n),i,r,a)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new O(L.UNKNOWN,e.toString())}))}Ho(e,t,n,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((r=>{let[a,o]=r;return this.connection.Ho(e,Es(t,n),i,a,o,s)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new O(L.UNKNOWN,e.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class oa{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(k(t),this.aa=!1):x("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const la="RemoteStore";class ca{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((e=>{n.enqueueAndForget((async()=>{ya(this)&&(x(la,"Restarting streams for network reachability change."),await async function(e){const t=N(e);t.Ea.add(4),await ha(t),t.Ra.set("Unknown"),t.Ea.delete(4),await ua(t)}(this))}))})),this.Ra=new oa(n,i)}}async function ua(e){if(ya(e))for(const t of e.da)await t(!0)}async function ha(e){for(const t of e.da)await t(!1)}function da(e,t){const n=N(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),va(n)?ma(n):Fa(n).O_()&&fa(n,t))}function pa(e,t){const n=N(e),i=Fa(n);n.Ia.delete(t),i.O_()&&ga(n,t),0===n.Ia.size&&(i.O_()?i.L_():ya(n)&&n.Ra.set("Unknown"))}function fa(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ye.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Fa(e).Y_(t)}function ga(e,t){e.Va.Ue(t),Fa(e).Z_(t)}function ma(e){e.Va=new us({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),Fa(e).start(),e.Ra.ua()}function va(e){return ya(e)&&!Fa(e).x_()&&e.Ia.size>0}function ya(e){return 0===N(e).Ea.size}function ba(e){e.Va=void 0}async function wa(e){e.Ra.set("Online")}async function _a(e){e.Ia.forEach(((t,n)=>{fa(e,t)}))}async function Aa(e,t){ba(e),va(e)?(e.Ra.ha(t),ma(e)):e.Ra.set("Unknown")}async function Ea(e,t,n){if(e.Ra.set("Online"),t instanceof ls&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.Ia.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.Ia.delete(i),e.Va.removeTarget(i))}(e,t)}catch(n){x(la,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Sa(e,n)}else if(t instanceof as?e.Va.Ze(t):t instanceof os?e.Va.st(t):e.Va.tt(t),!n.isEqual(ye.min()))try{const t=await Dr(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.Ia.get(i);s&&e.Ia.set(i,s.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const i=e.Ia.get(t);if(!i)return;e.Ia.set(t,i.withResumeToken(bt.EMPTY_BYTE_STRING,i.snapshotVersion)),ga(e,t);const s=new qs(i.target,t,n,i.sequenceNumber);fa(e,s)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){x(la,"Failed to raise snapshot:",t),await Sa(e,t)}}async function Sa(e,t,n){if(!Pe(t))throw t;e.Ea.add(1),await ha(e),e.Ra.set("Offline"),n||(n=()=>Dr(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{x(la,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await ua(e)}))}function Ca(e,t){return t().catch((n=>Sa(e,n,t)))}async function Ta(e){const t=N(e),n=Ua(t);let i=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:De;for(;xa(t);)try{const e=await Nr(t.localStore,i);if(null===e){0===t.Ta.length&&n.L_();break}i=e.batchId,ka(t,e)}catch(e){await Sa(t,e)}Ia(t)&&Pa(t)}function xa(e){return ya(e)&&e.Ta.length<10}function ka(e,t){e.Ta.push(t);const n=Ua(e);n.O_()&&n.X_&&n.ea(t.mutations)}function Ia(e){return ya(e)&&!Ua(e).x_()&&e.Ta.length>0}function Pa(e){Ua(e).start()}async function Ra(e){Ua(e).ra()}async function Da(e){const t=Ua(e);for(const n of e.Ta)t.ea(n.mutations)}async function Ma(e,t,n){const i=e.Ta.shift(),s=$i.from(i,t,n);await Ca(e,(()=>e.remoteSyncer.applySuccessfulWrite(s))),await Ta(e)}async function Na(e,t){t&&Ua(e).X_&&await async function(e,t){if(function(e){return Xi(e)&&e!==L.ABORTED}(t.code)){const n=e.Ta.shift();Ua(e).B_(),await Ca(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Ta(e)}}(e,t),Ia(e)&&Pa(e)}async function La(e,t){const n=N(e);n.asyncQueue.verifyOperationInProgress(),x(la,"RemoteStore received new credentials");const i=ya(n);n.Ea.add(3),await ha(n),i&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await ua(n)}async function Oa(e,t){const n=N(e);t?(n.Ea.delete(2),await ua(n)):t||(n.Ea.add(2),await ha(n),n.Ra.set("Unknown"))}function Fa(e){return e.ma||(e.ma=function(e,t,n){const i=N(e);return i.sa(),new ia(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Xo:wa.bind(null,e),t_:_a.bind(null,e),r_:Aa.bind(null,e),H_:Ea.bind(null,e)}),e.da.push((async t=>{t?(e.ma.B_(),va(e)?ma(e):e.Ra.set("Unknown")):(await e.ma.stop(),ba(e))}))),e.ma}function Ua(e){return e.fa||(e.fa=function(e,t,n){const i=N(e);return i.sa(),new sa(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:Ra.bind(null,e),r_:Na.bind(null,e),ta:Da.bind(null,e),na:Ma.bind(null,e)}),e.da.push((async t=>{t?(e.fa.B_(),await Ta(e)):(await e.fa.stop(),e.Ta.length>0&&(x(la,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa}class za{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new F,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const r=Date.now()+n,a=new za(e,t,r,i,s);return a.start(n),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new O(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Va(e,t){if(k("AsyncQueue",`${t}: ${e}`),Pe(e))return new O(L.UNAVAILABLE,`${t}: ${e}`);throw e}class Ba{static emptySet(e){return new Ba(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||re.comparator(t.key,n.key):(e,t)=>re.comparator(e.key,t.key),this.keyedMap=ti(),this.sortedSet=new dt(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ba))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ba;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ja{constructor(){this.ga=new dt(re.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):R(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Ha{constructor(e,t,n,i,s,r,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,s){const r=[];return t.forEach((e=>{r.push({type:0,doc:e})})),new Ha(e,t,Ba.emptySet(t),r,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&$n(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class $a{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class qa{constructor(){this.queries=Wa(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=N(e),i=n.queries;n.queries=Wa(),i.forEach(((e,n)=>{for(const i of n.Sa)i.onError(t)}))}(this,new O(L.ABORTED,"Firestore shutting down"))}}function Wa(){return new Yn((e=>qn(e)),$n)}async function Ga(e,t){const n=N(e);let i=3;const s=t.query;let r=n.queries.get(s);r?!r.ba()&&t.Da()&&(i=2):(r=new $a,i=t.Da()?0:1);try{switch(i){case 0:r.wa=await n.onListen(s,!0);break;case 1:r.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(e){const n=Va(e,`Initialization of query '${Wn(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,r),r.Sa.push(t),t.va(n.onlineState),r.wa&&t.Fa(r.wa)&&Ya(n)}async function Ka(e,t){const n=N(e),i=t.query;let s=3;const r=n.queries.get(i);if(r){const e=r.Sa.indexOf(t);e>=0&&(r.Sa.splice(e,1),0===r.Sa.length?s=t.Da()?0:1:!r.ba()&&t.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}function Xa(e,t){const n=N(e);let i=!1;for(const s of t){const e=s.query,t=n.queries.get(e);if(t){for(const e of t.Sa)e.Fa(s)&&(i=!0);t.wa=s}}i&&Ya(n)}function Qa(e,t,n){const i=N(e),s=i.queries.get(t);if(s)for(const r of s.Sa)r.onError(n);i.queries.delete(t)}function Ya(e){e.Ca.forEach((e=>{e.next()}))}var Ja,Za;(Za=Ja||(Ja={})).Ma="default",Za.Cache="cache";class eo{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Ha(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Ha.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ja.Cache}}class to{constructor(e){this.key=e}}class no{constructor(e){this.key=e}}class io{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=li(),this.mutatedKeys=li(),this.eu=Xn(e),this.tu=new Ba(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new ja,i=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,r=i,a=!1;const o="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((e,t)=>{const c=i.get(e),u=Gn(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),p=!0):this.su(c,u)||(n.track({type:2,doc:u}),p=!0,(o&&this.eu(u,o)>0||l&&this.eu(u,l)<0)&&(a=!0)):!c&&u?(n.track({type:0,doc:u}),p=!0):c&&!u&&(n.track({type:1,doc:c}),p=!0,(o||l)&&(a=!0)),p&&(u?(r=r.add(u),s=d?s.add(e):s.delete(e)):(r=r.delete(e),s=s.delete(e)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{tu:r,iu:n,Cs:a,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const r=e.iu.ya();r.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc))),this.ou(n),i=i??!1;const a=t&&!i?this._u():[],o=0===this.Xa.size&&this.current&&!i?1:0,l=o!==this.Za;return this.Za=o,0!==r.length||l?{snapshot:new Ha(this.query,e.tu,s,r,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ja,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=li(),this.tu.forEach((e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))}));const t=[];return e.forEach((e=>{this.Xa.has(e)||t.push(new no(e))})),this.Xa.forEach((n=>{e.has(n)||t.push(new to(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=li();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ha.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const so="SyncEngine";class ro{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ao{constructor(e){this.key=e,this.hu=!1}}class oo{constructor(e,t,n,i,s,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Pu={},this.Tu=new Yn((e=>qn(e)),$n),this.Iu=new Map,this.Eu=new Set,this.du=new dt(re.comparator),this.Au=new Map,this.Ru=new fr,this.Vu={},this.mu=new Map,this.fu=er.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function lo(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=Po(e);let s;const r=i.Tu.get(t);return r?(i.sharedClientState.addLocalQueryTarget(r.targetId),s=r.view.lu()):s=await uo(i,t,n,!0),s}async function co(e,t){const n=Po(e);await uo(n,t,!0,!1)}async function uo(e,t,n,i){const s=await Lr(e.localStore,Vn(t)),r=s.targetId,a=e.sharedClientState.addLocalQueryTarget(r,n);let o;return i&&(o=await ho(e,t,r,"current"===a,s.resumeToken)),e.isPrimaryClient&&n&&da(e.remoteStore,s),o}async function ho(e,t,n,i,s){e.pu=(t,n,i)=>async function(e,t,n,i){let s=t.view.ru(n);s.Cs&&(s=await Fr(e.localStore,t.query,!1).then((e=>{let{documents:n}=e;return t.view.ru(n,s)})));const r=i&&i.targetChanges.get(t.targetId),a=i&&null!=i.targetMismatches.get(t.targetId),o=t.view.applyChanges(s,e.isPrimaryClient,r,a);return So(e,t.targetId,o.au),o.snapshot}(e,t,n,i);const r=await Fr(e.localStore,t,!0),a=new io(t,r.Qs),o=a.ru(r.documents),l=rs.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,s),c=a.applyChanges(o,e.isPrimaryClient,l);So(e,n,c.au);const u=new ro(t,n,a);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),c.snapshot}async function po(e,t,n){const i=N(e),s=i.Tu.get(t),r=i.Iu.get(s.targetId);if(r.length>1)return i.Iu.set(s.targetId,r.filter((e=>!$n(e,t)))),void i.Tu.delete(t);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||await Or(i.localStore,s.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(s.targetId),n&&pa(i.remoteStore,s.targetId),Ao(i,s.targetId)})).catch(xe)):(Ao(i,s.targetId),await Or(i.localStore,s.targetId,!0))}async function fo(e,t){const n=N(e),i=n.Tu.get(t),s=n.Iu.get(i.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),pa(n.remoteStore,i.targetId))}async function go(e,t){const n=N(e);try{const e=await function(e,t){const n=N(e),i=t.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const r=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const a=[];t.targetChanges.forEach(((r,o)=>{const l=s.get(o);if(!l)return;a.push(n.Pi.removeMatchingKeys(e,r.removedDocuments,o).next((()=>n.Pi.addMatchingKeys(e,r.addedDocuments,o))));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(bt.EMPTY_BYTE_STRING,ye.min()).withLastLimboFreeSnapshotVersion(ye.min()):r.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(r.resumeToken,i)),s=s.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=kr||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(l,c,r)&&a.push(n.Pi.updateTargetData(e,c))}));let o=Zn(),l=li();if(t.documentUpdates.forEach((i=>{t.resolvedLimboDocuments.has(i)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))})),a.push(Mr(e,r,t.documentUpdates).next((e=>{o=e.ks,l=e.qs}))),!i.isEqual(ye.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next((t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,i)));a.push(t)}return ke.waitFor(a).next((()=>r.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,o,l))).next((()=>o))})).then((e=>(n.Ms=s,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const i=n.Au.get(t);i&&(M(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?i.hu=!0:e.modifiedDocuments.size>0?M(i.hu,14607):e.removedDocuments.size>0&&(M(i.hu,42227),i.hu=!1))})),await xo(n,e,t)}catch(e){await xe(e)}}function mo(e,t,n){const i=N(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.Tu.forEach(((n,i)=>{const s=i.view.va(t);s.snapshot&&e.push(s.snapshot)})),function(e,t){const n=N(e);n.onlineState=t;let i=!1;n.queries.forEach(((e,n)=>{for(const s of n.Sa)s.va(t)&&(i=!0)})),i&&Ya(n)}(i.eventManager,t),e.length&&i.Pu.H_(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function vo(e,t,n){const i=N(e);i.sharedClientState.updateQueryState(t,"rejected",n);const s=i.Au.get(t),r=s&&s.key;if(r){let e=new dt(re.comparator);e=e.insert(r,an.newNoDocument(r,ye.min()));const n=li().add(r),s=new ss(ye.min(),new Map,new dt(K),e,n);await go(i,s),i.du=i.du.remove(r),i.Au.delete(t),To(i)}else await Or(i.localStore,t,!1).then((()=>Ao(i,t,n))).catch(xe)}async function yo(e,t){const n=N(e),i=t.batch.batchId;try{const e=await function(e,t){const n=N(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const i=t.batch.keys(),s=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const s=n.batch,r=s.keys();let a=ke.resolve();return r.forEach((e=>{a=a.next((()=>i.getEntry(t,e))).next((t=>{const r=n.docVersions.get(e);M(null!==r,48541),t.version.compareTo(r)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))}))})),a.next((()=>e.mutationQueue.removeMutationBatch(t,s)))}(n,e,t,s).next((()=>s.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=li();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(n.localStore,t);_o(n,i,null),wo(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await xo(n,e)}catch(e){await xe(e)}}async function bo(e,t,n){const i=N(e);try{const e=await function(e,t){const n=N(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(M(null!==t,37113),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(i.localStore,t);_o(i,t,n),wo(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await xo(i,e)}catch(n){await xe(n)}}function wo(e,t){(e.mu.get(t)||[]).forEach((e=>{e.resolve()})),e.mu.delete(t)}function _o(e,t,n){const i=N(e);let s=i.Vu[i.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),i.Vu[i.currentUser.toKey()]=s}}function Ao(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.Iu.get(t))e.Tu.delete(i),n&&e.Pu.yu(i,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach((t=>{e.Ru.containsKey(t)||Eo(e,t)}))}function Eo(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(pa(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),To(e))}function So(e,t,n){for(const i of n)i instanceof to?(e.Ru.addReference(i.key,t),Co(e,i)):i instanceof no?(x(so,"Document no longer in limbo: "+i.key),e.Ru.removeReference(i.key,t),e.Ru.containsKey(i.key)||Eo(e,i.key)):R(19791,{wu:i})}function Co(e,t){const n=t.key,i=n.path.canonicalString();e.du.get(n)||e.Eu.has(i)||(x(so,"New document in limbo: "+n),e.Eu.add(i),To(e))}function To(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new re(ne.fromString(t)),i=e.fu.next();e.Au.set(i,new ao(n)),e.du=e.du.insert(n,i),da(e.remoteStore,new qs(Vn(On(n.path)),i,"TargetPurposeLimboResolution",Re.ce))}}async function xo(e,t,n){const i=N(e),s=[],r=[],a=[];i.Tu.isEmpty()||(i.Tu.forEach(((e,o)=>{a.push(i.pu(o,t,n).then((e=>{if((e||n)&&i.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(o.targetId)?.current;i.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){s.push(e);const t=Sr.As(o.targetId,e);r.push(t)}})))})),await Promise.all(a),i.Pu.H_(s),await async function(e,t){const n=N(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>ke.forEach(t,(t=>ke.forEach(t.Es,(i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i))).next((()=>ke.forEach(t.ds,(i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))))))}catch(e){if(!Pe(e))throw e;x(xr,"Failed to update sequence numbers: "+e)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.Ms.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.Ms=n.Ms.insert(e,s)}}}(i.localStore,r))}async function ko(e,t){const n=N(e);if(!n.currentUser.isEqual(t)){x(so,"User change. New user:",t.toKey());const e=await Rr(n.localStore,t);n.currentUser=t,function(e,t){e.mu.forEach((e=>{e.forEach((e=>{e.reject(new O(L.CANCELLED,t))}))})),e.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await xo(n,e.Ls)}}function Io(e,t){const n=N(e),i=n.Au.get(t);if(i&&i.hu)return li().add(i.key);{let e=li();const i=n.Iu.get(t);if(!i)return e;for(const t of i){const i=n.Tu.get(t);e=e.unionWith(i.view.nu)}return e}}function Po(e){const t=N(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=go.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Io.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=vo.bind(null,t),t.Pu.H_=Xa.bind(null,t.eventManager),t.Pu.yu=Qa.bind(null,t.eventManager),t}function Ro(e){const t=N(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=yo.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=bo.bind(null,t),t}class Do{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Zr(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Pr(this.persistence,new Tr,e.initialUser,this.serializer)}Cu(e){return new wr(Ar.mi,this.serializer)}Du(e){return new Vr}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Do.provider={build:()=>new Do};class Mo extends Do{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){M(this.persistence.referenceDelegate instanceof Er,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new rr(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Zs.withCacheSize(this.cacheSizeBytes):Zs.DEFAULT;return new wr((e=>Er.mi(e,t)),this.serializer)}}class No{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>mo(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ko.bind(null,this.syncEngine),await Oa(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new qa}createDatastore(e){const t=Zr(e.databaseInfo.databaseId),n=function(e){return new Yr(e)}(e.databaseInfo);return function(e,t,n,i){return new aa(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,i,s){return new ca(e,t,n,i,s)}(this.localStore,this.datastore,e.asyncQueue,(e=>mo(this.syncEngine,e,0)),Hr.v()?new Hr:new Br)}createSyncEngine(e,t){return function(e,t,n,i,s,r,a){const o=new oo(e,t,n,i,s,r);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){const t=N(e);x(la,"RemoteStore shutting down."),t.Ea.add(5),await ha(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}No.provider={build:()=>new No};class Lo{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):k("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Oo="FirestoreClient";class Fo{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=E.UNAUTHENTICATED,this.clientId=G.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async e=>{x(Oo,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(x(Oo,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new F;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Va(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Uo(e,t){e.asyncQueue.verifyOperationInProgress(),x(Oo,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener((async e=>{i.isEqual(e)||(await Rr(t.localStore,e),i=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function zo(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Vo(e);x(Oo,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>La(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>La(t.remoteStore,n))),e._onlineComponents=t}async function Vo(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){x(Oo,"Using user provided OfflineComponentProvider");try{await Uo(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===L.FAILED_PRECONDITION||e.code===L.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;I("Error using user provided cache. Falling back to memory cache: "+n),await Uo(e,new Do)}}else x(Oo,"Using default OfflineComponentProvider"),await Uo(e,new Mo(void 0));return e._offlineComponents}async function Bo(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(x(Oo,"Using user provided OnlineComponentProvider"),await zo(e,e._uninitializedComponentsProvider._online)):(x(Oo,"Using default OnlineComponentProvider"),await zo(e,new No))),e._onlineComponents}function jo(e){return Bo(e).then((e=>e.syncEngine))}async function Ho(e){const t=await Bo(e),n=t.eventManager;return n.onListen=lo.bind(null,t.syncEngine),n.onUnlisten=po.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=co.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=fo.bind(null,t.syncEngine),n}function $o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new F;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,i,s){const r=new Lo({next:o=>{r.Nu(),t.enqueueAndForget((()=>Ka(e,a)));const l=o.docs.has(n);!l&&o.fromCache?s.reject(new O(L.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&i&&"server"===i.source?s.reject(new O(L.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(o)},error:e=>s.reject(e)}),a=new eo(On(n.path),r,{includeMetadataChanges:!0,qa:!0});return Ga(e,a)}(await Ho(e),e.asyncQueue,t,n,i))),i.promise}function qo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new F;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,i,s){const r=new Lo({next:n=>{r.Nu(),t.enqueueAndForget((()=>Ka(e,a))),n.fromCache&&"server"===i.source?s.reject(new O(L.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),a=new eo(n,r,{includeMetadataChanges:!0,qa:!0});return Ga(e,a)}(await Ho(e),e.asyncQueue,t,n,i))),i.promise}function Wo(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Go=new Map,Ko="firestore.googleapis.com",Xo=!0;class Qo{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new O(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ko,this.ssl=Xo}else this.host=e.host,this.ssl=e.ssl??Xo;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Js;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<nr)throw new O(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new O(L.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Wo(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new O(L.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new O(L.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new O(L.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Yo{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new O(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qo(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new z;switch(e.type){case"firstParty":return new H(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new O(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Go.get(e);t&&(x("ComponentProvider","Removing Datastore"),Go.delete(e),t.terminate())}(this),Promise.resolve()}}function Jo(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=he(e,Yo);const s=(0,l.zJ)(t),r=e._getSettings(),a={...r,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${n}`;s&&((0,l.gE)(`https://${o}`),(0,l.P1)("Firestore",!0)),r.host!==Ko&&r.host!==o&&I("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...r,host:o,ssl:s,emulatorOptions:i};if(!(0,l.bD)(c,a)&&(e._setSettings(c),i.mockUserToken)){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=E.MOCK_USER;else{t=(0,l.Fy)(i.mockUserToken,e._app?.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new O(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new E(s)}e._authCredentials=new V(new U(t,n))}}class Zo{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Zo(this.firestore,e,this._query)}}class el{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new tl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new el(this.firestore,e,this._key)}toJSON(){return{type:el._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(fe(t,el._jsonSchema))return new el(e,n||null,new re(ne.fromString(t.referencePath)))}}el._jsonSchemaVersion="firestore/documentReference/1.0",el._jsonSchema={type:pe("string",el._jsonSchemaVersion),referencePath:pe("string")};class tl extends Zo{constructor(e,t,n){super(e,t,On(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new el(this.firestore,null,new re(e))}withConverter(e){return new tl(this.firestore,e,this._path)}}function nl(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];if(e=(0,l.Ku)(e),ae("collection","path",t),e instanceof Yo){const n=ne.fromString(t,...i);return le(n),new tl(e,null,n)}{if(!(e instanceof el||e instanceof tl))throw new O(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(ne.fromString(t,...i));return le(n),new tl(e.firestore,null,n)}}function il(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];if(e=(0,l.Ku)(e),1===arguments.length&&(t=G.newId()),ae("doc","path",t),e instanceof Yo){const n=ne.fromString(t,...i);return oe(n),new el(e,null,new re(n))}{if(!(e instanceof el||e instanceof tl))throw new O(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(ne.fromString(t,...i));return oe(n),new el(e.firestore,e instanceof tl?e.converter:null,new re(n))}}const sl="AsyncQueue";class rl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ea(this,"async_queue_retry"),this._c=()=>{const e=Jr();e&&x(sl,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Jr();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Jr();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new F;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Pe(e))throw e;x(sl,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((e=>{throw this.nc=e,this.rc=!1,k("INTERNAL UNHANDLED ERROR: ",al(e)),e})).then((e=>(this.rc=!1,e))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=za.createAndSchedule(this,e,t,n,(e=>this.hc(e)));return this.tc.push(i),i}uc(){this.nc&&R(47125,{Pc:al(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function al(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function ol(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const i of t)if(i in n&&"function"==typeof n[i])return!0;return!1}(e,["next","error","complete"])}class ll extends Yo{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new rl,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new rl(e),this._firestoreClient=void 0,await e}}}function cl(e,t){const n="object"==typeof e?e:(0,r.Sx)(),i="string"==typeof e?e:t||Dt,s=(0,r.j6)(n,"firestore").getImmediate({identifier:i});if(!s._initialized){const e=(0,l.yU)("firestore");e&&Jo(s,...e)}return s}function ul(e){if(e._terminated)throw new O(L.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||hl(e),e._firestoreClient}function hl(e){const t=e._freezeSettings(),n=function(e,t,n,i){return new Rt(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Wo(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator)}(e._databaseId,e._app?.options.appId||"",e._persistenceKey,t);e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new Fo(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}class dl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dl(bt.fromBase64String(e))}catch(e){throw new O(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new dl(bt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:dl._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(fe(e,dl._jsonSchema))return dl.fromBase64String(e.bytes)}}dl._jsonSchemaVersion="firestore/bytes/1.0",dl._jsonSchema={type:pe("string",dl._jsonSchemaVersion),bytes:pe("string")};class pl{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let i=0;i<t.length;++i)if(0===t[i].length)throw new O(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new se(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class fl{constructor(e){this._methodName=e}}class gl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return K(this._lat,e._lat)||K(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:gl._jsonSchemaVersion}}static fromJSON(e){if(fe(e,gl._jsonSchema))return new gl(e.latitude,e.longitude)}}gl._jsonSchemaVersion="firestore/geoPoint/1.0",gl._jsonSchema={type:pe("string",gl._jsonSchemaVersion),latitude:pe("number"),longitude:pe("number")};class ml{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ml._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(fe(e,ml._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((e=>"number"==typeof e)))return new ml(e.vectorValues);throw new O(L.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ml._jsonSchemaVersion="firestore/vectorValue/1.0",ml._jsonSchema={type:pe("string",ml._jsonSchemaVersion),vectorValues:pe("object")};const vl=/^__.*__$/;class yl{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Fi(e,this.data,this.fieldMask,t,this.fieldTransforms):new Oi(e,this.data,t,this.fieldTransforms)}}class bl{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Fi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function wl(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R(40011,{Ac:e})}}class _l{constructor(e,t,n,i,s,r){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new _l({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Fl(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(wl(this.Ac)&&vl.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Al{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Zr(e)}Cc(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new _l({Ac:e,methodName:t,Dc:n,path:se.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function El(e){const t=e._freezeSettings(),n=Zr(e._databaseId);return new Al(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Sl(e,t,n,i,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.Cc(r.merge||r.mergeFields?2:0,t,n,s);Ml("Data must be an object, but it was:",a,i);const o=Rl(i,a);let l,c;if(r.merge)l=new vt(a.fieldMask),c=a.fieldTransforms;else if(r.mergeFields){const e=[];for(const i of r.mergeFields){const s=Nl(t,i,n);if(!a.contains(s))throw new O(L.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Ul(e,s)||e.push(s)}l=new vt(e),c=a.fieldTransforms.filter((e=>l.covers(e.field)))}else l=null,c=a.fieldTransforms;return new yl(new sn(o),l,c)}class Cl extends fl{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Cl}}class Tl extends fl{_toFieldTransform(e){return new Ti(e.path,new yi)}isEqual(e){return e instanceof Tl}}function xl(e,t,n,i){const s=e.Cc(1,t,n);Ml("Data must be an object, but it was:",s,i);const r=[],a=sn.empty();ut(i,((e,i)=>{const o=Ol(t,e,n);i=(0,l.Ku)(i);const c=s.yc(o);if(i instanceof Cl)r.push(o);else{const e=Pl(i,c);null!=e&&(r.push(o),a.set(o,e))}}));const o=new vt(r);return new bl(a,o,s.fieldTransforms)}function kl(e,t,n,i,s,r){const a=e.Cc(1,t,n),o=[Nl(t,i,n)],c=[s];if(r.length%2!=0)throw new O(L.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let l=0;l<r.length;l+=2)o.push(Nl(t,r[l])),c.push(r[l+1]);const u=[],h=sn.empty();for(let p=o.length-1;p>=0;--p)if(!Ul(u,o[p])){const e=o[p];let t=c[p];t=(0,l.Ku)(t);const n=a.yc(e);if(t instanceof Cl)u.push(e);else{const i=Pl(t,n);null!=i&&(u.push(e),h.set(e,i))}}const d=new vt(u);return new bl(h,d,a.fieldTransforms)}function Il(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Pl(n,e.Cc(i?4:3,t))}function Pl(e,t){if(Dl(e=(0,l.Ku)(e)))return Ml("Unsupported field value:",t,e),Rl(e,t);if(e instanceof fl)return function(e,t){if(!wl(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const s of e){let e=Pl(s,t.wc(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,l.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return pi(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ve.fromDate(e);return{timestampValue:ys(t.serializer,n)}}if(e instanceof ve){const n=new ve(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ys(t.serializer,n)}}if(e instanceof gl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof dl)return{bytesValue:bs(t.serializer,e._byteString)};if(e instanceof el){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Sc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:As(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof ml)return function(e,t){return{mapValue:{fields:{[Nt]:{stringValue:Ft},[Ut]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return hi(t.serializer,e)}))}}}}}}(e,t);throw t.Sc(`Unsupported field value: ${ue(e)}`)}(e,t)}function Rl(e,t){const n={};return ht(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ut(e,((e,i)=>{const s=Pl(i,t.mc(e));null!=s&&(n[e]=s)})),{mapValue:{fields:n}}}function Dl(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ve||e instanceof gl||e instanceof dl||e instanceof el||e instanceof fl||e instanceof ml)}function Ml(e,t,n){if(!Dl(n)||!ce(n)){const i=ue(n);throw"an object"===i?t.Sc(e+" a custom object"):t.Sc(e+" "+i)}}function Nl(e,t,n){if((t=(0,l.Ku)(t))instanceof pl)return t._internalPath;if("string"==typeof t)return Ol(e,t);throw Fl("Field path arguments must be of type string or ",e,!1,void 0,n)}const Ll=new RegExp("[~\\*/\\[\\]]");function Ol(e,t,n){if(t.search(Ll)>=0)throw Fl(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new pl(...t.split("."))._internalPath}catch(i){throw Fl(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Fl(e,t,n,i,s){const r=i&&!i.isEmpty(),a=void 0!==s;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(r||a)&&(l+=" (found",r&&(l+=` in field ${i}`),a&&(l+=` in document ${s}`),l+=")"),new O(L.INVALID_ARGUMENT,o+e+l)}function Ul(e,t){return e.some((e=>e.isEqual(t)))}class zl{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new el(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Vl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Bl("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Vl extends zl{data(){return super.data()}}function Bl(e,t){return"string"==typeof t?Ol(e,t):t instanceof pl?t._internalPath:t._delegate._internalPath}function jl(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new O(L.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Hl{}class $l extends Hl{}function ql(e,t){let n=[];for(var i=arguments.length,s=new Array(i>2?i-2:0),r=2;r<i;r++)s[r-2]=arguments[r];t instanceof Hl&&n.push(t),n=n.concat(s),function(e){const t=e.filter((e=>e instanceof Gl)).length,n=e.filter((e=>e instanceof Wl)).length;if(t>1||t>0&&n>0)throw new O(L.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)e=a._apply(e);return e}class Wl extends $l{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Wl(e,t,n)}_apply(e){const t=this._parse(e);return ec(e._query,t),new Zo(e.firestore,e.converter,jn(e._query,t))}_parse(e){const t=El(e.firestore),n=function(e,t,n,i,s,r,a){let o;if(s.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new O(L.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){Zl(a,r);const t=[];for(const n of a)t.push(Jl(i,e,n));o={arrayValue:{values:t}}}else o=Jl(i,e,a)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||Zl(a,r),o=Il(n,t,a,"in"===r||"not-in"===r);return pn.create(s,r,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class Gl extends Hl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Gl(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:fn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const i=t.getFlattenedFilters();for(const s of i)ec(n,s),n=jn(n,s)}(e._query,t),new Zo(e.firestore,e.converter,jn(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Kl extends $l{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Kl(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new O(L.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new O(L.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new un(t,n)}(e._query,this._field,this._direction);return new Zo(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Nn(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Xl(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Bl("orderBy",e);return Kl._create(n,t)}class Ql extends $l{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Ql(e,t,n)}_apply(e){return new Zo(e.firestore,e.converter,Hn(e._query,this._limit,this._limitType))}}function Yl(e){return de("limit",e),Ql._create("limit",e,"F")}function Jl(e,t,n){if("string"==typeof(n=(0,l.Ku)(n))){if(""===n)throw new O(L.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Un(t)&&-1!==n.indexOf("/"))throw new O(L.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=t.path.child(ne.fromString(n));if(!re.isDocumentKey(i))throw new O(L.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Kt(e,new re(i))}if(n instanceof el)return Kt(e,n._key);throw new O(L.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ue(n)}.`)}function Zl(e,t){if(!Array.isArray(e)||0===e.length)throw new O(L.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ec(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new O(L.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new O(L.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class tc{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(zt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return At(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Et(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw R(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return ut(e,((e,i)=>{n[e]=this.convertValue(i,t)})),n}convertVectorValue(e){const t=e.fields?.[Ut].arrayValue?.values?.map((e=>At(e.doubleValue)));return new ml(t)}convertGeoPoint(e){return new gl(At(e.latitude),At(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=It(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Pt(e));default:return null}}convertTimestamp(e){const t=_t(e);return new ve(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ne.fromString(e);M($s(n),9688,{name:e});const i=new Mt(n.get(1),n.get(3)),s=new re(n.popFirst(5));return i.isEqual(t)||k(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function nc(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}class ic{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class sc extends zl{constructor(e,t,n,i,s,r){super(e,t,n,i,r),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new rc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Bl("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(L.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=sc._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}sc._jsonSchemaVersion="firestore/documentSnapshot/1.0",sc._jsonSchema={type:pe("string",sc._jsonSchemaVersion),bundleSource:pe("string","DocumentSnapshot"),bundleName:pe("string"),bundle:pe("string")};class rc extends sc{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class ac{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ic(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new rc(this._firestore,this._userDataWriter,n.key,n,new ic(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new O(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const i=new rc(e._firestore,e._userDataWriter,n.doc.key,n.doc,new ic(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const i=new rc(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ic(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,r=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:oc(t.type),doc:i,oldIndex:s,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(L.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ac._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=G.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],i=[];return this.docs.forEach((e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),i.push(e.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function oc(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R(61501,{type:e})}}function lc(e){e=he(e,el);const t=he(e.firestore,ll);return $o(ul(t),e._key).then((n=>mc(t,e,n)))}ac._jsonSchemaVersion="firestore/querySnapshot/1.0",ac._jsonSchema={type:pe("string",ac._jsonSchemaVersion),bundleSource:pe("string","QuerySnapshot"),bundleName:pe("string"),bundle:pe("string")};class cc extends tc{constructor(e){super(),this.firestore=e}convertBytes(e){return new dl(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new el(this.firestore,null,t)}}function uc(e){e=he(e,Zo);const t=he(e.firestore,ll),n=ul(t),i=new cc(t);return jl(e._query),qo(n,e._query).then((n=>new ac(t,i,e,n)))}function hc(e,t,n){e=he(e,el);const i=he(e.firestore,ll),s=nc(e.converter,t,n);return gc(i,[Sl(El(i),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,ki.none())])}function dc(e,t,n){e=he(e,el);const i=he(e.firestore,ll),s=El(i);let r;for(var a=arguments.length,o=new Array(a>3?a-3:0),c=3;c<a;c++)o[c-3]=arguments[c];return r="string"==typeof(t=(0,l.Ku)(t))||t instanceof pl?kl(s,"updateDoc",e._key,t,n,o):xl(s,"updateDoc",e._key,t),gc(i,[r.toMutation(e._key,ki.exists(!0))])}function pc(e){return gc(he(e.firestore,ll),[new Bi(e._key,ki.none())])}function fc(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];e=(0,l.Ku)(e);let s={includeMetadataChanges:!1,source:"default"},r=0;"object"!=typeof n[r]||ol(n[r])||(s=n[r++]);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(ol(n[r])){const e=n[r];n[r]=e.next?.bind(e),n[r+1]=e.error?.bind(e),n[r+2]=e.complete?.bind(e)}let o,c,u;if(e instanceof el)c=he(e.firestore,ll),u=On(e._key.path),o={next:t=>{n[r]&&n[r](mc(c,e,t))},error:n[r+1],complete:n[r+2]};else{const t=he(e,Zo);c=he(t.firestore,ll),u=t._query;const i=new cc(c);o={next:e=>{n[r]&&n[r](new ac(c,i,t,e))},error:n[r+1],complete:n[r+2]},jl(e._query)}return function(e,t,n,i){const s=new Lo(i),r=new eo(t,s,n);return e.asyncQueue.enqueueAndForget((async()=>Ga(await Ho(e),r))),()=>{s.Nu(),e.asyncQueue.enqueueAndForget((async()=>Ka(await Ho(e),r)))}}(ul(c),u,a,o)}function gc(e,t){return function(e,t){const n=new F;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const i=Ro(e);try{const e=await function(e,t){const n=N(e),i=ve.now(),s=t.reduce(((e,t)=>e.add(t.key)),li());let r,a;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let o=Zn(),l=li();return n.Ns.getEntries(e,s).next((e=>{o=e,o.forEach(((e,t)=>{t.isValidDocument()||(l=l.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,o))).next((s=>{r=s;const a=[];for(const e of t){const t=Ni(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new Fi(e.key,t,rn(t.value.mapValue),ki.exists(!0)))}return n.mutationQueue.addMutationBatch(e,i,a,t)})).next((t=>{a=t;const i=t.applyToLocalDocumentSet(r,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,i)}))})).then((()=>({batchId:a.batchId,changes:ni(r)})))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.Vu[e.currentUser.toKey()];i||(i=new dt(K)),i=i.insert(t,n),e.Vu[e.currentUser.toKey()]=i}(i,e.batchId,n),await xo(i,e.changes),await Ta(i.remoteStore)}catch(e){const t=Va(e,"Failed to persist write");n.reject(t)}}(await jo(e),t,n))),n.promise}(ul(e),t)}function mc(e,t,n){const i=n.docs.get(t._key),s=new cc(e);return new sc(e,s,t._key,i,new ic(n.hasPendingWrites,n.fromCache),t.converter)}class vc{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=El(e)}set(e,t,n){this._verifyNotCommitted();const i=yc(e,this._firestore),s=nc(i.converter,t,n),r=Sl(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(r.toMutation(i._key,ki.none())),this}update(e,t,n){this._verifyNotCommitted();const i=yc(e,this._firestore);let s;for(var r=arguments.length,a=new Array(r>3?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];return s="string"==typeof(t=(0,l.Ku)(t))||t instanceof pl?kl(this._dataReader,"WriteBatch.update",i._key,t,n,a):xl(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,ki.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=yc(e,this._firestore);return this._mutations=this._mutations.concat(new Bi(t._key,ki.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new O(L.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function yc(e,t){if((e=(0,l.Ku)(e)).firestore!==t)throw new O(L.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function bc(){return new Tl("serverTimestamp")}function wc(e){return ul(e=he(e,ll)),new vc(e,(t=>gc(e,t)))}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){S=e}(r.MF),(0,r.om)(new a.uA("firestore",((e,n)=>{let{instanceIdentifier:i,options:s}=n;const r=e.getProvider("app").getImmediate(),a=new ll(new B(e.getProvider("auth-internal")),new q(r,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new O(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mt(e.options.projectId,t)}(r,i),r);return s={useFetchStreams:t,...s},a._setSettings(s),a}),"PUBLIC").setMultipleInstances(!0)),(0,r.KO)(_,A,e),(0,r.KO)(_,A,"esm2020")}()},387:(e,t,n)=>{n.d(t,{BR:()=>u,QG:()=>h,fn:()=>c});var i=n(9950),s=n(7927),r=n(5532),a=n(9916),o=n(2180),l=n(4414);const c="https://applectura-backend.onrender.com";console.log("\ud83d\udd27 [AppContext] Backend URL configurada:",c);const u=(0,i.createContext)(),h=e=>{let{children:t}=e;console.log("\ud83d\ude80 AppContext provider loaded");let h=null,d=null;try{const e=(0,r.As)();h=e.currentUser,d=e.userData}catch(A){console.warn("\u26a0\ufe0f [AppContext] AuthContext no disponible a\xfan, continuando sin auth")}const[p,f]=(0,i.useState)(""),g=(0,i.useCallback)((e=>{console.log("\ud83d\udd04 AppContext - Estableciendo nuevo texto, longitud:",(null===e||void 0===e?void 0:e.length)||0),console.log("\ud83d\udd04 AppContext - Primeros 200 caracteres:",(null===e||void 0===e?void 0:e.substring(0,200))||"Vac\xedo"),f(e)}),[]),[m,v]=(0,i.useState)((()=>localStorage.getItem("openai_api_key")||"")),[y,b]=(0,i.useState)((()=>{const e=localStorage.getItem("modoOscuro");return null!==e?JSON.parse(e):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches})),[w,_]=(0,i.useState)(!1),[A,E]=(0,i.useState)(""),[S,C]=(0,i.useState)(null),[T,x]=(0,i.useState)(null),[k,I]=(0,i.useState)(null),[P,R]=(0,i.useState)((()=>{const e=localStorage.getItem("rubricProgress");if(e)try{const t=JSON.parse(e),n={};return["rubrica1","rubrica2","rubrica3","rubrica4","rubrica5"].forEach((e=>{t[e]&&"object"===typeof t[e]?n[e]={scores:Array.isArray(t[e].scores)?t[e].scores:[],average:"number"===typeof t[e].average?t[e].average:0,lastUpdate:t[e].lastUpdate||null,artefactos:Array.isArray(t[e].artefactos)?t[e].artefactos:[]}:n[e]={scores:[],average:0,lastUpdate:null,artefactos:[]}})),console.log("\u2705 [AppContext] rubricProgress cargado y validado desde localStorage"),n}catch(t){console.warn("\u26a0\ufe0f Error cargando rubricProgress desde localStorage:",t)}return{rubrica1:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica2:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica3:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica4:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica5:{scores:[],average:0,lastUpdate:null,artefactos:[]}}}));(0,i.useEffect)((()=>{localStorage.setItem("rubricProgress",JSON.stringify(P))}),[P]);const[D,M]=(0,i.useState)((()=>{const e=localStorage.getItem("savedCitations");if(e)try{return JSON.parse(e)}catch(t){console.warn("\u26a0\ufe0f Error cargando savedCitations desde localStorage:",t)}return{}}));(0,i.useEffect)((()=>{localStorage.setItem("savedCitations",JSON.stringify(D))}),[D]);const[N,L]=(0,i.useState)((()=>{const e=localStorage.getItem("activitiesProgress");if(e)try{return JSON.parse(e)}catch(A){console.warn("\u26a0\ufe0f Error cargando activitiesProgress desde localStorage:",A)}return{}})),[O,F]=(0,i.useState)(!1),[U,z]=(0,i.useState)(null);(0,i.useEffect)((()=>{localStorage.getItem("activitiesProgress_migrated")||n.e(179).then(n.bind(n,8179)).then((e=>{let{migrateActivityDataToContext:t}=e;const n=t();n.migrated>0&&(console.log(`\u2705 [Migration] ${n.migrated} documentos migrados a activitiesProgress`),L(n.data),localStorage.setItem("activitiesProgress_migrated","true"))})).catch((e=>{console.warn("\u26a0\ufe0f [Migration] Error importando migraci\xf3n:",e)}))}),[]),(0,i.useEffect)((()=>{localStorage.setItem("activitiesProgress",JSON.stringify(N))}),[N]);const V=(0,i.useCallback)((e=>{v(e),e?localStorage.setItem("openai_api_key",e):localStorage.removeItem("openai_api_key")}),[]),B=(0,i.useCallback)((()=>{b((e=>{const t=!e;return localStorage.setItem("modoOscuro",JSON.stringify(t)),t}))}),[]),j=(0,i.useCallback)((e=>{_(e)}),[]),H=(0,i.useCallback)((e=>{E(e)}),[]),$=(0,i.useCallback)((e=>{C(e||null)}),[]),q=(0,i.useCallback)((e=>{console.log("\ud83d\udcd0 AppContext - Estableciendo estructura del texto:",e),x(e||null)}),[]),W=(0,i.useCallback)(((e,t)=>{console.log(`\ud83d\udcca [updateRubricScore] Actualizando ${e}:`,t),R((n=>{const i=n[e]||{scores:[],average:0,lastUpdate:null,artefactos:[]},s={score:t.score||t.scoreGlobal||t.nivel||0,nivel:t.nivel||Math.round((t.score||t.scoreGlobal||0)/2.5),artefacto:t.artefacto||t.source||"unknown",timestamp:Date.now(),criterios:t.criterios||t.criteriosEvaluados||null},r=[...i.scores||[],s],a=r.slice(-3),o=a.reduce(((e,t)=>e+t.score),0)/a.length,l=new Set([...i.artefactos||[],s.artefacto]),c={scores:r,average:Math.round(10*o)/10,lastUpdate:Date.now(),artefactos:Array.from(l)};return console.log(`\u2705 [updateRubricScore] ${e} actualizada. Promedio: ${c.average}/10`),window.dispatchEvent(new CustomEvent("artifact-evaluated",{detail:{rubricId:e,score:s.score,average:c.average,artefacto:s.artefacto}})),{...n,[e]:c}}))}),[]),G=(0,i.useCallback)((e=>{console.log(`\ud83d\uddd1\ufe0f [clearRubricProgress] Limpiando ${e}`),R((t=>({...t,[e]:{scores:[],average:0,lastUpdate:null,artefactos:[]}})))}),[]),K=(0,i.useCallback)((()=>{console.log("\ud83d\uddd1\ufe0f [resetAllProgress] Reseteando todo el progreso de r\xfabricas");R({rubrica1:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica2:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica3:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica4:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica5:{scores:[],average:0,lastUpdate:null,artefactos:[]}}),localStorage.removeItem("rubricProgress")}),[]),X=(0,i.useCallback)((e=>{console.log("\ud83d\udcbe [saveCitation] Guardando cita:",e);const{documentId:t,texto:n,nota:i=""}=e;return!t||!n||n.trim().length<10?(console.warn("\u26a0\ufe0f [saveCitation] Cita inv\xe1lida (requiere documentId y texto >10 chars)"),!1):(M((e=>{const s=e[t]||[];if(s.some((e=>e.texto.substring(0,50)===n.substring(0,50))))return console.warn("\u26a0\ufe0f [saveCitation] Cita duplicada, no se guardar\xe1"),e;const r={id:Date.now(),texto:n.trim(),timestamp:Date.now(),nota:i.trim()},a={...e,[t]:[...s,r]};return console.log(`\u2705 [saveCitation] Cita guardada. Total para documento: ${a[t].length}`),a})),!0)}),[]),Q=(0,i.useCallback)(((e,t)=>{console.log(`\ud83d\uddd1\ufe0f [deleteCitation] Eliminando cita ${t} del documento ${e}`),M((n=>{const i=(n[e]||[]).filter((e=>e.id!==t));if(0===i.length){const{[e]:t,...i}=n;return i}return{...n,[e]:i}}))}),[]),Y=(0,i.useCallback)((e=>e&&D[e]||[]),[D]),J=(0,i.useCallback)((e=>{console.log(`\ud83d\uddd1\ufe0f [clearDocumentCitations] Limpiando todas las citas del documento ${e}`),M((t=>{const{[e]:n,...i}=t;return i}))}),[]),Z=(0,i.useCallback)(((e,t)=>{e&&L((n=>{const i=n[e]||{},s="function"===typeof t?t(i):t;return{...n,[e]:{...i,...s}}}))}),[]),ee=(0,i.useCallback)(((e,t)=>{e&&Z(e,(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e,preparation:{...e.preparation||{},...t,updatedAt:Date.now()}}}))}),[Z]),te=(0,i.useCallback)((e=>{e&&L((t=>{const{[e]:n,...i}=t;return i}))}),[]),ne=(0,i.useCallback)((async()=>{if(!h||!p||p.length<100)return console.log("\u26a0\ufe0f [Firestore] No se puede guardar: usuario no autenticado o texto muy corto"),null;try{return console.log("\ud83d\udcbe [Firestore] Texto disponible para guardar (funci\xf3n pendiente de implementaci\xf3n completa)"),console.log("\ud83d\udcca Longitud:",p.length,"palabras"),"pending_implementation"}catch(A){return console.error("\u274c [Firestore] Error:",A),null}}),[h,p]),ie=(0,i.useCallback)((async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(h&&null!==(e=d)&&void 0!==e&&e.role)try{if(console.log("\ud83d\udcbe [Firestore] Sincronizando progreso de r\xfabricas...",t||"todas"),"estudiante"===d.role){const e=window.__rewardsEngine?window.__rewardsEngine.exportState():null,n={rubricProgress:t?{[t]:P[t]}:P,rewardsState:e,lastSync:(new Date).toISOString(),userId:h.uid,syncType:t?"incremental":"full"};return await(0,a.saveStudentProgress)(h.uid,"global_progress",n),console.log("\u2705 [Firestore] Progreso de estudiante sincronizado (incluye rewardsState)"),!0}return console.log("\u2139\ufe0f [Firestore] Usuario docente - progreso no se sincroniza"),!1}catch(A){return console.error("\u274c [Firestore] Error sincronizando progreso:",A),!1}}),[h,d,P]),se=(0,i.useCallback)((async e=>{if(!h)return console.log("\u26a0\ufe0f [Firestore] No se puede guardar evaluaci\xf3n: usuario no autenticado"),null;try{var t;console.log("\ud83d\udcbe [Firestore] Guardando evaluaci\xf3n...");const n={estudianteUid:h.uid,estudianteNombre:(null===(t=d)||void 0===t?void 0:t.nombre)||h.displayName||"Usuario",textoId:e.textId||"unknown",textoTitulo:e.textTitle||"Sin t\xedtulo",respuestas:e.responses||[],puntajes:e.scores||{},puntajeTotal:e.totalScore||0,rubricas:e.rubrics||[],feedback:e.feedback||"",timestamp:new Date},i=await(0,a.RW)(n);return console.log("\u2705 [Firestore] Evaluaci\xf3n guardada con ID:",i),i}catch(A){return console.error("\u274c [Firestore] Error guardando evaluaci\xf3n:",A),null}}),[h,d]),re=(0,i.useCallback)((async()=>{if(h&&0!==Object.keys(D).length)try{console.log("\ud83d\udcbe [Firestore] Citas disponibles para sincronizar:",Object.keys(D).length),console.log("\u2139\ufe0f [Firestore] Sincronizaci\xf3n de citas pendiente de implementaci\xf3n")}catch(A){console.error("\u274c [Firestore] Error sincronizando citas:",A)}}),[h,D]);(0,i.useEffect)((()=>{const e=async e=>{const{rubricId:t,score:n}=e.detail||{};t&&h&&(console.log(`\ud83d\udcca [AppContext] Artefacto completado: ${t}, score: ${n}`),await ie(t))};return window.addEventListener("artifact-evaluated",e),()=>window.removeEventListener("artifact-evaluated",e)}),[h,ie]),(0,i.useEffect)((()=>{var e,t;if(null===(e=h)||void 0===e||!e.uid||null===(t=d)||void 0===t||!t.role||"estudiante"!==d.role)return;let n=null;const i=e=>{const{totalPoints:t,availablePoints:i}=e.detail||{};console.log(`\ud83c\udfae [AppContext] Puntos actualizados: ${t} pts (${i} disponibles)`),n&&clearTimeout(n),n=setTimeout((async()=>{try{var e;const t=null===(e=window.__rewardsEngine)||void 0===e?void 0:e.exportState();if(!t)return;const n={rewardsState:t,lastSync:(new Date).toISOString(),userId:h.uid,syncType:"rewards_update"};await(0,a.saveStudentProgress)(h.uid,"global_progress",n),console.log("\u2705 [AppContext] rewardsState sincronizado a Firestore")}catch(A){console.error("\u274c [AppContext] Error sincronizando rewardsState:",A)}}),3e3)};return window.addEventListener("rewards-state-changed",i),()=>{window.removeEventListener("rewards-state-changed",i),n&&clearTimeout(n)}}),[h,d]),(0,i.useEffect)((()=>{var e,t;if(null===(e=h)||void 0===e||!e.uid||null===(t=d)||void 0===t||!t.role||"estudiante"!==d.role)return;if(!(Object.keys(N).length>0))return;const n=setTimeout((()=>{console.log("\ud83d\udcbe [AppContext] Sincronizando activitiesProgress a Firestore...");const e=window.__rewardsEngine?window.__rewardsEngine.exportState():null,t={activitiesProgress:N,rewardsState:e,lastSync:(new Date).toISOString(),userId:h.uid,syncType:"activities_update"};(0,a.saveStudentProgress)(h.uid,"global_progress",t).then((()=>{console.log("\u2705 [AppContext] activitiesProgress + rewardsState sincronizados")})).catch((e=>{console.error("\u274c [AppContext] Error sincronizando activitiesProgress:",e)}))}),2e3);return()=>clearTimeout(n)}),[N,h,d]),(0,i.useEffect)((()=>{var e;null!==(e=h)&&void 0!==e&&e.uid?((0,s.lt)(h.uid),console.log("\ud83d\udc64 [AppContext] Usuario establecido en SessionManager:",h.uid)):((0,s.lt)(null),console.log("\ud83d\udc64 [AppContext] Usuario removido de SessionManager"))}),[h]);const ae=(0,i.useCallback)((async()=>{try{var e,t,n,i;if(console.log("\ud83d\udd35 [AppContext.createSession] Iniciando creaci\xf3n de sesi\xf3n..."),console.log("\ud83d\udd35 [AppContext.createSession] Texto disponible:",!!p,"longitud:",(null===p||void 0===p?void 0:p.length)||0),console.log("\ud83d\udd35 [AppContext.createSession] Archivo actual:",(null===S||void 0===S?void 0:S.name)||"sin archivo"),console.log("\ud83d\udd35 [AppContext.createSession] currentUser:",(null===(e=h)||void 0===e?void 0:e.email)||"null","uid:",(null===(t=h)||void 0===t?void 0:t.uid)||"null"),null!==(n=h)&&void 0!==n&&n.uid)console.log("\ud83d\udc64 [AppContext.createSession] Configurando usuario en sessionManager:",h.uid),(0,s.lt)(h.uid,(null===(i=d)||void 0===i?void 0:i.nombre)||h.email);else console.warn("\u26a0\ufe0f [AppContext.createSession] Sin usuario autenticado, sesi\xf3n solo local");if(!p||0===p.length)return console.warn("\u26a0\ufe0f [AppContext.createSession] No hay texto para guardar"),null;const r={texto:p,archivoActual:S,completeAnalysis:k,rubricProgress:P,savedCitations:D,activitiesProgress:N,modoOscuro:y,rewardsState:window.__rewardsEngine?window.__rewardsEngine.exportState():null};console.log("\ud83d\udd35 [AppContext.createSession] Llamando a createSessionFromState...");const a=(0,s.aI)(r);return console.log("\u2705 [AppContext.createSession] Sesi\xf3n creada:",null===a||void 0===a?void 0:a.id),window.dispatchEvent(new CustomEvent("session-updated")),a}catch(A){return console.error("\u274c [AppContext.createSession] Error:",A),console.error("\u274c [AppContext.createSession] Stack:",A.stack),null}}),[p,S,k,P,D,N,y,h,d]),oe=(0,i.useCallback)((async()=>{try{var e;console.log("\ud83d\udcbe [AppContext.updateCurrentSession] Actualizando sesi\xf3n actual...");const n=(0,s.dC)();if(!n)return console.warn("\u26a0\ufe0f [AppContext.updateCurrentSession] No hay sesi\xf3n activa para actualizar"),null;var t;if(null!==(e=h)&&void 0!==e&&e.uid)(0,s.lt)(h.uid,(null===(t=d)||void 0===t?void 0:t.nombre)||h.email);if(!p||0===p.length)return console.warn("\u26a0\ufe0f [AppContext.updateCurrentSession] No hay texto para guardar"),null;const i={text:{content:p,fileName:(null===S||void 0===S?void 0:S.name)||"texto_manual",fileType:(null===S||void 0===S?void 0:S.type)||"text/plain",metadata:{length:p.length,words:p.split(/\s+/).length}},completeAnalysis:k,rubricProgress:P,savedCitations:D,activitiesProgress:N,artifactsDrafts:(0,s.cx)(),settings:{modoOscuro:y},rewardsState:window.__rewardsEngine?window.__rewardsEngine.exportState():null};return(0,s.DA)(i)?(console.log("\u2705 [AppContext.updateCurrentSession] Sesi\xf3n actualizada:",n),window.dispatchEvent(new CustomEvent("session-updated")),n):(console.error("\u274c [AppContext.updateCurrentSession] Error actualizando sesi\xf3n"),null)}catch(A){return console.error("\u274c [AppContext.updateCurrentSession] Error:",A),null}}),[p,S,k,P,D,N,y,h,d]),le=(0,i.useCallback)((async e=>{try{(0,s.dC)()&&(console.log("\ud83d\udd12 [AppContext] Deshabilitando auto-guardado durante restauraci\xf3n"),localStorage.setItem("__restoring_session__",Date.now().toString()));const i={setTexto:g,setCompleteAnalysis:I,setRubricProgress:e=>R(e),setSavedCitations:e=>M(e),setActivitiesProgress:e=>L(e)},r=(0,s.fw)(e,i);var t,n;if(r)null!==(t=e.text)&&void 0!==t&&t.fileName&&null!==(n=e.text)&&void 0!==n&&n.fileType&&$({name:e.text.fileName,type:e.text.fileType}),e.rewardsState&&window.__rewardsEngine&&(console.log("\ud83c\udfae [AppContext] Restaurando puntos y gamificaci\xf3n..."),window.__rewardsEngine.importState(e.rewardsState,!1)),console.log("\u2705 [AppContext] Sesi\xf3n restaurada exitosamente"),setTimeout((()=>{localStorage.removeItem("__restoring_session__"),console.log("\ud83d\udd13 [AppContext] Auto-guardado re-habilitado")}),3e3);else localStorage.removeItem("__restoring_session__");return r}catch(A){return console.error("\u274c [AppContext] Error restaurando sesi\xf3n:",A),localStorage.removeItem("__restoring_session__"),!1}}),[g,I,$,R,M]);(0,i.useEffect)((()=>{const e=()=>{const e=localStorage.getItem("__restoring_session__");if(e){const t=parseInt(e,10);Date.now()-t>3e4&&(console.warn("\u26a0\ufe0f [AppContext] Flag __restoring_session__ stuck, limpiando..."),localStorage.removeItem("__restoring_session__"))}};e();const t=setInterval(e,1e4);return()=>clearInterval(t)}),[]),(0,i.useEffect)((()=>{const e=localStorage.getItem("__restoring_session__");if(e){const t=parseInt(e,10);if(!isNaN(t)&&Date.now()-t<3e4)return void console.log("\u23f8\ufe0f [AppContext] Auto-guardado pausado (restauraci\xf3n en curso)")}const t=(0,s.dC)();if(t&&p){console.log("\ud83d\udd04 [AppContext] Auto-guardado programado para sesi\xf3n:",t);const e=setTimeout((()=>{console.log("\ud83d\udcbe [AppContext] Ejecutando auto-guardado de sesi\xf3n:",t);const e=(0,s.Nd)({texto:p,archivoActual:S,completeAnalysis:k,rubricProgress:P,savedCitations:D,activitiesProgress:N,modoOscuro:y}),n=(0,s.DA)(e);console.log("\u2705 [AppContext] Auto-guardado completado:",n)}),2e3);return()=>clearTimeout(e)}}),[p,S,k,P,D,N,y]);const ce=(0,i.useCallback)((()=>{console.log("\ud83d\uddd1\ufe0f [clearAllHistory] Iniciando limpieza completa del historial...");try{const e=["modoOscuro","openai_api_key","tutorDockWidth","tutorFollowUpsEnabled","tutorCompactMode","tutorLengthMode","tutorTemperature"],t=[];for(let a=0;a<localStorage.length;a++)t.push(localStorage.key(a));const n=[/^tutorHistorial/,/^activity_results_/,/^analysis_cache_/,/^visor_highlights_/,/^annotation_/,/^text_analysis_cache/],i=["notasLectura","conversacionesGuardadas","rubricProgress","savedCitations","tutorInteractionsLog","ethicalReflections","tutorConvos","annotations_migrated_v1","tutorHistorial","analysis_cache_stats","analysis_cache_metrics"];let s=0;t.forEach((t=>{if(e.includes(t))return;(n.some((e=>e.test(t)))||i.includes(t))&&(localStorage.removeItem(t),s++,console.log(`  \u2713 Eliminado: ${t}`))}));const r=[];for(let a=0;a<sessionStorage.length;a++)r.push(sessionStorage.key(a));return r.forEach((e=>{(e.includes("resumenAcademico")||e.includes("tablaACD")||e.includes("mapaActores")||e.includes("respuestaArgumentativa"))&&(sessionStorage.removeItem(e),s++,console.log(`  \u2713 Eliminado (session): ${e}`))})),R({rubrica1:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica2:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica3:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica4:{scores:[],average:0,lastUpdate:null,artefactos:[]},rubrica5:{scores:[],average:0,lastUpdate:null,artefactos:[]}}),M({}),I(null),x(null),console.log(`\u2705 [clearAllHistory] Limpieza completada. ${s} elementos eliminados.`),window.dispatchEvent(new CustomEvent("app-history-cleared")),{success:!0,removedCount:s,message:`Se eliminaron ${s} elementos del historial`}}catch(A){return console.error("\u274c [clearAllHistory] Error durante la limpieza:",A),{success:!1,error:A.message,message:"Error al limpiar el historial"}}}),[]),ue=(0,i.useCallback)((async e=>{if(console.log("\ud83d\udd35 [AppContext.analyzeDocument] LLAMADA RECIBIDA"),console.log("\ud83d\udd0d [AppContext.analyzeDocument] Longitud texto:",(null===e||void 0===e?void 0:e.length)||0),!e||e.trim().length<100)console.warn("\u26a0\ufe0f [AppContext.analyzeDocument] Texto muy corto para an\xe1lisis completo (m\xednimo 100 caracteres)");else{console.log("\ud83d\udcca [AppContext.analyzeDocument] Iniciando an\xe1lisis completo con backend RAG..."),_(!0),E("");try{console.log("\ud83c\udf10 [AppContext.analyzeDocument] Llamando al endpoint /api/analysis/prelecture..."),console.log("\ud83d\udd17 [AppContext.analyzeDocument] Backend URL:",c);const t=new AbortController,n=setTimeout((()=>t.abort()),12e4),r=await fetch(`${c}/api/analysis/prelecture`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,metadata:{}}),signal:t.signal});if(clearTimeout(n),!r.ok){const e=await r.json();throw new Error(e.error||`HTTP ${r.status}`)}const a=await r.json();console.log("\ud83d\udce5 [AppContext.analyzeDocument] An\xe1lisis recibido:",a),I(a),console.log("\u2705 [AppContext.analyzeDocument] An\xe1lisis completo guardado en contexto"),console.log("\ud83d\udcbe [AppContext.analyzeDocument] Creando sesi\xf3n con an\xe1lisis completo..."),console.log("\ud83d\udd0d [AppContext.analyzeDocument] text param length:",(null===e||void 0===e?void 0:e.length)||0),console.log("\ud83d\udd0d [AppContext.analyzeDocument] texto state length:",(null===p||void 0===p?void 0:p.length)||0);const o=(0,s.dC)();if(!o&&e&&e.length>0){console.log("\ud83c\udd95 [AppContext.analyzeDocument] Creando nueva sesi\xf3n con texto de par\xe1metro...");try{const t={texto:e,archivoActual:S,completeAnalysis:a,rubricProgress:P,savedCitations:D,modoOscuro:y},n=(0,s.aI)(t);n&&(console.log("\u2705 [AppContext.analyzeDocument] Sesi\xf3n creada:",n.id),window.dispatchEvent(new CustomEvent("session-updated")))}catch(i){console.error("\u274c [AppContext.analyzeDocument] Error creando sesi\xf3n:",i)}}else o?console.log("\u2139\ufe0f [AppContext.analyzeDocument] Ya existe sesi\xf3n activa:",o):console.warn("\u26a0\ufe0f [AppContext.analyzeDocument] No hay texto para crear sesi\xf3n (text length:",(null===e||void 0===e?void 0:e.length)||0,")")}catch(r){var t,n;console.error("\u274c [AppContext.analyzeDocument] Error en an\xe1lisis completo:",r),"AbortError"===r.name?(E("El an\xe1lisis tard\xf3 demasiado tiempo y fue cancelado"),console.error("\u274c [AppContext.analyzeDocument] Timeout despu\xe9s de 2 minutos")):(console.error("\u274c [AppContext.analyzeDocument] Stack:",r.stack),E(`Error en an\xe1lisis: ${r.message}`)),null!==(t=r.response)&&void 0!==t&&null!==(n=t.data)&&void 0!==n&&n.fallback&&I(r.response.data.fallback)}finally{_(!1),console.log("\ud83c\udfc1 [AppContext.analyzeDocument] Proceso finalizado")}}}),[p,S,P,D,y,ae]);(0,i.useEffect)((()=>{const e=window.document.body;y?(e.classList.add("modo-oscuro"),e.setAttribute("data-theme","dark")):(e.classList.remove("modo-oscuro"),e.setAttribute("data-theme","light"))}),[y]),(0,i.useEffect)((()=>{var e,t,n,i,r;(console.log("\ud83d\udd0d [AppContext] useEffect Firebase sync ejecutado, currentUser:",(null===(e=h)||void 0===e?void 0:e.email)||"null","uid:",(null===(t=h)||void 0===t?void 0:t.uid)||"null"),null!==(n=h)&&void 0!==n&&n.uid)?(console.log("\ud83d\udd04 [AppContext] Usuario autenticado detectado, sincronizando sesiones..."),console.log("\ud83d\udc64 [AppContext] UID:",h.uid),console.log("\ud83d\udc64 [AppContext] Email:",h.email),console.log("\ud83d\udc64 [AppContext] Nombre:",(null===(i=d)||void 0===i?void 0:i.nombre)||"sin nombre"),(0,s.lt)(h.uid,(null===(r=d)||void 0===r?void 0:r.nombre)||h.email),(0,s.eh)().then((e=>{console.log(`\u2705 [AppContext] Sincronizaci\xf3n completada: ${e.synced} sesiones subidas`),e.errors>0&&console.warn(`\u26a0\ufe0f [AppContext] ${e.errors} errores en sincronizaci\xf3n`)})).catch((e=>{console.error("\u274c [AppContext] Error en sincronizaci\xf3n inicial:",e)}))):null===h?(console.log("\ud83d\udd12 [AppContext] Usuario deslogueado, limpiando referencia"),(0,s.lt)(null,null)):console.log("\u23f3 [AppContext] currentUser es undefined, esperando...")}),[h,d]),(0,i.useEffect)((()=>{var e,t;if(null===(e=h)||void 0===e||!e.uid||null===(t=d)||void 0===t||!t.role)return void console.log("\ud83d\udd10 [Session] Sin usuario autenticado, saltando sesi\xf3n");let n=null,i=null;return(async()=>{try{console.log("\ud83d\udd10 [Session] ========================================"),console.log("\ud83d\udd10 [Session] Creando sesi\xf3n activa para usuario:",h.uid),console.log("\ud83d\udd10 [Session] Email:",h.email),console.log("\ud83d\udd10 [Session] Role:",d.role);const e=await(0,o.j3)(h.uid,{role:d.role,email:h.email,sessionInfo:(0,o.TT)()});console.log("\u2705 [Session] Sesi\xf3n creada con ID:",e),console.log("\ud83d\udd10 [Session] ========================================"),i=(0,o.z4)(h.uid),console.log("\ud83d\udc93 [Session] Heartbeat iniciado (cada 30s)"),n=(0,o.W6)(h.uid,(e=>{console.error("\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f [Session] ========================================"),console.error("\u26a0\ufe0f [Session] \xa1CONFLICTO DETECTADO! Otra sesi\xf3n activa:"),console.error("\u26a0\ufe0f [Session] Session ID conflictiva:",e.sessionId),console.error("\u26a0\ufe0f [Session] Browser:",e.browser),console.error("\u26a0\ufe0f [Session] Creada:",e.createdAt),console.error("\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f [Session] ========================================"),setTimeout((()=>{var t,n;F(!0),z({browser:e.browser,createdAt:(null===(t=e.createdAt)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||new Date(e.createdAt)})}),0)})),console.log("\ud83d\udc42 [Session] Listener de conflictos activo")}catch(A){console.error("\u274c [Session] Error inicializando sesi\xf3n:",A)}})(),()=>{var e;console.log("\ud83d\udd0c [Session] Limpiando sesi\xf3n..."),i&&(i(),console.log("\ud83d\udc94 [Session] Heartbeat detenido")),n&&(n(),console.log("\ud83d\udd07 [Session] Listener de conflictos desconectado")),null!==(e=h)&&void 0!==e&&e.uid&&(0,o.rY)(h.uid).then((()=>console.log("\u2705 [Session] Sesi\xf3n cerrada correctamente"))).catch((e=>console.warn("\u26a0\ufe0f [Session] Error cerrando sesi\xf3n:",e)))}}),[h,d]),(0,i.useEffect)((()=>{var e,t;if(null===(e=h)||void 0===e||!e.uid||null===(t=d)||void 0===t||!t.role)return;if("estudiante"!==d.role)return;console.log("\ud83d\udc42 [AppContext] Iniciando listener de progreso en tiempo real..."),"undefined"!==typeof window&&(window.__firebaseUserLoading=!0);let n=null,i=!0;return(async()=>{try{console.log("\ud83d\udce5 [AppContext] Cargando progreso inicial desde Firestore...");const e=await(0,a.getStudentProgress)(h.uid,"global_progress");if(!i||!e)return void console.log("\u2139\ufe0f [AppContext] No hay datos iniciales en Firestore");if(console.log("\u2705 [AppContext] Datos iniciales cargados desde Firestore"),e.rewardsState&&window.__rewardsEngine){const t=e.rewardsState.totalPoints||0,n=e.rewardsState.lastInteraction||0,i=window.__rewardsEngine.exportState(),s=i.totalPoints||0,r=i.lastInteraction||0;if(console.log(`\ud83c\udfae [Carga Inicial] Puntos - Remoto: ${t} (${new Date(n).toLocaleString()}), Local: ${s} (${new Date(r).toLocaleString()})`),t>0&&(t>s||t===s&&n>=r))console.log("\u2705 [Carga Inicial] Cargando puntos desde Firebase (source of truth)"),window.__rewardsEngine.importState(e.rewardsState,!1),window.dispatchEvent(new CustomEvent("rewards-state-changed",{detail:{totalPoints:e.rewardsState.totalPoints,availablePoints:e.rewardsState.availablePoints}}));else if(s>t){console.log(`\u26a0\ufe0f [Carga Inicial] Local tiene m\xe1s puntos (${s} > ${t}), mantener pero sincronizar a Firebase`);const e=window.__rewardsEngine.exportState();(0,a.saveStudentProgress)(h.uid,"global_progress",{rewardsState:e,lastSync:(new Date).toISOString(),syncType:"local_higher_on_init"}).catch((e=>console.error("\u274c Error sincronizando puntos locales:",e)))}else console.log("\u2139\ufe0f [Carga Inicial] Puntos iguales o Firebase vac\xedo, mantener estado actual")}"undefined"!==typeof window&&(window.__firebaseUserLoading=!1),e.rubricProgress&&Object.keys(e.rubricProgress).length>0&&(console.log("\ud83d\udcca [Carga Inicial] Cargando rubricProgress"),R((t=>({...t,...e.rubricProgress})))),e.activitiesProgress&&Object.keys(e.activitiesProgress).length>0&&(console.log("\ud83c\udfaf [Carga Inicial] Cargando activitiesProgress"),L((t=>({...t,...e.activitiesProgress}))))}catch(A){console.error("\u274c [AppContext] Error cargando progreso inicial:",A)}})(),n=(0,a.subscribeToStudentProgress)(h.uid,"global_progress",(async e=>{if(i)if(e){if(console.log("\ud83d\udce5 [AppContext] Progreso recibido desde Firestore:",e),e.rubricProgress&&R((t=>{const n={...t};let i=!1;return Object.keys(e.rubricProgress).forEach((s=>{const r=e.rubricProgress[s],a=t[s];if(!a||!a.lastUpdate)return n[s]=r,i=!0,void console.log(`\ud83d\udcca [Sync] ${s}: Datos remotos agregados (no exist\xeda local)`);const o=r.totalScore||0,l=a.totalScore||0,c=r.lastUpdate||0,u=a.lastUpdate||0;o>l?(n[s]=r,i=!0,console.log(`\ud83d\udcca [Sync] ${s}: Remoto mejor (${o} > ${l})`)):o===l&&c>u?(n[s]=r,i=!0,console.log(`\ud83d\udcca [Sync] ${s}: Remoto m\xe1s reciente (mismo score: ${o})`)):console.log(`\ud83d\udcca [Sync] ${s}: Local mejor o igual (${l} >= ${o})`)})),i?(console.log("\u2705 [Sync] rubricProgress actualizado desde Firestore"),window.dispatchEvent(new CustomEvent("progress-synced-from-cloud",{detail:{type:"rubricProgress",timestamp:Date.now()}})),n):t})),e.activitiesProgress&&L((t=>{const n={...t};let i=!1;return Object.keys(e.activitiesProgress).forEach((s=>{var r,a,o;const l=e.activitiesProgress[s],c=t[s];if(!c||null===(r=c.preparation)||void 0===r||!r.updatedAt)return n[s]=l,i=!0,void console.log(`\ud83c\udfaf [Sync] ${s}: Actividad remota agregada (no exist\xeda local)`);const u=(null===(a=l.preparation)||void 0===a?void 0:a.updatedAt)||0,h=(null===(o=c.preparation)||void 0===o?void 0:o.updatedAt)||0,d=Object.keys(l.preparation||{}).length,p=Object.keys(c.preparation||{}).length;d>p?(n[s]=l,i=!0,console.log(`\ud83c\udfaf [Sync] ${s}: Remota m\xe1s completa (${d} campos > ${p})`)):d===p&&u>h?(n[s]=l,i=!0,console.log(`\ud83c\udfaf [Sync] ${s}: Remota m\xe1s reciente (${new Date(u).toLocaleTimeString()})`)):console.log(`\ud83c\udfaf [Sync] ${s}: Local m\xe1s completa o igual, manteniendo`)})),i?(console.log("\u2705 [Sync] activitiesProgress actualizado desde Firestore"),window.dispatchEvent(new CustomEvent("progress-synced-from-cloud",{detail:{type:"activitiesProgress",timestamp:Date.now()}})),n):t})),e.rewardsState){if(!window.__rewardsEngine)return console.warn("\u26a0\ufe0f [Sync] rewardsEngine a\xfan no inicializado, esperando..."),void setTimeout((()=>{window.__rewardsEngine&&(console.log("\u2705 [Sync] rewardsEngine ya disponible, importando estado remoto"),window.__rewardsEngine.importState(e.rewardsState,!1),window.dispatchEvent(new CustomEvent("rewards-state-changed",{detail:{totalPoints:e.rewardsState.totalPoints,availablePoints:e.rewardsState.availablePoints}})))}),500);try{const t=window.__rewardsEngine.exportState(),n=e.rewardsState,i=n.totalPoints||0,s=t.totalPoints||0,r=n.lastInteraction||0,o=t.lastInteraction||0;if(i>s)console.log(`\ud83c\udfae [Sync] Usando rewardsState remoto (${i} pts > ${s} pts locales)`),window.__rewardsEngine.importState(n,!1),window.dispatchEvent(new CustomEvent("rewards-state-changed",{detail:{totalPoints:n.totalPoints,availablePoints:n.availablePoints}})),window.dispatchEvent(new CustomEvent("progress-synced-from-cloud",{detail:{type:"rewardsState",timestamp:Date.now()}}));else if(i===s&&r>o)console.log(`\ud83c\udfae [Sync] Usando rewardsState remoto (mismo pts, m\xe1s reciente: ${new Date(r).toLocaleString()})`),window.__rewardsEngine.importState(n,!1),window.dispatchEvent(new CustomEvent("rewards-state-changed",{detail:{totalPoints:n.totalPoints,availablePoints:n.availablePoints}})),window.dispatchEvent(new CustomEvent("progress-synced-from-cloud",{detail:{type:"rewardsState",timestamp:Date.now()}}));else if(s>i){console.log(`\ud83c\udfae [Sync] Local tiene m\xe1s puntos (${s} > ${i}), subiendo a Firestore`);const e=window.__rewardsEngine.exportState();await(0,a.saveStudentProgress)(h.uid,"global_progress",{rewardsState:e,lastSync:(new Date).toISOString(),syncType:"local_higher_score"}),console.log("\ud83d\udce4 [Sync] Estado local con m\xe1s puntos subido a Firestore")}else console.log(`\ud83c\udfae [Sync] Estados iguales (${s} pts), manteniendo local`)}catch(A){console.error("\u274c [Sync] Error en merge de rewardsState:",A)}}}else console.log("\u2139\ufe0f [AppContext] No hay progreso remoto a\xfan")})),console.log("\u2705 [AppContext] Listener de tiempo real activo"),()=>{i=!1,console.log("\ud83d\udd0c [AppContext] Desconectando listener de progreso"),n&&n()}}),[h,d]),(0,i.useEffect)((()=>{var e;if(null===(e=h)||void 0===e||!e.uid)return;let t=!0;return(async()=>{try{console.log("\ud83d\udce5 [AppContext] Cargando sesiones iniciales desde Firestore...");const e=await(0,a.XF)(h.uid);if(!t)return;const n=(0,s.Dq)(),i=(0,a.Iq)(n,e);localStorage.setItem("appLectura_sessions",JSON.stringify(i)),console.log(`\u2705 [AppContext] ${i.length} sesiones cargadas desde Firebase (${e.length} remotas, ${n.length} locales)`),window.dispatchEvent(new CustomEvent("sessions-loaded-from-firebase",{detail:{count:i.length}}))}catch(A){console.error("\u274c [AppContext] Error cargando sesiones iniciales:",A)}})(),()=>{t=!1}}),[h]);const[he,de]=(0,i.useState)(!1);(0,i.useEffect)((()=>{if(k&&p&&!he){console.log("\ud83c\udf93 [AppContext] An\xe1lisis completo detectado, marcando para auto-generaci\xf3n de notas"),de(!0);const e=p.substring(0,50).replace(/\s+/g,"_");localStorage.setItem(`notas_disponibles_${e}`,"true")}}),[k,p,he]),(0,i.useEffect)((()=>{de(!1)}),[p]);const pe=(0,i.useMemo)((()=>({setTexto:g,setOpenAIApiKey:V,toggleModoOscuro:B,setLoading:j,setError:H,setArchivoActual:$,setTextStructure:q,analyzeDocument:ue,setCompleteAnalysis:I,updateRubricScore:W,clearRubricProgress:G,resetAllProgress:K,saveCitation:X,deleteCitation:Q,getCitations:Y,clearDocumentCitations:J,updateActivitiesProgress:Z,markPreparationProgress:ee,resetActivitiesProgress:te,clearAllHistory:ce,createSession:ae,updateCurrentSessionFromState:oe,restoreSession:le,saveCurrentTextToFirestore:ne,syncRubricProgressToFirestore:ie,saveEvaluationToFirestore:se,syncCitationsToFirestore:re})),[g,V,B,j,H,$,q,ue,W,G,K,X,Q,Y,J,Z,ee,te,ce,ae,oe,le,ne,ie,se,re]),fe=(0,i.useMemo)((()=>({texto:p,openAIApiKey:m,modoOscuro:y,loading:w,error:A,archivoActual:S,textStructure:T,completeAnalysis:k,rubricProgress:P,savedCitations:D,notasAutoGeneradas:he,currentUser:h,userData:d,activitiesProgress:N,sessionConflict:O,conflictingSessionInfo:U})),[p,m,y,w,A,S,T,k,P,D,he,h,d,N,O,U]),ge=(0,i.useMemo)((()=>({...fe,...pe})),[fe,pe]);return(0,l.jsx)(u.Provider,{value:ge,children:t})}},498:(e,t,n)=>{n.d(t,{cY:()=>f,FA:()=>M,g:()=>D,u:()=>o,Uj:()=>a,Fy:()=>v,tD:()=>B,bD:()=>O,hp:()=>V,T9:()=>d,Tj:()=>u,yU:()=>h,XA:()=>p,mS:()=>l,Ku:()=>$,ZQ:()=>_,sr:()=>C,zJ:()=>g,c1:()=>S,Im:()=>L,lT:()=>x,zW:()=>P,jZ:()=>A,lV:()=>T,nr:()=>k,Ov:()=>I,gE:()=>m,Am:()=>U,I9:()=>z,P1:()=>w,eX:()=>R});const i=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296===(64512&s)&&i+1<e.length&&56320===(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<e.length;s+=3){const t=e[s],r=s+1<e.length,a=r?e[s+1]:0,o=s+2<e.length,l=o?e[s+2]:0,c=t>>2,u=(3&t)<<4|a>>4;let h=(15&a)<<2|l>>6,d=63&l;o||(d=64,r||(h=64)),i.push(n[c],n[u],n[h],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],a=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<e.length;){const t=n[e.charAt(s++)],a=s<e.length?n[e.charAt(s)]:0;++s;const o=s<e.length?n[e.charAt(s)]:64;++s;const l=s<e.length?n[e.charAt(s)]:64;if(++s,null==t||null==a||null==o||null==l)throw new r;const c=t<<2|a>>4;if(i.push(c),64!==o){const e=a<<4&240|o>>2;if(i.push(e),64!==l){const e=o<<6&192|l;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return function(e){const t=i(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return s.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function l(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}const c=()=>{try{return l().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BACKEND_URL:"https://applectura-backend.onrender.com",REACT_APP_FIREBASE_API_KEY:"AIzaSyAzh5Qqiend6CSZzzCu6aUm4V9r17X42Ic",REACT_APP_FIREBASE_APP_ID:"1:522981088704:web:4d58bbb7f74ca661ccbc25",REACT_APP_FIREBASE_AUTH_DOMAIN:"applectura-cb058.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"522981088704",REACT_APP_FIREBASE_PROJECT_ID:"applectura-cb058",REACT_APP_FIREBASE_STORAGE_BUCKET:"applectura-cb058.firebasestorage.app",REACT_APP_PORT:"3000",REACT_APP_SERPER_API_KEY:"",REACT_APP_TAVILY_API_KEY:"configured"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&o(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},u=e=>c()?.emulatorHosts?.[e],h=e=>{const t=u(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},d=()=>c()?.config,p=e=>c()?.[`_${e}`];class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function g(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function m(e){return(await fetch(e,{credentials:"include"})).ok}function v(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e};return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(r)),""].join(".")}const y={};let b=!1;function w(e,t){if("undefined"===typeof window||"undefined"===typeof document||!g(window.location.host)||y[e]===t||y[e]||b)return;function n(e){return`__firebase__banner__${e}`}y[e]=t;const i="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(y))y[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function r(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{b=!0,function(){const e=document.getElementById(i);e&&e.remove()}()},e}function a(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(i),t=n("text"),a=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),l=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,o);const n=r();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,a,l,n),document.body.appendChild(t)}s?(a.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}function _(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function A(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_())}function E(){const e=c()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}function S(){return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function C(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function T(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function x(){const e=_();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function k(){return!E()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function I(){return!E()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function P(){try{return"object"===typeof indexedDB}catch(e){return!1}}function R(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(n){t(n)}}))}class D extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,D.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,M.prototype.create)}}class M{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(N,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(i,t):"Error",r=`${this.serviceName}: ${s} (${n}).`;return new D(n,r,t)}}const N=/\{\$([^}]+)}/g;function L(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function O(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(F(n)&&F(r)){if(!O(n,r))return!1}else if(n!==r)return!1}for(const s of i)if(!n.includes(s))return!1;return!0}function F(e){return null!==e&&"object"===typeof e}function U(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function z(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function V(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function B(e,t){const n=new j(e,t);return n.subscribe.bind(n)}class j{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=H),void 0===i.error&&(i.error=H),void 0===i.complete&&(i.complete=H);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function H(){}function $(e){return e&&e._delegate?e._delegate:e}},1352:(e,t,n)=>{var i=n(7119);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},1741:(e,t,n)=>{n.d(t,{MF:()=>ue,j6:()=>re,xZ:()=>ae,om:()=>se,Sx:()=>de,Wp:()=>he,KO:()=>pe});var i=n(6863),s=n(2226),r=n(498);let a,o;const l=new WeakMap,c=new WeakMap,u=new WeakMap,h=new WeakMap,d=new WeakMap;let p={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return c.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.apply(v(this),n),m(l.get(this))}:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return m(e.apply(v(this),n))}:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];const r=e.call(v(this),t,...i);return u.set(r,t.sort?t.sort():[t]),m(r)}}function g(e){return"function"===typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(c.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)}));c.set(e,t)}(e),t=e,(a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,p):e);var t}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(m(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&l.set(t,e)})).catch((()=>{})),d.set(t,e),t}(e);if(h.has(e))return h.get(e);const t=g(e);return t!==e&&(h.set(e,t),d.set(t,e)),t}const v=e=>d.get(e);const y=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],w=new Map;function _(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=b.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!y.includes(n))return;const r=async function(e){const t=this.transaction(e,s?"readwrite":"readonly");let r=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];return i&&(r=r.index(o.shift())),(await Promise.all([r[n](...o),s&&t.done]))[0]};return w.set(t,r),r}p=(e=>({...e,get:(t,n,i)=>_(t,n)||e.get(t,n,i),has:(t,n)=>!!_(t,n)||e.has(t,n)}))(p);class A{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const E="@firebase/app",S="0.14.4",C=new s.Vy("@firebase/app"),T="@firebase/app-compat",x="@firebase/analytics-compat",k="@firebase/analytics",I="@firebase/app-check-compat",P="@firebase/app-check",R="@firebase/auth",D="@firebase/auth-compat",M="@firebase/database",N="@firebase/data-connect",L="@firebase/database-compat",O="@firebase/functions",F="@firebase/functions-compat",U="@firebase/installations",z="@firebase/installations-compat",V="@firebase/messaging",B="@firebase/messaging-compat",j="@firebase/performance",H="@firebase/performance-compat",$="@firebase/remote-config",q="@firebase/remote-config-compat",W="@firebase/storage",G="@firebase/storage-compat",K="@firebase/firestore",X="@firebase/ai",Q="@firebase/firestore-compat",Y="firebase",J="[DEFAULT]",Z={[E]:"fire-core",[T]:"fire-core-compat",[k]:"fire-analytics",[x]:"fire-analytics-compat",[P]:"fire-app-check",[I]:"fire-app-check-compat",[R]:"fire-auth",[D]:"fire-auth-compat",[M]:"fire-rtdb",[N]:"fire-data-connect",[L]:"fire-rtdb-compat",[O]:"fire-fn",[F]:"fire-fn-compat",[U]:"fire-iid",[z]:"fire-iid-compat",[V]:"fire-fcm",[B]:"fire-fcm-compat",[j]:"fire-perf",[H]:"fire-perf-compat",[$]:"fire-rc",[q]:"fire-rc-compat",[W]:"fire-gcs",[G]:"fire-gcs-compat",[K]:"fire-fst",[Q]:"fire-fst-compat",[X]:"fire-vertex","fire-js":"fire-js",[Y]:"fire-js-all"},ee=new Map,te=new Map,ne=new Map;function ie(e,t){try{e.container.addComponent(t)}catch(n){C.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function se(e){const t=e.name;if(ne.has(t))return C.debug(`There were multiple attempts to register component ${t}.`),!1;ne.set(t,e);for(const n of ee.values())ie(n,e);for(const n of te.values())ie(n,e);return!0}function re(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ae(e){return null!==e&&void 0!==e&&void 0!==e.settings}const oe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},le=new r.FA("app","Firebase",oe);class ce{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.uA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw le.create("app-deleted",{appName:this._name})}}const ue="12.4.0";function he(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const s={name:J,automaticDataCollectionEnabled:!0,...t},a=s.name;if("string"!==typeof a||!a)throw le.create("bad-app-name",{appName:String(a)});if(n||(n=(0,r.T9)()),!n)throw le.create("no-options");const o=ee.get(a);if(o){if((0,r.bD)(n,o.options)&&(0,r.bD)(s,o.config))return o;throw le.create("duplicate-app",{appName:a})}const l=new i.h1(a);for(const i of ne.values())l.addComponent(i);const c=new ce(n,s,l);return ee.set(a,c),c}function de(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J;const t=ee.get(e);if(!t&&e===J&&(0,r.T9)())return he();if(!t)throw le.create("no-app",{appName:e});return t}function pe(e,t,n){let s=Z[e]??e;n&&(s+=`-${n}`);const r=s.match(/\s|\//),a=t.match(/\s|\//);if(r||a){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void C.warn(e.join(" "))}se(new i.uA(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const fe="firebase-heartbeat-store";let ge=null;function me(){return ge||(ge=function(e,t){let{blocked:n,upgrade:i,blocking:s,terminated:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=m(a);return i&&a.addEventListener("upgradeneeded",(e=>{i(m(a.result),e.oldVersion,e.newVersion,m(a.transaction),e)})),n&&a.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),o.then((e=>{r&&e.addEventListener("close",(()=>r())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(fe)}catch(n){console.warn(n)}}}).catch((e=>{throw le.create("idb-open",{originalErrorMessage:e.message})}))),ge}async function ve(e,t){try{const n=(await me()).transaction(fe,"readwrite"),i=n.objectStore(fe);await i.put(t,ye(e)),await n.done}catch(n){if(n instanceof r.g)C.warn(n.message);else{const e=le.create("idb-set",{originalErrorMessage:n?.message});C.warn(e.message)}}}function ye(e){return`${e.name}!${e.options.appId}`}class be{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new _e(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=we();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){C.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=we(),{heartbeatsToSend:t,unsentEntries:n}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let i=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),Ae(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ae(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=(0,r.Uj)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return C.warn(e),""}}}function we(){return(new Date).toISOString().substring(0,10)}class _e{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,r.zW)()&&(0,r.eX)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await me()).transaction(fe),n=await t.objectStore(fe).get(ye(e));return await t.done,n}catch(t){if(t instanceof r.g)C.warn(t.message);else{const e=le.create("idb-get",{originalErrorMessage:t?.message});C.warn(e.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return ve(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return ve(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function Ae(e){return(0,r.Uj)(JSON.stringify({version:2,heartbeats:e})).length}var Ee;Ee="",se(new i.uA("platform-logger",(e=>new A(e)),"PRIVATE")),se(new i.uA("heartbeat",(e=>new be(e)),"PRIVATE")),pe(E,S,Ee),pe(E,S,"esm2020"),pe("fire-js","")},1761:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,s=e[i];if(!(0<r(s,t)))break e;e[i]=t,e[n]=s,n=i}}function i(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,s=e.length,a=s>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,u=e[c];if(0>r(l,n))c<s&&0>r(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<s&&0>r(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,g=!1,m=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=i(u);null!==t;){if(null===t.callback)s(u);else{if(!(t.startTime<=e))break;s(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function _(e){if(m=!1,w(e),!g)if(null!==i(c))g=!0,M(A);else{var t=i(u);null!==t&&N(_,t.startTime-e)}}function A(e,n){g=!1,m&&(m=!1,y(T),T=-1),f=!0;var r=p;try{for(w(n),d=i(c);null!==d&&(!(d.expirationTime>n)||e&&!I());){var a=d.callback;if("function"===typeof a){d.callback=null,p=d.priorityLevel;var o=a(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===i(c)&&s(c),w(n)}else s(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&N(_,h.startTime-n),l=!1}return l}finally{d=null,p=r,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E,S=!1,C=null,T=-1,x=5,k=-1;function I(){return!(t.unstable_now()-k<x)}function P(){if(null!==C){var e=t.unstable_now();k=e;var n=!0;try{n=C(!0,e)}finally{n?E():(S=!1,C=null)}}else S=!1}if("function"===typeof b)E=function(){b(P)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,D=R.port2;R.port1.onmessage=P,E=function(){D.postMessage(null)}}else E=function(){v(P,0)};function M(e){C=e,S||(S=!0,E())}function N(e,n){T=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,M(A))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,s,r){var a=t.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?a+r:a:r=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:s,priorityLevel:e,startTime:r,expirationTime:o=r+o,sortIndex:-1},r>a?(e.sortIndex=r,n(u,e),null===i(c)&&e===i(u)&&(m?(y(T),T=-1):m=!0,N(_,r-a))):(e.sortIndex=o,n(c,e),g||f||(g=!0,M(A))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},2049:(e,t)=>{var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var w=b.prototype=new y;w.constructor=b,g(w,v.prototype),w.isPureReactComponent=!0;var _=Array.isArray,A=Object.prototype.hasOwnProperty,E={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,i){var s,r={},a=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)A.call(t,s)&&!S.hasOwnProperty(s)&&(r[s]=t[s]);var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===r[s]&&(r[s]=l[s]);return{$$typeof:n,type:e,key:a,ref:o,props:r,_owner:E.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var x=/\/+/g;function k(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,s,r,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return a=a(l=e),e=""===r?"."+k(l,0):r,_(a)?(s="",null!=e&&(s=e.replace(x,"$&/")+"/"),I(a,t,s,"",(function(e){return e}))):null!=a&&(T(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(x,"$&/")+"/")+e)),t.push(a)),1;if(l=0,r=""===r?".":r+":",_(e))for(var c=0;c<e.length;c++){var u=r+k(o=e[c],c);l+=I(o,t,s,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=I(o=o.value,t,s,u=r+k(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,n){if(null==e)return e;var i=[],s=0;return I(e,i,"","",(function(e){return t.call(n,e,s++)})),i}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},M={transition:null},N={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:M,ReactCurrentOwner:E};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=s,t.Profiler=a,t.PureComponent=b,t.StrictMode=r,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,t.act=L,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=g({},e.props),r=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=E.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)A.call(t,c)&&!S.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:n,type:e.type,key:r,ref:a,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},2180:(e,t,n)=>{n.d(t,{TT:()=>h,W6:()=>c,j3:()=>a,rY:()=>l,z4:()=>u});var i=n(5299),s=n(306);function r(){let e=sessionStorage.getItem("appLectura_sessionId");return e||(e=`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("appLectura_sessionId",e)),e}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=r();console.log("\ud83d\udd10 [SessionManager.createActiveSession] Iniciando..."),console.log("  - User ID:",e),console.log("  - Session ID:",n),console.log("  - Metadata:",t);const a={sessionId:n,userId:e,createdAt:(0,s.O5)(),lastActivity:(0,s.O5)(),browser:navigator.userAgent,...t},o=(0,s.H9)(i.db,"active_sessions",e);try{return console.log("\ud83d\udcdd [SessionManager] Escribiendo a Firestore:",o.path),await(0,s.BN)(o,a),console.log("\u2705 [SessionManager] Sesi\xf3n creada exitosamente"),console.log("\ud83d\udcca [SessionManager] Datos guardados:",a),n}catch(l){throw console.error("\u274c [SessionManager] Error creando sesi\xf3n:",l),console.error("\ud83d\udccb [SessionManager] Detalles del error:",l.message),l}}async function o(e){const t=r(),n=(0,s.H9)(i.db,"active_sessions",e);try{await(0,s.BN)(n,{sessionId:t,lastActivity:(0,s.O5)()},{merge:!0}),console.log("\ud83d\udd04 [SessionManager] Actividad actualizada")}catch(a){console.warn("\u26a0\ufe0f [SessionManager] Error actualizando actividad:",a)}}async function l(e){const t=(0,s.H9)(i.db,"active_sessions",e);try{await(0,s.kd)(t),sessionStorage.removeItem("appLectura_sessionId"),console.log("\u2705 [SessionManager] Sesi\xf3n cerrada")}catch(n){console.error("\u274c [SessionManager] Error cerrando sesi\xf3n:",n)}}function c(e,t){const n=r(),a=(0,s.H9)(i.db,"active_sessions",e);return console.log("\ud83d\udc42 [SessionManager.listenToSessionConflicts] Iniciando listener..."),console.log("  - User ID:",e),console.log("  - Current Session ID:",n),console.log("  - Firestore path:",a.path),(0,s.aQ)(a,(e=>{if(console.log("\ud83d\udce1 [SessionManager] Snapshot recibido"),console.log("  - Documento existe:",e.exists()),e.exists()){const i=e.data();console.log("\ud83d\udcca [SessionManager] Datos de sesi\xf3n:",i),console.log("  - Session ID en Firestore:",i.sessionId),console.log("  - Session ID local:",n),console.log("  - \xbfSon diferentes?:",i.sessionId!==n),i.sessionId!==n?(console.warn("\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f [SessionManager] \xa1CONFLICTO! Sesi\xf3n tomada por otro dispositivo"),console.warn("  - Session ID nueva:",i.sessionId),console.warn("  - Session ID nuestra:",n),t(i)):console.log("\u2705 [SessionManager] Sesi\xf3n v\xe1lida, es nuestra")}else console.log("\u2139\ufe0f [SessionManager] Sesi\xf3n eliminada de Firestore")}),(e=>{console.error("\u274c [SessionManager] Error en listener de sesi\xf3n:",e)}))}function u(e){const t=setInterval((()=>{o(e)}),3e4);return o(e),()=>clearInterval(t)}function h(){return{sessionId:r(),browser:navigator.userAgent,timestamp:(new Date).toISOString()}}},2226:(e,t,n)=>{n.d(t,{$b:()=>s,Vy:()=>c});const i=[];var s;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));const r={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},a=s.INFO,o={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},l=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),i=o[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);for(var s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];console[i](`[${n}]  ${e.name}:`,...r)};class c{constructor(e){this.name=e,this._logLevel=a,this._logHandler=l,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?r[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...t),this._logHandler(this,s.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...t),this._logHandler(this,s.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.INFO,...t),this._logHandler(this,s.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.WARN,...t),this._logHandler(this,s.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.ERROR,...t),this._logHandler(this,s.ERROR,...t)}}},2423:(e,t,n)=>{n.d(t,{nb:()=>ke,XR:()=>Ce,qk:()=>Se,c7:()=>xe,KR:()=>Te,D:()=>Ee});var i=n(1741),s=n(498),r=n(6863);const a="firebasestorage.googleapis.com",o="storageBucket";class l extends s.g{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(h(e),`Firebase Storage: ${t} (${h(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,l.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return h(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var c,u;function h(e){return"storage/"+e}function d(){return new l(c.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function p(){return new l(c.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function f(){return new l(c.CANCELED,"User canceled the upload/download.")}function g(){return new l(c.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function m(e){return new l(c.INVALID_ARGUMENT,e)}function v(){return new l(c.APP_DELETED,"The Firebase app was deleted.")}function y(e,t){return new l(c.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function b(e){throw new l(c.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(c||(c={}));class w{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=w.makeFromUrl(e,t)}catch(s){return new w(e,"")}if(""===n.path)return n;throw i=e,new l(c.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)";const s=new RegExp("^gs://"+i+"(/(.*))?$","i");function r(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),u=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:r},{regex:new RegExp(`^https?://${t===a?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:r}];for(let a=0;a<u.length;a++){const t=u[a],i=t.regex.exec(e);if(i){const e=i[t.indices.bucket];let s=i[t.indices.path];s||(s=""),n=new w(e,s),t.postModify(n);break}}if(null==n)throw function(e){return new l(c.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class _{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function A(e){return"string"===typeof e||e instanceof String}function E(e){return S()&&e instanceof Blob}function S(){return"undefined"!==typeof Blob}function C(e,t,n,i){if(i<t)throw m(`Invalid value for '${e}'. Expected ${t} or greater.`);if(i>n)throw m(`Invalid value for '${e}'. Expected ${n} or less.`)}function T(e,t,n){let i=t;return null==n&&(i=`https://${t}`),`${n}://${i}/v0${e}`}function x(e){const t=encodeURIComponent;let n="?";for(const i in e)if(e.hasOwnProperty(i)){n=n+(t(i)+"="+t(e[i]))+"&"}return n=n.slice(0,-1),n}function k(e,t){const n=e>=500&&e<600,i=-1!==[408,429].indexOf(e),s=-1!==t.indexOf(e);return n||i||s}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(u||(u={}));class I{constructor(e,t,n,i,s,r,a,o,l,c,u){let h=!(arguments.length>11&&void 0!==arguments[11])||arguments[11],d=arguments.length>12&&void 0!==arguments[12]&&arguments[12];this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=r,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=u,this.retry=h,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new P(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===u.NO_ERROR,s=n.getStatus();if(!t||k(s,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===u.ABORT;return void e(!1,new P(!1,null,t))}const r=-1!==this.successCodes_.indexOf(s);e(!0,new P(r,n))}))},t=(e,t)=>{const n=this.resolve_,i=this.reject_,s=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(s,s.getResponse());void 0!==e?n(e):n()}catch(r){i(r)}else if(null!==s){const e=d();e.serverResponse=s.getErrorText(),this.errorCallback_?i(this.errorCallback_(s,e)):i(e)}else if(t.canceled){i(this.appDelete_?v():f())}else{i(p())}};this.canceled_?t(0,new P(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,s=null,r=null,a=!1,o=0;function l(){return 2===o}let c=!1;function u(){if(!c){c=!0;for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(null,n)}}function h(t){s=setTimeout((()=>{s=null,e(p,l())}),t)}function d(){r&&clearTimeout(r)}function p(e){if(c)return void d();for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];if(e)return d(),void u.call(null,e,...n);if(l()||a)return d(),void u.call(null,e,...n);let r;i<64&&(i*=2),1===o?(o=2,r=0):r=1e3*(i+Math.random()),h(r)}let f=!1;function g(e){f||(f=!0,d(),c||(null!==s?(e||(o=2),clearTimeout(s),h(0)):e||(o=1)))}return h(0),r=setTimeout((()=>{a=!0,g(!0)}),n),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class P{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function R(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function D(){const e=R();for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(void 0!==e){const t=new e;for(let e=0;e<n.length;e++)t.append(n[e]);return t.getBlob()}if(S())return new Blob(n);throw new l(c.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function M(e){if("undefined"===typeof atob)throw t="base-64",new l(c.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`);var t;return atob(e)}const N="raw",L="base64",O="base64url",F="data_url";class U{constructor(e,t){this.data=e,this.contentType=t||null}}function z(e,t){switch(e){case N:return new U(V(t));case L:case O:return new U(B(e,t));case F:return new U(function(e){const t=new j(e);return t.base64?B(L,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(n){throw y(F,"Malformed data URL.")}return V(t)}(t.rest)}(t),new j(t).contentType)}throw d()}function V(e){const t=[];for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i<=127)t.push(i);else if(i<=2047)t.push(192|i>>6,128|63&i);else if(55296===(64512&i)){if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1))){i=65536|(1023&i)<<10|1023&e.charCodeAt(++n),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}else t.push(239,191,189)}else 56320===(64512&i)?t.push(239,191,189):t.push(224|i>>12,128|i>>6&63,128|63&i)}return new Uint8Array(t)}function B(e,t){switch(e){case L:{const n=-1!==t.indexOf("-"),i=-1!==t.indexOf("_");if(n||i){throw y(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case O:{const n=-1!==t.indexOf("+"),i=-1!==t.indexOf("/");if(n||i){throw y(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=M(t)}catch(s){if(s.message.includes("polyfill"))throw s;throw y(e,"Invalid character found")}const i=new Uint8Array(n.length);for(let r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return i}class j{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw y(F,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){if(!(e.length>=t.length))return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class H{constructor(e,t){let n=0,i="";E(e)?(this.data_=e,n=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(E(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new H(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new H(n,!0)}}static getBlob(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(S()){const e=t.map((e=>e instanceof H?e.data_:e));return new H(D.apply(null,e))}{const e=t.map((e=>A(e)?z(N,e).data:e.data_));let n=0;e.forEach((e=>{n+=e.byteLength}));const i=new Uint8Array(n);let s=0;return e.forEach((e=>{for(let t=0;t<e.length;t++)i[s++]=e[t]})),new H(i,!0)}}uploadData(){return this.data_}}function $(e){let t;try{t=JSON.parse(e)}catch(i){return null}return"object"!==typeof(n=t)||Array.isArray(n)?null:t;var n}function q(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function W(e,t){return t}class G{constructor(e,t,n,i){this.server=e,this.local=t||e,this.writable=!!n,this.xform=i||W}}let K=null;function X(){if(K)return K;const e=[];e.push(new G("bucket")),e.push(new G("generation")),e.push(new G("metageneration")),e.push(new G("name","fullPath",!0));const t=new G("name");t.xform=function(e,t){return function(e){return!A(e)||e.length<2?e:q(e)}(t)},e.push(t);const n=new G("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new G("timeCreated")),e.push(new G("updated")),e.push(new G("md5Hash",null,!0)),e.push(new G("cacheControl",null,!0)),e.push(new G("contentDisposition",null,!0)),e.push(new G("contentEncoding",null,!0)),e.push(new G("contentLanguage",null,!0)),e.push(new G("contentType",null,!0)),e.push(new G("metadata","customMetadata",!0)),K=e,K}function Q(e,t,n){const i={type:"file"},s=n.length;for(let r=0;r<s;r++){const e=n[r];i[e.local]=e.xform(i,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,i=e.fullPath,s=new w(n,i);return t._makeStorageReference(s)}})}(i,e),i}function Y(e,t,n){const i=$(t);if(null===i)return null;return Q(e,i,n)}function J(e,t){const n={},i=t.length;for(let s=0;s<i;s++){const i=t[s];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}class Z{constructor(e,t,n,i){this.url=e,this.method=t,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function ee(e){if(!e)throw d()}function te(e,t){return function(n,i){const s=Y(e,i,t);return ee(null!==s),s}}function ne(e,t){return function(n,i){const s=Y(e,i,t);return ee(null!==s),function(e,t,n,i){const s=$(t);if(null===s)return null;if(!A(s.downloadTokens))return null;const r=s.downloadTokens;if(0===r.length)return null;const a=encodeURIComponent;return r.split(",").map((t=>{const s=e.bucket,r=e.fullPath;return T("/b/"+a(s)+"/o/"+a(r),n,i)+x({alt:"media",token:t})}))[0]}(s,i,e.host,e._protocol)}}function ie(e){return function(t,n){let i;var s,r;return 401===t.getStatus()?i=t.getErrorText().includes("Firebase App Check token is invalid")?new l(c.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new l(c.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(r=e.bucket,i=new l(c.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(s=e.path,i=new l(c.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")):i=n,i.status=t.getStatus(),i.serverResponse=n.serverResponse,i}}function se(e){const t=ie(e);return function(n,i){let s=t(n,i);var r;return 404===n.getStatus()&&(r=e.path,s=new l(c.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")),s.serverResponse=i.serverResponse,s}}function re(e,t,n){const i=Object.assign({},n);return i.fullPath=e.path,i.size=t.size(),i.contentType||(i.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),i}function ae(e,t,n,i,s){const r=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};const o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;const l=re(t,i,s),c="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+J(l,n)+"\r\n--"+o+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",u="\r\n--"+o+"--",h=H.getBlob(c,i,u);if(null===h)throw g();const d={name:l.fullPath},p=T(r,e.host,e._protocol),f=e.maxUploadRetryTime,m=new Z(p,"POST",te(e,n),f);return m.urlParams=d,m.headers=a,m.body=h.uploadData(),m.errorHandler=ie(t),m}let oe=null;class le{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=u.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=u.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=u.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,i,r){if(this.sent_)throw b("cannot .send() more than once");if((0,s.zJ)(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const s in r)r.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,r[s].toString());return void 0!==i?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw b("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw b("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw b("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw b("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class ce extends le{initXhr(){this.xhr_.responseType="text"}}function ue(){return oe?oe():new ce}class he{constructor(e,t){this._service=e,this._location=t instanceof w?t:w.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new he(e,t)}get root(){const e=new w(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return q(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new w(this._location.bucket,e);return new he(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new l(c.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function de(e,t,n){e._throwIfRoot("uploadBytes");const i=ae(e.storage,e._location,X(),new H(t,!0),n);return e.storage.makeRequestWithTokens(i,ue).then((t=>({metadata:t,ref:e})))}function pe(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const i=T(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,r=new Z(i,"GET",ne(e,n),s);return r.errorHandler=se(t),r}(e.storage,e._location,X());return e.storage.makeRequestWithTokens(t,ue).then((e=>{if(null===e)throw new l(c.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function fe(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=T(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new Z(n,"DELETE",(function(e,t){}),i);return s.successCodes=[200,204],s.errorHandler=se(t),s}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,ue)}function ge(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),i=new w(e._location.bucket,n);return new he(e.storage,i)}function me(e,t){if(e instanceof be){const n=e;if(null==n._bucket)throw new l(c.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+o+"' property when initializing the app?");const i=new he(n,n._bucket);return null!=t?me(i,t):i}return void 0!==t?ge(e,t):e}function ve(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof be)return new he(e,t);throw m("To use ref(service, url), the first argument must be a Storage instance.")}return me(e,t)}function ye(e,t){const n=t?.[o];return null==n?null:w.makeFromBucketSpec(n,e)}class be{constructor(e,t,n,i,s){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=s,this._isUsingEmulator=r,this._bucket=null,this._host=a,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?w.makeFromBucketSpec(i,this._host):ye(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=w.makeFromBucketSpec(this._url,e):this._bucket=ye(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){C("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){C("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if((0,i.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new he(this,e)}_makeRequest(e,t,n,i){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new _(v());{const r=function(e,t,n,i,s,r){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=x(e.urlParams),c=e.url+l,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}(u,r),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,i),new I(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,s,a,o)}(e,this._appId,n,i,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(r),r.getPromise().then((()=>this._requests.delete(r)),(()=>this._requests.delete(r))),r}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const we="@firebase/storage",_e="0.14.0",Ae="storage";function Ee(e,t,n){return de(e=(0,s.Ku)(e),t,n)}function Se(e){return pe(e=(0,s.Ku)(e))}function Ce(e){return fe(e=(0,s.Ku)(e))}function Te(e,t){return ve(e=(0,s.Ku)(e),t)}function xe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.Sx)(),t=arguments.length>1?arguments[1]:void 0;e=(0,s.Ku)(e);const n=(0,i.j6)(e,Ae).getImmediate({identifier:t}),r=(0,s.yU)("storage");return r&&ke(n,...r),n}function ke(e,t,n){!function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host=`${t}:${n}`;const r=(0,s.zJ)(t);r&&((0,s.gE)(`https://${e.host}/b`),(0,s.P1)("Storage",!0)),e._isUsingEmulator=!0,e._protocol=r?"https":"http";const{mockUserToken:a}=i;a&&(e._overrideAuthToken="string"===typeof a?a:(0,s.Fy)(a,e.app.options.projectId))}(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{})}function Ie(e,t){let{instanceIdentifier:n}=t;const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),a=e.getProvider("app-check-internal");return new be(s,r,a,n,i.MF)}(0,i.om)(new r.uA(Ae,Ie,"PUBLIC").setMultipleInstances(!0)),(0,i.KO)(we,_e,""),(0,i.KO)(we,_e,"esm2020")},2654:(e,t,n)=>{var i=n(9950),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,r={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,i)&&!l.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:s,type:e,key:c,ref:u,props:r,_owner:o.current}}t.Fragment=r,t.jsx=c,t.jsxs=c},2726:(e,t,n)=>{n(7764).EA.workerSrc="/pdf.worker.min.js"},3096:(e,t,n)=>{n.d(t,{HF:()=>Ye,Wq:()=>De,xI:()=>Fn,hg:()=>dt,J1:()=>ut,x9:()=>ht,df:()=>Yt,CI:()=>pt});var i=n(1741),s=n(498),r=n(2226),a=n(6863);function o(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const l=o,c=new s.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),u=new r.Vy("@firebase/auth");function h(e){if(u.logLevel<=r.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];u.error(`Auth (${i.MF}): ${e}`,...n)}}function d(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw v(e,...n)}function p(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return v(e,...n)}function f(e,t,n){const i={...l(),[t]:n};return new s.FA("auth","Firebase",i).create(t,{appName:e.name})}function g(e){return f(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function m(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&d(e,"argument-error"),f(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function v(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if("string"!==typeof e){const t=n[0],i=[...n.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(t,...i)}return c.create(e,...n)}function y(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];throw v(t,...i)}}function b(e){const t="INTERNAL ASSERTION FAILED: "+e;throw h(t),new Error(t)}function w(e,t){e||b(t)}function _(){return"undefined"!==typeof self&&self.location?.href||""}function A(){return"http:"===E()||"https:"===E()}function E(){return"undefined"!==typeof self&&self.location?.protocol||null}class S{constructor(e,t){this.shortDelay=e,this.longDelay=t,w(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,s.jZ)()||(0,s.lV)()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(A()||(0,s.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function C(e,t){w(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class T{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void b("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void b("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void b("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const x={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},k=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],I=new S(3e4,6e4);function P(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function R(e,t,n,i){return D(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},(async()=>{let r={},a={};i&&("GET"===t?a=i:r={body:JSON.stringify(i)});const o=(0,s.Am)({key:e.config.apiKey,...a}).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const c={method:t,headers:l,...r};return(0,s.c1)()||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,s.zJ)(e.emulatorConfig.host)&&(c.credentials="include"),T.fetch()(await N(e,e.config.apiHost,n,o),c)}))}async function D(e,t,n){e._canInitEmulator=!1;const i={...x,...t};try{const t=new O(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw F(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw F(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw F(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw F(e,"user-disabled",r);const o=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw f(e,o,a);d(e,o)}}catch(r){if(r instanceof s.g)throw r;d(e,"network-request-failed",{message:String(r)})}}async function M(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=await R(e,t,n,i,s);return"mfaPendingCredential"in r&&d(e,"multi-factor-auth-required",{_serverResponse:r}),r}async function N(e,t,n,i){const s=`${t}${n}?${i}`,r=e,a=r.config.emulator?C(e.config,s):`${e.config.apiScheme}://${s}`;if(k.includes(n)&&(await r._persistenceManagerAvailable,"COOKIE"===r._getPersistenceType())){return r._getPersistence()._getFinalTarget(a).toString()}return a}function L(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class O{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(p(this.auth,"network-request-failed"))),I.get())}))}}function F(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=p(e,t,i);return s.customData._tokenResponse=n,s}function U(e){return void 0!==e&&void 0!==e.enterprise}class z{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return L(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function V(e,t){return R(e,"GET","/v2/recaptchaConfig",P(e,t))}async function B(e,t){return R(e,"POST","/v1/accounts:lookup",t)}function j(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function H(e){return 1e3*Number(e)}function $(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return h("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,s.u)(n);return e?JSON.parse(e):(h("Failed to decode base64 JWT payload"),null)}catch(r){return h("Caught error parsing JWT payload as JSON",r?.toString()),null}}function q(e){const t=$(e);return y(t,"internal-error"),y("undefined"!==typeof t.exp,"internal-error"),y("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function W(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof s.g&&function(e){let{code:t}=e;return"auth/user-disabled"===t||"auth/user-token-expired"===t}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class G{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e?.code&&this.schedule(!0))}this.schedule()}}class K{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=j(this.lastLoginAt),this.creationTime=j(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function X(e){const t=e.auth,n=await e.getIdToken(),i=await W(e,B(t,{idToken:n}));y(i?.users.length,t,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const r=s.providerUserInfo?.length?Q(s.providerUserInfo):[],a=(o=e.providerData,l=r,[...o.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var o,l;const c=e.isAnonymous,u=!(e.email&&s.passwordHash)&&!a?.length,h=!!c&&u,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new K(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(e,d)}function Q(e){return e.map((e=>{let{providerId:t,...n}=e;return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class Y{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){y(e.idToken,"internal-error"),y("undefined"!==typeof e.idToken,"internal-error"),y("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):q(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){y(0!==e.length,"internal-error");const t=q(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(y(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(e,t){const n=await D(e,{},(async()=>{const n=(0,s.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,a=await N(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:n};return e.emulatorConfig&&(0,s.zJ)(e.emulatorConfig.host)&&(l.credentials="include"),T.fetch()(a,l)}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new Y;return n&&(y("string"===typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(y("string"===typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(y("number"===typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Y,this.toJSON())}_performRefresh(){return b("not implemented")}}function J(e,t){y("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Z{constructor(e){let{uid:t,auth:n,stsTokenManager:i,...s}=e;this.providerId="firebase",this.proactiveRefresh=new G(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new K(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await W(this,this.stsTokenManager.getToken(this.auth,e));return y(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,s.Ku)(e),i=await n.getIdToken(t),r=$(i);y(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const a="object"===typeof r.firebase?r.firebase:void 0,o=a?.sign_in_provider;return{claims:r,token:i,authTime:j(H(r.auth_time)),issuedAtTime:j(H(r.iat)),expirationTime:j(H(r.exp)),signInProvider:o||null,signInSecondFactor:a?.sign_in_second_factor||null}}(this,e)}reload(){return async function(e){const t=(0,s.Ku)(e);await X(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(y(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>({...e}))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Z({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){y(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await X(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,i.xZ)(this.auth.app))return Promise.reject(g(this.auth));const e=await this.getIdToken();return await W(this,async function(e,t){return R(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>({...e}))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,r=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;y(u&&f,e,"internal-error");const g=Y.fromJSON(this.name,f);y("string"===typeof u,e,"internal-error"),J(n,e.name),J(i,e.name),y("boolean"===typeof h,e,"internal-error"),y("boolean"===typeof d,e,"internal-error"),J(s,e.name),J(r,e.name),J(a,e.name),J(o,e.name),J(l,e.name),J(c,e.name);const m=new Z({uid:u,auth:e,email:i,emailVerified:h,displayName:n,isAnonymous:d,photoURL:r,phoneNumber:s,tenantId:a,stsTokenManager:g,createdAt:l,lastLoginAt:c});return p&&Array.isArray(p)&&(m.providerData=p.map((e=>({...e})))),o&&(m._redirectEventId=o),m}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=new Y;i.updateFromServerResponse(t);const s=new Z({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await X(s),s}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];y(void 0!==i.localId,"internal-error");const s=void 0!==i.providerUserInfo?Q(i.providerUserInfo):[],r=!(i.email&&i.passwordHash)&&!s?.length,a=new Y;a.updateFromIdToken(n);const o=new Z({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:r}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new K(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(o,l),o}}const ee=new Map;function te(e){w(e instanceof Function,"Expected a class definition");let t=ee.get(e);return t?(w(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ee.set(e,t),t)}class ne{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ne.type="NONE";const ie=ne;function se(e,t,n){return`firebase:${e}:${t}:${n}`}class re{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=se(this.userKey,i.apiKey,s),this.fullPersistenceKey=se("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await B(this.auth,{idToken:e}).catch((()=>{}));return t?Z._fromGetAccountInfoResponse(this.auth,t,e):null}return Z._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new re(te(ie),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=i[0]||te(ie);const r=se(n,e.config.apiKey,e.name);let a=null;for(const l of t)try{const t=await l._get(r);if(t){let n;if("string"===typeof t){const i=await B(e,{idToken:t}).catch((()=>{}));if(!i)break;n=await Z._fromGetAccountInfoResponse(e,i,t)}else n=Z._fromJSON(e,t);l!==s&&(a=n),s=l;break}}catch{}const o=i.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&o.length?(s=o[0],a&&await s._set(r,a.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(r)}catch{}}))),new re(s,e,n)):new re(s,e,n)}}function ae(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ue(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(oe(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(de(t))return"Blackberry";if(pe(t))return"Webos";if(le(t))return"Safari";if((t.includes("chrome/")||ce(t))&&!t.includes("edge/"))return"Chrome";if(he(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===n?.length)return n[1]}return"Other"}function oe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/firefox\//i.test(e)}function le(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ce(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/crios\//i.test(e)}function ue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/iemobile/i.test(e)}function he(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/android/i.test(e)}function de(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/blackberry/i.test(e)}function pe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/webos/i.test(e)}function fe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ge(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return fe(e)||he(e)||pe(e)||de(e)||/windows phone/i.test(e)||ue(e)}function me(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=ae((0,s.ZQ)());break;case"Worker":t=`${ae((0,s.ZQ)())}-${e}`;break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return`${t}/JsCore/${i.MF}/${r}`}class ve{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(s){i(s)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(i){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}class ye{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class be{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _e(this),this.idTokenSubscription=new _e(this),this.beforeStateQueue=new ve(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=c,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise((e=>this._resolvePersistenceManagerAvailable=e))}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=te(t)),this._initializationPromise=this.queue((async()=>{if(!this._deleted&&(this.persistenceManager=await re.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(n){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await B(this,{idToken:e}),n=await Z._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if((0,i.xZ)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,i=n?._redirectEventId,r=await this.tryRedirectSignIn(e);t&&t!==i||!r?.user||(n=r.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(r){n=t,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(r)))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return y(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await X(e)}catch(t){if("auth/network-request-failed"!==t?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,i.xZ)(this.app))return Promise.reject(g(this));const t=e?(0,s.Ku)(e):null;return t&&y(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&y(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(0,i.xZ)(this.app)?Promise.reject(g(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,i.xZ)(this.app)?Promise.reject(g(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(te(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return R(e,"GET","/v2/passwordPolicy",P(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new ye(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new s.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return R(e,"POST","/v2/accounts:revokeToken",P(e,t))}(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&te(e)||this._popupRedirectResolver;y(t,this,"argument-error"),this.redirectPersistenceManager=await re.create(this,[te(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue((async()=>{})),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"===typeof t?t:t.next.bind(t);let r=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(y(a,this,"internal-error"),a.then((()=>{r||s(this.currentUser)})),"function"===typeof t){const s=e.addObserver(t,n,i);return()=>{r=!0,s()}}{const n=e.addObserver(t);return()=>{r=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return y(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=me(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if((0,i.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return e?.error&&function(e){if(u.logLevel<=r.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];u.warn(`Auth (${i.MF}): ${e}`,...n)}}(`Error while retrieving App Check token: ${e.error}`),e?.token}}function we(e){return(0,s.Ku)(e)}class _e{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,s.tD)((e=>this.observer=e))}get next(){return y(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ae={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ee(e){return Ae.loadJS(e)}function Se(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Ce{constructor(){this.enterprise=new Te}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Te{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const xe="NO_RECAPTCHA";class ke{constructor(e){this.type="recaptcha-enterprise",this.auth=we(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,i){const s=window.grecaptcha;U(s)?s.enterprise.ready((()=>{s.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(xe)}))})):i(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Ce).execute("siteKey",{action:"verify"})}return new Promise(((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{V(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new z(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((s=>{if(!t&&U(window.grecaptcha))n(s,e,i);else{if("undefined"===typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=Ae.recaptchaEnterpriseScript;0!==t.length&&(t+=s),Ee(t).then((()=>{n(s,e,i)})).catch((e=>{i(e)}))}})).catch((e=>{i(e)}))}))}}async function Ie(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=new ke(e);let a;if(s)a=xe;else try{a=await r.verify(n)}catch(l){a=await r.verify(n,!0)}const o={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in o){const e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return i?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Pe(e,t,n,i,s){if("EMAIL_PASSWORD_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Ie(e,t,n,"getOobCode"===n);return i(e,s)}return i(e,t).catch((async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await Ie(e,t,n,"getOobCode"===n);return i(e,s)}return Promise.reject(s)}))}if("PHONE_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const s=await Ie(e,t,n);return i(e,s).catch((async s=>{if("AUDIT"===e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const s=await Ie(e,t,n,!1,!0);return i(e,s)}return Promise.reject(s)}))}{const s=await Ie(e,t,n,!1,!0);return i(e,s)}}return Promise.reject(s+" provider is not supported.")}async function Re(e){const t=we(e),n=await V(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),i=new z(n);if(null==t.tenantId?t._agentRecaptchaConfig=i:t._tenantRecaptchaConfigs[t.tenantId]=i,i.isAnyProviderEnabled()){new ke(t).verify()}}function De(e,t,n){const i=we(e);y(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!n?.disableWarnings,a=Me(t),{host:o,port:l}=function(e){const t=Me(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const e=s[1];return{host:e,port:Ne(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Ne(t)}}}(t),c=null===l?"":`:${l}`,u={url:`${a}//${o}${c}/`},h=Object.freeze({host:o,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator)return y(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),void y((0,s.bD)(u,i.config.emulator)&&(0,s.bD)(h,i.emulatorConfig),i,"emulator-config-failed");i.config.emulator=u,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,(0,s.zJ)(o)?((0,s.gE)(`${a}//${o}${c}`),(0,s.P1)("Auth",!0)):r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Me(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ne(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Le{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return b("not implemented")}_getIdTokenResponse(e){return b("not implemented")}_linkToIdToken(e,t){return b("not implemented")}_getReauthenticationResolver(e){return b("not implemented")}}async function Oe(e,t){return R(e,"POST","/v1/accounts:signUp",t)}async function Fe(e,t){return M(e,"POST","/v1/accounts:signInWithPassword",P(e,t))}async function Ue(e,t){return R(e,"POST","/v1/accounts:sendOobCode",P(e,t))}async function ze(e,t){return Ue(e,t)}class Ve extends Le{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Ve(e,t,"password")}static _fromEmailAndCode(e,t){return new Ve(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Pe(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Fe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return M(e,"POST","/v1/accounts:signInWithEmailLink",P(e,t))}(e,{email:this._email,oobCode:this._password});default:d(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Pe(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Oe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return M(e,"POST","/v1/accounts:signInWithEmailLink",P(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:d(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Be(e,t){return M(e,"POST","/v1/accounts:signInWithIdp",P(e,t))}class je extends Le{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new je(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):d("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i,...s}=t;if(!n||!i)return null;const r=new je(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(e){return Be(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Be(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Be(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,s.Am)(t)}return e}}async function He(e,t){return R(e,"POST","/v1/accounts:sendVerificationCode",P(e,t))}const $e={USER_NOT_FOUND:"user-not-found"};class qe extends Le{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new qe({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new qe({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return M(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await M(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,t));if(n.temporaryProof)throw F(e,"account-exists-with-different-credential",n);return n}(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return async function(e,t){return M(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,{...t,operation:"REAUTH"}),$e)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new qe({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class We{constructor(e){const t=(0,s.I9)((0,s.hp)(e)),n=t.apiKey??null,i=t.oobCode??null,r=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);y(n&&i&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=function(e){const t=(0,s.I9)((0,s.hp)(e)).link,n=t?(0,s.I9)((0,s.hp)(t)).deep_link_id:null,i=(0,s.I9)((0,s.hp)(e)).deep_link_id;return(i?(0,s.I9)((0,s.hp)(i)).link:null)||i||n||t||e}(e);try{return new We(t)}catch{return null}}}class Ge{constructor(){this.providerId=Ge.PROVIDER_ID}static credential(e,t){return Ve._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=We.parseLink(t);return y(n,"argument-error"),Ve._fromEmailAndCode(e,n.code,n.tenantId)}}Ge.PROVIDER_ID="password",Ge.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ge.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ke{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Xe extends Ke{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Qe extends Xe{constructor(){super("facebook.com")}static credential(e){return je._fromParams({providerId:Qe.PROVIDER_ID,signInMethod:Qe.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qe.credentialFromTaggedObject(e)}static credentialFromError(e){return Qe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Qe.credential(t.oauthAccessToken)}catch{return null}}}Qe.FACEBOOK_SIGN_IN_METHOD="facebook.com",Qe.PROVIDER_ID="facebook.com";class Ye extends Xe{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return je._fromParams({providerId:Ye.PROVIDER_ID,signInMethod:Ye.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ye.credentialFromTaggedObject(e)}static credentialFromError(e){return Ye.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:i}=t;if(!n&&!i)return null;try{return Ye.credential(n,i)}catch{return null}}}Ye.GOOGLE_SIGN_IN_METHOD="google.com",Ye.PROVIDER_ID="google.com";class Je extends Xe{constructor(){super("github.com")}static credential(e){return je._fromParams({providerId:Je.PROVIDER_ID,signInMethod:Je.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Je.credentialFromTaggedObject(e)}static credentialFromError(e){return Je.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Je.credential(t.oauthAccessToken)}catch{return null}}}Je.GITHUB_SIGN_IN_METHOD="github.com",Je.PROVIDER_ID="github.com";class Ze extends Xe{constructor(){super("twitter.com")}static credential(e,t){return je._fromParams({providerId:Ze.PROVIDER_ID,signInMethod:Ze.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ze.credentialFromTaggedObject(e)}static credentialFromError(e){return Ze.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:i}=t;if(!n||!i)return null;try{return Ze.credential(n,i)}catch{return null}}}Ze.TWITTER_SIGN_IN_METHOD="twitter.com",Ze.PROVIDER_ID="twitter.com";class et{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=await Z._fromIdTokenResponse(e,n,i),r=tt(n);return new et({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=tt(n);return new et({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function tt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class nt extends s.g{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,nt.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new nt(e,t,n,i)}}function it(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw nt._fromErrorAndOperation(e,n,t,i);throw n}))}async function st(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=await W(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return et._forOperation(e,"link",i)}async function rt(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:s}=e;if((0,i.xZ)(s.app))return Promise.reject(g(s));const r="reauthenticate";try{const i=await W(e,it(s,r,t,e),n);y(i.idToken,s,"internal-error");const a=$(i.idToken);y(a,s,"internal-error");const{sub:o}=a;return y(e.uid===o,s,"user-mismatch"),et._forOperation(e,r,i)}catch(a){throw"auth/user-not-found"===a?.code&&d(s,"user-mismatch"),a}}async function at(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,i.xZ)(e.app))return Promise.reject(g(e));const s="signIn",r=await it(e,s,t),a=await et._fromIdTokenResponse(e,s,r);return n||await e._updateCurrentUser(a.user),a}async function ot(e,t){return at(we(e),t)}function lt(e,t,n){y(n.url?.length>0,e,"invalid-continue-uri"),y("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),y("undefined"===typeof n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(y(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(y(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function ct(e){const t=we(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function ut(e,t,n){const i=we(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&lt(i,s,n),await Pe(i,s,"getOobCode",ze,"EMAIL_PASSWORD_PROVIDER")}function ht(e,t,n){return(0,i.xZ)(e.app)?Promise.reject(g(e)):ot((0,s.Ku)(e),Ge.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&ct(e),t}))}function dt(e,t,n,i){return(0,s.Ku)(e).onAuthStateChanged(t,n,i)}function pt(e){return(0,s.Ku)(e).signOut()}function ft(e,t){return R(e,"POST","/v2/accounts/mfaEnrollment:start",P(e,t))}new WeakMap;const gt="__sak";class mt{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(gt,"1"),this.storage.removeItem(gt),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class vt extends mt{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ge(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);(0,s.lT)()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}vt.type="LOCAL";const yt=vt;function bt(e){const t=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),n=RegExp(`${t}=([^;]+)`);return document.cookie.match(n)?.[1]??null}function wt(e){return`${"http:"===window.location.protocol?"__dev_":"__HOST-"}FIREBASE_${e.split(":")[3]}`}class _t{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(navigator.cookieEnabled??!0))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=wt(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return e?.value}return bt(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=wt(e);document.cookie=`${t}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch((()=>{}))}_addListener(e,t){if(!this._isAvailable())return;const n=wt(e);if(window.cookieStore){const e=e=>{const i=e.changed.find((e=>e.name===n));i&&t(i.value);e.deleted.find((e=>e.name===n))&&t(null)},i=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,i),window.cookieStore.addEventListener("change",e)}let i=bt(n);const s=setInterval((()=>{const e=bt(n);e!==i&&(t(e),i=e)}),1e3);this.listenerUnsubscribes.set(t,(()=>clearInterval(s)))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}_t.type="COOKIE";class At extends mt{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}At.type="SESSION";const Et=At;class St{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new St(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!r?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const a=Array.from(r).map((async e=>e(t.origin,s))),o=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Ct(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}St.receivers=[];class Tt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const i="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise(((a,o)=>{const l=Ct("",20);i.port1.start();const c=setTimeout((()=>{o(new Error("unsupported_event"))}),n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),s=setTimeout((()=>{o(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(c),clearTimeout(s),o(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function xt(){return window}function kt(){return"undefined"!==typeof xt().WorkerGlobalScope&&"function"===typeof xt().importScripts}const It="firebaseLocalStorageDb",Pt="firebaseLocalStorage",Rt="fbase_key";class Dt{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Mt(e,t){return e.transaction([Pt],t?"readwrite":"readonly").objectStore(Pt)}function Nt(){const e=indexedDB.open(It,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Pt,{keyPath:Rt})}catch(i){n(i)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Pt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(It);return new Dt(e).toPromise()}(),t(await Nt()))}))}))}async function Lt(e,t,n){const i=Mt(e,!0).put({[Rt]:t,value:n});return new Dt(i).toPromise()}function Ot(e,t){const n=Mt(e,!0).delete(t);return new Dt(n).toPromise()}class Ft{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Nt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return kt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=St._getInstance(kt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new Tt(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Nt();return await Lt(e,gt,"1"),await Ot(e,gt),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Lt(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Mt(e,!1).get(t),i=await new Dt(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Ot(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Mt(e,!1).getAll();return new Dt(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ft.type="LOCAL";const Ut=Ft;function zt(e,t){return R(e,"POST","/v2/accounts/mfaSignIn:start",P(e,t))}Se("rcb"),new S(3e4,6e4);const Vt="recaptcha";async function Bt(e,t,n){if(!e._getRecaptchaConfig())try{await Re(e)}catch(i){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){y("enroll"===t.type,e,"internal-error");const s={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},r=Pe(e,s,"mfaSmsEnrollment",(async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===xe){y(n?.type===Vt,e,"argument-error");return ft(e,await jt(e,t,n))}return ft(e,t)}),"PHONE_PROVIDER");return(await r.catch((e=>Promise.reject(e)))).phoneSessionInfo.sessionInfo}{y("signin"===t.type,e,"internal-error");const s=i.multiFactorHint?.uid||i.multiFactorUid;y(s,e,"missing-multi-factor-info");const r={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=Pe(e,r,"mfaSmsSignIn",(async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===xe){y(n?.type===Vt,e,"argument-error");return zt(e,await jt(e,t,n))}return zt(e,t)}),"PHONE_PROVIDER");return(await a.catch((e=>Promise.reject(e)))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},s=Pe(e,t,"sendVerificationCode",(async(e,t)=>{if(t.captchaResponse===xe){y(n?.type===Vt,e,"argument-error");return He(e,await jt(e,t,n))}return He(e,t)}),"PHONE_PROVIDER");return(await s.catch((e=>Promise.reject(e)))).sessionInfo}}finally{n?._reset()}}async function jt(e,t,n){y(n.type===Vt,e,"argument-error");const i=await n.verify();y("string"===typeof i,e,"argument-error");const s={...t};if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,r=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:r}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:i}),s}class Ht{constructor(e){this.providerId=Ht.PROVIDER_ID,this.auth=we(e)}verifyPhoneNumber(e,t){return Bt(this.auth,e,(0,s.Ku)(t))}static credential(e,t){return qe._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ht.credentialFromTaggedObject(t)}static credentialFromError(e){return Ht.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:i}=t;return n&&i?qe._fromTokenResponse(n,i):null}}function $t(e,t){return t?te(t):(y(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Ht.PROVIDER_ID="phone",Ht.PHONE_SIGN_IN_METHOD="phone";class qt extends Le{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Be(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Be(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Be(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Wt(e){return at(e.auth,new qt(e),e.bypassAuthState)}function Gt(e){const{auth:t,user:n}=e;return y(n,t,"internal-error"),rt(n,new qt(e),e.bypassAuthState)}async function Kt(e){const{auth:t,user:n}=e;return y(n,t,"internal-error"),st(n,new qt(e),e.bypassAuthState)}class Xt{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:a}=e;if(r)return void this.reject(r);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Wt;case"linkViaPopup":case"linkViaRedirect":return Kt;case"reauthViaPopup":case"reauthViaRedirect":return Gt;default:d(this.auth,"internal-error")}}resolve(e){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Qt=new S(2e3,1e4);async function Yt(e,t,n){if((0,i.xZ)(e.app))return Promise.reject(p(e,"operation-not-supported-in-this-environment"));const s=we(e);m(e,t,Ke);const r=$t(s,n);return new Jt(s,"signInViaPopup",t,r).executeNotNull()}class Jt extends Xt{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,Jt.currentPopupAction&&Jt.currentPopupAction.cancel(),Jt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return y(e,this.auth,"internal-error"),e}async onExecution(){w(1===this.filter.length,"Popup operations only handle one event");const e=Ct();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(p(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(p(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Jt.currentPopupAction=null}pollUserCancellation(){const e=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(p(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Qt.get())};e()}}Jt.currentPopupAction=null;const Zt=new Map;class en extends Xt{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Zt.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=sn(t),i=nn(e);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Zt.set(this.auth._key(),e)}return this.bypassAuthState||Zt.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function tn(e,t){Zt.set(e._key(),t)}function nn(e){return te(e._redirectPersistence)}function sn(e){return se("pendingRedirect",e.config.apiKey,e.name)}async function rn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,i.xZ)(e.app))return Promise.reject(g(e));const s=we(e),r=$t(s,t),a=new en(s,r,n),o=await a.execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,t)),o}class an{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ln(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!ln(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(p(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(on(e))}saveEventToCache(e){this.cachedEventUids.add(on(e)),this.lastProcessedEventTime=Date.now()}}function on(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function ln(e){let{type:t,error:n}=e;return"unknown"===t&&"auth/no-auth-event"===n?.code}const cn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,un=/^https?/;async function hn(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return R(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const n of t)try{if(dn(n))return}catch{}d(e,"unauthorized-domain")}function dn(e){const t=_(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!un.test(n))return!1;if(cn.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const pn=new S(3e4,6e4);function fn(){const e=xt().___jsl;if(e?.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function gn(e){return new Promise(((t,n)=>{function i(){fn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{fn(),n(p(e,"network-request-failed"))},timeout:pn.get()})}if(xt().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else{if(!xt().gapi?.load){const t=Se("iframefcb");return xt()[t]=()=>{gapi.load?i():n(p(e,"network-request-failed"))},Ee(`${Ae.gapiScript}?onload=${t}`).catch((e=>n(e)))}i()}})).catch((e=>{throw mn=null,e}))}let mn=null;const vn=new S(5e3,15e3),yn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function wn(e){const t=e.config;y(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?C(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:i.MF},a=bn.get(e.config.apiHost);a&&(r.eid=a);const o=e._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${(0,s.Am)(r).slice(1)}`}async function _n(e){const t=await function(e){return mn=mn||gn(e),mn}(e),n=xt().gapi;return y(n,e,"internal-error"),t.open({where:document.body,url:wn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yn,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=p(e,"network-request-failed"),r=xt().setTimeout((()=>{i(s)}),vn.get());function a(){xt().clearTimeout(r),n(t)}t.ping(a).then(a,(()=>{i(s)}))}))))}const An={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class En{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Sn(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const a=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let l="";const c={...An,width:i.toString(),height:r.toString(),top:a,left:o},u=(0,s.ZQ)().toLowerCase();n&&(l=ce(u)?"_blank":n),oe(u)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,t)=>{let[n,i]=t;return`${e}${n}=${i},`}),"");if(function(){return fe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)())&&!!window.navigator?.standalone}(u)&&"_self"!==l)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",l),new En(null);const d=window.open(t||"",l,h);y(d,e,"popup-blocked");try{d.focus()}catch(p){}return new En(d)}const Cn="__/auth/handler",Tn="emulator/auth/handler",xn=encodeURIComponent("fac");async function kn(e,t,n,r,a,o){y(e.config.authDomain,e,"auth-domain-config-required"),y(e.config.apiKey,e,"invalid-api-key");const l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:i.MF,eventId:a};if(t instanceof Ke){t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,s.Im)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(o||{}))l[e]=t}if(t instanceof Xe){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(l.scopes=e.join(","))}e.tenantId&&(l.tid=e.tenantId);const c=l;for(const i of Object.keys(c))void 0===c[i]&&delete c[i];const u=await e._getAppCheckToken(),h=u?`#${xn}=${encodeURIComponent(u)}`:"";return`${function(e){let{config:t}=e;if(!t.emulator)return`https://${t.authDomain}/${Cn}`;return C(t,Tn)}(e)}?${(0,s.Am)(c).slice(1)}${h}`}const In="webStorageSupport";const Pn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Et,this._completeRedirectFn=rn,this._overrideRedirectResult=tn}async _openPopup(e,t,n,i){w(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");return Sn(e,await kn(e,t,n,_(),i),Ct())}async _openRedirect(e,t,n,i){await this._originValidation(e);return function(e){xt().location.href=e}(await kn(e,t,n,_(),i)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(w(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await _n(e),n=new an(e);return t.register("authEvent",(t=>{y(t?.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(In,{type:In},(n=>{const i=n?.[0]?.[In];void 0!==i&&t(!!i),d(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=hn(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ge()||le()||fe()}};var Rn="@firebase/auth",Dn="1.11.0";class Mn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e(t?.stsTokenManager.accessToken||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){y(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Nn=(0,s.XA)("authIdTokenMaxAge")||300;let Ln=null;const On=e=>async t=>{const n=t&&await t.getIdTokenResult(),i=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>Nn)return;const s=n?.token;Ln!==s&&(Ln=s,await fetch(e,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Fn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.Sx)();const t=(0,i.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,i.j6)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),i=n.getOptions();if((0,s.bD)(i,t??{}))return e;d(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Pn,persistence:[Ut,yt,Et]}),r=(0,s.XA)("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=On(e.toString());!function(e,t,n){(0,s.Ku)(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,t,n,i){(0,s.Ku)(e).onIdTokenChanged(t,n,i)}(n,(e=>t(e)))}}const a=(0,s.Tj)("auth");return a&&De(n,`http://${a}`),n}var Un;Ae={loadJS:e=>new Promise(((t,n)=>{const i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=p("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(i)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Un="Browser",(0,i.om)(new a.uA("auth",((e,t)=>{let{options:n}=t;const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=i.options;y(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:a,authDomain:o,clientPlatform:Un,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:me(Un)},c=new be(i,s,r,l);return function(e,t){const n=t?.persistence||[],i=(Array.isArray(n)?n:[n]).map(te);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,t?.popupRedirectResolver)}(c,n),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,i.om)(new a.uA("auth-internal",(e=>(e=>new Mn(e))(we(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,i.KO)(Rn,Dn,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Un)),(0,i.KO)(Rn,Dn,"esm2020")},3759:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(9950),s=n(4414);class r extends i.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error no capturado:",e,t)}render(){return this.state.hasError?(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{children:"Algo sali\xf3 mal."}),(0,s.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:this.state.error&&this.state.error.toString()})]}):this.props.children}}const a=r},4414:(e,t,n)=>{e.exports=n(2654)},5299:(e,t,n)=>{n.d(t,{j2:()=>u,db:()=>h,IG:()=>d});var i=n(1741);(0,i.KO)("firebase","12.4.0","app");var s=n(3096),r=n(306),a=n(2423),o=n(5571);o.Ay.debug("\ud83d\udd0d [Firebase Config] Verificando variables de entorno:",{apiKey:"\u2705 Presente",authDomain:"\u2705 Presente",projectId:"\u2705 Presente",storageBucket:"\u2705 Presente",messagingSenderId:"\u2705 Presente",appId:"\u2705 Presente"});const l={apiKey:"AIzaSyAzh5Qqiend6CSZzzCu6aUm4V9r17X42Ic",authDomain:"applectura-cb058.firebaseapp.com",projectId:"applectura-cb058",storageBucket:"applectura-cb058.firebasestorage.app",messagingSenderId:"522981088704",appId:"1:522981088704:web:4d58bbb7f74ca661ccbc25"};let c;try{c=(0,i.Wp)(l),o.Ay.log("\u2705 Firebase initialized successfully")}catch(p){throw o.Ay.error("\u274c Error initializing Firebase:",p),p}const u=(0,s.xI)(c),h=(0,r.aU)(c),d=(0,a.c7)(c);"true"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BACKEND_URL:"https://applectura-backend.onrender.com",REACT_APP_FIREBASE_API_KEY:"AIzaSyAzh5Qqiend6CSZzzCu6aUm4V9r17X42Ic",REACT_APP_FIREBASE_APP_ID:"1:522981088704:web:4d58bbb7f74ca661ccbc25",REACT_APP_FIREBASE_AUTH_DOMAIN:"applectura-cb058.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"522981088704",REACT_APP_FIREBASE_PROJECT_ID:"applectura-cb058",REACT_APP_FIREBASE_STORAGE_BUCKET:"applectura-cb058.firebasestorage.app",REACT_APP_PORT:"3000",REACT_APP_SERPER_API_KEY:"",REACT_APP_TAVILY_API_KEY:"configured"}.REACT_APP_USE_FIREBASE_EMULATOR&&(o.Ay.log("\ud83d\udd27 Conectando a emuladores Firebase..."),(0,s.Wq)(u,"http://localhost:9099"),(0,r.vN)(h,"localhost",8080),(0,a.nb)(d,"localhost",9199))},5340:(e,t,n)=>{e.exports=n(1761)},5532:(e,t,n)=>{n.d(t,{As:()=>h,OJ:()=>u});var i=n(9950),s=n(3096),r=n(5299),a=n(8853),o=n(5571),l=n(4414);const c=(0,i.createContext)();function u(e){let{children:t}=e;const[n,u]=(0,i.useState)(null),[h,d]=(0,i.useState)(null),[p,f]=(0,i.useState)(!0),[g,m]=(0,i.useState)(null),[v,y]=(0,i.useState)(null),b=()=>{o.Ay.debug("\ud83e\uddf9 [AuthContext] Limpiando datos locales del usuario...");["applectura_sessions","applectura_current_session","rubricProgress","savedCitations","activitiesProgress","annotations_migrated_v1","analysisCache","analysis_cache_stats","analysis_cache_metrics","studyItems_cache","annotations_cache"].forEach((e=>{try{localStorage.removeItem(e)}catch(t){o.Ay.warn(`\u26a0\ufe0f No se pudo eliminar ${e}:`,t)}}));const e=["activity_","session_","artifact_"];Object.keys(localStorage).forEach((t=>{if(e.some((e=>t.startsWith(e))))try{localStorage.removeItem(t)}catch(n){o.Ay.warn(`\u26a0\ufe0f No se pudo eliminar ${t}:`,n)}})),o.Ay.log("\u2705 [AuthContext] Datos locales limpiados")};(0,i.useEffect)((()=>{o.Ay.debug("\ud83d\udd10 [AuthContext] Inicializando listener de autenticaci\xf3n...");const e=(0,s.hg)(r.j2,(async e=>{o.Ay.debug("\ud83d\udd10 [AuthContext] Estado de auth cambi\xf3:",e?e.email:"No autenticado");try{if(e){v&&v!==e.uid&&(o.Ay.warn("\ud83d\udd04 [AuthContext] Cambio de usuario detectado, limpiando datos locales..."),b()),y(e.uid);const t=await(0,a.gL)(e.uid);u(e),d(t),o.Ay.log("\u2705 [AuthContext] Usuario cargado:",{uid:e.uid,email:e.email,role:t.role,nombre:t.nombre})}else v&&(o.Ay.debug("\ud83e\uddf9 [AuthContext] Usuario cerr\xf3 sesi\xf3n, limpiando datos locales..."),b()),y(null),u(null),d(null),o.Ay.debug("\u2139\ufe0f [AuthContext] No hay usuario autenticado")}catch(t){o.Ay.error("\u274c [AuthContext] Error cargando datos de usuario:",t),m(t.message),u(null),d(null)}finally{f(!1)}}));return()=>{o.Ay.debug("\ud83d\udd10 [AuthContext] Limpiando listener de autenticaci\xf3n"),e()}}),[v]);const w=(0,i.useCallback)((async()=>{if(n)try{o.Ay.debug("\ud83d\udd04 [AuthContext] Refrescando datos de usuario...");const e=await(0,a.gL)(n.uid);d(e),o.Ay.log("\u2705 [AuthContext] Datos refrescados")}catch(e){o.Ay.error("\u274c [AuthContext] Error refrescando datos:",e),m(e.message)}}),[n]),_=(0,i.useCallback)((async()=>{try{o.Ay.debug("\ud83d\udd10 [AuthContext] Cerrando sesi\xf3n..."),b(),await(0,s.CI)(r.j2),o.Ay.log("\u2705 [AuthContext] Sesi\xf3n cerrada correctamente")}catch(e){throw o.Ay.error("\u274c [AuthContext] Error cerrando sesi\xf3n:",e),e}}),[b]),A="estudiante"===(null===h||void 0===h?void 0:h.role),E="docente"===(null===h||void 0===h?void 0:h.role),S={currentUser:n,userData:h,loading:p,error:g,refreshUserData:w,signOut:_,isEstudiante:A,isDocente:E,isAuthenticated:!!n};return(0,l.jsx)(c.Provider,{value:S,children:t})}function h(){const e=(0,i.useContext)(c);if(void 0===e)throw new Error("useAuth debe usarse dentro de un AuthProvider");return e}},5571:(e,t,n)=>{n.d(t,{Ay:()=>r});const i=!1,s={log:function(){i},warn:function(){i},error:function(){console.error(...arguments)},debug:function(){i},group:function(){i},groupEnd:()=>{i},table:function(){i},time:e=>{i},timeEnd:e=>{i}},r=s,{log:a,warn:o,error:l,debug:c,group:u,groupEnd:h,table:d,time:p,timeEnd:f}=s},6863:(e,t,n)=>{n.d(t,{h1:()=>o,uA:()=>s});var i=n(498);class s{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const r="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new i.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(n)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:r})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:i});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,r]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&r.resolve(i)}return i}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);const s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===r?void 0:s),options:n}),this.instances.set(t,i),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}var s;return i||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;return this.component?this.component.multipleInstances?e:r:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class o{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},7119:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(8345)},7764:(e,t,n)=>{n.d(t,{D6:()=>Es,EA:()=>_s,Tm:()=>As,YE:()=>Ss,dU:()=>bs,ng:()=>ws});var i={d:(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},s=globalThis.pdfjsLib={};i.d(s,{AbortException:()=>me,AnnotationEditorLayer:()=>vs,AnnotationEditorParamsType:()=>y,AnnotationEditorType:()=>v,AnnotationEditorUIManager:()=>yt,AnnotationLayer:()=>rs,AnnotationMode:()=>m,CMapCompressionType:()=>Y,ColorPicker:()=>ps,DOMSVGFactory:()=>We,DrawLayer:()=>ys,FeatureTest:()=>we,GlobalWorkerOptions:()=>un,ImageKind:()=>T,InvalidPDFException:()=>de,MissingPDFException:()=>pe,OPS:()=>J,Outliner:()=>ls,PDFDataRangeTransport:()=>di,PDFDateString:()=>st,PDFWorker:()=>vi,PasswordResponses:()=>Z,PermissionFlag:()=>b,PixelsPerInch:()=>je,RenderingCancelledException:()=>Ke,TextLayer:()=>ei,UnexpectedResponseException:()=>fe,Util:()=>Ae,VerbosityLevel:()=>Q,XfaLayer:()=>ki,build:()=>Si,createValidAbsoluteUrl:()=>oe,fetchData:()=>He,getDocument:()=>ci,getFilenameFromUrl:()=>Ye,getPdfFilenameFromUrl:()=>Je,getXfaPageViewport:()=>rt,isDataScheme:()=>Xe,isPdfFile:()=>Qe,noContextMenu:()=>tt,normalizeUnicode:()=>Ce,renderTextLayer:()=>ti,setLayerDimensions:()=>ct,shadow:()=>le,updateTextLayer:()=>ni,version:()=>Ei});const r="object"===typeof process&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&"browser"!==process.type),a=[1,0,0,1,0,0],o=[.001,0,0,.001,0,0],l=1.35,c=1,u=2,h=4,d=16,p=32,f=64,g=256,m={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},v={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},y={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},b={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},w=0,_=1,A=2,E=3,S=3,C=4,T={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},x=1,k=2,I=3,P=4,R=5,D=6,M=7,N=8,L=9,O=10,F=11,U=12,z=13,V=14,B=15,j=16,H=17,$=20,q=1,W=2,G=3,K=4,X=5,Q={ERRORS:0,WARNINGS:1,INFOS:5},Y={NONE:0,BINARY:1},J={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},Z={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let ee=Q.WARNINGS;function te(e){Number.isInteger(e)&&(ee=e)}function ne(){return ee}function ie(e){ee>=Q.INFOS&&console.log(`Info: ${e}`)}function se(e){ee>=Q.WARNINGS&&console.log(`Warning: ${e}`)}function re(e){throw new Error(e)}function ae(e,t){e||re(t)}function oe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return null;try{if(n&&"string"===typeof e){if(n.addDefaultProtocol&&e.startsWith("www.")){const t=e.match(/\./g);t?.length>=2&&(e=`http://${e}`)}if(n.tryConvertEncoding)try{e=decodeURIComponent(escape(e))}catch{}}const i=t?new URL(e,t):new URL(e);if(function(e){switch(e?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i))return i}catch{}return null}function le(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object.defineProperty(e,t,{value:n,enumerable:!i,configurable:!0,writable:!1}),n}const ce=function(){function e(t,n){this.constructor===e&&re("Cannot initialize BaseException."),this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();class ue extends ce{constructor(e,t){super(e,"PasswordException"),this.code=t}}class he extends ce{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class de extends ce{constructor(e){super(e,"InvalidPDFException")}}class pe extends ce{constructor(e){super(e,"MissingPDFException")}}class fe extends ce{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class ge extends ce{constructor(e){super(e,"FormatError")}}class me extends ce{constructor(e){super(e,"AbortException")}}function ve(e){"object"===typeof e&&void 0!==e?.length||re("Invalid argument for bytesToString");const t=e.length,n=8192;if(t<n)return String.fromCharCode.apply(null,e);const i=[];for(let s=0;s<t;s+=n){const r=Math.min(s+n,t),a=e.subarray(s,r);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function ye(e){"string"!==typeof e&&re("Invalid argument for stringToBytes");const t=e.length,n=new Uint8Array(t);for(let i=0;i<t;++i)n[i]=255&e.charCodeAt(i);return n}function be(e){const t=Object.create(null);for(const[n,i]of e)t[n]=i;return t}class we{static get isLittleEndian(){return le(this,"isLittleEndian",function(){const e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}static get isEvalSupported(){return le(this,"isEvalSupported",function(){try{return new Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return le(this,"isOffscreenCanvasSupported","undefined"!==typeof OffscreenCanvas)}static get platform(){return"undefined"!==typeof navigator&&"string"===typeof navigator?.platform?le(this,"platform",{isMac:navigator.platform.includes("Mac")}):le(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return le(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const _e=Array.from(Array(256).keys(),(e=>e.toString(16).padStart(2,"0")));class Ae{static makeHexColor(e,t,n){return`#${_e[e]}${_e[t]}${_e[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}static applyInverseTransform(e,t){const n=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n]}static getAxialAlignedBoundingBox(e,t){const n=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),s=this.applyTransform([e[0],e[3]],t),r=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],i[0],s[0],r[0]),Math.min(n[1],i[1],s[1],r[1]),Math.max(n[0],i[0],s[0],r[0]),Math.max(n[1],i[1],s[1],r[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],s=e[2]*t[0]+e[3]*t[2],r=e[2]*t[1]+e[3]*t[3],a=(n+r)/2,o=Math.sqrt((n+r)**2-4*(n*r-s*i))/2,l=a+o||1,c=a-o||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>i)return null;const s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>r?null:[n,s,i,r]}static#e(e,t,n,i,s,r,a,o,l,c){if(l<=0||l>=1)return;const u=1-l,h=l*l,d=h*l,p=u*(u*(u*e+3*l*t)+3*h*n)+d*i,f=u*(u*(u*s+3*l*r)+3*h*a)+d*o;c[0]=Math.min(c[0],p),c[1]=Math.min(c[1],f),c[2]=Math.max(c[2],p),c[3]=Math.max(c[3],f)}static#t(e,t,n,i,s,r,a,o,l,c,u,h){if(Math.abs(l)<1e-12)return void(Math.abs(c)>=1e-12&&this.#e(e,t,n,i,s,r,a,o,-u/c,h));const d=c**2-4*u*l;if(d<0)return;const p=Math.sqrt(d),f=2*l;this.#e(e,t,n,i,s,r,a,o,(-c+p)/f,h),this.#e(e,t,n,i,s,r,a,o,(-c-p)/f,h)}static bezierBoundingBox(e,t,n,i,s,r,a,o,l){return l?(l[0]=Math.min(l[0],e,a),l[1]=Math.min(l[1],t,o),l[2]=Math.max(l[2],e,a),l[3]=Math.max(l[3],t,o)):l=[Math.min(e,a),Math.min(t,o),Math.max(e,a),Math.max(t,o)],this.#t(e,n,s,a,t,i,r,o,3*(3*(n-s)-e+a),6*(e-2*n+s),3*(n-e),l),this.#t(e,n,s,a,t,i,r,o,3*(3*(i-r)-t+o),6*(t-2*i+r),3*(i-t),l),l}}let Ee=null,Se=null;function Ce(e){return Ee||(Ee=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Se=new Map([["\ufb05","\u017ft"]])),e.replaceAll(Ee,((e,t,n)=>t?t.normalize("NFKC"):Se.get(n)))}const Te="pdfjs_internal_id_",xe=0,ke=1,Ie=2,Pe=3,Re=4,De=5,Me=6,Ne=7,Le=8;class Oe{constructor(){this.constructor===Oe&&re("Cannot initialize BaseFilterFactory.")}addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,i,s){return"none"}destroy(){}}class Fe{#n=!1;constructor(){let{enableHWA:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.constructor===Fe&&re("Cannot initialize BaseCanvasFactory."),this.#n=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#n})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){re("Abstract method `_createCanvas` called.")}}class Ue{constructor(e){let{baseUrl:t=null,isCompressed:n=!0}=e;this.constructor===Ue&&re("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=t,this.isCompressed=n}async fetch(e){let{name:t}=e;if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!t)throw new Error("CMap name must be specified.");const n=this.baseUrl+t+(this.isCompressed?".bcmap":""),i=this.isCompressed?Y.BINARY:Y.NONE;return this._fetchData(n,i).catch((e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${n}`)}))}_fetchData(e,t){re("Abstract method `_fetchData` called.")}}class ze{constructor(e){let{baseUrl:t=null}=e;this.constructor===ze&&re("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=t}async fetch(e){let{filename:t}=e;if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!t)throw new Error("Font filename must be specified.");const n=`${this.baseUrl}${t}`;return this._fetchData(n).catch((e=>{throw new Error(`Unable to load font data at: ${n}`)}))}_fetchData(e){re("Abstract method `_fetchData` called.")}}class Ve{constructor(){this.constructor===Ve&&re("Cannot initialize BaseSVGFactory.")}create(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if("string"!==typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){re("Abstract method `_createSVG` called.")}}const Be="http://www.w3.org/2000/svg";class je{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=(()=>this.CSS/this.PDF)()}async function He(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(et(e,document.baseURI)){const n=await fetch(e);if(!n.ok)throw new Error(n.statusText);switch(t){case"arraybuffer":return n.arrayBuffer();case"blob":return n.blob();case"json":return n.json()}return n.text()}return new Promise(((n,i)=>{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE)if(200!==s.status&&0!==s.status)i(new Error(s.statusText));else{switch(t){case"arraybuffer":case"blob":case"json":return void n(s.response)}n(s.responseText)}},s.send(null)}))}class $e extends Ue{_fetchData(e,t){return He(e,this.isCompressed?"arraybuffer":"text").then((e=>({cMapData:e instanceof ArrayBuffer?new Uint8Array(e):ye(e),compressionType:t})))}}class qe extends ze{_fetchData(e){return He(e,"arraybuffer").then((e=>new Uint8Array(e)))}}class We extends Ve{_createSVG(e){return document.createElementNS(Be,e)}}class Ge{constructor(e){let{viewBox:t,scale:n,rotation:i,offsetX:s=0,offsetY:r=0,dontFlip:a=!1}=e;this.viewBox=t,this.scale=n,this.rotation=i,this.offsetX=s,this.offsetY=r;const o=(t[2]+t[0])/2,l=(t[3]+t[1])/2;let c,u,h,d,p,f,g,m;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,u=0,h=0,d=1;break;case 90:c=0,u=1,h=1,d=0;break;case 270:c=0,u=-1,h=-1,d=0;break;case 0:c=1,u=0,h=0,d=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(h=-h,d=-d),0===c?(p=Math.abs(l-t[1])*n+s,f=Math.abs(o-t[0])*n+r,g=(t[3]-t[1])*n,m=(t[2]-t[0])*n):(p=Math.abs(o-t[0])*n+s,f=Math.abs(l-t[1])*n+r,g=(t[2]-t[0])*n,m=(t[3]-t[1])*n),this.transform=[c*n,u*n,h*n,d*n,p-c*n*o-h*n*l,f-u*n*o-d*n*l],this.width=g,this.height=m}get rawDims(){const{viewBox:e}=this;return le(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone(){let{scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ge({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:s})}convertToViewportPoint(e,t){return Ae.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=Ae.applyTransform([e[0],e[1]],this.transform),n=Ae.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return Ae.applyInverseTransform([e,t],this.transform)}}class Ke extends ce{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super(e,"RenderingCancelledException"),this.extraDelay=t}}function Xe(e){const t=e.length;let n=0;for(;n<t&&""===e[n].trim();)n++;return"data:"===e.substring(n,n+5).toLowerCase()}function Qe(e){return"string"===typeof e&&/\.pdf$/i.test(e)}function Ye(e){return[e]=e.split(/[#?]/,1),e.substring(e.lastIndexOf("/")+1)}function Je(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if("string"!==typeof e)return t;if(Xe(e))return se('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e);let s=n.exec(i[1])||n.exec(i[2])||n.exec(i[3]);if(s&&(s=s[0],s.includes("%")))try{s=n.exec(decodeURIComponent(s))[0]}catch{}return s||t}class Ze{started=(()=>Object.create(null))();times=[];time(e){e in this.started&&se(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||se(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:i,end:s}of this.times)e.push(`${n.padEnd(t)} ${s-i}ms\n`);return e.join("")}}function et(e,t){try{const{protocol:n}=t?new URL(e,t):new URL(e);return"http:"===n||"https:"===n}catch{return!1}}function tt(e){e.preventDefault()}function nt(e){console.log("Deprecated API usage: "+e)}let it;class st{static toDateObject(e){if(!e||"string"!==typeof e)return null;it||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=it.exec(e);if(!t)return null;const n=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let o=parseInt(t[6],10);o=o>=0&&o<=59?o:0;const l=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let u=parseInt(t[9],10)||0;return u=u>=0&&u<=59?u:0,"-"===l?(r+=c,a+=u):"+"===l&&(r-=c,a-=u),new Date(Date.UTC(n,i,s,r,a,o))}}function rt(e,t){let{scale:n=1,rotation:i=0}=t;const{width:s,height:r}=e.attributes.style,a=[0,0,parseInt(s),parseInt(r)];return new Ge({viewBox:a,scale:n,rotation:i})}function at(e){if(e.startsWith("#")){const t=parseInt(e.slice(1),16);return[(16711680&t)>>16,(65280&t)>>8,255&t]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map((e=>parseInt(e))):e.startsWith("rgba(")?e.slice(5,-1).split(",").map((e=>parseInt(e))).slice(0,3):(se(`Not a valid color format: "${e}"`),[0,0,0])}function ot(e){const{a:t,b:n,c:i,d:s,e:r,f:a}=e.getTransform();return[t,n,i,s,r,a]}function lt(e){const{a:t,b:n,c:i,d:s,e:r,f:a}=e.getTransform().invertSelf();return[t,n,i,s,r,a]}function ct(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(t instanceof Ge){const{pageWidth:i,pageHeight:s}=t.rawDims,{style:r}=e,a=we.isCSSRoundSupported,o=`var(--scale-factor) * ${i}px`,l=`var(--scale-factor) * ${s}px`,c=a?`round(${o}, 1px)`:`calc(${o})`,u=a?`round(${l}, 1px)`:`calc(${l})`;n&&t.rotation%180!==0?(r.width=u,r.height=c):(r.width=c,r.height=u)}i&&e.setAttribute("data-main-rotation",t.rotation)}class ut{#i=null;#s=null;#r;#a=null;constructor(e){this.#r=e}render(){const e=this.#i=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#r._uiManager._signal;e.addEventListener("contextmenu",tt,{signal:t}),e.addEventListener("pointerdown",ut.#o,{signal:t});const n=this.#a=document.createElement("div");n.className="buttons",e.append(n);const i=this.#r.toolbarPosition;if(i){const{style:t}=e,n="ltr"===this.#r._uiManager.direction?1-i[0]:i[0];t.insetInlineEnd=100*n+"%",t.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return this.#l(),e}static#o(e){e.stopPropagation()}#c(e){this.#r._focusEventsAllowed=!1,e.preventDefault(),e.stopPropagation()}#u(e){this.#r._focusEventsAllowed=!0,e.preventDefault(),e.stopPropagation()}#h(e){const t=this.#r._uiManager._signal;e.addEventListener("focusin",this.#c.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#u.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",tt,{signal:t})}hide(){this.#i.classList.add("hidden"),this.#s?.hideDropdown()}show(){this.#i.classList.remove("hidden")}#l(){const e=document.createElement("button");e.className="delete",e.tabIndex=0,e.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#r.editorType}-button`),this.#h(e),e.addEventListener("click",(e=>{this.#r._uiManager.delete()}),{signal:this.#r._uiManager._signal}),this.#a.append(e)}get#d(){const e=document.createElement("div");return e.className="divider",e}addAltTextButton(e){this.#h(e),this.#a.prepend(e,this.#d)}addColorPicker(e){this.#s=e;const t=e.renderButton();this.#h(t),this.#a.prepend(t,this.#d)}remove(){this.#i.remove(),this.#s?.destroy(),this.#s=null}}class ht{#a=null;#i=null;#p;constructor(e){this.#p=e}#f(){const e=this.#i=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",tt,{signal:this.#p._signal});const t=this.#a=document.createElement("div");return t.className="buttons",e.append(t),this.#g(),e}#m(e,t){let n=0,i=0;for(const s of e){const e=s.y+s.height;if(e<n)continue;const r=s.x+(t?s.width:0);e>n?(i=r,n=e):t?r>i&&(i=r):r<i&&(i=r)}return[t?1-i:i,n]}show(e,t,n){const[i,s]=this.#m(t,n),{style:r}=this.#i||=this.#f();e.append(this.#i),r.insetInlineEnd=100*i+"%",r.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#i.remove()}#g(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const n=this.#p._signal;e.addEventListener("contextmenu",tt,{signal:n}),e.addEventListener("click",(()=>{this.#p.highlightSelection("floating_button")}),{signal:n}),this.#a.append(e)}}function dt(e,t,n){for(const i of n)t.addEventListener(i,e[i].bind(e))}class pt{#v=0;get id(){return"pdfjs_internal_editor_"+this.#v++}}class ft{#y=(()=>function(){if("undefined"!==typeof crypto&&"function"===typeof crypto?.randomUUID)return crypto.randomUUID();const e=new Uint8Array(32);if("undefined"!==typeof crypto&&"function"===typeof crypto?.getRandomValues)crypto.getRandomValues(e);else for(let t=0;t<32;t++)e[t]=Math.floor(255*Math.random());return ve(e)}())();#v=0;#b=null;static get _isSVGFittingCanvas(){const e=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),t=new Image;t.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';return le(this,"_isSVGFittingCanvas",t.decode().then((()=>(e.drawImage(t,0,0,1,1,0,0,1,3),0===new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0]))))}async#w(e,t){this.#b||=new Map;let n=this.#b.get(e);if(null===n)return null;if(n?.bitmap)return n.refCounter+=1,n;try{let e;if(n||={bitmap:null,id:`image_${this.#y}_${this.#v++}`,refCounter:0,isSvg:!1},"string"===typeof t?(n.url=t,e=await He(t,"blob")):e=n.file=t,"image/svg+xml"===e.type){const t=ft._isSVGFittingCanvas,i=new FileReader,s=new Image,r=new Promise(((e,r)=>{s.onload=()=>{n.bitmap=s,n.isSvg=!0,e()},i.onload=async()=>{const e=n.svgUrl=i.result;s.src=await t?`${e}#svgView(preserveAspectRatio(none))`:e},s.onerror=i.onerror=r}));i.readAsDataURL(e),await r}else n.bitmap=await createImageBitmap(e);n.refCounter=1}catch(i){console.error(i),n=null}return this.#b.set(e,n),n&&this.#b.set(n.id,n),n}async getFromFile(e){const{lastModified:t,name:n,size:i,type:s}=e;return this.#w(`${t}_${n}_${i}_${s}`,e)}async getFromUrl(e){return this.#w(e,e)}async getFromId(e){this.#b||=new Map;const t=this.#b.get(e);return t?t.bitmap?(t.refCounter+=1,t):t.file?this.getFromFile(t.file):this.getFromUrl(t.url):null}getSvgUrl(e){const t=this.#b.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#b||=new Map;const t=this.#b.get(e);t&&(t.refCounter-=1,0===t.refCounter&&(t.bitmap=null))}isValidId(e){return e.startsWith(`image_${this.#y}_`)}}class gt{#_=[];#A=!1;#E;#S=-1;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;this.#E=e}add(e){let{cmd:t,undo:n,post:i,mustExec:s,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}=e;if(s&&t(),this.#A)return;const l={cmd:t,undo:n,post:i,type:r};if(-1===this.#S)return this.#_.length>0&&(this.#_.length=0),this.#S=0,void this.#_.push(l);if(a&&this.#_[this.#S].type===r)return o&&(l.undo=this.#_[this.#S].undo),void(this.#_[this.#S]=l);const c=this.#S+1;c===this.#E?this.#_.splice(0,1):(this.#S=c,c<this.#_.length&&this.#_.splice(c)),this.#_.push(l)}undo(){if(-1===this.#S)return;this.#A=!0;const{undo:e,post:t}=this.#_[this.#S];e(),t?.(),this.#A=!1,this.#S-=1}redo(){if(this.#S<this.#_.length-1){this.#S+=1,this.#A=!0;const{cmd:e,post:t}=this.#_[this.#S];e(),t?.(),this.#A=!1}}hasSomethingToUndo(){return-1!==this.#S}hasSomethingToRedo(){return this.#S<this.#_.length-1}destroy(){this.#_=null}}class mt{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=we.platform;for(const[n,i,s={}]of e)for(const e of n){const n=e.startsWith("mac+");t&&n?(this.callbacks.set(e.slice(4),{callback:i,options:s}),this.allKeys.add(e.split("+").at(-1))):t||n||(this.callbacks.set(e,{callback:i,options:s}),this.allKeys.add(e.split("+").at(-1)))}}#C(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(this.#C(t));if(!n)return;const{callback:i,options:{bubbles:s=!1,args:r=[],checker:a=null}}=n;a&&!a(e,t)||(i.bind(e,...r,t)(),s||(t.stopPropagation(),t.preventDefault()))}}class vt{static _colorsMapping=(()=>new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]))();get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return function(e){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const n of e.keys()){t.style.color=n;const i=window.getComputedStyle(t).color;e.set(n,at(i))}t.remove()}(e),le(this,"_colors",e)}convert(e){const t=at(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,i]of this._colors)if(i.every(((e,n)=>e===t[n])))return vt._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?Ae.makeHexColor(...t):e}}class yt{#T=(()=>new AbortController)();#x=null;#k=(()=>new Map)();#I=(()=>new Map)();#P=null;#R=null;#D=null;#M=(()=>new gt)();#N=0;#L=(()=>new Set)();#O=null;#F=null;#U=(()=>new Set)();#z=!1;#V=null;#B=null;#j=null;#H=!1;#$=null;#q=(()=>new pt)();#W=!1;#G=!1;#K=null;#X=null;#Q=null;#Y=(()=>v.NONE)();#J=(()=>new Set)();#Z=null;#ee=null;#te=null;#ne=this.blur.bind(this);#ie=this.focus.bind(this);#se=this.copy.bind(this);#re=this.cut.bind(this);#ae=this.paste.bind(this);#oe=this.keydown.bind(this);#le=this.keyup.bind(this);#ce=this.onEditingAction.bind(this);#ue=this.onPageChanging.bind(this);#he=this.onScaleChanging.bind(this);#de=this.onRotationChanging.bind(this);#pe={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#fe=[0,0];#ge=null;#me=null;#ve=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=yt.prototype,t=e=>e.#me.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&e.hasSomethingToControl(),n=(e,t)=>{let{target:n}=t;if(n instanceof HTMLInputElement){const{type:e}=n;return"text"!==e&&"number"!==e}return!0},i=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return le(this,"_keyboardManager",new mt([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(e,t)=>{let{target:n}=t;return!(n instanceof HTMLButtonElement)&&e.#me.contains(n)&&!e.isEnterHandled}}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(e,t)=>{let{target:n}=t;return!(n instanceof HTMLButtonElement)&&e.#me.contains(document.activeElement)}}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}]]))}constructor(e,t,n,i,s,r,a,o,l){this._signal=this.#T.signal,this.#me=e,this.#ve=t,this.#P=n,this._eventBus=i,this._eventBus._on("editingaction",this.#ce),this._eventBus._on("pagechanging",this.#ue),this._eventBus._on("scalechanging",this.#he),this._eventBus._on("rotationchanging",this.#de),this.#ye(),this.#be(),this.#we(),this.#R=s.annotationStorage,this.#V=s.filterFactory,this.#ee=r,this.#j=a||null,this.#z=o,this.#Q=l||null,this.viewParameters={realScale:je.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){this.#T?.abort(),this.#T=null,this._signal=null,this._eventBus._off("editingaction",this.#ce),this._eventBus._off("pagechanging",this.#ue),this._eventBus._off("scalechanging",this.#he),this._eventBus._off("rotationchanging",this.#de);for(const e of this.#I.values())e.destroy();this.#I.clear(),this.#k.clear(),this.#U.clear(),this.#x=null,this.#J.clear(),this.#M.destroy(),this.#P?.destroy(),this.#$?.hide(),this.#$=null,this.#B&&(clearTimeout(this.#B),this.#B=null),this.#ge&&(clearTimeout(this.#ge),this.#ge=null)}async mlGuess(e){return this.#Q?.guess(e)||null}get hasMLManager(){return!!this.#Q}get hcmFilter(){return le(this,"hcmFilter",this.#ee?this.#V.addHCMFilter(this.#ee.foreground,this.#ee.background):"none")}get direction(){return le(this,"direction",getComputedStyle(this.#me).direction)}get highlightColors(){return le(this,"highlightColors",this.#j?new Map(this.#j.split(",").map((e=>e.split("=").map((e=>e.trim()))))):null)}get highlightColorNames(){return le(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,(e=>e.reverse()))):null)}setMainHighlightColorPicker(e){this.#X=e}editAltText(e){this.#P?.editAltText(this,e)}onPageChanging(e){let{pageNumber:t}=e;this.#N=t-1}focusMainContainer(){this.#me.focus()}findParent(e,t){for(const n of this.#I.values()){const{x:i,y:s,width:r,height:a}=n.div.getBoundingClientRect();if(e>=i&&e<=i+r&&t>=s&&t<=s+a)return n}return null}disableUserSelect(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#ve.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#U.add(e)}removeShouldRescale(e){this.#U.delete(e)}onScaleChanging(e){let{scale:t}=e;this.commitOrRemove(),this.viewParameters.realScale=t*je.PDF_TO_CSS_UNITS;for(const n of this.#U)n.onScaleChanging()}onRotationChanging(e){let{pagesRotation:t}=e;this.commitOrRemove(),this.viewParameters.rotation=t}#_e(e){let{anchorNode:t}=e;return t.nodeType===Node.TEXT_NODE?t.parentElement:t}highlightSelection(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:n,anchorOffset:i,focusNode:s,focusOffset:r}=t,a=t.toString(),o=this.#_e(t).closest(".textLayer"),l=this.getSelectionBoxes(o);if(l){t.empty(),this.#Y===v.NONE&&(this._eventBus.dispatch("showannotationeditorui",{source:this,mode:v.HIGHLIGHT}),this.showAllEditors("highlight",!0,!0));for(const t of this.#I.values())if(t.hasTextLayer(o)){t.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:l,anchorNode:n,anchorOffset:i,focusNode:s,focusOffset:r,text:a});break}}}#Ae(){const e=document.getSelection();if(!e||e.isCollapsed)return;const t=this.#_e(e).closest(".textLayer"),n=this.getSelectionBoxes(t);n&&(this.#$||=new ht(this),this.#$.show(t,n,"ltr"===this.direction))}addToAnnotationStorage(e){e.isEmpty()||!this.#R||this.#R.has(e.id)||this.#R.setValue(e.id,e)}#Ee(){const e=document.getSelection();if(!e||e.isCollapsed)return void(this.#Z&&(this.#$?.hide(),this.#Z=null,this.#Se({hasSelectedText:!1})));const{anchorNode:t}=e;if(t===this.#Z)return;if(this.#_e(e).closest(".textLayer")){if(this.#$?.hide(),this.#Z=t,this.#Se({hasSelectedText:!0}),(this.#Y===v.HIGHLIGHT||this.#Y===v.NONE)&&(this.#Y===v.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#H=this.isShiftKeyDown,!this.isShiftKeyDown)){const e=this._signal,t=e=>{"pointerup"===e.type&&0!==e.button||(window.removeEventListener("pointerup",t),window.removeEventListener("blur",t),"pointerup"===e.type&&this.#Ce("main_toolbar"))};window.addEventListener("pointerup",t,{signal:e}),window.addEventListener("blur",t,{signal:e})}}else this.#Z&&(this.#$?.hide(),this.#Z=null,this.#Se({hasSelectedText:!1}))}#Ce(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.#Y===v.HIGHLIGHT?this.highlightSelection(e):this.#z&&this.#Ae()}#ye(){document.addEventListener("selectionchange",this.#Ee.bind(this),{signal:this._signal})}#Te(){const e=this._signal;window.addEventListener("focus",this.#ie,{signal:e}),window.addEventListener("blur",this.#ne,{signal:e})}#xe(){window.removeEventListener("focus",this.#ie),window.removeEventListener("blur",this.#ne)}blur(){if(this.isShiftKeyDown=!1,this.#H&&(this.#H=!1,this.#Ce("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#J)if(t.div.contains(e)){this.#K=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#K)return;const[e,t]=this.#K;this.#K=null,t.addEventListener("focusin",(()=>{e._focusEventsAllowed=!0}),{once:!0,signal:this._signal}),t.focus()}#we(){const e=this._signal;window.addEventListener("keydown",this.#oe,{signal:e}),window.addEventListener("keyup",this.#le,{signal:e})}#ke(){window.removeEventListener("keydown",this.#oe),window.removeEventListener("keyup",this.#le)}#Ie(){const e=this._signal;document.addEventListener("copy",this.#se,{signal:e}),document.addEventListener("cut",this.#re,{signal:e}),document.addEventListener("paste",this.#ae,{signal:e})}#Pe(){document.removeEventListener("copy",this.#se),document.removeEventListener("cut",this.#re),document.removeEventListener("paste",this.#ae)}#be(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#we(),this.#Ie()}removeEditListeners(){this.#ke(),this.#Pe()}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of this.#F)if(n.isHandlingMimeForPasting(t))return e.dataTransfer.dropEffect="copy",void e.preventDefault()}drop(e){for(const t of e.dataTransfer.items)for(const n of this.#F)if(n.isHandlingMimeForPasting(t.type))return n.paste(t,this.currentLayer),void e.preventDefault()}copy(e){if(e.preventDefault(),this.#x?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const n of this.#J){const e=n.serialize(!0);e&&t.push(e)}0!==t.length&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const e of this.#F)if(e.isHandlingMimeForPasting(r.type))return void e.paste(r,this.currentLayer);let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(s){return void se(`paste: "${s.message}".`)}if(!Array.isArray(n))return;this.unselectAll();const i=this.currentLayer;try{const e=[];for(const r of n){const t=i.deserialize(r);if(!t)return;e.push(t)}const t=()=>{for(const t of e)this.#Re(t);this.#De(e)},s=()=>{for(const t of e)t.remove()};this.addCommands({cmd:t,undo:s,mustExec:!0})}catch(s){se(`paste: "${s.message}".`)}}keydown(e){this.isShiftKeyDown||"Shift"!==e.key||(this.isShiftKeyDown=!0),this.#Y===v.NONE||this.isEditorHandlingKeyboard||yt._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&"Shift"===e.key&&(this.isShiftKeyDown=!1,this.#H&&(this.#H=!1,this.#Ce("main_toolbar")))}onEditingAction(e){let{name:t}=e;switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu")}}#Se(e){Object.entries(e).some((e=>{let[t,n]=e;return this.#pe[t]!==n}))&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#pe,e)}),this.#Y===v.HIGHLIGHT&&!1===e.hasSelectedEditor&&this.#Me([[y.HIGHLIGHT_FREE,!0]]))}#Me(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#Te(),this.#Ie(),this.#Se({isEditing:this.#Y!==v.NONE,isEmpty:this.#Ne(),hasSomethingToUndo:this.#M.hasSomethingToUndo(),hasSomethingToRedo:this.#M.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#xe(),this.#Pe(),this.#Se({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#F){this.#F=e;for(const e of this.#F)this.#Me(e.defaultPropertiesToUpdate)}}getId(){return this.#q.id}get currentLayer(){return this.#I.get(this.#N)}getLayer(e){return this.#I.get(e)}get currentPageIndex(){return this.#N}addLayer(e){this.#I.set(e.pageIndex,e),this.#W?e.enable():e.disable()}removeLayer(e){this.#I.delete(e.pageIndex)}updateMode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.#Y!==e){if(this.#Y=e,e===v.NONE)return this.setEditingState(!1),void this.#Le();this.setEditingState(!0),this.#Oe(),this.unselectAll();for(const t of this.#I.values())t.updateMode(e);if(t||!n){if(t)for(const e of this.#k.values())if(e.annotationElementId===t){this.setSelected(e),e.enterInEditMode();break}}else this.addNewEditorFromKeyboard()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==this.#Y&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){if(this.#F){switch(e){case y.CREATE:return void this.currentLayer.addNewEditor();case y.HIGHLIGHT_DEFAULT_COLOR:this.#X?.updateColor(t);break;case y.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#te||=new Map).set(e,t),this.showAllEditors("highlight",t)}for(const n of this.#J)n.updateParams(e,t);for(const n of this.#F)n.updateDefaultParams(e,t)}}showAllEditors(e,t){for(const n of this.#k.values())n.editorType===e&&n.show(t);(this.#te?.get(y.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#Me([[y.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.#G!==e){this.#G=e;for(const t of this.#I.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}#Oe(){if(!this.#W){this.#W=!0;for(const e of this.#I.values())e.enable();for(const e of this.#k.values())e.enable()}}#Le(){if(this.unselectAll(),this.#W){this.#W=!1;for(const e of this.#I.values())e.disable();for(const e of this.#k.values())e.disable()}}getEditors(e){const t=[];for(const n of this.#k.values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return this.#k.get(e)}addEditor(e){this.#k.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#B&&clearTimeout(this.#B),this.#B=setTimeout((()=>{this.focusMainContainer(),this.#B=null}),0)),this.#k.delete(e.id),this.unselect(e),e.annotationElementId&&this.#L.has(e.annotationElementId)||this.#R?.remove(e.id)}addDeletedAnnotationElement(e){this.#L.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#L.has(e)}removeDeletedAnnotationElement(e){this.#L.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#Re(e){const t=this.#I.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#x!==e&&(this.#x=e,e&&this.#Me(e.propertiesToUpdate))}get#Fe(){let e=null;for(e of this.#J);return e}updateUI(e){this.#Fe===e&&this.#Me(e.propertiesToUpdate)}toggleSelected(e){if(this.#J.has(e))return this.#J.delete(e),e.unselect(),void this.#Se({hasSelectedEditor:this.hasSelection});this.#J.add(e),e.select(),this.#Me(e.propertiesToUpdate),this.#Se({hasSelectedEditor:!0})}setSelected(e){for(const t of this.#J)t!==e&&t.unselect();this.#J.clear(),this.#J.add(e),e.select(),this.#Me(e.propertiesToUpdate),this.#Se({hasSelectedEditor:!0})}isSelected(e){return this.#J.has(e)}get firstSelectedEditor(){return this.#J.values().next().value}unselect(e){e.unselect(),this.#J.delete(e),this.#Se({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#J.size}get isEnterHandled(){return 1===this.#J.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#M.undo(),this.#Se({hasSomethingToUndo:this.#M.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#Ne()})}redo(){this.#M.redo(),this.#Se({hasSomethingToUndo:!0,hasSomethingToRedo:this.#M.hasSomethingToRedo(),isEmpty:this.#Ne()})}addCommands(e){this.#M.add(e),this.#Se({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#Ne()})}#Ne(){if(0===this.#k.size)return!0;if(1===this.#k.size)for(const e of this.#k.values())return e.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...this.#J];this.addCommands({cmd:()=>{for(const t of e)t.remove()},undo:()=>{for(const t of e)this.#Re(t)},mustExec:!0})}commitOrRemove(){this.#x?.commitOrRemove()}hasSomethingToControl(){return this.#x||this.hasSelection}#De(e){for(const t of this.#J)t.unselect();this.#J.clear();for(const t of e)t.isEmpty()||(this.#J.add(t),t.select());this.#Se({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#J)e.commit();this.#De(this.#k.values())}unselectAll(){if((!this.#x||(this.#x.commitOrRemove(),this.#Y===v.NONE))&&this.hasSelection){for(const e of this.#J)e.unselect();this.#J.clear(),this.#Se({hasSelectedEditor:!1})}}translateSelectedEditors(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||this.commitOrRemove(),!this.hasSelection)return;this.#fe[0]+=e,this.#fe[1]+=t;const[n,i]=this.#fe,s=[...this.#J];this.#ge&&clearTimeout(this.#ge),this.#ge=setTimeout((()=>{this.#ge=null,this.#fe[0]=this.#fe[1]=0,this.addCommands({cmd:()=>{for(const e of s)this.#k.has(e.id)&&e.translateInPage(n,i)},undo:()=>{for(const e of s)this.#k.has(e.id)&&e.translateInPage(-n,-i)},mustExec:!1})}),1e3);for(const r of s)r.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#O=new Map;for(const e of this.#J)this.#O.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#O)return!1;this.disableUserSelect(!1);const e=this.#O;this.#O=null;let t=!1;for(const[{x:i,y:s,pageIndex:r},a]of e)a.newX=i,a.newY=s,a.newPageIndex=r,t||=i!==a.savedX||s!==a.savedY||r!==a.savedPageIndex;if(!t)return!1;const n=(e,t,n,i)=>{if(this.#k.has(e.id)){const s=this.#I.get(i);s?e._setParentAndPosition(s,t,n):(e.pageIndex=i,e.x=t,e.y=n)}};return this.addCommands({cmd:()=>{for(const[t,{newX:i,newY:s,newPageIndex:r}]of e)n(t,i,s,r)},undo:()=>{for(const[t,{savedX:i,savedY:s,savedPageIndex:r}]of e)n(t,i,s,r)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#O)for(const n of this.#O.keys())n.drag(e,t)}rebuild(e){if(null===e.parent){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#J.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#x===e}getActive(){return this.#x}getMode(){return this.#Y}get imageManager(){return le(this,"imageManager",new ft)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let l=0,c=t.rangeCount;l<c;l++)if(!e.contains(t.getRangeAt(l).commonAncestorContainer))return null;const{x:n,y:i,width:s,height:r}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(e,t,a,o)=>({x:(t-i)/r,y:1-(e+a-n)/s,width:o/r,height:a/s});break;case"180":a=(e,t,a,o)=>({x:1-(e+a-n)/s,y:1-(t+o-i)/r,width:a/s,height:o/r});break;case"270":a=(e,t,a,o)=>({x:1-(t+o-i)/r,y:(e-n)/s,width:o/r,height:a/s});break;default:a=(e,t,a,o)=>({x:(e-n)/s,y:(t-i)/r,width:a/s,height:o/r})}const o=[];for(let l=0,c=t.rangeCount;l<c;l++){const e=t.getRangeAt(l);if(!e.collapsed)for(const{x:t,y:n,width:i,height:s}of e.getClientRects())0!==i&&0!==s&&o.push(a(t,n,i,s))}return 0===o.length?null:o}addChangedExistingAnnotation(e){let{annotationElementId:t,id:n}=e;(this.#D||=new Map).set(t,n)}removeChangedExistingAnnotation(e){let{annotationElementId:t}=e;this.#D?.delete(t)}renderAnnotationElement(e){const t=this.#D?.get(e.data.id);if(!t)return;const n=this.#R.getRawValue(t);n&&(this.#Y!==v.NONE||n.hasBeenModified)&&n.renderAnnotationElement(e)}}class bt{#Ue="";#ze=!1;#Ve=null;#Be=null;#je=null;#He=!1;#r=null;static _l10nPromise=null;constructor(e){this.#r=e}static initialize(e){bt._l10nPromise||=e}async render(){const e=this.#Ve=document.createElement("button");e.className="altText";const t=await bt._l10nPromise.get("pdfjs-editor-alt-text-button-label");e.textContent=t,e.setAttribute("aria-label",t),e.tabIndex="0";const n=this.#r._uiManager._signal;e.addEventListener("contextmenu",tt,{signal:n}),e.addEventListener("pointerdown",(e=>e.stopPropagation()),{signal:n});const i=e=>{e.preventDefault(),this.#r._uiManager.editAltText(this.#r)};return e.addEventListener("click",i,{capture:!0,signal:n}),e.addEventListener("keydown",(t=>{t.target===e&&"Enter"===t.key&&(this.#He=!0,i(t))}),{signal:n}),await this.#$e(),e}finish(){this.#Ve&&(this.#Ve.focus({focusVisible:this.#He}),this.#He=!1)}isEmpty(){return!this.#Ue&&!this.#ze}get data(){return{altText:this.#Ue,decorative:this.#ze}}set data(e){let{altText:t,decorative:n}=e;this.#Ue===t&&this.#ze===n||(this.#Ue=t,this.#ze=n,this.#$e())}toggle(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#Ve&&(!e&&this.#je&&(clearTimeout(this.#je),this.#je=null),this.#Ve.disabled=!e)}destroy(){this.#Ve?.remove(),this.#Ve=null,this.#Be=null}async#$e(){const e=this.#Ve;if(!e)return;if(!this.#Ue&&!this.#ze)return e.classList.remove("done"),void this.#Be?.remove();e.classList.add("done"),bt._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then((t=>{e.setAttribute("aria-label",t)}));let t=this.#Be;if(!t){this.#Be=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip");const n=t.id=`alt-text-tooltip-${this.#r.id}`;e.setAttribute("aria-describedby",n);const i=100,s=this.#r._uiManager._signal;s.addEventListener("abort",(()=>{clearTimeout(this.#je),this.#je=null}),{once:!0}),e.addEventListener("mouseenter",(()=>{this.#je=setTimeout((()=>{this.#je=null,this.#Be.classList.add("show"),this.#r._reportTelemetry({action:"alt_text_tooltip"})}),i)}),{signal:s}),e.addEventListener("mouseleave",(()=>{this.#je&&(clearTimeout(this.#je),this.#je=null),this.#Be?.classList.remove("show")}),{signal:s})}t.innerText=this.#ze?await bt._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#Ue,t.parentNode||e.append(t);const n=this.#r.getImageForAltText();n?.setAttribute("aria-describedby",t.id)}}class wt{#qe=null;#We=null;#Ue=null;#Ge=!1;#Ke=!1;#Xe=null;#Qe=null;#Ye=this.focusin.bind(this);#Je=this.focusout.bind(this);#Ze=null;#et="";#tt=!1;#nt=null;#it=!1;#st=!1;#rt=!1;#at=null;#ot=0;#lt=0;#ct=null;_initialOptions=(()=>Object.create(null))();_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#ut=!1;#ht=(()=>wt._zIndex++)();static _borderLineWidth=-1;static _colorManager=(()=>new vt)();static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=wt.prototype._resizeWithKeyboard,t=yt.TRANSLATE_SMALL,n=yt.TRANSLATE_BIG;return le(this,"_resizerKeyboardManager",new mt([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],wt.prototype._stopResizingWithKeyboard]]))}constructor(e){this.constructor===wt&&re("Cannot initialize AnnotationEditor."),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:n,pageHeight:i,pageX:s,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,i],this.pageTranslation=[s,r];const[a,o]=this.parentDimensions;this.x=e.x/a,this.y=e.y/o,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return le(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new _t({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t,n){if(wt._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map((t=>[t,e.get(t.replaceAll(/([A-Z])/g,(e=>`-${e.toLowerCase()}`)))]))),n?.strings)for(const s of n.strings)wt._l10nPromise.set(s,e.get(s));if(-1!==wt._borderLineWidth)return;const i=getComputedStyle(document.documentElement);wt._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){re("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#ut}set _isDraggable(e){this.#ut=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(2*e),this.y+=this.width*e/(2*t);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(2*e),this.y-=this.width*e/(2*t);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#ht}setParent(e){null!==e?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#dt(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#tt?this.#tt=!1:this.parent.setSelected(this))}focusout(e){if(!this._focusEventsAllowed)return;if(!this.isAttachedToDOM)return;const t=e.relatedTarget;t?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,i){const[s,r]=this.parentDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(e+n)/s,this.y=(t+i)/r,this.fixAndSetPosition()}#pt(e,t,n){let[i,s]=e;[t,n]=this.screenToPageTranslation(t,n),this.x+=t/i,this.y+=n/s,this.fixAndSetPosition()}translate(e,t){this.#pt(this.parentDimensions,e,t)}translateInPage(e,t){this.#nt||=[this.x,this.y],this.#pt(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){this.#nt||=[this.x,this.y];const[n,i]=this.parentDimensions;if(this.x+=e/n,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:e,y:t}=this.div.getBoundingClientRect();this.parent.findNewParent(this,e,t)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:s,y:r}=this;const[a,o]=this.getBaseTranslation();s+=a,r+=o,this.div.style.left=`${(100*s).toFixed(2)}%`,this.div.style.top=`${(100*r).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!this.#nt&&(this.#nt[0]!==this.x||this.#nt[1]!==this.y)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=wt,i=n/e,s=n/t;switch(this.rotation){case 90:return[-i,s];case 180:return[i,s];case 270:return[i,-s];default:return[-i,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rotation;const[t,n]=this.pageDimensions;let{x:i,y:s,width:r,height:a}=this;if(r*=t,a*=n,i*=t,s*=n,this._mustFixPosition)switch(e){case 0:i=Math.max(0,Math.min(t-r,i)),s=Math.max(0,Math.min(n-a,s));break;case 90:i=Math.max(0,Math.min(t-a,i)),s=Math.min(n,Math.max(r,s));break;case 180:i=Math.min(t,Math.max(r,i)),s=Math.min(n,Math.max(a,s));break;case 270:i=Math.min(t,Math.max(a,i)),s=Math.max(0,Math.min(n-r,s))}this.x=i/=t,this.y=s/=n;const[o,l]=this.getBaseTranslation();i+=o,s+=l;const{style:c}=this.div;c.left=`${(100*i).toFixed(2)}%`,c.top=`${(100*s).toFixed(2)}%`,this.moveInDOM()}static#ft(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return wt.#ft(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return wt.#ft(e,t,360-this.parentRotation)}#gt(e){switch(e){case 90:{const[e,t]=this.pageDimensions;return[0,-e/t,t/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,t]=this.pageDimensions;return[0,e/t,-t/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this,i=t*e,s=n*e;return we.isCSSRoundSupported?[Math.round(i),Math.round(s)]:[i,s]}setDims(e,t){const[n,i]=this.parentDimensions;this.div.style.width=`${(100*e/n).toFixed(2)}%`,this.#Ke||(this.div.style.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:n}=e,i=n.endsWith("%"),s=!this.#Ke&&t.endsWith("%");if(i&&s)return;const[r,a]=this.parentDimensions;i||(e.width=`${(100*parseFloat(n)/r).toFixed(2)}%`),this.#Ke||s||(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#mt(){if(this.#Xe)return;this.#Xe=document.createElement("div"),this.#Xe.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const e=document.createElement("div");this.#Xe.append(e),e.classList.add("resizer",n),e.setAttribute("data-resizer-name",n),e.addEventListener("pointerdown",this.#vt.bind(this,n),{signal:t}),e.addEventListener("contextmenu",tt,{signal:t}),e.tabIndex=-1}this.div.prepend(this.#Xe)}#vt(e,t){t.preventDefault();const{isMac:n}=we.platform;if(0!==t.button||t.ctrlKey&&n)return;this.#Ue?.toggle(!1);const i=this.#yt.bind(this,e),s=this._isDraggable;this._isDraggable=!1;const r=this._uiManager._signal,a={passive:!0,capture:!0,signal:r};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",i,a),window.addEventListener("contextmenu",tt,{signal:r});const o=this.x,l=this.y,c=this.width,u=this.height,h=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const p=()=>{this.parent.togglePointerEvents(!0),this.#Ue?.toggle(!0),this._isDraggable=s,window.removeEventListener("pointerup",p),window.removeEventListener("blur",p),window.removeEventListener("pointermove",i,a),window.removeEventListener("contextmenu",tt),this.parent.div.style.cursor=h,this.div.style.cursor=d,this.#bt(o,l,c,u)};window.addEventListener("pointerup",p,{signal:r}),window.addEventListener("blur",p,{signal:r})}#bt(e,t,n,i){const s=this.x,r=this.y,a=this.width,o=this.height;s===e&&r===t&&a===n&&o===i||this.addCommands({cmd:()=>{this.width=a,this.height=o,this.x=s,this.y=r;const[e,t]=this.parentDimensions;this.setDims(e*a,t*o),this.fixAndSetPosition()},undo:()=>{this.width=n,this.height=i,this.x=e,this.y=t;const[s,r]=this.parentDimensions;this.setDims(s*n,r*i),this.fixAndSetPosition()},mustExec:!0})}#yt(e,t){const[n,i]=this.parentDimensions,s=this.x,r=this.y,a=this.width,o=this.height,l=wt.MIN_SIZE/n,c=wt.MIN_SIZE/i,u=e=>Math.round(1e4*e)/1e4,h=this.#gt(this.rotation),d=(e,t)=>[h[0]*e+h[2]*t,h[1]*e+h[3]*t],p=this.#gt(360-this.rotation);let f,g,m=!1,v=!1;switch(e){case"topLeft":m=!0,f=(e,t)=>[0,0],g=(e,t)=>[e,t];break;case"topMiddle":f=(e,t)=>[e/2,0],g=(e,t)=>[e/2,t];break;case"topRight":m=!0,f=(e,t)=>[e,0],g=(e,t)=>[0,t];break;case"middleRight":v=!0,f=(e,t)=>[e,t/2],g=(e,t)=>[0,t/2];break;case"bottomRight":m=!0,f=(e,t)=>[e,t],g=(e,t)=>[0,0];break;case"bottomMiddle":f=(e,t)=>[e/2,t],g=(e,t)=>[e/2,0];break;case"bottomLeft":m=!0,f=(e,t)=>[0,t],g=(e,t)=>[e,0];break;case"middleLeft":v=!0,f=(e,t)=>[0,t/2],g=(e,t)=>[e,t/2]}const y=f(a,o),b=g(a,o);let w=d(...b);const _=u(s+w[0]),A=u(r+w[1]);let E=1,S=1,[C,T]=this.screenToPageTranslation(t.movementX,t.movementY);var x,k;if([C,T]=(x=C/n,k=T/i,[p[0]*x+p[2]*k,p[1]*x+p[3]*k]),m){const e=Math.hypot(a,o);E=S=Math.max(Math.min(Math.hypot(b[0]-y[0]-C,b[1]-y[1]-T)/e,1/a,1/o),l/a,c/o)}else v?E=Math.max(l,Math.min(1,Math.abs(b[0]-y[0]-C)))/a:S=Math.max(c,Math.min(1,Math.abs(b[1]-y[1]-T)))/o;const I=u(a*E),P=u(o*S);w=d(...g(I,P));const R=_-w[0],D=A-w[1];this.width=I,this.height=P,this.x=R,this.y=D,this.setDims(n*I,i*P),this.fixAndSetPosition()}altTextFinish(){this.#Ue?.finish()}async addEditToolbar(){return this.#Ze||this.#st||(this.#Ze=new ut(this),this.div.append(this.#Ze.render()),this.#Ue&&this.#Ze.addAltTextButton(await this.#Ue.render())),this.#Ze}removeEditToolbar(){this.#Ze&&(this.#Ze.remove(),this.#Ze=null,this.#Ue?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#Ue||(bt.initialize(wt._l10nPromise),this.#Ue=new bt(this),this.#qe&&(this.#Ue.data=this.#qe,this.#qe=null),await this.addEditToolbar())}get altTextData(){return this.#Ue?.data}set altTextData(e){this.#Ue&&(this.#Ue.data=e)}hasAltText(){return!this.#Ue?.isEmpty()}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#Ge?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground();const e=this._uiManager._signal;this.div.addEventListener("focusin",this.#Ye,{signal:e}),this.div.addEventListener("focusout",this.#Je,{signal:e});const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*n/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[i,s]=this.getInitialTranslation();return this.translate(i,s),dt(this,this.div,["pointerdown"]),this.div}pointerdown(e){const{isMac:t}=we.platform;0!==e.button||e.ctrlKey&&t?e.preventDefault():(this.#tt=!0,this._isDraggable?this.#wt(e):this.#_t(e))}#_t(e){const{isMac:t}=we.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#wt(e){const t=this._uiManager.isSelected(this);let n,i;this._uiManager.setUpDragSession();const s=this._uiManager._signal;t&&(this.div.classList.add("moving"),n={passive:!0,capture:!0,signal:s},this.#ot=e.clientX,this.#lt=e.clientY,i=e=>{const{clientX:t,clientY:n}=e,[i,s]=this.screenToPageTranslation(t-this.#ot,n-this.#lt);this.#ot=t,this.#lt=n,this._uiManager.dragSelectedEditors(i,s)},window.addEventListener("pointermove",i,n));const r=()=>{window.removeEventListener("pointerup",r),window.removeEventListener("blur",r),t&&(this.div.classList.remove("moving"),window.removeEventListener("pointermove",i,n)),this.#tt=!1,this._uiManager.endDragSession()||this.#_t(e)};window.addEventListener("pointerup",r,{signal:s}),window.addEventListener("blur",r,{signal:s})}moveInDOM(){this.#at&&clearTimeout(this.#at),this.#at=setTimeout((()=>{this.#at=null,this.parent?.moveEditorInDOM(this)}),0)}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition()}getRect(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rotation;const i=this.parentScale,[s,r]=this.pageDimensions,[a,o]=this.pageTranslation,l=e/i,c=t/i,u=this.x*s,h=this.y*r,d=this.width*s,p=this.height*r;switch(n){case 0:return[u+l+a,r-h-c-p+o,u+l+d+a,r-h-c+o];case 90:return[u+c+a,r-h+l+o,u+c+p+a,r-h+l+d+o];case 180:return[u-l-d+a,r-h+c+o,u-l+a,r-h+c+p+o];case 270:return[u-c-p+a,r-h-l-d+o,u-c+a,r-h-l+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,i,s,r]=e,a=s-n,o=r-i;switch(this.rotation){case 0:return[n,t-r,a,o];case 90:return[n,t-i,o,a];case 180:return[s,t-i,a,o];case 270:return[s,t-r,o,a];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#st=!0}disableEditMode(){this.#st=!1}isInEditMode(){return this.#st}shouldGetKeyboardEvents(){return this.#rt}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){const e=this._uiManager._signal;this.div?.addEventListener("focusin",this.#Ye,{signal:e}),this.div?.addEventListener("focusout",this.#Je,{signal:e})}rotate(e){}serialize(){re("An editor must be serializable")}static deserialize(e,t,n){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});i.rotation=e.rotation,i.#qe=e.accessibilityData;const[s,r]=i.pageDimensions,[a,o,l,c]=i.getRectInCurrentCoords(e.rect,r);return i.x=a/s,i.y=o/r,i.width=l/s,i.height=c/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.div.removeEventListener("focusin",this.#Ye),this.div.removeEventListener("focusout",this.#Je),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#at&&(clearTimeout(this.#at),this.#at=null),this.#dt(),this.removeEditToolbar(),this.#ct){for(const e of this.#ct.values())clearTimeout(e);this.#ct=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#mt(),this.#Xe.classList.remove("hidden"),dt(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||"Enter"!==e.key)return;this._uiManager.setSelected(this),this.#Qe={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#Xe.children;if(!this.#We){this.#We=Array.from(t);const e=this.#At.bind(this),n=this.#Et.bind(this),i=this._uiManager._signal;for(const t of this.#We){const s=t.getAttribute("data-resizer-name");t.setAttribute("role","spinbutton"),t.addEventListener("keydown",e,{signal:i}),t.addEventListener("blur",n,{signal:i}),t.addEventListener("focus",this.#St.bind(this,s),{signal:i}),wt._l10nPromise.get(`pdfjs-editor-resizer-label-${s}`).then((e=>t.setAttribute("aria-label",e)))}}const n=this.#We[0];let i=0;for(const r of t){if(r===n)break;i++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#We.length/4);if(s!==i){if(s<i)for(let t=0;t<i-s;t++)this.#Xe.append(this.#Xe.firstChild);else if(s>i)for(let t=0;t<s-i;t++)this.#Xe.firstChild.before(this.#Xe.lastChild);let e=0;for(const n of t){const t=this.#We[e++].getAttribute("data-resizer-name");wt._l10nPromise.get(`pdfjs-editor-resizer-label-${t}`).then((e=>n.setAttribute("aria-label",e)))}}this.#Ct(0),this.#rt=!0,this.#Xe.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#At(e){wt._resizerKeyboardManager.exec(this,e)}#Et(e){this.#rt&&e.relatedTarget?.parentNode!==this.#Xe&&this.#dt()}#St(e){this.#et=this.#rt?e:""}#Ct(e){if(this.#We)for(const t of this.#We)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#rt&&this.#yt(this.#et,{movementX:e,movementY:t})}#dt(){if(this.#rt=!1,this.#Ct(-1),this.#Qe){const{savedX:e,savedY:t,savedWidth:n,savedHeight:i}=this.#Qe;this.#bt(e,t,n,i),this.#Qe=null}}_stopResizingWithKeyboard(){this.#dt(),this.div.focus()}select(){this.makeResizable(),this.div?.classList.add("selectedEditor"),this.#Ze?this.#Ze?.show():this.addEditToolbar().then((()=>{this.div?.classList.contains("selectedEditor")&&this.#Ze?.show()}))}unselect(){this.#Xe?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this.#Ze?.hide()}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#it}set isEditing(e){this.#it=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#Ke=!0;const n=e/t,{style:i}=this.div;i.aspectRatio=n,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){this.#ct||=new Map;const{action:t}=e;let n=this.#ct.get(t);return n&&clearTimeout(n),n=setTimeout((()=>{this._reportTelemetry(e),this.#ct.delete(t),0===this.#ct.size&&(this.#ct=null)}),wt._telemetryTimeout),void this.#ct.set(t,n)}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#Ge=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#Ge=!0}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(t){if("CANVAS"===t.nodeName){const e=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.before(t)}}else t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);return t}resetAnnotationElement(e){const{firstChild:t}=e.container;"DIV"===t.nodeName&&t.classList.contains("annotationContent")&&t.remove()}}class _t extends wt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}const At=3285377520,Et=4294901760,St=65535;class Ct{constructor(e){this.h1=e?4294967295&e:At,this.h2=e?4294967295&e:At}update(e){let t,n;if("string"===typeof e){t=new Uint8Array(2*e.length),n=0;for(let i=0,s=e.length;i<s;i++){const s=e.charCodeAt(i);s<=255?t[n++]=s:(t[n++]=s>>>8,t[n++]=255&s)}}else{if(!ArrayBuffer.isView(e))throw new Error("Invalid data format, must be a string or TypedArray.");t=e.slice(),n=t.byteLength}const i=n>>2,s=n-4*i,r=new Uint32Array(t.buffer,0,i);let a=0,o=0,l=this.h1,c=this.h2;const u=3432918353,h=461845907,d=11601,p=13715;for(let f=0;f<i;f++)1&f?(a=r[f],a=a*u&Et|a*d&St,a=a<<15|a>>>17,a=a*h&Et|a*p&St,l^=a,l=l<<13|l>>>19,l=5*l+3864292196):(o=r[f],o=o*u&Et|o*d&St,o=o<<15|o>>>17,o=o*h&Et|o*p&St,c^=o,c=c<<13|c>>>19,c=5*c+3864292196);switch(a=0,s){case 3:a^=t[4*i+2]<<16;case 2:a^=t[4*i+1]<<8;case 1:a^=t[4*i],a=a*u&Et|a*d&St,a=a<<15|a>>>17,a=a*h&Et|a*p&St,1&i?l^=a:c^=a}this.h1=l,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=3981806797*e&Et|36045*e&St,t=4283543511*t&Et|(2950163797*(t<<16|e>>>16)&Et)>>>16,e^=t>>>1,e=444984403*e&Et|60499*e&St,t=3301882366*t&Et|(3120437893*(t<<16|e>>>16)&Et)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Tt=Object.freeze({map:null,hash:"",transfer:void 0});class xt{#Tt=!1;#xt=(()=>new Map)();constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=this.#xt.get(e);return void 0===n?t:Object.assign(t,n)}getRawValue(e){return this.#xt.get(e)}remove(e){if(this.#xt.delete(e),0===this.#xt.size&&this.resetModified(),"function"===typeof this.onAnnotationEditor){for(const e of this.#xt.values())if(e instanceof wt)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=this.#xt.get(e);let i=!1;if(void 0!==n)for(const[s,r]of Object.entries(t))n[s]!==r&&(i=!0,n[s]=r);else i=!0,this.#xt.set(e,t);i&&this.#kt(),t instanceof wt&&"function"===typeof this.onAnnotationEditor&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#xt.has(e)}getAll(){return this.#xt.size>0?be(this.#xt):null}setAll(e){for(const[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return this.#xt.size}#kt(){this.#Tt||(this.#Tt=!0,"function"===typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#Tt&&(this.#Tt=!1,"function"===typeof this.onResetModified&&this.onResetModified())}get print(){return new kt(this)}get serializable(){if(0===this.#xt.size)return Tt;const e=new Map,t=new Ct,n=[],i=Object.create(null);let s=!1;for(const[r,a]of this.#xt){const n=a instanceof wt?a.serialize(!1,i):a;n&&(e.set(r,n),t.update(`${r}:${JSON.stringify(n)}`),s||=!!n.bitmap)}if(s)for(const r of e.values())r.bitmap&&n.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:Tt}get editorStats(){let e=null;const t=new Map;for(const n of this.#xt.values()){if(!(n instanceof wt))continue;const i=n.telemetryFinalData;if(!i)continue;const{type:s}=i;t.has(s)||t.set(s,Object.getPrototypeOf(n).constructor),e||=Object.create(null);const r=e[s]||=new Map;for(const[e,t]of Object.entries(i)){if("type"===e)continue;let n=r.get(e);n||(n=new Map,r.set(e,n));const i=n.get(t)??0;n.set(t,i+1)}}for(const[n,i]of t)e[n]=i.computeTelemetryFinalData(e[n]);return e}}class kt extends xt{#It;constructor(e){super();const{map:t,hash:n,transfer:i}=e.serializable,s=structuredClone(t,i?{transfer:i}:null);this.#It={map:s,hash:n,transfer:i}}get print(){re("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#It}}class It{#Pt=(()=>new Set)();constructor(e){let{ownerDocument:t=globalThis.document,styleElement:n=null}=e;this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#Pt.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(e){let{systemFontInfo:t,_inspectFont:n}=e;if(t&&!this.#Pt.has(t.loadedName))if(ae(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:e,src:i,style:s}=t,r=new FontFace(e,i,s);this.addNativeFontFace(r);try{await r.load(),this.#Pt.add(e),n?.(t)}catch{se(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}}else re("Not implemented: loadSystemFont without the Font Loading API.")}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo)return void await this.loadSystemFont(e);if(this.isFontLoadingAPISupported){const t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(n){throw se(`Failed to load font '${t.family}': '${n}'.`),e.disableFontFace=!0,n}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise((t=>{const n=this._queueLoadingCallback(t);this._prepareFontLoadEvent(e,n)}))}}get isFontLoadingAPISupported(){return le(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){let e=!1;return(r||"undefined"!==typeof navigator&&"string"===typeof navigator?.userAgent&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),le(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){const{loadingRequests:t}=this,n={done:!1,complete:function(){for(ae(!n.done,"completeRequest() cannot be called twice."),n.done=!0;t.length>0&&t[0].done;){const e=t.shift();setTimeout(e.callback,0)}},callback:e};return t.push(n),n}get _loadTestFont(){return le(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(e,t){function n(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function i(e,t,n,i){return e.substring(0,t)+i+e.substring(t+n)}let s,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const o=a.getContext("2d");let l=0;const c=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=i(u,976,c.length,c);const h=1482184792;let d=n(u,16);for(s=0,r=c.length-3;s<r;s+=4)d=d-h+n(c,s)|0;var p;s<c.length&&(d=d-h+n(c+"XXX",s)|0),u=i(u,16,4,(p=d,String.fromCharCode(p>>24&255,p>>16&255,p>>8&255,255&p)));const f=`@font-face {font-family:"${c}";src:${`url(data:font/opentype;base64,${btoa(u)});`}}`;this.insertRule(f);const g=this._document.createElement("div");g.style.visibility="hidden",g.style.width=g.style.height="10px",g.style.position="absolute",g.style.top=g.style.left="0px";for(const m of[e.loadedName,c]){const e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=m,g.append(e)}this._document.body.append(g),function e(t,n){if(++l>30)return se("Load test font never loaded."),void n();o.font="30px "+t,o.fillText(".",0,20),o.getImageData(0,0,1,1).data[3]>0?n():setTimeout(e.bind(null,t,n))}(c,(()=>{g.remove(),t.complete()}))}}class Pt{constructor(e,t){let{disableFontFace:n=!1,inspectFont:i=null}=t;this.compiledGlyphs=Object.create(null);for(const s in e)this[s]=e[s];this.disableFontFace=!0===n,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(this.cssFontInfo){const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}else e=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=ve(this.data),t=`url(data:${this.mimetype};base64,${btoa(e)});`;let n;if(this.cssFontInfo){let e=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(e+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),n=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${e}src:${t}}`}else n=`@font-face {font-family:"${this.loadedName}";src:${t}}`;return this._inspectFont?.(this,t),n}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let n;try{n=e.get(this.loadedName+"_path_"+t)}catch(s){se(`getPathGenerator - ignoring character: "${s}".`)}if(!Array.isArray(n)||0===n.length)return this.compiledGlyphs[t]=function(e,t){};const i=[];for(let r=0,a=n.length;r<a;)switch(n[r++]){case xe:{const[e,t,s,a,o,l]=n.slice(r,r+6);i.push((n=>n.bezierCurveTo(e,t,s,a,o,l))),r+=6}break;case ke:{const[e,t]=n.slice(r,r+2);i.push((n=>n.moveTo(e,t))),r+=2}break;case Ie:{const[e,t]=n.slice(r,r+2);i.push((n=>n.lineTo(e,t))),r+=2}break;case Pe:{const[e,t,s,a]=n.slice(r,r+4);i.push((n=>n.quadraticCurveTo(e,t,s,a))),r+=4}break;case Re:i.push((e=>e.restore()));break;case De:i.push((e=>e.save()));break;case Me:ae(2===i.length,"Scale command is only valid at the third position.");break;case Ne:{const[e,t,s,a,o,l]=n.slice(r,r+6);i.push((n=>n.transform(e,t,s,a,o,l))),r+=6}break;case Le:{const[e,t]=n.slice(r,r+2);i.push((n=>n.translate(e,t))),r+=2}}return this.compiledGlyphs[t]=function(e,t){i[0](e),i[1](e),e.scale(t,-t);for(let n=2,s=i.length;n<s;n++)i[n](e)}}}if(r){var Rt=Promise.withResolvers(),Dt=null;(async()=>{const e=await import("fs"),t=await import("http"),n=await import("https"),i=await import("url");return new Map(Object.entries({fs:e,http:t,https:n,url:i,canvas:undefined,path2d:undefined}))})().then((e=>{Dt=e,Rt.resolve()}),(e=>{se(`loadPackages: ${e}`),Dt=new Map,Rt.resolve()}))}class Mt{static get promise(){return Rt.promise}static get(e){return Dt?.get(e)}}const Nt=function(e){return Mt.get("fs").promises.readFile(e).then((e=>new Uint8Array(e)))};const Lt="Fill",Ot="Stroke",Ft="Shading";function Ut(e,t){if(!t)return;const n=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],n,i),e.clip(s)}class zt{constructor(){this.constructor===zt&&re("Cannot initialize BaseShadingPattern.")}getPattern(){re("Abstract method `getPattern` called.")}}class Vt extends zt{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,i){let s;if(i===Ot||i===Lt){const r=t.current.getClippedPathBoundingBox(i,ot(e))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,o=Math.ceil(r[3]-r[1])||1,l=t.cachedCanvases.getCanvas("pattern",a,o,!0),c=l.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),n=Ae.transform(n,[1,0,0,1,r[0],r[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),Ut(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),s=e.createPattern(l.canvas,"no-repeat");const u=new DOMMatrix(n);s.setTransform(u)}else Ut(e,this._bbox),s=this._createGradient(e);return s}}function Bt(e,t,n,i,s,r,a,o){const l=t.coords,c=t.colors,u=e.data,h=4*e.width;let d;l[n+1]>l[i+1]&&(d=n,n=i,i=d,d=r,r=a,a=d),l[i+1]>l[s+1]&&(d=i,i=s,s=d,d=a,a=o,o=d),l[n+1]>l[i+1]&&(d=n,n=i,i=d,d=r,r=a,a=d);const p=(l[n]+t.offsetX)*t.scaleX,f=(l[n+1]+t.offsetY)*t.scaleY,g=(l[i]+t.offsetX)*t.scaleX,m=(l[i+1]+t.offsetY)*t.scaleY,v=(l[s]+t.offsetX)*t.scaleX,y=(l[s+1]+t.offsetY)*t.scaleY;if(f>=y)return;const b=c[r],w=c[r+1],_=c[r+2],A=c[a],E=c[a+1],S=c[a+2],C=c[o],T=c[o+1],x=c[o+2],k=Math.round(f),I=Math.round(y);let P,R,D,M,N,L,O,F;for(let U=k;U<=I;U++){if(U<m){const e=U<f?0:(f-U)/(f-m);P=p-(p-g)*e,R=b-(b-A)*e,D=w-(w-E)*e,M=_-(_-S)*e}else{let e;e=U>y?1:m===y?0:(m-U)/(m-y),P=g-(g-v)*e,R=A-(A-C)*e,D=E-(E-T)*e,M=S-(S-x)*e}let e;e=U<f?0:U>y?1:(f-U)/(f-y),N=p-(p-v)*e,L=b-(b-C)*e,O=w-(w-T)*e,F=_-(_-x)*e;const t=Math.round(Math.min(P,N)),n=Math.round(Math.max(P,N));let i=h*U+4*t;for(let s=t;s<=n;s++)e=(P-s)/(P-N),e<0?e=0:e>1&&(e=1),u[i++]=R-(R-L)*e|0,u[i++]=D-(D-O)*e|0,u[i++]=M-(M-F)*e|0,u[i++]=255}}function jt(e,t,n){const i=t.coords,s=t.colors;let r,a;switch(t.type){case"lattice":const o=t.verticesPerRow,l=Math.floor(i.length/o)-1,c=o-1;for(r=0;r<l;r++){let t=r*o;for(let r=0;r<c;r++,t++)Bt(e,n,i[t],i[t+1],i[t+o],s[t],s[t+1],s[t+o]),Bt(e,n,i[t+o+1],i[t+1],i[t+o],s[t+o+1],s[t+1],s[t+o])}break;case"triangles":for(r=0,a=i.length;r<a;r+=3)Bt(e,n,i[r],i[r+1],i[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class Ht extends zt{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){const i=Math.floor(this._bounds[0]),s=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-i,a=Math.ceil(this._bounds[3])-s,o=Math.min(Math.ceil(Math.abs(r*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(a*e[1]*1.1)),3e3),c=r/o,u=a/l,h={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-s,scaleX:1/c,scaleY:1/u},d=o+4,p=l+4,f=n.getCanvas("mesh",d,p,!1),g=f.context,m=g.createImageData(o,l);if(t){const e=m.data;for(let n=0,i=e.length;n<i;n+=4)e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=255}for(const v of this._figures)jt(m,v,h);g.putImageData(m,2,2);return{canvas:f.canvas,offsetX:i-2*c,offsetY:s-2*u,scaleX:c,scaleY:u}}getPattern(e,t,n,i){let s;if(Ut(e,this._bbox),i===Ft)s=Ae.singularValueDecompose2dScale(ot(e));else if(s=Ae.singularValueDecompose2dScale(t.baseTransform),this.matrix){const e=Ae.singularValueDecompose2dScale(this.matrix);s=[s[0]*e[0],s[1]*e[1]]}const r=this._createMeshCanvas(s,i===Ft?null:this._background,t.cachedCanvases);return i!==Ft&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}}class $t extends zt{getPattern(){return"hotpink"}}const qt=1,Wt=2;class Gt{static MAX_PATTERN_SIZE=3e3;constructor(e,t,n,i,s){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=i,this.baseTransform=s}createPatternCanvas(e){const t=this.operatorList,n=this.bbox,i=this.xstep,s=this.ystep,r=this.paintType,a=this.tilingType,o=this.color,l=this.canvasGraphicsFactory;ie("TilingType: "+a);const c=n[0],u=n[1],h=n[2],d=n[3],p=Ae.singularValueDecompose2dScale(this.matrix),f=Ae.singularValueDecompose2dScale(this.baseTransform),g=[p[0]*f[0],p[1]*f[1]],m=this.getSizeAndScale(i,this.ctx.canvas.width,g[0]),v=this.getSizeAndScale(s,this.ctx.canvas.height,g[1]),y=e.cachedCanvases.getCanvas("pattern",m.size,v.size,!0),b=y.context,w=l.createCanvasGraphics(b);w.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(w,r,o);let _=c,A=u,E=h,S=d;return c<0&&(_=0,E+=Math.abs(c)),u<0&&(A=0,S+=Math.abs(u)),b.translate(-m.scale*_,-v.scale*A),w.transform(m.scale,0,0,v.scale,0,0),b.save(),this.clipBbox(w,_,A,E,S),w.baseTransform=ot(w.ctx),w.executeOperatorList(t),w.endDrawing(),{canvas:y.canvas,scaleX:m.scale,scaleY:v.scale,offsetX:_,offsetY:A}}getSizeAndScale(e,t,n){e=Math.abs(e);const i=Math.max(Gt.MAX_PATTERN_SIZE,t);let s=Math.ceil(e*n);return s>=i?s=i:n=s/e,{scale:n,size:s}}clipBbox(e,t,n,i,s){const r=i-t,a=s-n;e.ctx.rect(t,n,r,a),e.current.updateRectMinMax(ot(e.ctx),[t,n,i,s]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const i=e.ctx,s=e.current;switch(t){case qt:const e=this.ctx;i.fillStyle=e.fillStyle,i.strokeStyle=e.strokeStyle,s.fillColor=e.fillStyle,s.strokeColor=e.strokeStyle;break;case Wt:const r=Ae.makeHexColor(n[0],n[1],n[2]);i.fillStyle=r,i.strokeStyle=r,s.fillColor=r,s.strokeColor=r;break;default:throw new ge(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,i){let s=n;i!==Ft&&(s=Ae.transform(s,t.baseTransform),this.matrix&&(s=Ae.transform(s,this.matrix)));const r=this.createPatternCanvas(t);let a=new DOMMatrix(s);a=a.translate(r.offsetX,r.offsetY),a=a.scale(1/r.scaleX,1/r.scaleY);const o=e.createPattern(r.canvas,"repeat");return o.setTransform(a),o}}function Kt(e){let{src:t,srcPos:n=0,dest:i,width:s,height:r,nonBlackColor:a=4294967295,inverseDecode:o=!1}=e;const l=we.isLittleEndian?4278190080:255,[c,u]=o?[a,l]:[l,a],h=s>>3,d=7&s,p=t.length;i=new Uint32Array(i.buffer);let f=0;for(let g=0;g<r;g++){for(const s=n+h;n<s;n++){const e=n<p?t[n]:255;i[f++]=128&e?u:c,i[f++]=64&e?u:c,i[f++]=32&e?u:c,i[f++]=16&e?u:c,i[f++]=8&e?u:c,i[f++]=4&e?u:c,i[f++]=2&e?u:c,i[f++]=1&e?u:c}if(0===d)continue;const e=n<p?t[n++]:255;for(let t=0;t<d;t++)i[f++]=e&1<<7-t?u:c}return{srcPos:n,destPos:f}}const Xt=16;class Qt{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let i;return void 0!==this.cache[e]?(i=this.cache[e],this.canvasFactory.reset(i,t,n)):(i=this.canvasFactory.create(t,n),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Yt(e,t,n,i,s,r,a,o,l,c){const[u,h,d,p,f,g]=ot(e);if(0===h&&0===d){const m=a*u+f,v=Math.round(m),y=o*p+g,b=Math.round(y),w=(a+l)*u+f,_=Math.abs(Math.round(w)-v)||1,A=(o+c)*p+g,E=Math.abs(Math.round(A)-b)||1;return e.setTransform(Math.sign(u),0,0,Math.sign(p),v,b),e.drawImage(t,n,i,s,r,0,0,_,E),e.setTransform(u,h,d,p,f,g),[_,E]}if(0===u&&0===p){const m=o*d+f,v=Math.round(m),y=a*h+g,b=Math.round(y),w=(o+c)*d+f,_=Math.abs(Math.round(w)-v)||1,A=(a+l)*h+g,E=Math.abs(Math.round(A)-b)||1;return e.setTransform(0,Math.sign(h),Math.sign(d),0,v,b),e.drawImage(t,n,i,s,r,0,0,E,_),e.setTransform(u,h,d,p,f,g),[E,_]}e.drawImage(t,n,i,s,r,a,o,l,c);return[Math.hypot(u,h)*l,Math.hypot(d,p)*c]}class Jt{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=a,this.textMatrixScale=1,this.fontMatrix=o,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=w,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=Ae.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){const n=Ae.applyTransform(t,e),i=Ae.applyTransform(t.slice(2),e),s=Ae.applyTransform([t[0],t[3]],e),r=Ae.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],i[0],s[0],r[0]),this.minY=Math.min(this.minY,n[1],i[1],s[1],r[1]),this.maxX=Math.max(this.maxX,n[0],i[0],s[0],r[0]),this.maxY=Math.max(this.maxY,n[1],i[1],s[1],r[1])}updateScalingPathMinMax(e,t){Ae.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,i,s,r,a,o,l,c){const u=Ae.bezierBoundingBox(t,n,i,s,r,a,o,l,c);c||this.updateRectMinMax(e,u)}getPathBoundingBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[this.minX,this.minY,this.maxX,this.maxY];if(e===Ot){t||re("Stroke bounding box must include transform.");const e=Ae.singularValueDecompose2dScale(t),i=e[0]*this.lineWidth/2,s=e[1]*this.lineWidth/2;n[0]-=i,n[1]-=s,n[2]+=i,n[3]+=s}return n}updateClipFromPath(){const e=Ae.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Ae.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Zt(e,t){if("undefined"!==typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);const n=t.height,i=t.width,s=n%Xt,r=(n-s)/Xt,a=0===s?r:r+1,o=e.createImageData(i,Xt);let l,c=0;const u=t.data,h=o.data;let d,p,f,g;if(t.kind===T.GRAYSCALE_1BPP){const t=u.byteLength,n=new Uint32Array(h.buffer,0,h.byteLength>>2),g=n.length,m=i+7>>3,v=4294967295,y=we.isLittleEndian?4278190080:255;for(d=0;d<a;d++){for(f=d<r?Xt:s,l=0,p=0;p<f;p++){const e=t-c;let s=0;const r=e>m?i:8*e-7,a=-8&r;let o=0,h=0;for(;s<a;s+=8)h=u[c++],n[l++]=128&h?v:y,n[l++]=64&h?v:y,n[l++]=32&h?v:y,n[l++]=16&h?v:y,n[l++]=8&h?v:y,n[l++]=4&h?v:y,n[l++]=2&h?v:y,n[l++]=1&h?v:y;for(;s<r;s++)0===o&&(h=u[c++],o=128),n[l++]=h&o?v:y,o>>=1}for(;l<g;)n[l++]=0;e.putImageData(o,0,d*Xt)}}else if(t.kind===T.RGBA_32BPP){for(p=0,g=i*Xt*4,d=0;d<r;d++)h.set(u.subarray(c,c+g)),c+=g,e.putImageData(o,0,p),p+=Xt;d<a&&(g=i*s*4,h.set(u.subarray(c,c+g)),e.putImageData(o,0,p))}else{if(t.kind!==T.RGB_24BPP)throw new Error(`bad image kind: ${t.kind}`);for(f=Xt,g=i*f,d=0;d<a;d++){for(d>=r&&(f=s,g=i*f),l=0,p=g;p--;)h[l++]=u[c++],h[l++]=u[c++],h[l++]=u[c++],h[l++]=255;e.putImageData(o,0,d*Xt)}}}function en(e,t){if(t.bitmap)return void e.drawImage(t.bitmap,0,0);const n=t.height,i=t.width,s=n%Xt,r=(n-s)/Xt,a=0===s?r:r+1,o=e.createImageData(i,Xt);let l=0;const c=t.data,u=o.data;for(let h=0;h<a;h++){const t=h<r?Xt:s;({srcPos:l}=Kt({src:c,srcPos:l,dest:u,width:i,height:t,nonBlackColor:0})),e.putImageData(o,0,h*Xt)}}function tn(e,t){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of n)void 0!==e[i]&&(t[i]=e[i]);void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function nn(e){if(e.strokeStyle=e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0),!r){const{filter:t}=e;"none"!==t&&""!==t&&(e.filter="none")}}function sn(e,t){if(t)return!0;const n=Ae.singularValueDecompose2dScale(e);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*je.PDF_TO_CSS_UNITS);return n[0]<=i&&n[1]<=i}const rn=["butt","round","square"],an=["miter","round","bevel"],on={},ln={};class cn{constructor(e,t,n,i,s,r,a,o){let{optionalContentConfig:l,markedContentStack:c=null}=r;this.ctx=e,this.current=new Jt(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=i,this.filterFactory=s,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=l,this.cachedCanvases=new Qt(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=a,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=o,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"===typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing(e){let{transform:t,viewport:n,transparency:i=!1,background:s=null}=e;const r=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=o,i){const e=this.cachedCanvases.getCanvas("transparent",r,a);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform(...ot(this.compositeCtx))}this.ctx.save(),nn(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...n.transform),this.viewportScale=n.scale,this.baseTransform=ot(this.ctx)}executeOperatorList(e,t,n,i){const s=e.argsArray,r=e.fnArray;let a=t||0;const o=s.length;if(o===a)return a;const l=o-a>10&&"function"===typeof n,c=l?Date.now()+15:0;let u=0;const h=this.commonObjs,d=this.objs;let p;for(;;){if(void 0!==i&&a===i.nextBreakPoint)return i.breakIt(a,n),a;if(p=r[a],p!==J.dependency)this[p].apply(this,s[a]);else for(const e of s[a]){const t=e.startsWith("g_")?h:d;if(!t.has(e))return t.get(e,n),a}if(a++,a===o)return a;if(l&&++u>10){if(Date.now()>c)return n(),a;u=0}}}#Rt(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#Rt(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#Dt()}#Dt(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==e){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const n=e.width,i=e.height;let s,r,a=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=n,c=i,u="prescale1";for(;a>2&&l>1||o>2&&c>1;){let t=l,n=c;a>2&&l>1&&(t=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),a/=l/t),o>2&&c>1&&(n=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/n),s=this.cachedCanvases.getCanvas(u,t,n),r=s.context,r.clearRect(0,0,t,n),r.drawImage(e,0,0,l,c,0,0,t,n),e=s.canvas,l=t,c=n,u="prescale1"===u?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e){const t=this.ctx,{width:n,height:i}=e,s=this.current.fillColor,r=this.current.patternFill,a=ot(t);let o,l,c,u;if((e.bitmap||e.data)&&e.count>1){const t=e.bitmap||e.data.buffer;l=JSON.stringify(r?a:[a.slice(0,4),s]),o=this._cachedBitmapsMap.get(t),o||(o=new Map,this._cachedBitmapsMap.set(t,o));const n=o.get(l);if(n&&!r){return{canvas:n,offsetX:Math.round(Math.min(a[0],a[2])+a[4]),offsetY:Math.round(Math.min(a[1],a[3])+a[5])}}c=n}c||(u=this.cachedCanvases.getCanvas("maskCanvas",n,i),en(u.context,e));let h=Ae.transform(a,[1/n,0,0,-1/i,0,0]);h=Ae.transform(h,[1,0,0,1,0,-i]);const[d,p,f,g]=Ae.getAxialAlignedBoundingBox([0,0,n,i],h),m=Math.round(f-d)||1,v=Math.round(g-p)||1,y=this.cachedCanvases.getCanvas("fillCanvas",m,v),b=y.context,w=d,_=p;b.translate(-w,-_),b.transform(...h),c||(c=this._scaleImage(u.canvas,lt(b)),c=c.img,o&&r&&o.set(l,c)),b.imageSmoothingEnabled=sn(ot(b),e.interpolate),Yt(b,c,0,0,c.width,c.height,0,0,n,i),b.globalCompositeOperation="source-in";const A=Ae.transform(lt(b),[1,0,0,1,-w,-_]);return b.fillStyle=r?s.getPattern(t,this,A,Lt):s,b.fillRect(0,0,n,i),o&&!r&&(this.cachedCanvases.delete("fillCanvas"),o.set(l,y.canvas)),{canvas:y.canvas,offsetX:Math.round(w),offsetY:Math.round(_)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=rn[e]}setLineJoin(e){this.ctx.lineJoin=an[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const n=this.ctx;void 0!==n.setLineDash&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;const s=this.ctx;s.setTransform(...ot(this.suspendedCtx)),tn(this.suspendedCtx,s),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},e.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},e.transform=function(e,n,i,s,r,a){t.transform(e,n,i,s,r,a),this.__originalTransform(e,n,i,s,r,a)},e.setTransform=function(e,n,i,s,r,a){t.setTransform(e,n,i,s,r,a),this.__originalSetTransform(e,n,i,s,r,a)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},e.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},e.bezierCurveTo=function(e,n,i,s,r,a){t.bezierCurveTo(e,n,i,s,r,a),this.__originalBezierCurveTo(e,n,i,s,r,a)},e.rect=function(e,n,i,s){t.rect(e,n,i,s),this.__originalRect(e,n,i,s)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(s,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),tn(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,i){const s=i[0],r=i[1],a=i[2]-s,o=i[3]-r;0!==a&&0!==o&&(this.genericComposeSMask(t.context,n,a,o,t.subtype,t.backdrop,t.transferMap,s,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,i,s,r,a,o,l,c,u){let h=e.canvas,d=o-c,p=l-u;if(r)if(d<0||p<0||d+n>h.width||p+i>h.height){const e=this.cachedCanvases.getCanvas("maskExtension",n,i),t=e.context;t.drawImage(h,-d,-p),r.some((e=>0!==e))&&(t.globalCompositeOperation="destination-atop",t.fillStyle=Ae.makeHexColor(...r),t.fillRect(0,0,n,i),t.globalCompositeOperation="source-over"),h=e.canvas,d=p=0}else if(r.some((e=>0!==e))){e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const t=new Path2D;t.rect(d,p,n,i),e.clip(t),e.globalCompositeOperation="destination-atop",e.fillStyle=Ae.makeHexColor(...r),e.fillRect(d,p,n,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),"Alpha"===s&&a?t.filter=this.filterFactory.addAlphaFilter(a):"Luminosity"===s&&(t.filter=this.filterFactory.addLuminosityFilter(a));const f=new Path2D;f.rect(o,l,n,i),t.clip(f),t.globalCompositeOperation="destination-in",t.drawImage(h,d,p,n,i,o,l,n,i),t.restore()}save(){this.inSMaskMode?(tn(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),tn(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,i,s,r){this.ctx.transform(e,t,n,i,s,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){const i=this.ctx,s=this.current;let r,a,o=s.x,l=s.y;const c=ot(i),u=0===c[0]&&0===c[3]||0===c[1]&&0===c[2],h=u?n.slice(0):null;for(let d=0,p=0,f=e.length;d<f;d++)switch(0|e[d]){case J.rectangle:o=t[p++],l=t[p++];const e=t[p++],n=t[p++],d=o+e,f=l+n;i.moveTo(o,l),0===e||0===n?i.lineTo(d,f):(i.lineTo(d,l),i.lineTo(d,f),i.lineTo(o,f)),u||s.updateRectMinMax(c,[o,l,d,f]),i.closePath();break;case J.moveTo:o=t[p++],l=t[p++],i.moveTo(o,l),u||s.updatePathMinMax(c,o,l);break;case J.lineTo:o=t[p++],l=t[p++],i.lineTo(o,l),u||s.updatePathMinMax(c,o,l);break;case J.curveTo:r=o,a=l,o=t[p+4],l=t[p+5],i.bezierCurveTo(t[p],t[p+1],t[p+2],t[p+3],o,l),s.updateCurvePathMinMax(c,r,a,t[p],t[p+1],t[p+2],t[p+3],o,l,h),p+=6;break;case J.curveTo2:r=o,a=l,i.bezierCurveTo(o,l,t[p],t[p+1],t[p+2],t[p+3]),s.updateCurvePathMinMax(c,r,a,o,l,t[p],t[p+1],t[p+2],t[p+3],h),o=t[p+2],l=t[p+3],p+=4;break;case J.curveTo3:r=o,a=l,o=t[p+2],l=t[p+3],i.bezierCurveTo(t[p],t[p+1],o,l,o,l),s.updateCurvePathMinMax(c,r,a,t[p],t[p+1],o,l,o,l,h),p+=4;break;case J.closePath:i.closePath()}u&&s.updateScalingPathMinMax(c,h),s.setCurrentPoint(o,l)}closePath(){this.ctx.closePath()}stroke(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"===typeof n&&n?.getPattern?(t.save(),t.strokeStyle=n.getPattern(t,this,lt(t),Ot),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.ctx,n=this.current.fillColor;let i=!1;this.current.patternFill&&(t.save(),t.fillStyle=n.getPattern(t,this,lt(t),Lt),i=!0);const s=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==s&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),i&&t.restore(),e&&this.consumePath(s)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=on}eoClip(){this.pendingClip=ln}beginText(){this.current.textMatrix=a,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(const n of e)t.setTransform(...n.transform),t.translate(n.x,n.y),n.addToPath(t,n.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){const n=this.commonObjs.get(e),i=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=n.fontMatrix||o,0!==i.fontMatrix[0]&&0!==i.fontMatrix[3]||se("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;const s=n.loadedName||"sans-serif",r=n.systemFontInfo?.css||`"${s}", ${n.fallbackName}`;let a="normal";n.black?a="900":n.bold&&(a="bold");const l=n.italic?"italic":"normal";let c=t;t<16?c=16:t>100&&(c=100),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${a} ${c}px ${r}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,i,s,r){this.current.textMatrix=[e,t,n,i,s,r],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,i){const s=this.ctx,r=this.current,a=r.font,o=r.textRenderingMode,l=r.fontSize/r.fontSizeScale,c=o&S,u=!!(o&C),h=r.patternFill&&!a.missingFile;let d;if((a.disableFontFace||u||h)&&(d=a.getPathGenerator(this.commonObjs,e)),a.disableFontFace||h?(s.save(),s.translate(t,n),s.beginPath(),d(s,l),i&&s.setTransform(...i),c!==w&&c!==A||s.fill(),c!==_&&c!==A||s.stroke(),s.restore()):(c!==w&&c!==A||s.fillText(e,t,n),c!==_&&c!==A||s.strokeText(e,t,n)),u){(this.pendingTextPaths||=[]).push({transform:ot(s),x:t,y:n,fontSize:l,addToPath:d})}}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){n=!0;break}return le(this,"isFontSubpixelAAEnabled",n)}showText(e){const t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);const i=t.fontSize;if(0===i)return;const s=this.ctx,r=t.fontSizeScale,a=t.charSpacing,o=t.wordSpacing,l=t.fontDirection,c=t.textHScale*l,u=e.length,h=n.vertical,d=h?1:-1,p=n.defaultVMetrics,f=i*t.fontMatrix[0],g=t.textRenderingMode===w&&!n.disableFontFace&&!t.patternFill;let m;if(s.save(),s.transform(...t.textMatrix),s.translate(t.x,t.y+t.textRise),l>0?s.scale(c,-1):s.scale(c,1),t.patternFill){s.save();const e=t.fillColor.getPattern(s,this,lt(s),Lt);m=ot(s),s.restore(),s.fillStyle=e}let v=t.lineWidth;const y=t.textMatrixScale;if(0===y||0===v){const e=t.textRenderingMode&S;e!==_&&e!==A||(v=this.getSinglePixelWidth())}else v/=y;if(1!==r&&(s.scale(r,r),v/=r),s.lineWidth=v,n.isInvalidPDFjsFont){const n=[];let i=0;for(const t of e)n.push(t.unicode),i+=t.width;return s.fillText(n.join(""),0,0),t.x+=i*f*c,s.restore(),void this.compose()}let b,E=0;for(b=0;b<u;++b){const t=e[b];if("number"===typeof t){E+=d*t*i/1e3;continue}let c=!1;const u=(t.isSpace?o:0)+a,v=t.fontChar,y=t.accent;let w,_,A=t.width;if(h){const e=t.vmetric||p,n=-(t.vmetric?e[1]:.5*A)*f,i=e[2]*f;A=e?-e[0]:A,w=n/r,_=(E+i)/r}else w=E/r,_=0;if(n.remeasure&&A>0){const e=1e3*s.measureText(v).width/i*r;if(A<e&&this.isFontSubpixelAAEnabled){const t=A/e;c=!0,s.save(),s.scale(t,1),w/=t}else A!==e&&(w+=(A-e)/2e3*i/r)}if(this.contentVisible&&(t.isInFont||n.missingFile))if(g&&!y)s.fillText(v,w,_);else if(this.paintChar(v,w,_,m),y){const e=w+i*y.offset.x/r,t=_-i*y.offset.y/r;this.paintChar(y.fontChar,e,t,m)}E+=h?A*f-u*l:A*f+u*l,c&&s.restore()}h?t.y-=E:t.x+=E*c,s.restore(),this.compose()}showType3Text(e){const t=this.ctx,n=this.current,i=n.font,s=n.fontSize,r=n.fontDirection,a=i.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,u=n.textHScale*r,h=n.fontMatrix||o,d=e.length;let p,f,g,m;if(!(n.textRenderingMode===E)&&0!==s){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(u,r),p=0;p<d;++p){if(f=e[p],"number"===typeof f){m=a*f*s/1e3,this.ctx.translate(m,0),n.x+=m*u;continue}const r=(f.isSpace?c:0)+l,o=i.charProcOperatorList[f.operatorListId];if(!o){se(`Type3 character "${f.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=f,this.save(),t.scale(s,s),t.transform(...h),this.executeOperatorList(o),this.restore());g=Ae.applyTransform([f.width,0],h)[0]*s+r,t.translate(g,0),n.x+=g*u}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,i,s,r){this.ctx.rect(n,i,s-n,r-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if("TilingPattern"===e[0]){const n=e[1],i=this.baseTransform||ot(this.ctx),s={createCanvasGraphics:e=>new cn(e,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Gt(e,n,this.ctx,s,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){const i=Ae.makeHexColor(e,t,n);this.ctx.strokeStyle=i,this.current.strokeColor=i}setFillRGBColor(e,t,n){const i=Ae.makeHexColor(e,t,n);this.ctx.fillStyle=i,this.current.fillColor=i,this.current.patternFill=!1}_getPattern(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.cachedPatterns.has(e)?t=this.cachedPatterns.get(e):(t=function(e){switch(e[0]){case"RadialAxial":return new Vt(e);case"Mesh":return new Ht(e);case"Dummy":return new $t}throw new Error(`Unknown IR type: ${e[0]}`)}(this.getObject(e)),this.cachedPatterns.set(e,t)),n&&(t.matrix=n),t}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,lt(t),Ft);const i=lt(t);if(i){const{width:e,height:n}=t.canvas,[s,r,a,o]=Ae.getAxialAlignedBoundingBox([0,0,e,n],i);this.ctx.fillRect(s,r,a-s,o-r)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){re("Should not call beginInlineImage")}beginImageData(){re("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=ot(this.ctx),t)){const e=t[2]-t[0],n=t[3]-t[1];this.ctx.rect(t[0],t[1],e,n),this.current.updateRectMinMax(ot(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||ie("TODO: Support non-isolated groups."),e.knockout&&se("Knockout groups not supported.");const n=ot(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=Ae.getAxialAlignedBoundingBox(e.bbox,ot(t));const s=[0,0,t.canvas.width,t.canvas.height];i=Ae.intersect(i,s)||[0,0,0,0];const r=Math.floor(i[0]),a=Math.floor(i[1]),o=Math.max(Math.ceil(i[2])-r,1),l=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,o,l]);let c="groupAt"+this.groupLevel;e.smask&&(c+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(c,o,l),h=u.context;h.translate(-r,-a),h.transform(...n),e.smask?this.smaskStack.push({canvas:u.canvas,context:h,offsetX:r,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(r,a),t.save()),tn(t,h),this.ctx=h,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const e=ot(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...e);const n=Ae.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],e);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,n,i,s){if(this.#Rt(),nn(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const i=t[2]-t[0],r=t[3]-t[1];if(s&&this.annotationCanvasMap){(n=n.slice())[4]-=t[0],n[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=i,t[3]=r;const[s,a]=Ae.singularValueDecompose2dScale(ot(this.ctx)),{viewportScale:o}=this,l=Math.ceil(i*this.outputScaleX*o),c=Math.ceil(r*this.outputScaleY*o);this.annotationCanvas=this.canvasFactory.create(l,c);const{canvas:u,context:h}=this.annotationCanvas;this.annotationCanvasMap.set(e,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=h,this.ctx.save(),this.ctx.setTransform(s,0,0,-a,0,r*a),nn(this.ctx)}else nn(this.ctx),this.ctx.rect(t[0],t[1],i,r),this.ctx.clip(),this.endPath()}this.current=new Jt(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#Dt(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;(e=this.getObject(e.data,e)).count=t;const n=this.ctx,i=this.processingType3;if(i&&(void 0===i.compiled&&(i.compiled=function(e){const{width:t,height:n}=e;if(t>1e3||n>1e3)return null;const i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),s=t+1;let r,a,o,l=new Uint8Array(s*(n+1));const c=t+7&-8;let u=new Uint8Array(c*n),h=0;for(const g of e.data){let e=128;for(;e>0;)u[h++]=g&e?0:255,e>>=1}let d=0;for(h=0,0!==u[h]&&(l[0]=1,++d),a=1;a<t;a++)u[h]!==u[h+1]&&(l[a]=u[h]?2:1,++d),h++;for(0!==u[h]&&(l[a]=2,++d),r=1;r<n;r++){h=r*c,o=r*s,u[h-c]!==u[h]&&(l[o]=u[h]?1:8,++d);let e=(u[h]?4:0)+(u[h-c]?8:0);for(a=1;a<t;a++)e=(e>>2)+(u[h+1]?4:0)+(u[h-c+1]?8:0),i[e]&&(l[o+a]=i[e],++d),h++;if(u[h-c]!==u[h]&&(l[o+a]=u[h]?2:4,++d),d>1e3)return null}for(h=c*(n-1),o=r*s,0!==u[h]&&(l[o]=8,++d),a=1;a<t;a++)u[h]!==u[h+1]&&(l[o+a]=u[h]?4:8,++d),h++;if(0!==u[h]&&(l[o+a]=4,++d),d>1e3)return null;const p=new Int32Array([0,s,-1,0,-s,0,0,0,1]),f=new Path2D;for(r=0;d&&r<=n;r++){let e=r*s;const n=e+t;for(;e<n&&!l[e];)e++;if(e===n)continue;f.moveTo(e%s,r);const i=e;let a=l[e];do{const t=p[a];do{e+=t}while(!l[e]);const n=l[e];5!==n&&10!==n?(a=n,l[e]=0):(a=n&51*a>>4,l[e]&=a>>2|a<<2),f.lineTo(e%s,e/s|0),l[e]||--d}while(i!==e);--r}return u=null,l=null,function(e){e.save(),e.scale(1/t,-1/n),e.translate(0,-n),e.fill(f),e.beginPath(),e.restore()}}(e)),i.compiled))return void i.compiled(n);const s=this._createMaskCanvas(e),r=s.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,s.offsetX,s.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;e=this.getObject(e.data,e);const a=this.ctx;a.save();const o=ot(a);a.transform(t,n,i,s,0,0);const l=this._createMaskCanvas(e);a.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(let c=0,u=r.length;c<u;c+=2){const e=Ae.transform(o,[t,n,i,s,r[c],r[c+1]]),[u,h]=Ae.applyTransform([0,0],e);a.drawImage(l.canvas,u,h)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,n=this.current.fillColor,i=this.current.patternFill;for(const s of e){const{data:e,width:r,height:a,transform:o}=s,l=this.cachedCanvases.getCanvas("maskCanvas",r,a),c=l.context;c.save();en(c,this.getObject(e,s)),c.globalCompositeOperation="source-in",c.fillStyle=i?n.getPattern(c,this,lt(t),Lt):n,c.fillRect(0,0,r,a),c.restore(),t.save(),t.transform(...o),t.scale(1,-1),Yt(t,l.canvas,0,0,r,a,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);t?this.paintInlineImageXObject(t):se("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,n,i){if(!this.contentVisible)return;const s=this.getObject(e);if(!s)return void se("Dependent image isn't ready yet");const r=s.width,a=s.height,o=[];for(let l=0,c=i.length;l<c;l+=2)o.push({transform:[t,0,0,n,i[l],i[l+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(s,o)}applyTransferMapsToCanvas(e){return"none"!==this.current.transferMaps&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if("none"===this.current.transferMaps)return e.bitmap;const{bitmap:t,width:n,height:i}=e,s=this.cachedCanvases.getCanvas("inlineImage",n,i),r=s.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",s.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,n=e.height,i=this.ctx;if(this.save(),!r){const{filter:e}=i;"none"!==e&&""!==e&&(i.filter="none")}let s;if(i.scale(1/t,-1/n),e.bitmap)s=this.applyTransferMapsToBitmap(e);else if("function"===typeof HTMLElement&&e instanceof HTMLElement||!e.data)s=e;else{const i=this.cachedCanvases.getCanvas("inlineImage",t,n).context;Zt(i,e),s=this.applyTransferMapsToCanvas(i)}const a=this._scaleImage(s,lt(i));i.imageSmoothingEnabled=sn(ot(i),e.interpolate),Yt(i,a.img,0,0,a.paintWidth,a.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const t=e.width,n=e.height,s=this.cachedCanvases.getCanvas("inlineImage",t,n).context;Zt(s,e),i=this.applyTransferMapsToCanvas(s)}for(const s of t)n.save(),n.transform(...s.transform),n.scale(1,-1),Yt(n,i,s.x,s.y,s.w,s.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const n=this.ctx;this.pendingClip&&(t||(this.pendingClip===ln?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=ot(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){const{lineWidth:e}=this.current,{a:t,b:n,c:i,d:s}=this.ctx.getTransform();let r,a;if(0===n&&0===i){const n=Math.abs(t),i=Math.abs(s);if(n===i)if(0===e)r=a=1/n;else{const t=n*e;r=a=t<1?1/t:1}else if(0===e)r=1/n,a=1/i;else{const t=n*e,s=i*e;r=t<1?1/t:1,a=s<1?1/s:1}}else{const o=Math.abs(t*s-n*i),l=Math.hypot(t,n),c=Math.hypot(i,s);if(0===e)r=c/o,a=l/o;else{const t=e*o;r=c>t?c/t:1,a=l>t?l/t:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:n}=this.current,[i,s]=this.getScaleForStroking();if(t.lineWidth=n||1,1===i&&1===s)return void t.stroke();const r=t.getLineDash();if(e&&t.save(),t.scale(i,s),r.length>0){const e=Math.max(i,s);t.setLineDash(r.map((t=>t/e))),t.lineDashOffset/=e}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const Cs in J)void 0!==cn.prototype[Cs]&&(cn.prototype[J[Cs]]=cn.prototype[Cs]);class un{static#Mt=null;static#Nt="";static get workerPort(){return this.#Mt}static set workerPort(e){if(!("undefined"!==typeof Worker&&e instanceof Worker)&&null!==e)throw new Error("Invalid `workerPort` type.");this.#Mt=e}static get workerSrc(){return this.#Nt}static set workerSrc(e){if("string"!==typeof e)throw new Error("Invalid `workerSrc` type.");this.#Nt=e}}const hn=1,dn=2,pn=1,fn=2,gn=3,mn=4,vn=5,yn=6,bn=7,wn=8;function _n(e){switch(e instanceof Error||"object"===typeof e&&null!==e||re('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new me(e.message);case"MissingPDFException":return new pe(e.message);case"PasswordException":return new ue(e.message,e.code);case"UnexpectedResponseException":return new fe(e.message,e.status);case"UnknownErrorException":return new he(e.message,e.details);default:return new he(e.message,e.toString())}}class An{constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=e=>{const t=e.data;if(t.targetName!==this.sourceName)return;if(t.stream)return void this.#Lt(t);if(t.callback){const e=t.callbackId,n=this.callbackCapabilities[e];if(!n)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],t.callback===hn)n.resolve(t.data);else{if(t.callback!==dn)throw new Error("Unexpected callback case");n.reject(_n(t.reason))}return}const i=this.actionHandler[t.action];if(!i)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const e=this.sourceName,s=t.sourceName;new Promise((function(e){e(i(t.data))})).then((function(i){n.postMessage({sourceName:e,targetName:s,callback:hn,callbackId:t.callbackId,data:i})}),(function(i){n.postMessage({sourceName:e,targetName:s,callback:dn,callbackId:t.callbackId,reason:_n(i)})}))}else t.streamId?this.#Ot(t):i(t.data)},n.addEventListener("message",this._onComObjOnMessage)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const i=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[i]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},n)}catch(r){s.reject(r)}return s.promise}sendWithStream(e,t,n,i){const s=this.streamId++,r=this.sourceName,a=this.targetName,o=this.comObj;return new ReadableStream({start:n=>{const l=Promise.withResolvers();return this.streamControllers[s]={controller:n,startCall:l,pullCall:null,cancelCall:null,isClosed:!1},o.postMessage({sourceName:r,targetName:a,action:e,streamId:s,data:t,desiredSize:n.desiredSize},i),l.promise},pull:e=>{const t=Promise.withResolvers();return this.streamControllers[s].pullCall=t,o.postMessage({sourceName:r,targetName:a,stream:yn,streamId:s,desiredSize:e.desiredSize}),t.promise},cancel:e=>{ae(e instanceof Error,"cancel must have a valid reason");const t=Promise.withResolvers();return this.streamControllers[s].cancelCall=t,this.streamControllers[s].isClosed=!0,o.postMessage({sourceName:r,targetName:a,stream:pn,streamId:s,reason:_n(e)}),t.promise}},n)}#Ot(e){const t=e.streamId,n=this.sourceName,i=e.sourceName,s=this.comObj,r=this,a=this.actionHandler[e.action],o={enqueue(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const o=this.desiredSize;this.desiredSize-=r,o>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:n,targetName:i,stream:mn,streamId:t,chunk:e},a)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:i,stream:gn,streamId:t}),delete r.streamSinks[t])},error(e){ae(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:i,stream:vn,streamId:t,reason:_n(e)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[t]=o,new Promise((function(t){t(a(e.data,o))})).then((function(){s.postMessage({sourceName:n,targetName:i,stream:wn,streamId:t,success:!0})}),(function(e){s.postMessage({sourceName:n,targetName:i,stream:wn,streamId:t,reason:_n(e)})}))}#Lt(e){const t=e.streamId,n=this.sourceName,i=e.sourceName,s=this.comObj,r=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case wn:e.success?r.startCall.resolve():r.startCall.reject(_n(e.reason));break;case bn:e.success?r.pullCall.resolve():r.pullCall.reject(_n(e.reason));break;case yn:if(!a){s.postMessage({sourceName:n,targetName:i,stream:bn,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,new Promise((function(e){e(a.onPull?.())})).then((function(){s.postMessage({sourceName:n,targetName:i,stream:bn,streamId:t,success:!0})}),(function(e){s.postMessage({sourceName:n,targetName:i,stream:bn,streamId:t,reason:_n(e)})}));break;case mn:if(ae(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case gn:if(ae(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#Ft(r,t);break;case vn:ae(r,"error should have stream controller"),r.controller.error(_n(e.reason)),this.#Ft(r,t);break;case fn:e.success?r.cancelCall.resolve():r.cancelCall.reject(_n(e.reason)),this.#Ft(r,t);break;case pn:if(!a)break;new Promise((function(t){t(a.onCancel?.(_n(e.reason)))})).then((function(){s.postMessage({sourceName:n,targetName:i,stream:fn,streamId:t,success:!0})}),(function(e){s.postMessage({sourceName:n,targetName:i,stream:fn,streamId:t,reason:_n(e)})})),a.sinkCapability.reject(_n(e.reason)),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#Ft(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}class En{#Ut;#zt;constructor(e){let{parsedData:t,rawData:n}=e;this.#Ut=t,this.#zt=n}getRaw(){return this.#zt}get(e){return this.#Ut.get(e)??null}getAll(){return be(this.#Ut)}has(e){return this.#Ut.has(e)}}const Sn=Symbol("INTERNAL");class Cn{#Vt=!1;#Bt=!1;#jt=!1;#Ht=!0;constructor(e,t){let{name:n,intent:i,usage:s}=t;this.#Vt=!!(e&u),this.#Bt=!!(e&h),this.name=n,this.intent=i,this.usage=s}get visible(){if(this.#jt)return this.#Ht;if(!this.#Ht)return!1;const{print:e,view:t}=this.usage;return this.#Vt?"OFF"!==t?.viewState:!this.#Bt||"OFF"!==e?.printState}_setVisible(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==Sn&&re("Internal method `_setVisible` called."),this.#jt=n,this.#Ht=t}}class Tn{#$t=null;#qt=(()=>new Map)();#Wt=null;#Gt=null;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;if(this.renderingIntent=t,this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,this.#Gt=e.order;for(const n of e.groups)this.#qt.set(n.id,new Cn(t,n));if("OFF"===e.baseState)for(const e of this.#qt.values())e._setVisible(Sn,!1);for(const t of e.on)this.#qt.get(t)._setVisible(Sn,!0);for(const t of e.off)this.#qt.get(t)._setVisible(Sn,!1);this.#Wt=this.getHash()}}#Kt(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let i=1;i<t;i++){const t=e[i];let s;if(Array.isArray(t))s=this.#Kt(t);else{if(!this.#qt.has(t))return se(`Optional content group not found: ${t}`),!0;s=this.#qt.get(t).visible}switch(n){case"And":if(!s)return!1;break;case"Or":if(s)return!0;break;case"Not":return!s;default:return!0}}return"And"===n}isVisible(e){if(0===this.#qt.size)return!0;if(!e)return ie("Optional content group not defined."),!0;if("OCG"===e.type)return this.#qt.has(e.id)?this.#qt.get(e.id).visible:(se(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression)return this.#Kt(e.expression);if(!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!this.#qt.has(t))return se(`Optional content group not found: ${t}`),!0;if(this.#qt.get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!this.#qt.has(t))return se(`Optional content group not found: ${t}`),!0;if(!this.#qt.get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!this.#qt.has(t))return se(`Optional content group not found: ${t}`),!0;if(!this.#qt.get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!this.#qt.has(t))return se(`Optional content group not found: ${t}`),!0;if(this.#qt.get(t).visible)return!1}return!0}return se(`Unknown optional content policy ${e.policy}.`),!0}return se(`Unknown group type ${e.type}.`),!0}setVisibility(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.#qt.get(e);n?(n._setVisible(Sn,!!t,!0),this.#$t=null):se(`Optional content group not found: ${e}`)}setOCGState(e){let t,{state:n,preserveRB:i}=e;for(const s of n){switch(s){case"ON":case"OFF":case"Toggle":t=s;continue}const e=this.#qt.get(s);if(e)switch(t){case"ON":e._setVisible(Sn,!0);break;case"OFF":e._setVisible(Sn,!1);break;case"Toggle":e._setVisible(Sn,!e.visible)}}this.#$t=null}get hasInitialVisibility(){return null===this.#Wt||this.getHash()===this.#Wt}getOrder(){return this.#qt.size?this.#Gt?this.#Gt.slice():[...this.#qt.keys()]:null}getGroups(){return this.#qt.size>0?be(this.#qt):null}getGroup(e){return this.#qt.get(e)||null}getHash(){if(null!==this.#$t)return this.#$t;const e=new Ct;for(const[t,n]of this.#qt)e.update(`${t}:${n.visible}`);return this.#$t=e.hexdigest()}}class xn{constructor(e,t){let{disableRange:n=!1,disableStream:i=!1}=t;ae(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:r,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,r?.length>0){const e=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!n,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener(((e,t)=>{this._onReceiveData({begin:e,chunk:t})})),e.addProgressListener(((e,t)=>{this._onProgress({loaded:e,total:t})})),e.addProgressiveReadListener((e=>{this._onReceiveData({chunk:e})})),e.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),e.transportReady()}_onReceiveData(e){let{begin:t,chunk:n}=e;const i=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;if(void 0===t)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{ae(this._rangeReaders.some((function(e){return e._begin===t&&(e._enqueue(i),!0)})),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){void 0===e.total?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ae(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new kn(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new In(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class kn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._stream=e,this._done=n||!1,this._filename=Qe(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length>0){this._requests.shift().resolve({value:e,done:!1})}else this._queuedChunks.push(e);this._loaded+=e.byteLength}}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){return{value:this._queuedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class In{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Pn(e){let{getResponseHeader:t,isHttp:n,rangeChunkSize:i,disableRange:s}=e;const r={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(t("Content-Length"),10);if(!Number.isInteger(a))return r;if(r.suggestedLength=a,a<=2*i)return r;if(s||!n)return r;if("bytes"!==t("Accept-Ranges"))return r;return"identity"!==(t("Content-Encoding")||"identity")||(r.allowRangeRequests=!0),r}function Rn(e){const t=e("Content-Disposition");if(t){let e=function(e){let t=!0,n=i("filename\\*","i").exec(e);if(n){n=n[1];let e=a(n);return e=unescape(e),e=o(e),e=l(e),r(e)}if(n=function(e){const t=[];let n;const s=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(n=s.exec(e));){let[,e,i,s]=n;if(e=parseInt(e,10),e in t){if(0===e)break}else t[e]=[i,s]}const r=[];for(let i=0;i<t.length&&i in t;++i){let[e,n]=t[i];n=a(n),e&&(n=unescape(n),0===i&&(n=o(n))),r.push(n)}return r.join("")}(e),n)return r(l(n));if(n=i("filename","i").exec(e),n){n=n[1];let e=a(n);return e=l(e),r(e)}function i(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function s(e,n){if(e){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const i=new TextDecoder(e,{fatal:!0}),s=ye(n);n=i.decode(s),t=!1}catch{}}return n}function r(e){return t&&/[\x80-\xff]/.test(e)&&(e=s("utf-8",e),t&&(e=s("iso-8859-1",e))),e}function a(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const n=t[e].indexOf('"');-1!==n&&(t[e]=t[e].slice(0,n),t.length=e+1),t[e]=t[e].replaceAll(/\\(.)/g,"$1")}e=t.join('"')}return e}function o(e){const t=e.indexOf("'");return-1===t?e:s(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function l(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,n,i){if("q"===n||"Q"===n)return s(t,i=(i=i.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})));try{i=atob(i)}catch{}return s(t,i)}))}return""}(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Qe(e))return e}return null}function Dn(e,t){return 404===e||0===e&&t.startsWith("file:")?new pe('Missing PDF "'+t+'".'):new fe(`Unexpected server response (${e}) while retrieving PDF "${t}".`,e)}function Mn(e){return 200===e||206===e}function Nn(e,t,n){return{method:"GET",headers:e,signal:n.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Ln(e){const t=new Headers;for(const n in e){const i=e[n];void 0!==i&&t.append(n,i)}return t}function On(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:(se(`getArrayBuffer - unexpected data format: ${e}`),new Uint8Array(e).buffer)}class Fn{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ae(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Un(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new zn(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Un{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=Ln(this._stream.httpHeaders);const n=t.url;fetch(n,Nn(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!Mn(e.status))throw Dn(e.status,n);this._reader=e.body.getReader(),this._headersCapability.resolve();const t=t=>e.headers.get(t),{allowRangeRequests:i,suggestedLength:s}=Pn({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i,this._contentLength=s||this._contentLength,this._filename=Rn(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new me("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:On(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class zn{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController,this._headers=Ln(this._stream.httpHeaders),this._headers.append("Range",`bytes=${t}-${n-1}`);const s=i.url;fetch(s,Nn(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!Mn(e.status))throw Dn(e.status,s);this._readCapability.resolve(),this._reader=e.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:On(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class Vn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||Object.create(null),this.withCredentials=t.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,n){const i={begin:e,end:t};for(const s in n)i[s]=n[s];return this.request(i)}requestFull(e){return this.request(e)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const s in this.httpHeaders){const e=this.httpHeaders[s];void 0!==e&&t.setRequestHeader(s,e)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=206):i.expectedStatus=200,t.responseType="arraybuffer",e.onError&&(t.onerror=function(n){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){const n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),4!==i.readyState)return;if(!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===i.status&&this.isHttp)return void n.onError?.(i.status);const s=i.status||200;if(!(200===s&&206===n.expectedStatus)&&s!==n.expectedStatus)return void n.onError?.(i.status);const r=function(e){const t=e.response;return"string"!==typeof t?t:ye(t).buffer}(i);if(206===s){const e=i.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);n.onDone({begin:parseInt(t[1],10),chunk:r})}else r?n.onDone({begin:0,chunk:r}):n.onError?.(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Bn{constructor(e){this._source=e,this._manager=new Vn(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ae(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new jn(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new Hn(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class jn{constructor(e,t){this._manager=e;const n={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(n),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),n=e=>t.getResponseHeader(e),{allowRangeRequests:i,suggestedLength:s}=Pn({getResponseHeader:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=s||this._contentLength,this._filename=Rn(n),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){if(e)if(this._requests.length>0){this._requests.shift().resolve({value:e.chunk,done:!1})}else this._cachedChunks.push(e.chunk);if(this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Dn(e,this._url),this._headersReceivedCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0){return{value:this._cachedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Hn{constructor(e,t,n){this._manager=e;const i={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,n,i),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;if(this._requests.length>0){this._requests.shift().resolve({value:t,done:!1})}else this._queuedChunk=t;this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=Dn(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const $n=/^file:\/\/\/[a-zA-Z]:\//;class qn{constructor(e){this.source=e,this.url=function(e){const t=Mt.get("url"),n=t.parse(e);return"file:"===n.protocol||n.host?n:/^[a-z]:[/\\]/i.test(e)?t.parse(`file:///${e}`):(n.host||(n.protocol="file:"),n)}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ae(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new Yn(this):new Xn(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=this.isFsUrl?new Jn(this,e,t):new Qn(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Wn{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();if(null===e)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength});return{value:new Uint8Array(e).buffer,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new me("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Gn{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();if(null===e)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=e.length,this.onProgress?.({loaded:this._loaded});return{value:new Uint8Array(e).buffer,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),this._storedError&&this._readableStream.destroy(this._storedError)}}function Kn(e,t){return{protocol:e.protocol,auth:e.auth,host:e.hostname,port:e.port,path:e.path,method:"GET",headers:t}}class Xn extends Wn{constructor(e){super(e);const t=t=>{if(404===t.statusCode){const e=new pe(`Missing PDF "${this._url}".`);return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);const n=e=>this._readableStream.headers[e.toLowerCase()],{allowRangeRequests:i,suggestedLength:s}=Pn({getResponseHeader:n,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i,this._contentLength=s||this._contentLength,this._filename=Rn(n)};if(this._request=null,"http:"===this._url.protocol){const n=Mt.get("http");this._request=n.request(Kn(this._url,e.httpHeaders),t)}else{const n=Mt.get("https");this._request=n.request(Kn(this._url,e.httpHeaders),t)}this._request.on("error",(e=>{this._storedError=e,this._headersCapability.reject(e)})),this._request.end()}}class Qn extends Gn{constructor(e,t,n){super(e),this._httpHeaders={};for(const s in e.httpHeaders){const t=e.httpHeaders[s];void 0!==t&&(this._httpHeaders[s]=t)}this._httpHeaders.Range=`bytes=${t}-${n-1}`;const i=e=>{if(404!==e.statusCode)this._setReadableStream(e);else{const e=new pe(`Missing PDF "${this._url}".`);this._storedError=e}};if(this._request=null,"http:"===this._url.protocol){const e=Mt.get("http");this._request=e.request(Kn(this._url,this._httpHeaders),i)}else{const e=Mt.get("https");this._request=e.request(Kn(this._url,this._httpHeaders),i)}this._request.on("error",(e=>{this._storedError=e})),this._request.end()}}class Yn extends Wn{constructor(e){super(e);let t=decodeURIComponent(this._url.path);$n.test(this._url.href)&&(t=t.replace(/^\//,""));const n=Mt.get("fs");n.promises.lstat(t).then((e=>{this._contentLength=e.size,this._setReadableStream(n.createReadStream(t)),this._headersCapability.resolve()}),(e=>{"ENOENT"===e.code&&(e=new pe(`Missing PDF "${t}".`)),this._storedError=e,this._headersCapability.reject(e)}))}}class Jn extends Gn{constructor(e,t,n){super(e);let i=decodeURIComponent(this._url.path);$n.test(this._url.href)&&(i=i.replace(/^\//,""));const s=Mt.get("fs");this._setReadableStream(s.createReadStream(i,{start:t,end:n-1}))}}const Zn=30;class ei{#Xt=(()=>Promise.withResolvers())();#me=null;#Qt=!1;#Yt=(()=>!!globalThis.FontInspector?.enabled)();#Jt=null;#Zt=null;#en=0;#tn=0;#nn=null;#in=null;#sn=0;#rn=0;#an=(()=>Object.create(null))();#on=[];#ln=null;#cn=[];#un=(()=>new WeakMap)();#hn=null;static#dn=(()=>new Map)();static#pn=(()=>new Map)();static#fn=null;static#gn=(()=>new Set)();constructor(e){let{textContentSource:t,container:n,viewport:i}=e;if(t instanceof ReadableStream)this.#ln=t;else{if("object"!==typeof t)throw new Error('No "textContentSource" parameter specified.');this.#ln=new ReadableStream({start(e){e.enqueue(t),e.close()}})}this.#me=this.#in=n,this.#rn=i.scale*(globalThis.devicePixelRatio||1),this.#sn=i.rotation,this.#Zt={prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:r,pageX:a,pageY:o}=i.rawDims;this.#hn=[1,0,0,-1,-a,o+r],this.#tn=s,this.#en=r,ei.#mn(),ct(n,i),this.#Xt.promise.catch((()=>{})).then((()=>{ei.#gn.delete(this),this.#Zt=null,this.#an=null}))}render(){const e=()=>{this.#nn.read().then((t=>{let{value:n,done:i}=t;i?this.#Xt.resolve():(this.#Jt??=n.lang,Object.assign(this.#an,n.styles),this.#vn(n.items),e())}),this.#Xt.reject)};return this.#nn=this.#ln.getReader(),ei.#gn.add(this),e(),this.#Xt.promise}update(e){let{viewport:t,onBefore:n=null}=e;const i=t.scale*(globalThis.devicePixelRatio||1),s=t.rotation;if(s!==this.#sn&&(n?.(),this.#sn=s,ct(this.#in,{rotation:s})),i!==this.#rn){n?.(),this.#rn=i;const e={prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:ei.#yn(this.#Jt)};for(const t of this.#cn)e.properties=this.#un.get(t),e.div=t,this.#bn(e)}}cancel(){const e=new me("TextLayer task cancelled.");this.#nn?.cancel(e).catch((()=>{})),this.#nn=null,this.#Xt.reject(e)}get textDivs(){return this.#cn}get textContentItemsStr(){return this.#on}#vn(e){if(this.#Qt)return;this.#Zt.ctx??=ei.#yn(this.#Jt);const t=this.#cn,n=this.#on;for(const i of e){if(t.length>1e5)return se("Ignoring additional textDivs for performance reasons."),void(this.#Qt=!0);if(void 0!==i.str)n.push(i.str),this.#wn(i);else if("beginMarkedContentProps"===i.type||"beginMarkedContent"===i.type){const e=this.#me;this.#me=document.createElement("span"),this.#me.classList.add("markedContent"),null!==i.id&&this.#me.setAttribute("id",`${i.id}`),e.append(this.#me)}else"endMarkedContent"===i.type&&(this.#me=this.#me.parentNode)}}#wn(e){const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:""!==e.str,hasEOL:e.hasEOL,fontSize:0};this.#cn.push(t);const i=Ae.transform(this.#hn,e.transform);let s=Math.atan2(i[1],i[0]);const r=this.#an[e.fontName];r.vertical&&(s+=Math.PI/2);const a=this.#Yt&&r.fontSubstitution||r.fontFamily,o=Math.hypot(i[2],i[3]),l=o*ei.#_n(a,this.#Jt);let c,u;0===s?(c=i[4],u=i[5]-l):(c=i[4]+l*Math.sin(s),u=i[5]-l*Math.cos(s));const h="calc(var(--scale-factor)*",d=t.style;this.#me===this.#in?(d.left=`${(100*c/this.#tn).toFixed(2)}%`,d.top=`${(100*u/this.#en).toFixed(2)}%`):(d.left=`${h}${c.toFixed(2)}px)`,d.top=`${h}${u.toFixed(2)}px)`),d.fontSize=`${h}${(ei.#fn*o).toFixed(2)}px)`,d.fontFamily=a,n.fontSize=o,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#Yt&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),0!==s&&(n.angle=s*(180/Math.PI));let p=!1;if(e.str.length>1)p=!0;else if(" "!==e.str&&e.transform[0]!==e.transform[3]){const t=Math.abs(e.transform[0]),n=Math.abs(e.transform[3]);t!==n&&Math.max(t,n)/Math.min(t,n)>1.5&&(p=!0)}if(p&&(n.canvasWidth=r.vertical?e.height:e.width),this.#un.set(t,n),this.#Zt.div=t,this.#Zt.properties=n,this.#bn(this.#Zt),n.hasText&&this.#me.append(t),n.hasEOL){const e=document.createElement("br");e.setAttribute("role","presentation"),this.#me.append(e)}}#bn(e){const{div:t,properties:n,ctx:i,prevFontSize:s,prevFontFamily:r}=e,{style:a}=t;let o="";if(ei.#fn>1&&(o=`scale(${1/ei.#fn})`),0!==n.canvasWidth&&n.hasText){const{fontFamily:l}=a,{canvasWidth:c,fontSize:u}=n;s===u&&r===l||(i.font=`${u*this.#rn}px ${l}`,e.prevFontSize=u,e.prevFontFamily=l);const{width:h}=i.measureText(t.textContent);h>0&&(o=`scaleX(${c*this.#rn/h}) ${o}`)}0!==n.angle&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(a.transform=o)}static cleanup(){if(!(this.#gn.size>0)){this.#dn.clear();for(const{canvas:e}of this.#pn.values())e.remove();this.#pn.clear()}}static#yn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.#pn.get(e||="");if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#pn.set(e,t)}return t}static#mn(){if(null!==this.#fn)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.textContent="X",document.body.append(e),this.#fn=e.getBoundingClientRect().height,e.remove()}static#_n(e,t){const n=this.#dn.get(e);if(n)return n;const i=this.#yn(t),s=i.font;i.canvas.width=i.canvas.height=Zn,i.font=`30px ${e}`;const r=i.measureText("");let a=r.fontBoundingBoxAscent,o=Math.abs(r.fontBoundingBoxDescent);if(a){const t=a/(a+o);return this.#dn.set(e,t),i.canvas.width=i.canvas.height=0,i.font=s,t}i.strokeStyle="red",i.clearRect(0,0,Zn,Zn),i.strokeText("g",0,0);let l=i.getImageData(0,0,Zn,Zn).data;o=0;for(let u=l.length-1-3;u>=0;u-=4)if(l[u]>0){o=Math.ceil(u/4/Zn);break}i.clearRect(0,0,Zn,Zn),i.strokeText("A",0,Zn),l=i.getImageData(0,0,Zn,Zn).data,a=0;for(let u=0,h=l.length;u<h;u+=4)if(l[u]>0){a=Zn-Math.floor(u/4/Zn);break}i.canvas.width=i.canvas.height=0,i.font=s;const c=a?a/(a+o):.8;return this.#dn.set(e,c),c}}function ti(){nt("`renderTextLayer`, please use `TextLayer` instead.");const{textContentSource:e,container:t,viewport:n,...i}=arguments[0],s=Object.keys(i);s.length>0&&se("Ignoring `renderTextLayer` parameters: "+s.join(", "));const r=new ei({textContentSource:e,container:t,viewport:n}),{textDivs:a,textContentItemsStr:o}=r;return{promise:r.render(),textDivs:a,textContentItemsStr:o}}function ni(){nt("`updateTextLayer`, please use `TextLayer` instead.")}class ii{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};return function e(n){if(!n)return;let i=null;const s=n.name;if("#text"===s)i=n.value;else{if(!ii.shouldBuildText(s))return;n?.attributes?.textContent?i=n.attributes.textContent:n.value&&(i=n.value)}if(null!==i&&t.push({str:i}),n.children)for(const t of n.children)e(t)}(e),n}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}const si=65536,ri=r?class extends Fe{_createCanvas(e,t){return Mt.get("canvas").createCanvas(e,t)}}:class extends Fe{constructor(){let{ownerDocument:e=globalThis.document,enableHWA:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}},ai=r?class extends Ue{_fetchData(e,t){return Nt(e).then((e=>({cMapData:e,compressionType:t})))}}:$e,oi=r?class extends Oe{}:class extends Oe{#An;#En;#Sn;#Cn;#Tn;#v=0;constructor(){let{docId:e,ownerDocument:t=globalThis.document}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.#Sn=e,this.#Cn=t}get#b(){return this.#An||=new Map}get#xn(){return this.#Tn||=new Map}get#kn(){if(!this.#En){const e=this.#Cn.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const n=this.#Cn.createElementNS(Be,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#En=this.#Cn.createElementNS(Be,"defs"),e.append(n),n.append(this.#En),this.#Cn.body.append(e)}return this.#En}#In(e){if(1===e.length){const t=e[0],n=new Array(256);for(let e=0;e<256;e++)n[e]=t[e]/255;const i=n.join(",");return[i,i,i]}const[t,n,i]=e,s=new Array(256),r=new Array(256),a=new Array(256);for(let o=0;o<256;o++)s[o]=t[o]/255,r[o]=n[o]/255,a[o]=i[o]/255;return[s.join(","),r.join(","),a.join(",")]}addFilter(e){if(!e)return"none";let t=this.#b.get(e);if(t)return t;const[n,i,s]=this.#In(e),r=1===e.length?n:`${n}${i}${s}`;if(t=this.#b.get(r),t)return this.#b.set(e,t),t;const a=`g_${this.#Sn}_transfer_map_${this.#v++}`,o=`url(#${a})`;this.#b.set(e,o),this.#b.set(r,o);const l=this.#Pn(a);return this.#Rn(n,i,s,l),o}addHCMFilter(e,t){const n=`${e}-${t}`,i="base";let s=this.#xn.get(i);if(s?.key===n)return s.url;if(s?(s.filter?.remove(),s.key=n,s.url="none",s.filter=null):(s={key:n,url:"none",filter:null},this.#xn.set(i,s)),!e||!t)return s.url;const r=this.#Dn(e);e=Ae.makeHexColor(...r);const a=this.#Dn(t);if(t=Ae.makeHexColor(...a),this.#kn.style.color="","#000000"===e&&"#ffffff"===t||e===t)return s.url;const o=new Array(256);for(let d=0;d<=255;d++){const e=d/255;o[d]=e<=.03928?e/12.92:((e+.055)/1.055)**2.4}const l=o.join(","),c=`g_${this.#Sn}_hcm_filter`,u=s.filter=this.#Pn(c);this.#Rn(l,l,l,u),this.#Mn(u);const h=(e,t)=>{const n=r[e]/255,i=a[e]/255,s=new Array(t+1);for(let r=0;r<=t;r++)s[r]=n+r/t*(i-n);return s.join(",")};return this.#Rn(h(0,5),h(1,5),h(2,5),u),s.url=`url(#${c})`,s.url}addAlphaFilter(e){let t=this.#b.get(e);if(t)return t;const[n]=this.#In([e]),i=`alpha_${n}`;if(t=this.#b.get(i),t)return this.#b.set(e,t),t;const s=`g_${this.#Sn}_alpha_map_${this.#v++}`,r=`url(#${s})`;this.#b.set(e,r),this.#b.set(i,r);const a=this.#Pn(s);return this.#Nn(n,a),r}addLuminosityFilter(e){let t,n,i=this.#b.get(e||"luminosity");if(i)return i;if(e?([t]=this.#In([e]),n=`luminosity_${t}`):n="luminosity",i=this.#b.get(n),i)return this.#b.set(e,i),i;const s=`g_${this.#Sn}_luminosity_map_${this.#v++}`,r=`url(#${s})`;this.#b.set(e,r),this.#b.set(n,r);const a=this.#Pn(s);return this.#Ln(a),e&&this.#Nn(t,a),r}addHighlightHCMFilter(e,t,n,i,s){const r=`${t}-${n}-${i}-${s}`;let a=this.#xn.get(e);if(a?.key===r)return a.url;if(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#xn.set(e,a)),!t||!n)return a.url;const[o,l]=[t,n].map(this.#Dn.bind(this));let c=Math.round(.2126*o[0]+.7152*o[1]+.0722*o[2]),u=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[h,d]=[i,s].map(this.#Dn.bind(this));u<c&&([c,u,h,d]=[u,c,d,h]),this.#kn.style.color="";const p=(e,t,n)=>{const i=new Array(256),s=(u-c)/n,r=e/255,a=(t-e)/(255*n);let o=0;for(let l=0;l<=n;l++){const e=Math.round(c+l*s),t=r+l*a;for(let n=o;n<=e;n++)i[n]=t;o=e+1}for(let l=o;l<256;l++)i[l]=i[o-1];return i.join(",")},f=`g_${this.#Sn}_hcm_${e}_filter`,g=a.filter=this.#Pn(f);return this.#Mn(g),this.#Rn(p(h[0],d[0],5),p(h[1],d[1],5),p(h[2],d[2],5),g),a.url=`url(#${f})`,a.url}destroy(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&0!==this.#xn.size||(this.#En&&(this.#En.parentNode.parentNode.remove(),this.#En=null),this.#An&&(this.#An.clear(),this.#An=null),this.#v=0)}#Ln(e){const t=this.#Cn.createElementNS(Be,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#Mn(e){const t=this.#Cn.createElementNS(Be,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#Pn(e){const t=this.#Cn.createElementNS(Be,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#kn.append(t),t}#On(e,t,n){const i=this.#Cn.createElementNS(Be,t);i.setAttribute("type","discrete"),i.setAttribute("tableValues",n),e.append(i)}#Rn(e,t,n,i){const s=this.#Cn.createElementNS(Be,"feComponentTransfer");i.append(s),this.#On(s,"feFuncR",e),this.#On(s,"feFuncG",t),this.#On(s,"feFuncB",n)}#Nn(e,t){const n=this.#Cn.createElementNS(Be,"feComponentTransfer");t.append(n),this.#On(n,"feFuncA",e)}#Dn(e){return this.#kn.style.color=e,at(getComputedStyle(this.#kn).getPropertyValue("color"))}},li=r?class extends ze{_fetchData(e){return Nt(e)}}:qe;function ci(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"string"===typeof e||e instanceof URL?e={url:e}:(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t=new hi,{docId:n}=t,i=e.url?function(e){if(e instanceof URL)return e.href;try{return new URL(e,window.location).href}catch{if(r&&"string"===typeof e)return e}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(e.url):null,s=e.data?function(e){if(r&&"undefined"!==typeof Buffer&&e instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if("string"===typeof e)return ye(e);if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)||"object"===typeof e&&!isNaN(e?.length))return new Uint8Array(e);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(e.data):null,a=e.httpHeaders||null,o=!0===e.withCredentials,l=e.password??null,c=e.range instanceof di?e.range:null,u=Number.isInteger(e.rangeChunkSize)&&e.rangeChunkSize>0?e.rangeChunkSize:si;let h=e.worker instanceof vi?e.worker:null;const d=e.verbosity,p="string"!==typeof e.docBaseUrl||Xe(e.docBaseUrl)?null:e.docBaseUrl,f="string"===typeof e.cMapUrl?e.cMapUrl:null,g=!1!==e.cMapPacked,m=e.CMapReaderFactory||ai,v="string"===typeof e.standardFontDataUrl?e.standardFontDataUrl:null,y=e.StandardFontDataFactory||li,b=!0!==e.stopAtErrors,w=Number.isInteger(e.maxImageSize)&&e.maxImageSize>-1?e.maxImageSize:-1,_=!1!==e.isEvalSupported,A="boolean"===typeof e.isOffscreenCanvasSupported?e.isOffscreenCanvasSupported:!r,E=Number.isInteger(e.canvasMaxAreaInBytes)?e.canvasMaxAreaInBytes:-1,S="boolean"===typeof e.disableFontFace?e.disableFontFace:r,C=!0===e.fontExtraProperties,T=!0===e.enableXfa,x=e.ownerDocument||globalThis.document,k=!0===e.disableRange,I=!0===e.disableStream,P=!0===e.disableAutoFetch,R=!0===e.pdfBug,D=!0===e.enableHWA,M=c?c.length:e.length??NaN,N="boolean"===typeof e.useSystemFonts?e.useSystemFonts:!r&&!S,L="boolean"===typeof e.useWorkerFetch?e.useWorkerFetch:m===$e&&y===qe&&f&&v&&et(f,document.baseURI)&&et(v,document.baseURI),O=e.canvasFactory||new ri({ownerDocument:x,enableHWA:D}),F=e.filterFactory||new oi({docId:n,ownerDocument:x});te(d);const U={canvasFactory:O,filterFactory:F};if(L||(U.cMapReaderFactory=new m({baseUrl:f,isCompressed:g}),U.standardFontDataFactory=new y({baseUrl:v})),!h){const e={verbosity:d,port:un.workerPort};h=e.port?vi.fromPort(e):new vi(e),t._worker=h}const z={docId:n,apiVersion:"4.4.168",data:s,password:l,disableAutoFetch:P,rangeChunkSize:u,length:M,docBaseUrl:p,enableXfa:T,evaluatorOptions:{maxImageSize:w,disableFontFace:S,ignoreErrors:b,isEvalSupported:_,isOffscreenCanvasSupported:A,canvasMaxAreaInBytes:E,fontExtraProperties:C,useSystemFonts:N,cMapUrl:L?f:null,standardFontDataUrl:L?v:null}},V={disableFontFace:S,fontExtraProperties:C,ownerDocument:x,pdfBug:R,styleElement:null,loadingParams:{disableAutoFetch:P,enableXfa:T}};return h.promise.then((function(){if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const e=h.messageHandler.sendWithPromise("GetDocRequest",z,s?[s.buffer]:null);let l;if(c)l=new xn(c,{disableRange:k,disableStream:I});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");l=(e=>{if(r){return function(){return"undefined"!==typeof fetch&&"undefined"!==typeof Response&&"body"in Response.prototype}()&&et(e.url)?new Fn(e):new qn(e)}return et(e.url)?new Fn(e):new Bn(e)})({url:i,length:M,httpHeaders:a,withCredentials:o,rangeChunkSize:u,disableRange:k,disableStream:I})}return e.then((e=>{if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const i=new An(n,e,h.port),s=new yi(i,t,l,V,U);t._transport=s,i.send("Ready",null)}))})).catch(t._capability.reject),t}function ui(e){return"object"===typeof e&&Number.isInteger(e?.num)&&e.num>=0&&Number.isInteger(e?.gen)&&e.gen>=0}class hi{static#Sn=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId="d"+hi.#Sn++,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await(this._transport?.destroy())}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class di{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then((()=>{for(const n of this._progressListeners)n(e,t)}))}onDataProgressiveRead(e){this._readyCapability.promise.then((()=>{for(const t of this._progressiveReadListeners)t(e)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const e of this._progressiveDoneListeners)e()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){re("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class pi{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return le(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){let{intent:e="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class fi{#Fn=null;#Un=!1;constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=i?new Ze:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new wi,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ge({viewBox:this.view,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:s})}getAnnotations(){let{intent:e="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return le(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render(e){let{canvasContext:t,viewport:n,intent:i="display",annotationMode:s=m.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:u=null}=e;this._stats?.time("Overall");const d=this._transport.getRenderingIntent(i,s,u),{renderingIntent:p,cacheKey:f}=d;this.#Un=!1,this.#zn(),o||=this._transport.getOptionalContentConfig(p);let g=this._intentStates.get(f);g||(g=Object.create(null),this._intentStates.set(f,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);const v=!!(p&h);g.displayReadyCapability||(g.displayReadyCapability=Promise.withResolvers(),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(d));const y=e=>{g.renderTasks.delete(b),(this._maybeCleanupAfterRender||v)&&(this.#Un=!0),this.#Vn(!v),e?(b.capability.reject(e),this._abortOperatorList({intentState:g,reason:e instanceof Error?e:new Error(e)})):b.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},b=new Ai({callback:y,params:{canvasContext:t,viewport:n,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:c});(g.renderTasks||=new Set).add(b);const w=b.task;return Promise.all([g.displayReadyCapability.promise,o]).then((e=>{let[t,n]=e;if(this.destroyed)y();else{if(this._stats?.time("Rendering"),!(n.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");b.initializeGraphics({transparency:t,optionalContentConfig:n}),b.operatorListChanged()}})).catch(y),w}getOperatorList(){let{intent:e="display",annotationMode:t=m.ENABLE,printAnnotationStorage:n=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=this._transport.getRenderingIntent(e,t,n,!0);let s,r=this._intentStates.get(i.cacheKey);return r||(r=Object.create(null),this._intentStates.set(i.cacheKey,r)),r.opListReadCapability||(s=Object.create(null),s.operatorListChanged=function(){r.operatorList.lastChunk&&(r.opListReadCapability.resolve(r.operatorList),r.renderTasks.delete(s))},r.opListReadCapability=Promise.withResolvers(),(r.renderTasks||=new Set).add(s),r.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(i)),r.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:e=!1,disableNormalization:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===e,disableNormalization:!0===t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then((e=>ii.textContent(e)));const t=this.streamTextContent(e);return new Promise((function(e,n){const i=t.getReader(),s={items:[],styles:Object.create(null),lang:null};!function t(){i.read().then((function(n){let{value:i,done:r}=n;r?e(s):(s.lang??=i.lang,Object.assign(s.styles,i.styles),s.items.push(...i.items),t())}),n)}()}))}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),this.#Un=!1,this.#zn(),Promise.all(e)}cleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#Un=!0;const t=this.#Vn(!1);return e&&t&&(this._stats&&=new Ze),t}#Vn(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.#zn(),!this.#Un||this.destroyed)return!1;if(e)return this.#Fn=setTimeout((()=>{this.#Fn=null,this.#Vn(!1)}),5e3),!1;for(const{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#Un=!1,!0}#zn(){this.#Fn&&(clearTimeout(this.#Fn),this.#Fn=null)}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,i=e.length;n<i;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&this.#Vn(!0)}_pumpOperatorList(e){let{renderingIntent:t,cacheKey:n,annotationStorageSerializable:i}=e;const{map:s,transfer:r}=i,a=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:n,annotationStorage:s},r).getReader(),o=this._intentStates.get(n);o.streamReader=a;const l=()=>{a.read().then((e=>{let{value:t,done:n}=e;n?o.streamReader=null:this._transport.destroyed||(this._renderPageChunk(t,o),l())}),(e=>{if(o.streamReader=null,!this._transport.destroyed){if(o.operatorList){o.operatorList.lastChunk=!0;for(const e of o.renderTasks)e.operatorListChanged();this.#Vn(!0)}if(o.displayReadyCapability)o.displayReadyCapability.reject(e);else{if(!o.opListReadCapability)throw e;o.opListReadCapability.reject(e)}}}))};l()}_abortOperatorList(e){let{intentState:t,reason:n,force:i=!1}=e;if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(n instanceof Ke){let e=100;return n.extraDelay>0&&n.extraDelay<1e3&&(e+=n.extraDelay),void(t.streamReaderCancelTimeout=setTimeout((()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:n,force:!0})}),e))}}if(t.streamReader.cancel(new me(n.message)).catch((()=>{})),t.streamReader=null,!this._transport.destroyed){for(const[e,n]of this._intentStates)if(n===t){this._intentStates.delete(e);break}this.cleanup()}}}get stats(){return this._stats}}class gi{#Bn=(()=>new Set)();#jn=(()=>Promise.resolve())();postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};this.#jn.then((()=>{for(const e of this.#Bn)e.call(this,n)}))}addEventListener(e,t){this.#Bn.add(t)}removeEventListener(e,t){this.#Bn.delete(t)}terminate(){this.#Bn.clear()}}const mi={isWorkerDisabled:!1,fakeWorkerId:0};r&&(mi.isWorkerDisabled=!0,un.workerSrc||="./pdf.worker.mjs"),mi.isSameOrigin=function(e,t){let n;try{if(n=new URL(e),!n.origin||"null"===n.origin)return!1}catch{return!1}const i=new URL(t,n);return n.origin===i.origin},mi.createCDNWrapper=function(e){const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};class vi{static#Hn;constructor(){let{name:e=null,port:t=null,verbosity:n=ne()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(vi.#Hn?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");return(vi.#Hn||=new WeakMap).set(t,this),void this._initializeFromPort(t)}this._initialize()}get promise(){return r?Promise.all([Mt.promise,this._readyCapability.promise]):this._readyCapability.promise}#$n(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new An("main","worker",e),this._messageHandler.on("ready",(function(){})),this.#$n()}_initialize(){if(mi.isWorkerDisabled||vi.#qn)return void this._setupFakeWorker();let{workerSrc:e}=vi;try{mi.isSameOrigin(window.location.href,e)||(e=mi.createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new An("main","worker",t),i=()=>{s.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},s=new AbortController;t.addEventListener("error",(()=>{this._webWorker||i()}),{signal:s.signal}),n.on("test",(e=>{s.abort(),!this.destroyed&&e?(this._messageHandler=n,this._port=t,this._webWorker=t,this.#$n()):i()})),n.on("ready",(e=>{if(s.abort(),this.destroyed)i();else try{r()}catch{this._setupFakeWorker()}}));const r=()=>{const e=new Uint8Array;n.send("test",e,[e.buffer])};return void r()}catch{ie("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){mi.isWorkerDisabled||(se("Setting up fake worker."),mi.isWorkerDisabled=!0),vi._setupFakeWorkerGlobal.then((e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const t=new gi;this._port=t;const n="fake"+mi.fakeWorkerId++,i=new An(n+"_worker",n,t);e.setup(i,t),this._messageHandler=new An(n,n+"_worker",t),this.#$n()})).catch((e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),vi.#Hn?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const t=this.#Hn?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new vi(e)}static get workerSrc(){if(un.workerSrc)return un.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#qn(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return le(this,"_setupFakeWorkerGlobal",(async()=>{if(this.#qn)return this.#qn;return(await import(this.workerSrc)).WorkerMessageHandler})())}}class yi{#Wn=(()=>new Map)();#Gn=(()=>new Map)();#Kn=(()=>new Map)();#Xn=(()=>new Map)();#Qn=null;constructor(e,t,n,i,s){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new wi,this.fontLoader=new It({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#Yn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.#Wn.get(e);if(n)return n;const i=this.messageHandler.sendWithPromise(e,t);return this.#Wn.set(e,i),i}get annotationStorage(){return le(this,"annotationStorage",new xt)}getRenderingIntent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.ENABLE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=u,r=Tt;switch(e){case"any":s=c;break;case"display":break;case"print":s=h;break;default:se(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case m.DISABLE:s+=f;break;case m.ENABLE:break;case m.ENABLE_FORMS:s+=d;break;case m.ENABLE_STORAGE:s+=p;r=(s&h&&n instanceof kt?n:this.annotationStorage).serializable;break;default:se(`getRenderingIntent - invalid annotationMode: ${t}`)}return i&&(s+=g),{renderingIntent:s,cacheKey:`${s}_${r.hash}`,annotationStorageSerializable:r}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#Qn?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const n of this.#Gn.values())e.push(n._destroy());this.#Gn.clear(),this.#Kn.clear(),this.#Xn.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then((()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#Wn.clear(),this.filterFactory.destroy(),ei.cleanup(),this._networkStream?.cancelAllRequests(new me("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",((e,t)=>{ae(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then((function(e){let{value:n,done:i}=e;i?t.close():(ae(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(n),1,[n]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(e=>{const n=Promise.withResolvers(),i=this._fullReader;return i.headersReady.then((()=>{i.isStreamingSupported&&i.isRangeSupported||(this._lastProgress&&t.onProgress?.(this._lastProgress),i.onProgress=e=>{t.onProgress?.({loaded:e.loaded,total:e.total})}),n.resolve({isStreamingSupported:i.isStreamingSupported,isRangeSupported:i.isRangeSupported,contentLength:i.contentLength})}),n.reject),n.promise})),e.on("GetRangeReader",((e,t)=>{ae(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(e.begin,e.end);n?(t.onPull=()=>{n.read().then((function(e){let{value:n,done:i}=e;i?t.close():(ae(n instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(n),1,[n]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{n.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}):t.close()})),e.on("GetDoc",(e=>{let{pdfInfo:n}=e;this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new pi(n,this))})),e.on("DocException",(function(e){let n;switch(e.name){case"PasswordException":n=new ue(e.message,e.code);break;case"InvalidPDFException":n=new de(e.message);break;case"MissingPDFException":n=new pe(e.message);break;case"UnexpectedResponseException":n=new fe(e.message,e.status);break;case"UnknownErrorException":n=new he(e.message,e.details);break;default:re("DocException - expected a valid Error.")}t._capability.reject(n)})),e.on("PasswordRequest",(e=>{if(this.#Qn=Promise.withResolvers(),t.onPassword){const i=e=>{e instanceof Error?this.#Qn.reject(e):this.#Qn.resolve({password:e})};try{t.onPassword(i,e.code)}catch(n){this.#Qn.reject(n)}}else this.#Qn.reject(new ue(e.message,e.code));return this.#Qn.promise})),e.on("DataLoaded",(e=>{t.onProgress?.({loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(e=>{if(this.destroyed)return;this.#Gn.get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(t=>{let[n,i,s]=t;if(this.destroyed)return null;if(this.commonObjs.has(n))return null;switch(i){case"Font":const{disableFontFace:t,fontExtraProperties:r,pdfBug:a}=this._params;if("error"in s){const e=s.error;se(`Error during font loading: ${e}`),this.commonObjs.resolve(n,e);break}const o=a&&globalThis.FontInspector?.enabled?(e,t)=>globalThis.FontInspector.fontAdded(e,t):null,l=new Pt(s,{disableFontFace:t,inspectFont:o});this.fontLoader.bind(l).catch((()=>e.sendWithPromise("FontFallback",{id:n}))).finally((()=>{!r&&l.data&&(l.data=null),this.commonObjs.resolve(n,l)}));break;case"CopyLocalImage":const{imageRef:c}=s;ae(c,"The imageRef must be defined.");for(const e of this.#Gn.values())for(const[,t]of e.objs)if(t?.ref===c)return t.dataLen?(this.commonObjs.resolve(n,structuredClone(t)),t.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,s);break;default:throw new Error(`Got unknown common object type ${i}`)}return null})),e.on("obj",(e=>{let[t,n,i,s]=e;if(this.destroyed)return;const r=this.#Gn.get(n);if(!r.objs.has(t))if(0!==r._intentStates.size)switch(i){case"Image":r.objs.resolve(t,s),s?.dataLen>1e7&&(r._maybeCleanupAfterRender=!0);break;case"Pattern":r.objs.resolve(t,s);break;default:throw new Error(`Got unknown object type ${i}`)}else s?.bitmap?.close()})),e.on("DocProgress",(e=>{this.destroyed||t.onProgress?.({loaded:e.loaded,total:e.total})})),e.on("FetchBuiltInCMap",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(e):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.")))),e.on("FetchStandardFontData",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(e):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&se("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally((()=>{this.annotationStorage.resetModified()}))}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=this.#Kn.get(t);if(n)return n;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then((n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#Xn.set(n.refStr,e);const i=new fi(t,n,this,this._params.pdfBug);return this.#Gn.set(t,i),i}));return this.#Kn.set(t,i),i}getPageIndex(e){return ui(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#Yn("GetFieldObjects")}hasJSActions(){return this.#Yn("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!==typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#Yn("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#Yn("GetOptionalContentConfig").then((t=>new Tn(t,e)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#Wn.get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then((e=>({info:e[0],metadata:e[1]?new En(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})));return this.#Wn.set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#Gn.values()){if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`)}this.commonObjs.clear(),e||this.fontLoader.clear(),this.#Wn.clear(),this.filterFactory.destroy(!0),ei.cleanup()}}cachedPageNumber(e){if(!ui(e))return null;const t=0===e.gen?`${e.num}R`:`${e.num}R${e.gen}`;return this.#Xn.get(t)??null}}const bi=Symbol("INITIAL_DATA");class wi{#Jn=(()=>Object.create(null))();#Zn(e){return this.#Jn[e]||={...Promise.withResolvers(),data:bi}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){const n=this.#Zn(e);return n.promise.then((()=>t(n.data))),null}const n=this.#Jn[e];if(!n||n.data===bi)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=this.#Jn[e];return!!t&&t.data!==bi}resolve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.#Zn(e);n.data=t,n.resolve()}clear(){for(const e in this.#Jn){const{data:t}=this.#Jn[e];t?.bitmap?.close()}this.#Jn=Object.create(null)}*[Symbol.iterator](){for(const e in this.#Jn){const{data:t}=this.#Jn[e];t!==bi&&(yield[e,t])}}}class _i{#ei=null;constructor(e){this.#ei=e,this.onContinue=null}get promise(){return this.#ei.capability.promise}cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.#ei.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#ei.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#ei;return e.form||e.canvas&&t?.size>0}}class Ai{#ti=null;static#ni=(()=>new WeakSet)();constructor(e){let{callback:t,params:n,objs:i,commonObjs:s,annotationCanvasMap:r,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:u=!1,pdfBug:h=!1,pageColors:d=null}=e;this.callback=t,this.params=n,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===u&&"undefined"!==typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new _i(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=n.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics(e){let{transparency:t=!1,optionalContentConfig:n}=e;if(this.cancelled)return;if(this._canvas){if(Ai.#ni.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ai.#ni.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:s,transform:r,background:a}=this.params;this.gfx=new cn(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:n},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:s,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#ti&&(window.cancelAnimationFrame(this.#ti),this.#ti=null),Ai.#ni.delete(this._canvas),this.callback(e||new Ke(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){this.graphicsReady?(this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#ti=window.requestAnimationFrame((()=>{this.#ti=null,this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ai.#ni.delete(this._canvas),this.callback())))}}const Ei="4.4.168",Si="19fbc8998";function Ci(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}function Ti(e){return Math.max(0,Math.min(255,255*e))}class xi{static CMYK_G(e){let[t,n,i,s]=e;return["G",1-Math.min(1,.3*t+.59*i+.11*n+s)]}static G_CMYK(e){let[t]=e;return["CMYK",0,0,0,1-t]}static G_RGB(e){let[t]=e;return["RGB",t,t,t]}static G_rgb(e){let[t]=e;return t=Ti(t),[t,t,t]}static G_HTML(e){let[t]=e;const n=Ci(t);return`#${n}${n}${n}`}static RGB_G(e){let[t,n,i]=e;return["G",.3*t+.59*n+.11*i]}static RGB_rgb(e){return e.map(Ti)}static RGB_HTML(e){return`#${e.map(Ci).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB(e){let[t,n,i,s]=e;return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,n+s)]}static CMYK_rgb(e){let[t,n,i,s]=e;return[Ti(1-Math.min(1,t+s)),Ti(1-Math.min(1,i+s)),Ti(1-Math.min(1,n+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK(e){let[t,n,i]=e;const s=1-t,r=1-n,a=1-i;return["CMYK",s,r,a,Math.min(s,r,a)]}}class ki{static setupStorage(e,t,n,i,s){const r=i.getValue(t,{value:null});switch(n.name){case"textarea":if(null!==r.value&&(e.textContent=r.value),"print"===s)break;e.addEventListener("input",(e=>{i.setValue(t,{value:e.target.value})}));break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(r.value===n.attributes.xfaOn?e.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&e.removeAttribute("checked"),"print"===s)break;e.addEventListener("change",(e=>{i.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})}))}else{if(null!==r.value&&e.setAttribute("value",r.value),"print"===s)break;e.addEventListener("input",(e=>{i.setValue(t,{value:e.target.value})}))}break;case"select":if(null!==r.value){e.setAttribute("value",r.value);for(const e of n.children)e.attributes.value===r.value?e.attributes.selected=!0:e.attributes.hasOwnProperty("selected")&&delete e.attributes.selected}e.addEventListener("input",(e=>{const n=e.target.options,s=-1===n.selectedIndex?"":n[n.selectedIndex].value;i.setValue(t,{value:s})}))}}static setAttributes(e){let{html:t,element:n,storage:i=null,intent:s,linkService:r}=e;const{attributes:a}=n,o=t instanceof HTMLAnchorElement;"radio"===a.type&&(a.name=`${a.name}-${s}`);for(const[l,c]of Object.entries(a))if(null!==c&&void 0!==c)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!o||"href"!==l&&"newWindow"!==l)&&t.setAttribute(l,c)}o&&r.addLinkAttributes(t,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(t,a.dataId,n,i)}static render(e){const t=e.annotationStorage,n=e.linkService,i=e.xfaHtml,s=e.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:s,linkService:n});const a="richText"!==s,o=e.div;if(o.append(r),e.viewport){const t=`matrix(${e.viewport.transform.join(",")})`;o.style.transform=t}a&&o.setAttribute("class","xfaLayer xfaFont");const l=[];if(0===i.children.length){if(i.value){const e=document.createTextNode(i.value);r.append(e),a&&ii.shouldBuildText(i.name)&&l.push(e)}return{textDivs:l}}const c=[[i,-1,r]];for(;c.length>0;){const[e,i,r]=c.at(-1);if(i+1===e.children.length){c.pop();continue}const o=e.children[++c.at(-1)[1]];if(null===o)continue;const{name:u}=o;if("#text"===u){const e=document.createTextNode(o.value);l.push(e),r.append(e);continue}const h=o?.attributes?.xmlns?document.createElementNS(o.attributes.xmlns,u):document.createElement(u);if(r.append(h),o.attributes&&this.setAttributes({html:h,element:o,storage:t,intent:s,linkService:n}),o.children?.length>0)c.push([o,-1,h]);else if(o.value){const e=document.createTextNode(o.value);a&&ii.shouldBuildText(u)&&l.push(e),h.append(e)}}for(const u of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:l}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Ii=1e3,Pi=new WeakSet;function Ri(e){return{width:e[2]-e[0],height:e[3]-e[1]}}class Di{static create(e){switch(e.data.annotationType){case k:return new Ni(e);case x:return new Li(e);case $:switch(e.data.fieldType){case"Tx":return new Fi(e);case"Btn":return e.data.radioButton?new Vi(e):e.data.checkBox?new zi(e):new Bi(e);case"Ch":return new ji(e);case"Sig":return new Ui(e)}return new Oi(e);case j:return new Hi(e);case I:return new qi(e);case P:return new Wi(e);case R:return new Gi(e);case D:return new Ki(e);case N:return new Xi(e);case V:return new Yi(e);case B:return new Ji(e);case M:return new Qi(e);case L:return new Zi(e);case O:return new es(e);case F:return new ts(e);case U:return new ns(e);case z:return new is(e);case H:return new ss(e);default:return new Mi(e)}}}class Mi{#ii=null;#si=!1;#ri=null;constructor(e){let{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),i&&this._createQuadrilaterals()}static _hasPopupData(e){let{titleObj:t,contentsObj:n,richText:i}=e;return!!(t?.str||n?.str||i?.str)}get hasPopupData(){return Mi._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;this.#ii||={rect:this.data.rect.slice(0)};const{rect:t}=e;t&&this.#ai(t),this.#ri?.popup.updateEdited(e)}resetEdited(){this.#ii&&(this.#ai(this.#ii.rect),this.#ri?.popup.resetEdited(),this.#ii=null)}#ai(e){const{container:{style:t},data:{rect:n,rotation:i},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:r,pageX:a,pageY:o}}}}=this;n?.splice(0,4,...e);const{width:l,height:c}=Ri(e);t.left=100*(e[0]-a)/s+"%",t.top=100*(r-e[3]+o)/r+"%",0===i?(t.width=100*l/s+"%",t.height=100*c/r+"%"):this.setRotation(i)}_createContainer(e){const{data:t,parent:{page:n,viewport:i}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),this instanceof Oi||(s.tabIndex=Ii);const{style:r}=s;if(r.zIndex=this.parent.zIndex++,t.popupRef&&s.setAttribute("aria-haspopup","dialog"),t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof Hi){const{rotation:e}=t;return t.hasOwnCanvas||0===e||this.setRotation(e,s),s}const{width:a,height:o}=Ri(t.rect);if(!e&&t.borderStyle.width>0){r.borderWidth=`${t.borderStyle.width}px`;const e=t.borderStyle.horizontalCornerRadius,n=t.borderStyle.verticalCornerRadius;if(e>0||n>0){const t=`calc(${e}px * var(--scale-factor)) / calc(${n}px * var(--scale-factor))`;r.borderRadius=t}else if(this instanceof Vi){const e=`calc(${a}px * var(--scale-factor)) / calc(${o}px * var(--scale-factor))`;r.borderRadius=e}switch(t.borderStyle.style){case q:r.borderStyle="solid";break;case W:r.borderStyle="dashed";break;case G:se("Unimplemented border style: beveled");break;case K:se("Unimplemented border style: inset");break;case X:r.borderBottomStyle="solid"}const i=t.borderColor||null;i?(this.#si=!0,r.borderColor=Ae.makeHexColor(0|i[0],0|i[1],0|i[2])):r.borderWidth=0}const l=Ae.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:c,pageHeight:u,pageX:h,pageY:d}=i.rawDims;r.left=100*(l[0]-h)/c+"%",r.top=100*(l[1]-d)/u+"%";const{rotation:p}=t;return t.hasOwnCanvas||0===p?(r.width=100*a/c+"%",r.height=100*o/u+"%"):this.setRotation(p,s),s}setRotation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;if(!this.data.rect)return;const{pageWidth:n,pageHeight:i}=this.parent.viewport.rawDims,{width:s,height:r}=Ri(this.data.rect);let a,o;e%180===0?(a=100*s/n,o=100*r/i):(a=100*r/n,o=100*s/i),t.style.width=`${a}%`,t.style.height=`${o}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(e,t,n)=>{const i=n.detail[e],s=i[0],r=i.slice(1);n.target.style[t]=xi[`${s}_HTML`](r),this.annotationStorage.setValue(this.data.id,{[t]:xi[`${s}_rgb`](r)})};return le(this,"_commonActions",{display:e=>{const{display:t}=e.detail,n=t%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:1===t||2===t})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:t}=e.detail;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:t,noView:t})},focus:e=>{setTimeout((()=>e.target.focus({preventScroll:!1})),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:e=>{const t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const i of Object.keys(t.detail)){const s=e[i]||n[i];s?.(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[i,s]of Object.entries(t)){const r=n[i];if(r){r({detail:{[i]:s},target:e}),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,i,s]=this.data.rect.map((e=>Math.fround(e)));if(8===e.length){const[r,a,o,l]=e.subarray(2,6);if(i===r&&s===a&&t===o&&n===l)return}const{style:r}=this.container;let a;if(this.#si){const{borderColor:e,borderWidth:t}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${e}" stroke-width="${t}">`],this.container.classList.add("hasBorder")}const o=i-t,l=s-n,{svgFactory:c}=this,u=c.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0);const h=c.createElement("defs");u.append(h);const d=c.createElement("clipPath"),p=`clippath_${this.data.id}`;d.setAttribute("id",p),d.setAttribute("clipPathUnits","objectBoundingBox"),h.append(d);for(let f=2,g=e.length;f<g;f+=8){const n=e[f],i=e[f+1],r=e[f+2],u=e[f+3],h=c.createElement("rect"),p=(r-t)/o,g=(s-i)/l,m=(n-r)/o,v=(i-u)/l;h.setAttribute("x",p),h.setAttribute("y",g),h.setAttribute("width",m),h.setAttribute("height",v),d.append(h),a?.push(`<rect vector-effect="non-scaling-stroke" x="${p}" y="${g}" width="${m}" height="${v}"/>`)}this.#si&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(u),this.container.style.clipPath=`url(#${p})`}_createPopup(){const{container:e,data:t}=this;e.setAttribute("aria-haspopup","dialog");const n=this.#ri=new Hi({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(n.render())}render(){re("Abstract method `AnnotationElement.render` called")}_getElementsByName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:e,id:s,exportValues:r}of i){if(-1===e)continue;if(s===t)continue;const i="string"===typeof r?r:null,a=document.querySelector(`[data-element-id="${s}"]`);!a||Pi.has(a)?n.push({id:s,exportValue:i,domElement:a}):se(`_getElementsByName - element not allowed: ${s}`)}return n}for(const i of document.getElementsByName(e)){const{exportValue:e}=i,s=i.getAttribute("data-element-id");s!==t&&(Pi.has(i)&&n.push({id:s,exportValue:e,domElement:i}))}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",(()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})}))}}class Ni extends Mi{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let i=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),i=!0):e.action?(this._bindNamedAction(n,e.action),i=!0):e.attachment?(this.#oi(n,e.attachment,e.attachmentDest),i=!0):e.setOCGState?(this.#li(n,e.setOCGState),i=!0):e.dest?(this._bindLink(n,e.dest),i=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),i=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(n,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(n),this.container}#ci(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&this.#ci()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#ci()}#oi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,n),!1),this.#ci()}#li(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#ci()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(t.actions)){const s=n.get(i);s&&(e[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:i}}),!1))}e.onclick||(e.onclick=()=>!1),this.#ci()}_bindResetFormAction(e,t){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),this.#ci(),!this._fieldObjects)return se('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(e.onclick=()=>!1));e.onclick=()=>{n?.();const{fields:e,refs:i,include:s}=t,r=[];if(0!==e.length||0!==i.length){const t=new Set(i);for(const n of e){const e=this._fieldObjects[n]||[];for(const{id:n}of e)t.add(n)}for(const e of Object.values(this._fieldObjects))for(const n of e)t.has(n.id)===s&&r.push(n)}else for(const t of Object.values(this._fieldObjects))r.push(...t);const a=this.annotationStorage,o=[];for(const t of r){const{id:e}=t;switch(o.push(e),t.type){case"text":{const n=t.defaultValue||"";a.setValue(e,{value:n});break}case"checkbox":case"radiobutton":{const n=t.defaultValue===t.exportValues;a.setValue(e,{value:n});break}case"combobox":case"listbox":{const n=t.defaultValue||"";a.setValue(e,{value:n});break}default:continue}const n=document.querySelector(`[data-element-id="${e}"]`);n&&(Pi.has(n)?n.dispatchEvent(new Event("resetform")):se(`_bindResetFormAction - element not allowed: ${e}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:o,name:"ResetForm"}}),!1}}}class Li extends Mi{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Oi extends Mi{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&("CANVAS"===e.previousSibling?.nodeName&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return we.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,i,s){n.includes("mouse")?e.addEventListener(n,(e=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})})):e.addEventListener(n,(e=>{if("blur"===n){if(!t.focused||!e.relatedTarget)return;t.focused=!1}else if("focus"===n){if(t.focused)return;t.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(e)}})}))}_setEventListeners(e,t,n,i){for(const[s,r]of n)("Action"===r||this.data.actions?.[r])&&("Focus"!==r&&"Blur"!==r||(t||={focused:!1}),this._setEventListener(e,t,s,r,i),"Focus"!==r||this.data.actions?.Blur?"Blur"!==r||this.data.actions?.Focus||this._setEventListener(e,t,"focus","Focus",null):this._setEventListener(e,t,"blur","Blur",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":Ae.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||9,s=e.style;let r;const a=e=>Math.round(10*e)/10;if(this.data.multiLine){const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),t=e/(Math.round(e/(l*i))||1);r=Math.min(i,a(t/l))}else{const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2);r=Math.min(i,a(e/l))}s.fontSize=`calc(${r}px * var(--scale-factor))`,s.color=Ae.makeHexColor(n[0],n[1],n[2]),null!==this.data.textAlignment&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Fi extends Oi{constructor(e){super(e,{isRenderable:e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,n,i){const s=this.annotationStorage;for(const r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=n),s.setValue(r.id,{[i]:n})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const i=e.getValue(t,{value:this.data.fieldValue});let s=i.value||"";const r=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;r&&s.length>r&&(s=s.slice(0,r));let a=i.formattedValue||this.data.textContent?.join("\n")||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const o={userValue:s,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=a??s,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",a??s),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Pi.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=Ii,this._setRequired(n,this.data.required),r&&(n.maxLength=r),n.addEventListener("input",(i=>{e.setValue(t,{value:i.target.value}),this.setPropertyOnSiblings(n,"value",i.target.value,"value"),o.formattedValue=null})),n.addEventListener("resetform",(e=>{const t=this.data.defaultFieldValue??"";n.value=o.userValue=t,o.formattedValue=null}));let l=e=>{const{formattedValue:t}=o;null!==t&&void 0!==t&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",(e=>{if(o.focused)return;const{target:t}=e;o.userValue&&(t.value=o.userValue),o.lastCommittedValue=t.value,o.commitKey=1,this.data.actions?.Focus||(o.focused=!0)})),n.addEventListener("updatefromsandbox",(n=>{this.showElementAndHideCanvas(n.target);const i={value(n){o.userValue=n.detail.value??"",e.setValue(t,{value:o.userValue.toString()}),n.target.value=o.userValue},formattedValue(n){const{formattedValue:i}=n.detail;o.formattedValue=i,null!==i&&void 0!==i&&n.target!==document.activeElement&&(n.target.value=i),e.setValue(t,{formattedValue:i})},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:n=>{const{charLimit:i}=n.detail,{target:s}=n;if(0===i)return void s.removeAttribute("maxLength");s.setAttribute("maxLength",i);let r=o.userValue;!r||r.length<=i||(r=r.slice(0,i),s.value=o.userValue=r,e.setValue(t,{value:r}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:r,willCommit:!0,commitKey:1,selStart:s.selectionStart,selEnd:s.selectionEnd}}))}};this._dispatchEventFromSandbox(i,n)})),n.addEventListener("keydown",(e=>{o.commitKey=1;let n=-1;if("Escape"===e.key?n=0:"Enter"!==e.key||this.data.multiLine?"Tab"===e.key&&(o.commitKey=3):n=2,-1===n)return;const{value:i}=e.target;o.lastCommittedValue!==i&&(o.lastCommittedValue=i,o.userValue=i,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i,willCommit:!0,commitKey:n,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}));const i=l;l=null,n.addEventListener("blur",(e=>{if(!o.focused||!e.relatedTarget)return;this.data.actions?.Blur||(o.focused=!1);const{value:n}=e.target;o.userValue=n,o.lastCommittedValue!==n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:n,willCommit:!0,commitKey:o.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}),i(e)})),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",(e=>{o.lastCommittedValue=null;const{data:n,target:i}=e,{value:s,selectionStart:r,selectionEnd:a}=i;let l=r,c=a;switch(e.inputType){case"deleteWordBackward":{const e=s.substring(0,r).match(/\w*[^\w]*$/);e&&(l-=e[0].length);break}case"deleteWordForward":{const e=s.substring(r).match(/^[^\w]*\w*/);e&&(c+=e[0].length);break}case"deleteContentBackward":r===a&&(l-=1);break;case"deleteContentForward":r===a&&(c+=1)}e.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:s,change:n||"",willCommit:!1,selStart:l,selEnd:c}})})),this._setEventListeners(n,o,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.value))}if(l&&n.addEventListener("blur",l),this.data.comb){const e=(this.data.rect[2]-this.data.rect[0])/r;n.classList.add("comb"),n.style.letterSpacing=`calc(${e}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Ui extends Oi{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class zi extends Oi{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let i=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;"string"===typeof i&&(i="Off"!==i,e.setValue(n,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return Pi.add(s),s.setAttribute("data-element-id",n),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=Ii,s.addEventListener("change",(i=>{const{name:s,checked:r}=i.target;for(const a of this._getElementsByName(s,n)){const n=r&&a.exportValue===t.exportValue;a.domElement&&(a.domElement.checked=n),e.setValue(a.id,{value:n})}e.setValue(n,{value:r})})),s.addEventListener("resetform",(e=>{const n=t.defaultFieldValue||"Off";e.target.checked=n===t.exportValue})),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",(t=>{const i={value(t){t.target.checked="Off"!==t.detail.value,e.setValue(n,{value:t.target.checked})}};this._dispatchEventFromSandbox(i,t)})),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Vi extends Oi{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let i=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if("string"===typeof i&&(i=i!==t.buttonValue,e.setValue(n,{value:i})),i)for(const r of this._getElementsByName(t.fieldName,n))e.setValue(r.id,{value:!1});const s=document.createElement("input");if(Pi.add(s),s.setAttribute("data-element-id",n),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.tabIndex=Ii,s.addEventListener("change",(t=>{const{name:i,checked:s}=t.target;for(const r of this._getElementsByName(i,n))e.setValue(r.id,{value:!1});e.setValue(n,{value:s})})),s.addEventListener("resetform",(e=>{const n=t.defaultFieldValue;e.target.checked=null!==n&&void 0!==n&&n===t.buttonValue})),this.enableScripting&&this.hasJSActions){const i=t.buttonValue;s.addEventListener("updatefromsandbox",(t=>{const s={value:t=>{const s=i===t.detail.value;for(const i of this._getElementsByName(t.target.name)){const t=s&&i.id===n;i.domElement&&(i.domElement.checked=t),e.setValue(i.id,{value:t})}}};this._dispatchEventFromSandbox(s,t)})),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Bi extends Ni{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",(e=>{this._dispatchEventFromSandbox({},e)}))),e}}class ji extends Oi{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Pi.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Ii;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",(e=>{const t=this.data.defaultFieldValue;for(const n of i.options)n.selected=n.value===t}));for(const c of this.data.options){const e=document.createElement("option");e.textContent=c.displayValue,e.value=c.exportValue,n.value.includes(c.exportValue)&&(e.setAttribute("selected",!0),s=!1),i.append(e)}let r=null;if(s){const e=document.createElement("option");e.value=" ",e.setAttribute("hidden",!0),e.setAttribute("selected",!0),i.prepend(e),r=()=>{e.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const a=e=>{const t=e?"value":"textContent",{options:n,multiple:s}=i;return s?Array.prototype.filter.call(n,(e=>e.selected)).map((e=>e[t])):-1===n.selectedIndex?null:n[n.selectedIndex][t]};let o=a(!1);const l=e=>{const t=e.target.options;return Array.prototype.map.call(t,(e=>({displayValue:e.textContent,exportValue:e.value})))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",(n=>{const s={value(n){r?.();const s=n.detail.value,l=new Set(Array.isArray(s)?s:[s]);for(const e of i.options)e.selected=l.has(e.value);e.setValue(t,{value:a(!0)}),o=a(!1)},multipleSelection(e){i.multiple=!0},remove(n){const s=i.options,r=n.detail.remove;if(s[r].selected=!1,i.remove(r),s.length>0){-1===Array.prototype.findIndex.call(s,(e=>e.selected))&&(s[0].selected=!0)}e.setValue(t,{value:a(!0),items:l(n)}),o=a(!1)},clear(n){for(;0!==i.length;)i.remove(0);e.setValue(t,{value:null,items:[]}),o=a(!1)},insert(n){const{index:s,displayValue:r,exportValue:c}=n.detail.insert,u=i.children[s],h=document.createElement("option");h.textContent=r,h.value=c,u?u.before(h):i.append(h),e.setValue(t,{value:a(!0),items:l(n)}),o=a(!1)},items(n){const{items:s}=n.detail;for(;0!==i.length;)i.remove(0);for(const e of s){const{displayValue:t,exportValue:n}=e,s=document.createElement("option");s.textContent=t,s.value=n,i.append(s)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:a(!0),items:l(n)}),o=a(!1)},indices(n){const i=new Set(n.detail.indices);for(const e of n.target.options)e.selected=i.has(e.index);e.setValue(t,{value:a(!0)}),o=a(!1)},editable(e){e.target.disabled=!e.detail.editable}};this._dispatchEventFromSandbox(s,n)})),i.addEventListener("input",(n=>{const i=a(!0),s=a(!1);e.setValue(t,{value:i}),n.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:o,change:s,changeEx:i,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(e=>e.target.value))):i.addEventListener("input",(function(n){e.setValue(t,{value:a(!0)})})),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Hi extends Mi{constructor(e){const{data:t,elements:n}=e;super(e,{isRenderable:Mi._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new $i({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const n of this.elements)n.popup=e,t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map((e=>`${Te}${e}`)).join(",")),this.container}}class $i{#ui=this.#hi.bind(this);#di=this.#pi.bind(this);#fi=this.#gi.bind(this);#mi=this.#vi.bind(this);#yi=null;#me=null;#bi=null;#wi=null;#_i=null;#Ai=null;#Ei=null;#Si=!1;#Ci=null;#S=null;#Ti=null;#xi=null;#ki=null;#ii=null;#Ii=!1;constructor(e){let{container:t,color:n,elements:i,titleObj:s,modificationDate:r,contentsObj:a,richText:o,parent:l,rect:c,parentRect:u,open:h}=e;this.#me=t,this.#ki=s,this.#bi=a,this.#xi=o,this.#Ai=l,this.#yi=n,this.#Ti=c,this.#Ei=u,this.#_i=i,this.#wi=st.toDateObject(r),this.trigger=i.flatMap((e=>e.getElementsToTriggerPopup()));for(const d of this.trigger)d.addEventListener("click",this.#mi),d.addEventListener("mouseenter",this.#fi),d.addEventListener("mouseleave",this.#di),d.classList.add("popupTriggerArea");for(const d of i)d.container?.addEventListener("keydown",this.#ui);this.#me.hidden=!0,h&&this.#vi()}render(){if(this.#Ci)return;const e=this.#Ci=document.createElement("div");if(e.className="popup",this.#yi){const t=e.style.outlineColor=Ae.makeHexColor(...this.#yi);if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)"))e.style.backgroundColor=`color-mix(in srgb, ${t} 30%, white)`;else{const t=.7;e.style.backgroundColor=Ae.makeHexColor(...this.#yi.map((e=>Math.floor(t*(255-e)+e))))}}const t=document.createElement("span");t.className="header";const n=document.createElement("h1");if(t.append(n),({dir:n.dir,str:n.textContent}=this.#ki),e.append(t),this.#wi){const e=document.createElement("span");e.classList.add("popupDate"),e.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),e.setAttribute("data-l10n-args",JSON.stringify({date:this.#wi.toLocaleDateString(),time:this.#wi.toLocaleTimeString()})),t.append(e)}const i=this.#Pi;if(i)ki.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const t=this._formatContents(this.#bi);e.append(t)}this.#me.append(e)}get#Pi(){const e=this.#xi,t=this.#bi;return!e?.str||t?.str&&t.str!==e.str?null:this.#xi.html||null}get#Ri(){return this.#Pi?.attributes?.style?.fontSize||0}get#Di(){return this.#Pi?.attributes?.style?.color||null}#Mi(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:this.#Di,fontSize:this.#Ri?`calc(${this.#Ri}px * var(--scale-factor))`:""}};for(const s of e.split("\n"))t.push({name:"span",value:s,attributes:i});return n}_formatContents(e){let{str:t,dir:n}=e;const i=document.createElement("p");i.classList.add("popupContent"),i.dir=n;const s=t.split(/(?:\r\n?|\n)/);for(let r=0,a=s.length;r<a;++r){const e=s[r];i.append(document.createTextNode(e)),r<a-1&&i.append(document.createElement("br"))}return i}#hi(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||("Enter"===e.key||"Escape"===e.key&&this.#Si)&&this.#vi()}updateEdited(e){let{rect:t,popupContent:n}=e;this.#ii||={contentsObj:this.#bi,richText:this.#xi},t&&(this.#S=null),n&&(this.#xi=this.#Mi(n),this.#bi=null),this.#Ci?.remove(),this.#Ci=null}resetEdited(){this.#ii&&(({contentsObj:this.#bi,richText:this.#xi}=this.#ii),this.#ii=null,this.#Ci?.remove(),this.#Ci=null,this.#S=null)}#Ni(){if(null!==this.#S)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:i,pageY:s}}}=this.#Ai;let r=!!this.#Ei,a=r?this.#Ei:this.#Ti;for(const d of this.#_i)if(!a||null!==Ae.intersect(d.data.rect,a)){a=d.data.rect,r=!0;break}const o=Ae.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),l=r?a[2]-a[0]+5:0,c=o[0]+l,u=o[1];this.#S=[100*(c-i)/t,100*(u-s)/n];const{style:h}=this.#me;h.left=`${this.#S[0]}%`,h.top=`${this.#S[1]}%`}#vi(){this.#Si=!this.#Si,this.#Si?(this.#gi(),this.#me.addEventListener("click",this.#mi),this.#me.addEventListener("keydown",this.#ui)):(this.#pi(),this.#me.removeEventListener("click",this.#mi),this.#me.removeEventListener("keydown",this.#ui))}#gi(){this.#Ci||this.render(),this.isVisible?this.#Si&&this.#me.classList.add("focused"):(this.#Ni(),this.#me.hidden=!1,this.#me.style.zIndex=parseInt(this.#me.style.zIndex)+1e3)}#pi(){this.#me.classList.remove("focused"),!this.#Si&&this.isVisible&&(this.#me.hidden=!0,this.#me.style.zIndex=parseInt(this.#me.style.zIndex)-1e3)}forceHide(){this.#Ii=this.isVisible,this.#Ii&&(this.#me.hidden=!0)}maybeShow(){this.#Ii&&(this.#Ci||this.#gi(),this.#Ii=!1,this.#me.hidden=!1)}get isVisible(){return!1===this.#me.hidden}}class qi extends Mi{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=v.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class Wi extends Mi{#Li=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:t,height:n}=Ri(e.rect),i=this.svgFactory.create(t,n,!0),s=this.#Li=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),s.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),s.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),s.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#Li}addHighlightArea(){this.container.classList.add("highlightArea")}}class Gi extends Mi{#Oi=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:t,height:n}=Ri(e.rect),i=this.svgFactory.create(t,n,!0),s=e.borderStyle.width,r=this.#Oi=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",s/2),r.setAttribute("y",s/2),r.setAttribute("width",t-s),r.setAttribute("height",n-s),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#Oi}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ki extends Mi{#Fi=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:t,height:n}=Ri(e.rect),i=this.svgFactory.create(t,n,!0),s=e.borderStyle.width,r=this.#Fi=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",t/2),r.setAttribute("cy",n/2),r.setAttribute("rx",t/2-s/2),r.setAttribute("ry",n/2-s/2),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#Fi}addHighlightArea(){this.container.classList.add("highlightArea")}}class Xi extends Mi{#Ui=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:n,popupRef:i}}=this;if(!t)return this.container;const{width:s,height:r}=Ri(e),a=this.svgFactory.create(s,r,!0);let o=[];for(let c=0,u=t.length;c<u;c+=2){const n=t[c]-e[0],i=e[3]-t[c+1];o.push(`${n},${i}`)}o=o.join(" ");const l=this.#Ui=this.svgFactory.createElement(this.svgElementName);return l.setAttribute("points",o),l.setAttribute("stroke-width",n.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#Ui}addHighlightArea(){this.container.classList.add("highlightArea")}}class Qi extends Xi{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Yi extends Mi{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Ji extends Mi{#zi=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=v.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,inkLists:t,borderStyle:n,popupRef:i}}=this,{width:s,height:r}=Ri(e),a=this.svgFactory.create(s,r,!0);for(const o of t){let t=[];for(let n=0,i=o.length;n<i;n+=2){const i=o[n]-e[0],s=e[3]-o[n+1];t.push(`${i},${s}`)}t=t.join(" ");const s=this.svgFactory.createElement(this.svgElementName);this.#zi.push(s),s.setAttribute("points",t),s.setAttribute("stroke-width",n.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),!i&&this.hasPopupData&&this._createPopup(),a.append(s)}return this.container.append(a),this.container}getElementsToTriggerPopup(){return this.#zi}addHighlightArea(){this.container.classList.add("highlightArea")}}class Zi extends Mi{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class es extends Mi{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class ts extends Mi{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class ns extends Mi{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class is extends Mi{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class ss extends Mi{#Vi=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let n;t.hasAppearance||0===t.fillAlpha?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(100*t.fillAlpha)}%);`)),n.addEventListener("dblclick",this.#Bi.bind(this)),this.#Vi=n;const{isMac:i}=we.platform;return e.addEventListener("keydown",(e=>{"Enter"===e.key&&(i?e.metaKey:e.ctrlKey)&&this.#Bi()})),!t.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),e.append(n),e}getElementsToTriggerPopup(){return this.#Vi}addHighlightArea(){this.container.classList.add("highlightArea")}#Bi(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class rs{#ji=null;#Hi=null;#$i=(()=>new Map)();constructor(e){let{div:t,accessibilityManager:n,annotationCanvasMap:i,annotationEditorUIManager:s,page:r,viewport:a}=e;this.div=t,this.#ji=n,this.#Hi=i,this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s}#qi(e,t){const n=e.firstChild||e;n.id=`${Te}${t}`,this.div.append(e),this.#ji?.moveElementInDOM(this.div,e,n,!1)}async render(e){const{annotations:t}=e,n=this.div;ct(n,this.viewport);const i=new Map,s={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new We,annotationStorage:e.annotationStorage||new xt,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const r of t){if(r.noHTML)continue;const e=r.annotationType===j;if(e){const e=i.get(r.id);if(!e)continue;s.elements=e}else{const{width:e,height:t}=Ri(r.rect);if(e<=0||t<=0)continue}s.data=r;const t=Di.create(s);if(!t.isRenderable)continue;if(!e&&r.popupRef){const e=i.get(r.popupRef);e?e.push(t):i.set(r.popupRef,[t])}const n=t.render();r.hidden&&(n.style.visibility="hidden"),this.#qi(n,r.id),t.annotationEditorType>0&&(this.#$i.set(t.data.id,t),this._annotationEditorUIManager?.renderAnnotationElement(t))}this.#Wi()}update(e){let{viewport:t}=e;const n=this.div;this.viewport=t,ct(n,{rotation:t.rotation}),this.#Wi(),n.hidden=!1}#Wi(){if(!this.#Hi)return;const e=this.div;for(const[t,n]of this.#Hi){const i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;n.className="annotationContent";const{firstChild:s}=i;s?"CANVAS"===s.nodeName?s.replaceWith(n):s.classList.contains("annotationContent")?s.after(n):s.before(n):i.append(n)}this.#Hi.clear()}getEditableAnnotations(){return Array.from(this.#$i.values())}getEditableAnnotation(e){return this.#$i.get(e)}}const as=/\r\n?|\n/g;class os extends wt{#Gi=this.editorDivBlur.bind(this);#Ki=this.editorDivFocus.bind(this);#Xi=this.editorDivInput.bind(this);#Qi=this.editorDivKeydown.bind(this);#Yi=this.editorDivPaste.bind(this);#yi;#Ji="";#Zi=`${this.id}-editor`;#Ri;#es=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=os.prototype,t=e=>e.isEmpty(),n=yt.TRANSLATE_SMALL,i=yt.TRANSLATE_BIG;return le(this,"_keyboardManager",new mt([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}]]))}static _type="freetext";static _editorType=(()=>v.FREETEXT)();constructor(e){super({...e,name:"freeTextEditor"}),this.#yi=e.color||os._defaultColor||wt._defaultLineColor,this.#Ri=e.fontSize||os._defaultFontSize}static initialize(e,t){wt.initialize(e,t,{strings:["pdfjs-free-text-default-content"]});const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case y.FREETEXT_SIZE:os._defaultFontSize=t;break;case y.FREETEXT_COLOR:os._defaultColor=t}}updateParams(e,t){switch(e){case y.FREETEXT_SIZE:this.#ts(t);break;case y.FREETEXT_COLOR:this.#ns(t)}}static get defaultPropertiesToUpdate(){return[[y.FREETEXT_SIZE,os._defaultFontSize],[y.FREETEXT_COLOR,os._defaultColor||wt._defaultLineColor]]}get propertiesToUpdate(){return[[y.FREETEXT_SIZE,this.#Ri],[y.FREETEXT_COLOR,this.#yi]]}#ts(e){const t=e=>{this.editorDiv.style.fontSize=`calc(${e}px * var(--scale-factor))`,this.translate(0,-(e-this.#Ri)*this.parentScale),this.#Ri=e,this.#is()},n=this.#Ri;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#ns(e){const t=e=>{this.#yi=this.editorDiv.style.color=e},n=this.#yi;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-os._internalPadding*e,-(os._internalPadding+this.#Ri)*e]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(v.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant");const e=this._uiManager._signal;this.editorDiv.addEventListener("keydown",this.#Qi,{signal:e}),this.editorDiv.addEventListener("focus",this.#Ki,{signal:e}),this.editorDiv.addEventListener("blur",this.#Gi,{signal:e}),this.editorDiv.addEventListener("input",this.#Xi,{signal:e}),this.editorDiv.addEventListener("paste",this.#Yi,{signal:e})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#Zi),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#Qi),this.editorDiv.removeEventListener("focus",this.#Ki),this.editorDiv.removeEventListener("blur",this.#Gi),this.editorDiv.removeEventListener("input",this.#Xi),this.editorDiv.removeEventListener("paste",this.#Yi),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#ss(){const e=[];this.editorDiv.normalize();for(const t of this.editorDiv.childNodes)e.push(os.#rs(t));return e.join("\n")}#is(){const[e,t]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:e,div:t}=this,i=t.style.display,s=t.classList.contains("hidden");t.classList.remove("hidden"),t.style.display="hidden",e.div.append(this.div),n=t.getBoundingClientRect(),t.remove(),t.style.display=i,t.classList.toggle("hidden",s)}this.rotation%180===this.parentRotation%180?(this.width=n.width/e,this.height=n.height/t):(this.width=n.height/e,this.height=n.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#Ji,t=this.#Ji=this.#ss().trimEnd();if(e===t)return;const n=e=>{this.#Ji=e,e?(this.#as(),this._uiManager.rebuild(this),this.#is()):this.remove()};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),this.#is()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){os._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#Zi),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),wt._l10nPromise.get("pdfjs-free-text-default-content").then((e=>this.editorDiv?.setAttribute("default-content",e))),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#Ri}px * var(--scale-factor))`,n.color=this.#yi,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),dt(this,this.div,["dblclick","keydown"]),this.width){const[n,i]=this.parentDimensions;if(this.annotationElementId){const{position:s}=this.#es;let[r,a]=this.getInitialTranslation();[r,a]=this.pageTranslationToScreen(r,a);const[o,l]=this.pageDimensions,[c,u]=this.pageTranslation;let h,d;switch(this.rotation){case 0:h=e+(s[0]-c)/o,d=t+this.height-(s[1]-u)/l;break;case 90:h=e+(s[0]-c)/o,d=t-(s[1]-u)/l,[r,a]=[a,-r];break;case 180:h=e-this.width+(s[0]-c)/o,d=t-(s[1]-u)/l,[r,a]=[-r,-a];break;case 270:h=e+(s[0]-c-this.height*l)/o,d=t+(s[1]-u-this.width*o)/l,[r,a]=[-a,r]}this.setAt(h*n,d*i,r,a)}else this.setAt(e*n,t*i,this.width*n,this.height*i);this.#as(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#rs(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(as,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:n}=t;if(1===n.length&&"text/plain"===n[0])return;e.preventDefault();const i=os.#os(t.getData("text")||"").replaceAll(as,"\n");if(!i)return;const s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();const r=s.getRangeAt(0);if(!i.includes("\n"))return r.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),void s.collapseToStart();const{startContainer:a,startOffset:o}=r,l=[],c=[];if(a.nodeType===Node.TEXT_NODE){const e=a.parentElement;if(c.push(a.nodeValue.slice(o).replaceAll(as,"")),e!==this.editorDiv){let t=l;for(const n of this.editorDiv.childNodes)n!==e?t.push(os.#rs(n)):t=c}l.push(a.nodeValue.slice(0,o).replaceAll(as,""))}else if(a===this.editorDiv){let e=l,t=0;for(const n of this.editorDiv.childNodes)t++===o&&(e=c),e.push(os.#rs(n))}this.#Ji=`${l.join("\n")}${i}${c.join("\n")}`,this.#as();const u=new Range;let h=l.reduce(((e,t)=>e+t.length),0);for(const{firstChild:d}of this.editorDiv.childNodes)if(d.nodeType===Node.TEXT_NODE){const e=d.nodeValue.length;if(h<=e){u.setStart(d,h),u.setEnd(d,h);break}h-=e}s.removeAllRanges(),s.addRange(u)}#as(){if(this.editorDiv.replaceChildren(),this.#Ji)for(const e of this.#Ji.split("\n")){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#ls(){return this.#Ji.replaceAll("\xa0"," ")}static#os(e){return e.replaceAll(" ","\xa0")}get contentDiv(){return this.editorDiv}static deserialize(e,t,n){let i=null;if(e instanceof qi){const{data:{defaultAppearanceData:{fontSize:t,fontColor:n},rect:s,rotation:r,id:a},textContent:o,textPosition:l,parent:{page:{pageNumber:c}}}=e;if(!o||0===o.length)return null;i=e={annotationType:v.FREETEXT,color:Array.from(n),fontSize:t,value:o.join("\n"),position:l,pageIndex:c-1,rect:s.slice(0),rotation:r,id:a,deleted:!1}}const s=super.deserialize(e,t,n);return s.#Ri=e.fontSize,s.#yi=Ae.makeHexColor(...e.color),s.#Ji=os.#os(e.value),s.annotationElementId=e.id||null,s.#es=i,s}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const t=os._internalPadding*this.parentScale,n=this.getRect(t,t),i=wt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#yi),s={annotationType:v.FREETEXT,color:i,fontSize:this.#Ri,value:this.#ls(),pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?s:this.annotationElementId&&!this.#cs(s)?null:(s.id=this.annotationElementId,s)}#cs(e){const{value:t,fontSize:n,color:i,pageIndex:s}=this.#es;return this._hasBeenMoved||e.value!==t||e.fontSize!==n||e.color.some(((e,t)=>e!==i[t]))||e.pageIndex!==s}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(this.deleted)return t;const{style:n}=t;n.fontSize=`calc(${this.#Ri}px * var(--scale-factor))`,n.color=this.#yi,t.replaceChildren();for(const s of this.#Ji.split("\n")){const e=document.createElement("div");e.append(s?document.createTextNode(s):document.createElement("br")),t.append(e)}const i=os._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(i,i),popupContent:this.#Ji}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class ls{#us;#hs=[];#ds=[];constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=1/0,r=-1/0,a=1/0,o=-1/0;const l=10**-4;for(const{x:g,y:m,width:v,height:y}of e){const e=Math.floor((g-t)/l)*l,n=Math.ceil((g+v+t)/l)*l,i=Math.floor((m-t)/l)*l,c=Math.ceil((m+y+t)/l)*l,u=[e,i,c,!0],h=[n,i,c,!1];this.#hs.push(u,h),s=Math.min(s,e),r=Math.max(r,n),a=Math.min(a,i),o=Math.max(o,c)}const c=r-s+2*n,u=o-a+2*n,h=s-n,d=a-n,p=this.#hs.at(i?-1:-2),f=[p[0],p[2]];for(const g of this.#hs){const[e,t,n]=g;g[0]=(e-h)/c,g[1]=(t-d)/u,g[2]=(n-d)/u}this.#us={x:h,y:d,width:c,height:u,lastPoint:f}}getOutlines(){this.#hs.sort(((e,t)=>e[0]-t[0]||e[1]-t[1]||e[2]-t[2]));const e=[];for(const t of this.#hs)t[3]?(e.push(...this.#ps(t)),this.#fs(t)):(this.#gs(t),e.push(...this.#ps(t)));return this.#ms(e)}#ms(e){const t=[],n=new Set;for(const r of e){const[e,n,i]=r;t.push([e,n,r],[e,i,r])}t.sort(((e,t)=>e[1]-t[1]||e[0]-t[0]));for(let r=0,a=t.length;r<a;r+=2){const e=t[r][2],i=t[r+1][2];e.push(i),i.push(e),n.add(e),n.add(i)}const i=[];let s;for(;n.size>0;){const e=n.values().next().value;let[t,r,a,o,l]=e;n.delete(e);let c=t,u=r;for(s=[t,a],i.push(s);;){let e;if(n.has(o))e=o;else{if(!n.has(l))break;e=l}n.delete(e),[t,r,a,o,l]=e,c!==t&&(s.push(c,u,t,u===r?r:a),c=t),u=u===r?a:r}s.push(c,u)}return new us(i,this.#us)}#vs(e){const t=this.#ds;let n=0,i=t.length-1;for(;n<=i;){const s=n+i>>1,r=t[s][0];if(r===e)return s;r<e?n=s+1:i=s-1}return i+1}#fs(e){let[,t,n]=e;const i=this.#vs(t);this.#ds.splice(i,0,[t,n])}#gs(e){let[,t,n]=e;const i=this.#vs(t);for(let s=i;s<this.#ds.length;s++){const[e,i]=this.#ds[s];if(e!==t)break;if(e===t&&i===n)return void this.#ds.splice(s,1)}for(let s=i-1;s>=0;s--){const[e,i]=this.#ds[s];if(e!==t)break;if(e===t&&i===n)return void this.#ds.splice(s,1)}}#ps(e){const[t,n,i]=e,s=[[t,n,i]],r=this.#vs(i);for(let a=0;a<r;a++){const[e,n]=this.#ds[a];for(let i=0,r=s.length;i<r;i++){const[,a,o]=s[i];if(!(n<=a||o<=e))if(a>=e)if(o>n)s[i][1]=n;else{if(1===r)return[];s.splice(i,1),i--,r--}else s[i][2]=e,o>n&&s.push([t,n,o])}}return s}}class cs{toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(e,t){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof ds}}class us extends cs{#us;#ys;constructor(e,t){super(),this.#ys=e,this.#us=t}toSVGPath(){const e=[];for(const t of this.#ys){let[n,i]=t;e.push(`M${n} ${i}`);for(let s=2;s<t.length;s+=2){const r=t[s],a=t[s+1];r===n?(e.push(`V${a}`),i=a):a===i&&(e.push(`H${r}`),n=r)}e.push("Z")}return e.join(" ")}serialize(e,t){let[n,i,s,r]=e;const a=[],o=s-n,l=r-i;for(const c of this.#ys){const e=new Array(c.length);for(let t=0;t<c.length;t+=2)e[t]=n+c[t]*o,e[t+1]=r-c[t+1]*l;a.push(e)}return a}get box(){return this.#us}}class hs{#us;#bs=[];#ws;#_s;#As=[];#Es=(()=>new Float64Array(18))();#Ss;#Cs;#Ts;#xs;#ks;#Is;#Ps=[];static#Rs=8;static#Ds=2;static#Ms=(()=>hs.#Rs+hs.#Ds)();constructor(e,t,n,i,s){let{x:r,y:a}=e,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.#us=t,this.#Is=i*n,this.#_s=s,this.#Es.set([NaN,NaN,NaN,NaN,r,a],6),this.#ws=o,this.#xs=hs.#Rs*n,this.#Ts=hs.#Ms*n,this.#ks=n,this.#Ps.push(r,a)}get free(){return!0}isEmpty(){return isNaN(this.#Es[8])}#Ns(){const e=this.#Es.subarray(4,6),t=this.#Es.subarray(16,18),[n,i,s,r]=this.#us;return[(this.#Ss+(e[0]-t[0])/2-n)/s,(this.#Cs+(e[1]-t[1])/2-i)/r,(this.#Ss+(t[0]-e[0])/2-n)/s,(this.#Cs+(t[1]-e[1])/2-i)/r]}add(e){let{x:t,y:n}=e;this.#Ss=t,this.#Cs=n;const[i,s,r,a]=this.#us;let[o,l,c,u]=this.#Es.subarray(8,12);const h=t-c,d=n-u,p=Math.hypot(h,d);if(p<this.#Ts)return!1;const f=p-this.#xs,g=f/p,m=g*h,v=g*d;let y=o,b=l;o=c,l=u,c+=m,u+=v,this.#Ps?.push(t,n);const w=m/f,_=-v/f*this.#Is,A=w*this.#Is;if(this.#Es.set(this.#Es.subarray(2,8),0),this.#Es.set([c+_,u+A],4),this.#Es.set(this.#Es.subarray(14,18),12),this.#Es.set([c-_,u-A],16),isNaN(this.#Es[6]))return 0===this.#As.length&&(this.#Es.set([o+_,l+A],2),this.#As.push(NaN,NaN,NaN,NaN,(o+_-i)/r,(l+A-s)/a),this.#Es.set([o-_,l-A],14),this.#bs.push(NaN,NaN,NaN,NaN,(o-_-i)/r,(l-A-s)/a)),this.#Es.set([y,b,o,l,c,u],6),!this.isEmpty();this.#Es.set([y,b,o,l,c,u],6);return Math.abs(Math.atan2(b-l,y-o)-Math.atan2(v,m))<Math.PI/2?([o,l,c,u]=this.#Es.subarray(2,6),this.#As.push(NaN,NaN,NaN,NaN,((o+c)/2-i)/r,((l+u)/2-s)/a),[o,l,y,b]=this.#Es.subarray(14,18),this.#bs.push(NaN,NaN,NaN,NaN,((y+o)/2-i)/r,((b+l)/2-s)/a),!0):([y,b,o,l,c,u]=this.#Es.subarray(0,6),this.#As.push(((y+5*o)/6-i)/r,((b+5*l)/6-s)/a,((5*o+c)/6-i)/r,((5*l+u)/6-s)/a,((o+c)/2-i)/r,((l+u)/2-s)/a),[c,u,o,l,y,b]=this.#Es.subarray(12,18),this.#bs.push(((y+5*o)/6-i)/r,((b+5*l)/6-s)/a,((5*o+c)/6-i)/r,((5*l+u)/6-s)/a,((o+c)/2-i)/r,((l+u)/2-s)/a),!0)}toSVGPath(){if(this.isEmpty())return"";const e=this.#As,t=this.#bs,n=this.#Es.subarray(4,6),i=this.#Es.subarray(16,18),[s,r,a,o]=this.#us,[l,c,u,h]=this.#Ns();if(isNaN(this.#Es[6])&&!this.isEmpty())return`M${(this.#Es[2]-s)/a} ${(this.#Es[3]-r)/o} L${(this.#Es[4]-s)/a} ${(this.#Es[5]-r)/o} L${l} ${c} L${u} ${h} L${(this.#Es[16]-s)/a} ${(this.#Es[17]-r)/o} L${(this.#Es[14]-s)/a} ${(this.#Es[15]-r)/o} Z`;const d=[];d.push(`M${e[4]} ${e[5]}`);for(let p=6;p<e.length;p+=6)isNaN(e[p])?d.push(`L${e[p+4]} ${e[p+5]}`):d.push(`C${e[p]} ${e[p+1]} ${e[p+2]} ${e[p+3]} ${e[p+4]} ${e[p+5]}`);d.push(`L${(n[0]-s)/a} ${(n[1]-r)/o} L${l} ${c} L${u} ${h} L${(i[0]-s)/a} ${(i[1]-r)/o}`);for(let p=t.length-6;p>=6;p-=6)isNaN(t[p])?d.push(`L${t[p+4]} ${t[p+5]}`):d.push(`C${t[p]} ${t[p+1]} ${t[p+2]} ${t[p+3]} ${t[p+4]} ${t[p+5]}`);return d.push(`L${t[4]} ${t[5]} Z`),d.join(" ")}getOutlines(){const e=this.#As,t=this.#bs,n=this.#Es,i=n.subarray(4,6),s=n.subarray(16,18),[r,a,o,l]=this.#us,c=new Float64Array((this.#Ps?.length??0)+2);for(let m=0,v=c.length-2;m<v;m+=2)c[m]=(this.#Ps[m]-r)/o,c[m+1]=(this.#Ps[m+1]-a)/l;c[c.length-2]=(this.#Ss-r)/o,c[c.length-1]=(this.#Cs-a)/l;const[u,h,d,p]=this.#Ns();if(isNaN(n[6])&&!this.isEmpty()){const e=new Float64Array(36);return e.set([NaN,NaN,NaN,NaN,(n[2]-r)/o,(n[3]-a)/l,NaN,NaN,NaN,NaN,(n[4]-r)/o,(n[5]-a)/l,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,d,p,NaN,NaN,NaN,NaN,(n[16]-r)/o,(n[17]-a)/l,NaN,NaN,NaN,NaN,(n[14]-r)/o,(n[15]-a)/l],0),new ds(e,c,this.#us,this.#ks,this.#ws,this.#_s)}const f=new Float64Array(this.#As.length+24+this.#bs.length);let g=e.length;for(let m=0;m<g;m+=2)isNaN(e[m])?f[m]=f[m+1]=NaN:(f[m]=e[m],f[m+1]=e[m+1]);f.set([NaN,NaN,NaN,NaN,(i[0]-r)/o,(i[1]-a)/l,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,d,p,NaN,NaN,NaN,NaN,(s[0]-r)/o,(s[1]-a)/l],g),g+=24;for(let m=t.length-6;m>=6;m-=6)for(let e=0;e<6;e+=2)isNaN(t[m+e])?(f[g]=f[g+1]=NaN,g+=2):(f[g]=t[m+e],f[g+1]=t[m+e+1],g+=2);return f.set([NaN,NaN,NaN,NaN,t[4],t[5]],g),new ds(f,c,this.#us,this.#ks,this.#ws,this.#_s)}}class ds extends cs{#us;#Ls=null;#ws;#_s;#Ps;#ks;#Os;constructor(e,t,n,i,s,r){super(),this.#Os=e,this.#Ps=t,this.#us=n,this.#ks=i,this.#ws=s,this.#_s=r,this.#Fs(r);const{x:a,y:o,width:l,height:c}=this.#Ls;for(let u=0,h=e.length;u<h;u+=2)e[u]=(e[u]-a)/l,e[u+1]=(e[u+1]-o)/c;for(let u=0,h=t.length;u<h;u+=2)t[u]=(t[u]-a)/l,t[u+1]=(t[u+1]-o)/c}toSVGPath(){const e=[`M${this.#Os[4]} ${this.#Os[5]}`];for(let t=6,n=this.#Os.length;t<n;t+=6)isNaN(this.#Os[t])?e.push(`L${this.#Os[t+4]} ${this.#Os[t+5]}`):e.push(`C${this.#Os[t]} ${this.#Os[t+1]} ${this.#Os[t+2]} ${this.#Os[t+3]} ${this.#Os[t+4]} ${this.#Os[t+5]}`);return e.push("Z"),e.join(" ")}serialize(e,t){let[n,i,s,r]=e;const a=s-n,o=r-i;let l,c;switch(t){case 0:l=this.#Us(this.#Os,n,r,a,-o),c=this.#Us(this.#Ps,n,r,a,-o);break;case 90:l=this.#zs(this.#Os,n,i,a,o),c=this.#zs(this.#Ps,n,i,a,o);break;case 180:l=this.#Us(this.#Os,s,i,-a,o),c=this.#Us(this.#Ps,s,i,-a,o);break;case 270:l=this.#zs(this.#Os,s,r,-a,-o),c=this.#zs(this.#Ps,s,r,-a,-o)}return{outline:Array.from(l),points:[Array.from(c)]}}#Us(e,t,n,i,s){const r=new Float64Array(e.length);for(let a=0,o=e.length;a<o;a+=2)r[a]=t+e[a]*i,r[a+1]=n+e[a+1]*s;return r}#zs(e,t,n,i,s){const r=new Float64Array(e.length);for(let a=0,o=e.length;a<o;a+=2)r[a]=t+e[a+1]*i,r[a+1]=n+e[a]*s;return r}#Fs(e){const t=this.#Os;let n=t[4],i=t[5],s=n,r=i,a=n,o=i,l=n,c=i;const u=e?Math.max:Math.min;for(let g=6,m=t.length;g<m;g+=6){if(isNaN(t[g]))s=Math.min(s,t[g+4]),r=Math.min(r,t[g+5]),a=Math.max(a,t[g+4]),o=Math.max(o,t[g+5]),c<t[g+5]?(l=t[g+4],c=t[g+5]):c===t[g+5]&&(l=u(l,t[g+4]));else{const e=Ae.bezierBoundingBox(n,i,...t.slice(g,g+6));s=Math.min(s,e[0]),r=Math.min(r,e[1]),a=Math.max(a,e[2]),o=Math.max(o,e[3]),c<e[3]?(l=e[2],c=e[3]):c===e[3]&&(l=u(l,e[2]))}n=t[g+4],i=t[g+5]}const h=s-this.#ws,d=r-this.#ws,p=a-s+2*this.#ws,f=o-r+2*this.#ws;this.#Ls={x:h,y:d,width:p,height:f,lastPoint:[l,c]}}get box(){return this.#Ls}getNewOutline(e,t){const{x:n,y:i,width:s,height:r}=this.#Ls,[a,o,l,c]=this.#us,u=s*l,h=r*c,d=n*l+a,p=i*c+o,f=new hs({x:this.#Ps[0]*u+d,y:this.#Ps[1]*h+p},this.#us,this.#ks,e,this.#_s,t??this.#ws);for(let g=2;g<this.#Ps.length;g+=2)f.add({x:this.#Ps[g]*u+d,y:this.#Ps[g+1]*h+p});return f.getOutlines()}}class ps{#ui=this.#hi.bind(this);#Vs=this.#o.bind(this);#Bs=null;#js=null;#Hs;#$s=null;#qs=!1;#Ws=!1;#r=null;#Gs;#p=null;#Ks;static get _keyboardManager(){return le(this,"_keyboardManager",new mt([[["Escape","mac+Escape"],ps.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ps.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ps.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ps.prototype._moveToPrevious],[["Home","mac+Home"],ps.prototype._moveToBeginning],[["End","mac+End"],ps.prototype._moveToEnd]]))}constructor(e){let{editor:t=null,uiManager:n=null}=e;t?(this.#Ws=!1,this.#Ks=y.HIGHLIGHT_COLOR,this.#r=t):(this.#Ws=!0,this.#Ks=y.HIGHLIGHT_DEFAULT_COLOR),this.#p=t?._uiManager||n,this.#Gs=this.#p._eventBus,this.#Hs=t?.color||this.#p?.highlightColors.values().next().value||"#FFFF98"}renderButton(){const e=this.#Bs=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=this.#p._signal;e.addEventListener("click",this.#Xs.bind(this),{signal:t}),e.addEventListener("keydown",this.#ui,{signal:t});const n=this.#js=document.createElement("span");return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=this.#Hs,e.append(n),e}renderMainDropdown(){const e=this.#$s=this.#Qs();return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}#Qs(){const e=document.createElement("div"),t=this.#p._signal;e.addEventListener("contextmenu",tt,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[n,i]of this.#p.highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",i),s.title=n,s.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${n}`);const r=document.createElement("span");s.append(r),r.className="swatch",r.style.backgroundColor=i,s.setAttribute("aria-selected",i===this.#Hs),s.addEventListener("click",this.#Ys.bind(this,i),{signal:t}),e.append(s)}return e.addEventListener("keydown",this.#ui,{signal:t}),e}#Ys(e,t){t.stopPropagation(),this.#Gs.dispatch("switchannotationeditorparams",{source:this,type:this.#Ks,value:e})}_colorSelectFromKeyboard(e){if(e.target===this.#Bs)return void this.#Xs(e);const t=e.target.getAttribute("data-color");t&&this.#Ys(t,e)}_moveToNext(e){this.#Js?e.target!==this.#Bs?e.target.nextSibling?.focus():this.#$s.firstChild?.focus():this.#Xs(e)}_moveToPrevious(e){e.target!==this.#$s?.firstChild&&e.target!==this.#Bs?(this.#Js||this.#Xs(e),e.target.previousSibling?.focus()):this.#Js&&this._hideDropdownFromKeyboard()}_moveToBeginning(e){this.#Js?this.#$s.firstChild?.focus():this.#Xs(e)}_moveToEnd(e){this.#Js?this.#$s.lastChild?.focus():this.#Xs(e)}#hi(e){ps._keyboardManager.exec(this,e)}#Xs(e){if(this.#Js)return void this.hideDropdown();if(this.#qs=0===e.detail,window.addEventListener("pointerdown",this.#Vs,{signal:this.#p._signal}),this.#$s)return void this.#$s.classList.remove("hidden");const t=this.#$s=this.#Qs();this.#Bs.append(t)}#o(e){this.#$s?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#$s?.classList.add("hidden"),window.removeEventListener("pointerdown",this.#Vs)}get#Js(){return this.#$s&&!this.#$s.classList.contains("hidden")}_hideDropdownFromKeyboard(){this.#Ws||(this.#Js?(this.hideDropdown(),this.#Bs.focus({preventScroll:!0,focusVisible:this.#qs})):this.#r?.unselect())}updateColor(e){if(this.#js&&(this.#js.style.backgroundColor=e),!this.#$s)return;const t=this.#p.highlightColors.values();for(const n of this.#$s.children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){this.#Bs?.remove(),this.#Bs=null,this.#js=null,this.#$s?.remove(),this.#$s=null}}class fs extends wt{#Zs=null;#er=0;#tr;#nr=null;#s=null;#ir=null;#sr=null;#rr=0;#ar=null;#or=null;#v=null;#lr=!1;#oe=this.#cr.bind(this);#ur=null;#hr;#dr=null;#pr="";#Is;#fr="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _l10nPromise;static _type="highlight";static _editorType=(()=>v.HIGHLIGHT)();static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=fs.prototype;return le(this,"_keyboardManager",new mt([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||fs._defaultColor,this.#Is=e.thickness||fs._defaultThickness,this.#hr=e.opacity||fs._defaultOpacity,this.#tr=e.boxes||null,this.#fr=e.methodOfCreation||"",this.#pr=e.text||"",this._isDraggable=!1,e.highlightId>-1?(this.#lr=!0,this.#gr(e),this.#mr()):(this.#Zs=e.anchorNode,this.#er=e.anchorOffset,this.#sr=e.focusNode,this.#rr=e.focusOffset,this.#vr(),this.#mr(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#lr?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#Is,methodOfCreation:this.#fr}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#vr(){const e=new ls(this.#tr,.001);this.#or=e.getOutlines(),({x:this.x,y:this.y,width:this.width,height:this.height}=this.#or.box);const t=new ls(this.#tr,.0025,.001,"ltr"===this._uiManager.direction);this.#ir=t.getOutlines();const{lastPoint:n}=this.#ir.box;this.#ur=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#gr(e){let{highlightOutlines:t,highlightId:n,clipPathId:i}=e;this.#or=t;if(this.#ir=t.getNewOutline(this.#Is/2+1.5,.0025),n>=0)this.#v=n,this.#nr=i,this.parent.drawLayer.finalizeLine(n,t),this.#dr=this.parent.drawLayer.highlightOutline(this.#ir);else if(this.parent){const e=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(this.#v,t),this.parent.drawLayer.updateBox(this.#v,fs.#yr(this.#or.box,(e-this.rotation+360)%360)),this.parent.drawLayer.updateLine(this.#dr,this.#ir),this.parent.drawLayer.updateBox(this.#dr,fs.#yr(this.#ir.box,e))}const{x:s,y:r,width:a,height:o}=t.box;switch(this.rotation){case 0:this.x=s,this.y=r,this.width=a,this.height=o;break;case 90:{const[e,t]=this.parentDimensions;this.x=r,this.y=1-s,this.width=a*t/e,this.height=o*e/t;break}case 180:this.x=1-s,this.y=1-r,this.width=a,this.height=o;break;case 270:{const[e,t]=this.parentDimensions;this.x=1-r,this.y=s,this.width=a*t/e,this.height=o*e/t;break}}const{lastPoint:l}=this.#ir.box;this.#ur=[(l[0]-s)/a,(l[1]-r)/o]}static initialize(e,t){wt.initialize(e,t),fs._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case y.HIGHLIGHT_DEFAULT_COLOR:fs._defaultColor=t;break;case y.HIGHLIGHT_THICKNESS:fs._defaultThickness=t}}translateInPage(e,t){}get toolbarPosition(){return this.#ur}updateParams(e,t){switch(e){case y.HIGHLIGHT_COLOR:this.#ns(t);break;case y.HIGHLIGHT_THICKNESS:this.#br(t)}}static get defaultPropertiesToUpdate(){return[[y.HIGHLIGHT_DEFAULT_COLOR,fs._defaultColor],[y.HIGHLIGHT_THICKNESS,fs._defaultThickness]]}get propertiesToUpdate(){return[[y.HIGHLIGHT_COLOR,this.color||fs._defaultColor],[y.HIGHLIGHT_THICKNESS,this.#Is||fs._defaultThickness],[y.HIGHLIGHT_FREE,this.#lr]]}#ns(e){const t=e=>{this.color=e,this.parent?.drawLayer.changeColor(this.#v,e),this.#s?.updateColor(e)},n=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}#br(e){const t=this.#Is,n=e=>{this.#Is=e,this.#wr(e)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(this.#s=new ps({editor:this}),e.addColorPicker(this.#s)),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#_r())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#_r())}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#Ar(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#mr(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#Ar():e&&(this.#mr(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#wr(e){if(!this.#lr)return;this.#gr({highlightOutlines:this.#or.getNewOutline(e/2)}),this.fixAndSetPosition();const[t,n]=this.parentDimensions;this.setDims(this.width*t,this.height*n)}#Ar(){null!==this.#v&&this.parent&&(this.parent.drawLayer.remove(this.#v),this.#v=null,this.parent.drawLayer.remove(this.#dr),this.#dr=null)}#mr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;null===this.#v&&(({id:this.#v,clipPathId:this.#nr}=e.drawLayer.highlight(this.#or,this.color,this.#hr)),this.#dr=e.drawLayer.highlightOutline(this.#ir),this.#ar&&(this.#ar.style.clipPath=this.#nr))}static#yr(e,t){let{x:n,y:i,width:s,height:r}=e;switch(t){case 90:return{x:1-i-r,y:n,width:r,height:s};case 180:return{x:1-n-s,y:1-i-r,width:s,height:r};case 270:return{x:i,y:1-n-s,width:r,height:s}}return{x:n,y:i,width:s,height:r}}rotate(e){const{drawLayer:t}=this.parent;let n;this.#lr?(e=(e-this.rotation+360)%360,n=fs.#yr(this.#or.box,e)):n=fs.#yr(this,e),t.rotate(this.#v,e),t.rotate(this.#dr,e),t.updateBox(this.#v,n),t.updateBox(this.#dr,fs.#yr(this.#ir.box,e))}render(){if(this.div)return this.div;const e=super.render();this.#pr&&(e.setAttribute("aria-label",this.#pr),e.setAttribute("role","mark")),this.#lr?e.classList.add("free"):this.div.addEventListener("keydown",this.#oe,{signal:this._uiManager._signal});const t=this.#ar=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#nr;const[n,i]=this.parentDimensions;return this.setDims(this.width*n,this.height*i),dt(this,this.#ar,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.parent.drawLayer.addClass(this.#dr,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#dr,"hovered")}#cr(e){fs._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#Er(!0);break;case 1:case 3:this.#Er(!1)}}#Er(e){if(!this.#Zs)return;const t=window.getSelection();e?t.setPosition(this.#Zs,this.#er):t.setPosition(this.#sr,this.#rr)}select(){super.select(),this.#dr&&(this.parent?.drawLayer.removeClass(this.#dr,"hovered"),this.parent?.drawLayer.addClass(this.#dr,"selected"))}unselect(){super.unselect(),this.#dr&&(this.parent?.drawLayer.removeClass(this.#dr,"selected"),this.#lr||this.#Er(!1))}get _mustFixPosition(){return!this.#lr}show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;super.show(e),this.parent&&(this.parent.drawLayer.show(this.#v,e),this.parent.drawLayer.show(this.#dr,e))}#_r(){return this.#lr?this.rotation:0}#Sr(){if(this.#lr)return null;const[e,t]=this.pageDimensions,n=this.#tr,i=new Float32Array(8*n.length);let s=0;for(const{x:r,y:a,width:o,height:l}of n){const n=r*e,c=(1-a-l)*t;i[s]=i[s+4]=n,i[s+1]=i[s+3]=c,i[s+2]=i[s+6]=n+o*e,i[s+5]=i[s+7]=c+l*t,s+=8}return i}#Cr(e){return this.#or.serialize(e,this.#_r())}static startHighlighting(e,t,n){let{target:i,x:s,y:r}=n;const{x:a,y:o,width:l,height:c}=i.getBoundingClientRect(),u=t=>{this.#Tr(e,t)},h=e._signal,d={capture:!0,passive:!1,signal:h},p=e=>{e.preventDefault(),e.stopPropagation()},f=t=>{i.removeEventListener("pointermove",u),window.removeEventListener("blur",f),window.removeEventListener("pointerup",f),window.removeEventListener("pointerdown",p,d),window.removeEventListener("contextmenu",tt),this.#xr(e,t)};window.addEventListener("blur",f,{signal:h}),window.addEventListener("pointerup",f,{signal:h}),window.addEventListener("pointerdown",p,d),window.addEventListener("contextmenu",tt,{signal:h}),i.addEventListener("pointermove",u,{signal:h}),this._freeHighlight=new hs({x:s,y:r},[a,o,l,c],e.scale,this._defaultThickness/2,t,.001),({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0))}static#Tr(e,t){this._freeHighlight.add(t)&&e.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}static#xr(e,t){this._freeHighlight.isEmpty()?e.drawLayer.removeFreeHighlight(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(e,t,n){const i=super.deserialize(e,t,n),{rect:[s,r,a,o],color:l,quadPoints:c}=e;i.color=Ae.makeHexColor(...l),i.#hr=e.opacity;const[u,h]=i.pageDimensions;i.width=(a-s)/u,i.height=(o-r)/h;const d=i.#tr=[];for(let p=0;p<c.length;p+=8)d.push({x:(c[4]-a)/u,y:(o-(1-c[p+5]))/h,width:(c[p+2]-c[p])/u,height:(c[p+5]-c[p+1])/h});return i.#vr(),i}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty()||e)return null;const t=this.getRect(0,0),n=wt._colorManager.convert(this.color);return{annotationType:v.HIGHLIGHT,color:n,opacity:this.#hr,thickness:this.#Is,quadPoints:this.#Sr(),outlines:this.#Cr(t),pageIndex:this.pageIndex,rect:t,rotation:this.#_r(),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}}class gs extends wt{#kr=0;#Ir=0;#Pr=this.canvasPointermove.bind(this);#Rr=this.canvasPointerleave.bind(this);#Dr=this.canvasPointerup.bind(this);#Mr=this.canvasPointerdown.bind(this);#Nr=null;#Lr=(()=>new Path2D)();#Or=!1;#Fr=!1;#Ur=!1;#zr=null;#Vr=0;#Br=0;#jr=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=(()=>v.INK)();constructor(e){super({...e,name:"inkEditor"}),this.color=e.color||null,this.thickness=e.thickness||null,this.opacity=e.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(e,t){wt.initialize(e,t)}static updateDefaultParams(e,t){switch(e){case y.INK_THICKNESS:gs._defaultThickness=t;break;case y.INK_COLOR:gs._defaultColor=t;break;case y.INK_OPACITY:gs._defaultOpacity=t/100}}updateParams(e,t){switch(e){case y.INK_THICKNESS:this.#br(t);break;case y.INK_COLOR:this.#ns(t);break;case y.INK_OPACITY:this.#Hr(t)}}static get defaultPropertiesToUpdate(){return[[y.INK_THICKNESS,gs._defaultThickness],[y.INK_COLOR,gs._defaultColor||wt._defaultLineColor],[y.INK_OPACITY,Math.round(100*gs._defaultOpacity)]]}get propertiesToUpdate(){return[[y.INK_THICKNESS,this.thickness||gs._defaultThickness],[y.INK_COLOR,this.color||gs._defaultColor||wt._defaultLineColor],[y.INK_OPACITY,Math.round(100*(this.opacity??gs._defaultOpacity))]]}#br(e){const t=e=>{this.thickness=e,this.#$r()},n=this.thickness;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#ns(e){const t=e=>{this.color=e,this.#qr()},n=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#Hr(e){const t=e=>{this.opacity=e,this.#qr()};e/=100;const n=this.opacity;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:y.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.canvas||(this.#Wr(),this.#Gr()),this.isAttachedToDOM||(this.parent.add(this),this.#Kr()),this.#$r()))}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#Nr&&(clearTimeout(this.#Nr),this.#Nr=null),this.#zr?.disconnect(),this.#zr=null,super.remove())}setParent(e){!this.parent&&e?this._uiManager.removeShouldRescale(this):this.parent&&null===e&&this._uiManager.addShouldRescale(this),super.setParent(e)}onScaleChanging(){const[e,t]=this.parentDimensions,n=this.width*e,i=this.height*t;this.setDimensions(n,i)}enableEditMode(){this.#Or||null===this.canvas||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#Mr,{signal:this._uiManager._signal}))}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#Mr))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}#Xr(){const{parentRotation:e,parentDimensions:[t,n]}=this;switch(e){case 90:return[0,n,n,t];case 180:return[t,n,t,n];case 270:return[t,0,n,t];default:return[0,0,t,n]}}#Qr(){const{ctx:e,color:t,opacity:n,thickness:i,parentScale:s,scaleFactor:r}=this;e.lineWidth=i*s/r,e.lineCap="round",e.lineJoin="round",e.miterLimit=10,e.strokeStyle=`${t}${function(e){return Math.round(Math.min(255,Math.max(1,255*e))).toString(16).padStart(2,"0")}(n)}`}#Yr(e,t){const n=this._uiManager._signal;this.canvas.addEventListener("contextmenu",tt,{signal:n}),this.canvas.addEventListener("pointerleave",this.#Rr,{signal:n}),this.canvas.addEventListener("pointermove",this.#Pr,{signal:n}),this.canvas.addEventListener("pointerup",this.#Dr,{signal:n}),this.canvas.removeEventListener("pointerdown",this.#Mr),this.isEditing=!0,this.#Ur||(this.#Ur=!0,this.#Kr(),this.thickness||=gs._defaultThickness,this.color||=gs._defaultColor||wt._defaultLineColor,this.opacity??=gs._defaultOpacity),this.currentPath.push([e,t]),this.#Fr=!1,this.#Qr(),this.#jr=()=>{this.#Jr(),this.#jr&&window.requestAnimationFrame(this.#jr)},window.requestAnimationFrame(this.#jr)}#Zr(e,t){const[n,i]=this.currentPath.at(-1);if(this.currentPath.length>1&&e===n&&t===i)return;const s=this.currentPath;let r=this.#Lr;if(s.push([e,t]),this.#Fr=!0,s.length<=2)return r.moveTo(...s[0]),void r.lineTo(e,t);3===s.length&&(this.#Lr=r=new Path2D,r.moveTo(...s[0])),this.#ea(r,...s.at(-3),...s.at(-2),e,t)}#ta(){if(0===this.currentPath.length)return;const e=this.currentPath.at(-1);this.#Lr.lineTo(...e)}#na(e,t){let n;if(this.#jr=null,e=Math.min(Math.max(e,0),this.canvas.width),t=Math.min(Math.max(t,0),this.canvas.height),this.#Zr(e,t),this.#ta(),1!==this.currentPath.length)n=this.#ia();else{const i=[e,t];n=[[i,i.slice(),i.slice(),i]]}const i=this.#Lr,s=this.currentPath;this.currentPath=[],this.#Lr=new Path2D;this.addCommands({cmd:()=>{this.allRawPaths.push(s),this.paths.push(n),this.bezierPath2D.push(i),this._uiManager.rebuild(this)},undo:()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(this.#Wr(),this.#Gr()),this.#$r())},mustExec:!0})}#Jr(){if(!this.#Fr)return;this.#Fr=!1;const e=Math.ceil(this.thickness*this.parentScale),t=this.currentPath.slice(-3),n=t.map((e=>e[0])),i=t.map((e=>e[1])),{ctx:s}=(Math.min(...n),Math.max(...n),Math.min(...i),Math.max(...i),this);s.save(),s.clearRect(0,0,this.canvas.width,this.canvas.height);for(const r of this.bezierPath2D)s.stroke(r);s.stroke(this.#Lr),s.restore()}#ea(e,t,n,i,s,r,a){const o=(t+i)/2,l=(n+s)/2,c=(i+r)/2,u=(s+a)/2;e.bezierCurveTo(o+2*(i-o)/3,l+2*(s-l)/3,c+2*(i-c)/3,u+2*(s-u)/3,c,u)}#ia(){const e=this.currentPath;if(e.length<=2)return[[e[0],e[0],e.at(-1),e.at(-1)]];const t=[];let n,[i,s]=e[0];for(n=1;n<e.length-2;n++){const[r,a]=e[n],[o,l]=e[n+1],c=(r+o)/2,u=(a+l)/2,h=[i+2*(r-i)/3,s+2*(a-s)/3],d=[c+2*(r-c)/3,u+2*(a-u)/3];t.push([[i,s],h,d,[c,u]]),[i,s]=[c,u]}const[r,a]=e[n],[o,l]=e[n+1],c=[i+2*(r-i)/3,s+2*(a-s)/3],u=[o+2*(r-o)/3,l+2*(a-l)/3];return t.push([[i,s],c,u,[o,l]]),t}#qr(){if(this.isEmpty())return void this.#sa();this.#Qr();const{canvas:e,ctx:t}=this;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),this.#sa();for(const n of this.bezierPath2D)t.stroke(n)}commit(){this.#Or||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#Or=!0,this.div.classList.add("disabled"),this.#$r(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),this.enableEditMode())}canvasPointerdown(e){0===e.button&&this.isInEditMode()&&!this.#Or&&(this.setInForeground(),e.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#Yr(e.offsetX,e.offsetY))}canvasPointermove(e){e.preventDefault(),this.#Zr(e.offsetX,e.offsetY)}canvasPointerup(e){e.preventDefault(),this.#ra(e)}canvasPointerleave(e){this.#ra(e)}#ra(e){this.canvas.removeEventListener("pointerleave",this.#Rr),this.canvas.removeEventListener("pointermove",this.#Pr),this.canvas.removeEventListener("pointerup",this.#Dr),this.canvas.addEventListener("pointerdown",this.#Mr,{signal:this._uiManager._signal}),this.#Nr&&clearTimeout(this.#Nr),this.#Nr=setTimeout((()=>{this.#Nr=null,this.canvas.removeEventListener("contextmenu",tt)}),10),this.#na(e.offsetX,e.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#Wr(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#Gr(){this.#zr=new ResizeObserver((e=>{const t=e[0].contentRect;t.width&&t.height&&this.setDimensions(t.width,t.height)})),this.#zr.observe(this.div),this._uiManager._signal.addEventListener("abort",(()=>{this.#zr?.disconnect(),this.#zr=null}),{once:!0})}get isResizable(){return!this.isEmpty()&&this.#Or}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[n,i,s,r]=this.#Xr();if(this.setAt(n,i,0,0),this.setDims(s,r),this.#Wr(),this.width){const[n,i]=this.parentDimensions;this.setAspectRatio(this.width*n,this.height*i),this.setAt(e*n,t*i,this.width*n,this.height*i),this.#Ur=!0,this.#Kr(),this.setDims(this.width*n,this.height*i),this.#qr(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#Gr(),this.div}#Kr(){if(!this.#Ur)return;const[e,t]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*t),this.#sa()}setDimensions(e,t){const n=Math.round(e),i=Math.round(t);if(this.#Vr===n&&this.#Br===i)return;this.#Vr=n,this.#Br=i,this.canvas.style.visibility="hidden";const[s,r]=this.parentDimensions;this.width=e/s,this.height=t/r,this.fixAndSetPosition(),this.#Or&&this.#aa(e,t),this.#Kr(),this.#qr(),this.canvas.style.visibility="visible",this.fixDims()}#aa(e,t){const n=this.#oa(),i=(e-n)/this.#Ir,s=(t-n)/this.#kr;this.scaleFactor=Math.min(i,s)}#sa(){const e=this.#oa()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+e,this.translationY*this.scaleFactor+e)}static#la(e){const t=new Path2D;for(let n=0,i=e.length;n<i;n++){const[i,s,r,a]=e[n];0===n&&t.moveTo(...i),t.bezierCurveTo(s[0],s[1],r[0],r[1],a[0],a[1])}return t}static#ca(e,t,n){const[i,s,r,a]=t;switch(n){case 0:for(let t=0,n=e.length;t<n;t+=2)e[t]+=i,e[t+1]=a-e[t+1];break;case 90:for(let t=0,n=e.length;t<n;t+=2){const n=e[t];e[t]=e[t+1]+i,e[t+1]=n+s}break;case 180:for(let t=0,n=e.length;t<n;t+=2)e[t]=r-e[t],e[t+1]+=s;break;case 270:for(let t=0,n=e.length;t<n;t+=2){const n=e[t];e[t]=r-e[t+1],e[t+1]=a-n}break;default:throw new Error("Invalid rotation")}return e}static#ua(e,t,n){const[i,s,r,a]=t;switch(n){case 0:for(let t=0,n=e.length;t<n;t+=2)e[t]-=i,e[t+1]=a-e[t+1];break;case 90:for(let t=0,n=e.length;t<n;t+=2){const n=e[t];e[t]=e[t+1]-s,e[t+1]=n-i}break;case 180:for(let t=0,n=e.length;t<n;t+=2)e[t]=r-e[t],e[t+1]-=s;break;case 270:for(let t=0,n=e.length;t<n;t+=2){const n=e[t];e[t]=a-e[t+1],e[t+1]=r-n}break;default:throw new Error("Invalid rotation")}return e}#ha(e,t,n,i){const s=[],r=this.thickness/2,a=e*t+r,o=e*n+r;for(const l of this.paths){const t=[],n=[];for(let i=0,s=l.length;i<s;i++){const[r,c,u,h]=l[i];if(r[0]===h[0]&&r[1]===h[1]&&1===s){const i=e*r[0]+a,s=e*r[1]+o;t.push(i,s),n.push(i,s);break}const d=e*r[0]+a,p=e*r[1]+o,f=e*c[0]+a,g=e*c[1]+o,m=e*u[0]+a,v=e*u[1]+o,y=e*h[0]+a,b=e*h[1]+o;0===i&&(t.push(d,p),n.push(d,p)),t.push(f,g,m,v,y,b),n.push(f,g),i===s-1&&n.push(y,b)}s.push({bezier:gs.#ca(t,i,this.rotation),points:gs.#ca(n,i,this.rotation)})}return s}#da(){let e=1/0,t=-1/0,n=1/0,i=-1/0;for(const s of this.paths)for(const[r,a,o,l]of s){const s=Ae.bezierBoundingBox(...r,...a,...o,...l);e=Math.min(e,s[0]),n=Math.min(n,s[1]),t=Math.max(t,s[2]),i=Math.max(i,s[3])}return[e,n,t,i]}#oa(){return this.#Or?Math.ceil(this.thickness*this.parentScale):0}#$r(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return;if(!this.#Or)return void this.#qr();const t=this.#da(),n=this.#oa();this.#Ir=Math.max(wt.MIN_SIZE,t[2]-t[0]),this.#kr=Math.max(wt.MIN_SIZE,t[3]-t[1]);const i=Math.ceil(n+this.#Ir*this.scaleFactor),s=Math.ceil(n+this.#kr*this.scaleFactor),[r,a]=this.parentDimensions;this.width=i/r,this.height=s/a,this.setAspectRatio(i,s);const o=this.translationX,l=this.translationY;this.translationX=-t[0],this.translationY=-t[1],this.#Kr(),this.#qr(),this.#Vr=i,this.#Br=s,this.setDims(i,s);const c=e?n/this.scaleFactor/2:0;this.translate(o-this.translationX-c,l-this.translationY-c)}static deserialize(e,t,n){if(e instanceof Ji)return null;const i=super.deserialize(e,t,n);i.thickness=e.thickness,i.color=Ae.makeHexColor(...e.color),i.opacity=e.opacity;const[s,r]=i.pageDimensions,a=i.width*s,o=i.height*r,l=i.parentScale,c=e.thickness/2;i.#Or=!0,i.#Vr=Math.round(a),i.#Br=Math.round(o);const{paths:u,rect:h,rotation:d}=e;for(let{bezier:f}of u){f=gs.#ua(f,h,d);const e=[];i.paths.push(e);let t=l*(f[0]-c),n=l*(f[1]-c);for(let i=2,r=f.length;i<r;i+=6){const s=l*(f[i]-c),r=l*(f[i+1]-c),a=l*(f[i+2]-c),o=l*(f[i+3]-c),u=l*(f[i+4]-c),h=l*(f[i+5]-c);e.push([[t,n],[s,r],[a,o],[u,h]]),t=u,n=h}const s=this.#la(e);i.bezierPath2D.push(s)}const p=i.#da();return i.#Ir=Math.max(wt.MIN_SIZE,p[2]-p[0]),i.#kr=Math.max(wt.MIN_SIZE,p[3]-p[1]),i.#aa(a,o),i}serialize(){if(this.isEmpty())return null;const e=this.getRect(0,0),t=wt._colorManager.convert(this.ctx.strokeStyle);return{annotationType:v.INK,color:t,thickness:this.thickness,opacity:this.opacity,paths:this.#ha(this.scaleFactor/this.parentScale,this.translationX,this.translationY,e),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class ms extends wt{#pa=null;#fa=null;#ga=null;#ma=null;#va=null;#ya="";#ba=null;#zr=null;#wa=null;#_a=!1;#Aa=!1;static _type="stamp";static _editorType=(()=>v.STAMP)();constructor(e){super({...e,name:"stampEditor"}),this.#ma=e.bitmapUrl,this.#va=e.bitmapFile}static initialize(e,t){wt.initialize(e,t)}static get supportedTypes(){return le(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map((e=>`image/${e}`)))}static get supportedTypesStr(){return le(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,t){t.pasteEditor(v.STAMP,{bitmapFile:e.getAsFile()})}#Ea(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?(this.#pa=e.bitmap,t||(this.#fa=e.id,this.#_a=e.isSvg),e.file&&(this.#ya=e.file.name),this.#Wr()):this.remove()}#Sa(){this.#ga=null,this._uiManager.enableWaiting(!1),this.#ba&&this.div.focus()}#Ca(){if(this.#fa)return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(this.#fa).then((e=>this.#Ea(e,!0))).finally((()=>this.#Sa()));if(this.#ma){const e=this.#ma;return this.#ma=null,this._uiManager.enableWaiting(!0),void(this.#ga=this._uiManager.imageManager.getFromUrl(e).then((e=>this.#Ea(e))).finally((()=>this.#Sa())))}if(this.#va){const e=this.#va;return this.#va=null,this._uiManager.enableWaiting(!0),void(this.#ga=this._uiManager.imageManager.getFromFile(e).then((e=>this.#Ea(e))).finally((()=>this.#Sa())))}const e=document.createElement("input");e.type="file",e.accept=ms.supportedTypesStr;const t=this._uiManager._signal;this.#ga=new Promise((n=>{e.addEventListener("change",(async()=>{if(e.files&&0!==e.files.length){this._uiManager.enableWaiting(!0);const t=await this._uiManager.imageManager.getFromFile(e.files[0]);this.#Ea(t)}else this.remove();n()}),{signal:t}),e.addEventListener("cancel",(()=>{this.remove(),n()}),{signal:t})})).finally((()=>this.#Sa())),e.click()}remove(){this.#fa&&(this.#pa=null,this._uiManager.imageManager.deleteId(this.#fa),this.#ba?.remove(),this.#ba=null,this.#zr?.disconnect(),this.#zr=null,this.#wa&&(clearTimeout(this.#wa),this.#wa=null)),super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(this.#fa&&null===this.#ba&&this.#Ca(),this.isAttachedToDOM||this.parent.add(this))):this.#fa&&this.#Ca()}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#ga||this.#pa||this.#ma||this.#va||this.#fa)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;if(this.width&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),this.#pa?this.#Wr():this.#Ca(),this.width){const[n,i]=this.parentDimensions;this.setAt(e*n,t*i,this.width*n,this.height*i)}return this.div}#Wr(){const{div:e}=this;let{width:t,height:n}=this.#pa;const[i,s]=this.pageDimensions,r=.75;if(this.width)t=this.width*i,n=this.height*s;else if(t>r*i||n>r*s){const e=Math.min(r*i/t,r*s/n);t*=e,n*=e}const[a,o]=this.parentDimensions;this.setDims(t*a/i,n*o/s),this._uiManager.enableWaiting(!1);const l=this.#ba=document.createElement("canvas");e.append(l),e.hidden=!1,this.#Ta(t,n),this.#Gr(),this.#Aa||(this.parent.addUndoableEditor(this),this.#Aa=!0),this._reportTelemetry({action:"inserted_image"}),this.#ya&&l.setAttribute("aria-label",this.#ya)}#xa(e,t){const[n,i]=this.parentDimensions;this.width=e/n,this.height=t/i,this.setDims(e,t),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,null!==this.#wa&&clearTimeout(this.#wa);this.#wa=setTimeout((()=>{this.#wa=null,this.#Ta(e,t)}),200)}#ka(e,t){const{width:n,height:i}=this.#pa;let s=n,r=i,a=this.#pa;for(;s>2*e||r>2*t;){const n=s,i=r;s>2*e&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const o=new OffscreenCanvas(s,r);o.getContext("2d").drawImage(a,0,0,n,i,0,0,s,r),a=o.transferToImageBitmap()}return a}#Ta(e,t){e=Math.ceil(e),t=Math.ceil(t);const n=this.#ba;if(!n||n.width===e&&n.height===t)return;n.width=e,n.height=t;const i=this.#_a?this.#pa:this.#ka(e,t);if(this._uiManager.hasMLManager&&!this.hasAltText()){const n=new OffscreenCanvas(e,t).getContext("2d");n.drawImage(i,0,0,i.width,i.height,0,0,e,t),this._uiManager.mlGuess({service:"image-to-text",request:{data:n.getImageData(0,0,e,t).data,width:e,height:t,channels:4}}).then((e=>{const t=e?.output||"";this.parent&&t&&!this.hasAltText()&&(this.altTextData={altText:t,decorative:!1})}))}const s=n.getContext("2d");s.filter=this._uiManager.hcmFilter,s.drawImage(i,0,0,i.width,i.height,0,0,e,t)}getImageForAltText(){return this.#ba}#Ia(e){if(e){if(this.#_a){const e=this._uiManager.imageManager.getSvgUrl(this.#fa);if(e)return e}const e=document.createElement("canvas");({width:e.width,height:e.height}=this.#pa);return e.getContext("2d").drawImage(this.#pa,0,0),e.toDataURL()}if(this.#_a){const[e,t]=this.pageDimensions,n=Math.round(this.width*e*je.PDF_TO_CSS_UNITS),i=Math.round(this.height*t*je.PDF_TO_CSS_UNITS),s=new OffscreenCanvas(n,i);return s.getContext("2d").drawImage(this.#pa,0,0,this.#pa.width,this.#pa.height,0,0,n,i),s.transferToImageBitmap()}return structuredClone(this.#pa)}#Gr(){this._uiManager._signal&&(this.#zr=new ResizeObserver((e=>{const t=e[0].contentRect;t.width&&t.height&&this.#xa(t.width,t.height)})),this.#zr.observe(this.div),this._uiManager._signal.addEventListener("abort",(()=>{this.#zr?.disconnect(),this.#zr=null}),{once:!0}))}static deserialize(e,t,n){if(e instanceof is)return null;const i=super.deserialize(e,t,n),{rect:s,bitmapUrl:r,bitmapId:a,isSvg:o,accessibilityData:l}=e;a&&n.imageManager.isValidId(a)?i.#fa=a:i.#ma=r,i.#_a=o;const[c,u]=i.pageDimensions;return i.width=(s[2]-s[0])/c,i.height=(s[3]-s[1])/u,l&&(i.altTextData=l),i}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isEmpty())return null;const n={annotationType:v.STAMP,bitmapId:this.#fa,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#_a,structTreeParentId:this._structTreeParentId};if(e)return n.bitmapUrl=this.#Ia(!0),n.accessibilityData=this.altTextData,n;const{decorative:i,altText:s}=this.altTextData;if(!i&&s&&(n.accessibilityData={type:"Figure",alt:s}),null===t)return n;t.stamps||=new Map;const r=this.#_a?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(t.stamps.has(this.#fa)){if(this.#_a){const e=t.stamps.get(this.#fa);r>e.area&&(e.area=r,e.serialized.bitmap.close(),e.serialized.bitmap=this.#Ia(!1))}}else t.stamps.set(this.#fa,{area:r,serialized:n}),n.bitmap=this.#Ia(!1);return n}}class vs{#ji;#Pa=!1;#Ra=null;#Da=null;#Ma=null;#Na=null;#La=null;#Oa=(()=>new Map)();#Fa=!1;#Ua=!1;#za=!1;#Va=null;#p;static _initialized=!1;static#F=(()=>new Map([os,gs,ms,fs].map((e=>[e._editorType,e]))))();constructor(e){let{uiManager:t,pageIndex:n,div:i,accessibilityManager:s,annotationLayer:r,drawLayer:a,textLayer:o,viewport:l,l10n:c}=e;const u=[...vs.#F.values()];if(!vs._initialized){vs._initialized=!0;for(const e of u)e.initialize(c,t)}t.registerEditorTypes(u),this.#p=t,this.pageIndex=n,this.div=i,this.#ji=s,this.#Ra=r,this.viewport=l,this.#Va=o,this.drawLayer=a,this.#p.addLayer(this)}get isEmpty(){return 0===this.#Oa.size}get isInvisible(){return this.isEmpty&&this.#p.getMode()===v.NONE}updateToolbar(e){this.#p.updateToolbar(e)}updateMode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.#p.getMode();switch(this.#Ba(),e){case v.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case v.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case v.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const n of vs.#F.values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){return e===this.#Va?.div}addInkEditorIfNeeded(e){if(this.#p.getMode()!==v.INK)return;if(!e)for(const t of this.#Oa.values())if(t.isEmpty())return void t.setInBackground();this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(e){this.#p.setEditingState(e)}addCommands(e){this.#p.addCommands(e)}togglePointerEvents(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#Ra?.div.classList.toggle("disabled",!e)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const n of this.#Oa.values())n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#p.removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!this.#Ra)return;const t=this.#Ra.getEditableAnnotations();for(const n of t){if(n.hide(),this.#p.isDeletedAnnotationElement(n.data.id))continue;if(e.has(n.data.id))continue;const t=this.deserialize(n);t&&(this.addOrRebuild(t),t.enableEditing())}}disable(){this.#za=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const i of this.#Oa.values())i.disableEditing(),i.annotationElementId&&(null===i.serialize()?(t.set(i.annotationElementId,i),this.getEditableAnnotation(i.annotationElementId)?.show(),i.remove()):e.set(i.annotationElementId,i));if(this.#Ra){const n=this.#Ra.getEditableAnnotations();for(const i of n){const{id:n}=i.data;if(this.#p.isDeletedAnnotationElement(n))continue;let s=t.get(n);s?(s.resetAnnotationElement(i),s.show(!1),i.show()):(s=e.get(n),s&&(this.#p.addChangedExistingAnnotation(s),s.renderAnnotationElement(i),s.show(!1)),i.show())}}this.#Ba(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const i of vs.#F.values())n.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#za=!1}getEditableAnnotation(e){return this.#Ra?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#p.getActive()!==e&&this.#p.setActiveEditor(e)}enableTextSelection(){this.div.tabIndex=-1,this.#Va?.div&&!this.#Na&&(this.#Na=this.#ja.bind(this),this.#Va.div.addEventListener("pointerdown",this.#Na,{signal:this.#p._signal}),this.#Va.div.classList.add("highlighting"))}disableTextSelection(){this.div.tabIndex=0,this.#Va?.div&&this.#Na&&(this.#Va.div.removeEventListener("pointerdown",this.#Na),this.#Na=null,this.#Va.div.classList.remove("highlighting"))}#ja(e){if(this.#p.unselectAll(),e.target===this.#Va.div){const{isMac:t}=we.platform;if(0!==e.button||e.ctrlKey&&t)return;this.#p.showAllEditors("highlight",!0,!0),this.#Va.div.classList.add("free"),fs.startHighlighting(this,"ltr"===this.#p.direction,e),this.#Va.div.addEventListener("pointerup",(()=>{this.#Va.div.classList.remove("free")}),{once:!0,signal:this.#p._signal}),e.preventDefault()}}enableClick(){if(this.#Ma)return;const e=this.#p._signal;this.#Ma=this.pointerdown.bind(this),this.#Da=this.pointerup.bind(this),this.div.addEventListener("pointerdown",this.#Ma,{signal:e}),this.div.addEventListener("pointerup",this.#Da,{signal:e})}disableClick(){this.#Ma&&(this.div.removeEventListener("pointerdown",this.#Ma),this.div.removeEventListener("pointerup",this.#Da),this.#Ma=null,this.#Da=null)}attach(e){this.#Oa.set(e.id,e);const{annotationElementId:t}=e;t&&this.#p.isDeletedAnnotationElement(t)&&this.#p.removeDeletedAnnotationElement(e)}detach(e){this.#Oa.delete(e.id),this.#ji?.removePointerInTextLayer(e.contentDiv),!this.#za&&e.annotationElementId&&this.#p.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#p.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1,this.#Ua||this.addInkEditorIfNeeded(!1)}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#p.addDeletedAnnotationElement(e.annotationElementId),wt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(e.parent!==this||!e.isAttachedToDOM){if(this.changeParent(e),this.#p.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(),this.#p.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#La&&(e._focusEventsAllowed=!1,this.#La=setTimeout((()=>{this.#La=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",(()=>{e._focusEventsAllowed=!0}),{once:!0,signal:this.#p._signal}),t.focus())}),0)),e._structTreeParentId=this.#ji?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){this.addCommands({cmd:()=>e._uiManager.rebuild(e),undo:()=>{e.remove()},mustExec:!1})}getNextId(){return this.#p.getId()}get#Ha(){return vs.#F.get(this.#p.getMode())}get _signal(){return this.#p._signal}#$a(e){const t=this.#Ha;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#Ha?.canCreateNewEmptyEditor()}pasteEditor(e,t){this.#p.updateToolbar(e),this.#p.updateMode(e);const{offsetX:n,offsetY:i}=this.#qa(),s=this.getNextId(),r=this.#$a({parent:this,id:s,x:n,y:i,uiManager:this.#p,isCentered:!0,...t});r&&this.add(r)}deserialize(e){return vs.#F.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#p)||null}createAndAddNewEditor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=this.getNextId(),s=this.#$a({parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:this.#p,isCentered:t,...n});return s&&this.add(s),s}#qa(){const{x:e,y:t,width:n,height:i}=this.div.getBoundingClientRect(),s=Math.max(0,e),r=Math.max(0,t),a=(s+Math.min(window.innerWidth,e+n))/2-e,o=(r+Math.min(window.innerHeight,t+i))/2-t,[l,c]=this.viewport.rotation%180===0?[a,o]:[o,a];return{offsetX:l,offsetY:c}}addNewEditor(){this.createAndAddNewEditor(this.#qa(),!0)}setSelected(e){this.#p.setSelected(e)}toggleSelected(e){this.#p.toggleSelected(e)}isSelected(e){return this.#p.isSelected(e)}unselect(e){this.#p.unselect(e)}pointerup(e){const{isMac:t}=we.platform;0!==e.button||e.ctrlKey&&t||e.target===this.div&&this.#Fa&&(this.#Fa=!1,this.#Pa?this.#p.getMode()!==v.STAMP?this.createAndAddNewEditor(e,!1):this.#p.unselectAll():this.#Pa=!0)}pointerdown(e){if(this.#p.getMode()===v.HIGHLIGHT&&this.enableTextSelection(),this.#Fa)return void(this.#Fa=!1);const{isMac:t}=we.platform;if(0!==e.button||e.ctrlKey&&t)return;if(e.target!==this.div)return;this.#Fa=!0;const n=this.#p.getActive();this.#Pa=!n||n.isEmpty()}findNewParent(e,t,n){const i=this.#p.findParent(t,n);return null!==i&&i!==this&&(i.changeParent(e),!0)}destroy(){this.#p.getActive()?.parent===this&&(this.#p.commitOrRemove(),this.#p.setActiveEditor(null)),this.#La&&(clearTimeout(this.#La),this.#La=null);for(const e of this.#Oa.values())this.#ji?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#Oa.clear(),this.#p.removeLayer(this)}#Ba(){this.#Ua=!0;for(const e of this.#Oa.values())e.isEmpty()&&e.remove();this.#Ua=!1}render(e){let{viewport:t}=e;this.viewport=t,ct(this.div,t);for(const n of this.#p.getEditors(this.pageIndex))this.add(n),n.rebuild();this.updateMode()}update(e){let{viewport:t}=e;this.#p.commitOrRemove(),this.#Ba();const n=this.viewport.rotation,i=t.rotation;if(this.viewport=t,ct(this.div,{rotation:i}),n!==i)for(const s of this.#Oa.values())s.rotate(i);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#p.viewParameters.realScale}}class ys{#Ai=null;#v=0;#Wa=(()=>new Map)();#Ga=(()=>new Map)();constructor(e){let{pageIndex:t}=e;this.pageIndex=t}setParent(e){if(this.#Ai){if(this.#Ai!==e){if(this.#Wa.size>0)for(const t of this.#Wa.values())t.remove(),e.append(t);this.#Ai=e}}else this.#Ai=e}static get _svgFactory(){return le(this,"_svgFactory",new We)}static#Ka(e){let{x:t=0,y:n=0,width:i=1,height:s=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{style:r}=e;r.top=100*n+"%",r.left=100*t+"%",r.width=100*i+"%",r.height=100*s+"%"}#Xa(e){const t=ys._svgFactory.create(1,1,!0);return this.#Ai.append(t),t.setAttribute("aria-hidden",!0),ys.#Ka(t,e),t}#Qa(e,t){const n=ys._svgFactory.createElement("clipPath");e.append(n);const i=`clip_${t}`;n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");const s=ys._svgFactory.createElement("use");return n.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),i}highlight(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.#v++,r=this.#Xa(e.box);r.classList.add("highlight"),e.free&&r.classList.add("free");const a=ys._svgFactory.createElement("defs");r.append(a);const o=ys._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",l),o.setAttribute("d",e.toSVGPath()),i&&this.#Ga.set(s,o);const c=this.#Qa(a,l),u=ys._svgFactory.createElement("use");return r.append(u),r.setAttribute("fill",t),r.setAttribute("fill-opacity",n),u.setAttribute("href",`#${l}`),this.#Wa.set(s,r),{id:s,clipPathId:`url(#${c})`}}highlightOutline(e){const t=this.#v++,n=this.#Xa(e.box);n.classList.add("highlightOutline");const i=ys._svgFactory.createElement("defs");n.append(i);const s=ys._svgFactory.createElement("path");i.append(s);const r=`path_p${this.pageIndex}_${t}`;let a;if(s.setAttribute("id",r),s.setAttribute("d",e.toSVGPath()),s.setAttribute("vector-effect","non-scaling-stroke"),e.free){n.classList.add("free");const e=ys._svgFactory.createElement("mask");i.append(e),a=`mask_p${this.pageIndex}_${t}`,e.setAttribute("id",a),e.setAttribute("maskUnits","objectBoundingBox");const s=ys._svgFactory.createElement("rect");e.append(s),s.setAttribute("width","1"),s.setAttribute("height","1"),s.setAttribute("fill","white");const o=ys._svgFactory.createElement("use");e.append(o),o.setAttribute("href",`#${r}`),o.setAttribute("stroke","none"),o.setAttribute("fill","black"),o.setAttribute("fill-rule","nonzero"),o.classList.add("mask")}const o=ys._svgFactory.createElement("use");n.append(o),o.setAttribute("href",`#${r}`),a&&o.setAttribute("mask",`url(#${a})`);const l=o.cloneNode();return n.append(l),o.classList.add("mainOutline"),l.classList.add("secondaryOutline"),this.#Wa.set(t,n),t}finalizeLine(e,t){const n=this.#Ga.get(e);this.#Ga.delete(e),this.updateBox(e,t.box),n.setAttribute("d",t.toSVGPath())}updateLine(e,t){this.#Wa.get(e).firstChild.firstChild.setAttribute("d",t.toSVGPath())}removeFreeHighlight(e){this.remove(e),this.#Ga.delete(e)}updatePath(e,t){this.#Ga.get(e).setAttribute("d",t.toSVGPath())}updateBox(e,t){ys.#Ka(this.#Wa.get(e),t)}show(e,t){this.#Wa.get(e).classList.toggle("hidden",!t)}rotate(e,t){this.#Wa.get(e).setAttribute("data-main-rotation",t)}changeColor(e,t){this.#Wa.get(e).setAttribute("fill",t)}changeOpacity(e,t){this.#Wa.get(e).setAttribute("fill-opacity",t)}addClass(e,t){this.#Wa.get(e).classList.add(t)}removeClass(e,t){this.#Wa.get(e).classList.remove(t)}remove(e){null!==this.#Ai&&(this.#Wa.get(e).remove(),this.#Wa.delete(e))}destroy(){this.#Ai=null;for(const e of this.#Wa.values())e.remove();this.#Wa.clear()}}var bs=s.AnnotationLayer,ws=s.AnnotationMode,_s=s.GlobalWorkerOptions,As=s.PDFDataRangeTransport,Es=s.TextLayer,Ss=s.getDocument},7927:(e,t,n)=>{n.d(t,{cx:()=>_,Nd:()=>E,aI:()=>m,mw:()=>g,ME:()=>f,Dq:()=>d,L2:()=>S,dC:()=>b,jX:()=>x,KZ:()=>T,fw:()=>w,lt:()=>h,eh:()=>C,DA:()=>v});var i=n(9916);function s(e){return null!==e&&"object"===typeof e&&!Array.isArray(e)}function r(e){const t=[];if(!e)return{valid:!1,errors:["Sesi\xf3n es null o undefined"]};if(!s(e))return{valid:!1,errors:["Sesi\xf3n debe ser un objeto"]};e.id&&"string"===typeof e.id||t.push("session.id es requerido y debe ser string"),e.createdAt||t.push("session.createdAt es requerido"),e.lastModified||t.push("session.lastModified es requerido");const n=(i=e.text)?s(i)?i.content&&"string"!==typeof i.content?{valid:!1,error:"text.content debe ser string"}:i.content&&i.content.length>1e7?{valid:!1,error:"text.content excede 10MB"}:{valid:!0}:{valid:!1,error:"text debe ser objeto"}:{valid:!0};var i;n.valid||t.push(n.error);const r=(a=e.completeAnalysis)?s(a)?a.metadata&&s(a.metadata)?{valid:!0}:{valid:!1,error:"completeAnalysis.metadata es requerido"}:{valid:!1,error:"completeAnalysis debe ser objeto"}:{valid:!0};var a;r.valid||t.push(r.error);const o=function(e){if(!e)return{valid:!0};if(!s(e))return{valid:!1,error:"rubricProgress debe ser objeto"};const t=Object.keys(e);for(const n of t){const t=e[n];if(!s(t))return{valid:!1,error:`rubricProgress.${n} debe ser objeto`};if(t.scores&&!Array.isArray(t.scores))return{valid:!1,error:`rubricProgress.${n}.scores debe ser array`};if(t.average&&"number"!==typeof t.average)return{valid:!1,error:`rubricProgress.${n}.average debe ser n\xfamero`}}return{valid:!0}}(e.rubricProgress);o.valid||t.push(o.error);const l=function(e){if(!e)return{valid:!0};if(!s(e))return{valid:!1,error:"activitiesProgress debe ser objeto"};const t=Object.keys(e);for(const n of t){const t=e[n];if(!s(t))return{valid:!1,error:`activitiesProgress.${n} debe ser objeto`};if(t.preparation){const e=t.preparation;if(!s(e))return{valid:!1,error:`activitiesProgress.${n}.preparation debe ser objeto`};if(void 0!==e.completed&&"boolean"!==typeof e.completed)return{valid:!1,error:`activitiesProgress.${n}.preparation.completed debe ser boolean`};if(void 0!==e.mcqPassed&&"boolean"!==typeof e.mcqPassed)return{valid:!1,error:`activitiesProgress.${n}.preparation.mcqPassed debe ser boolean`}}}return{valid:!0}}(e.activitiesProgress);return l.valid||t.push(l.error),e.savedCitations&&!s(e.savedCitations)&&t.push("savedCitations debe ser objeto"),e.artifactsDrafts&&!s(e.artifactsDrafts)&&t.push("artifactsDrafts debe ser objeto"),{valid:0===t.length,errors:t}}function a(e){const t=r(e);if(t.valid)return{valid:!0,session:e,errors:[]};console.warn("\u26a0\ufe0f [Validator] Sesi\xf3n tiene errores, intentando sanitizar:",t.errors);const n=function(e){if(!e||!s(e))return null;const t={id:e.id||`session_${Date.now()}`,title:"string"===typeof e.title?e.title:"Sesi\xf3n sin t\xedtulo",createdAt:e.createdAt||Date.now(),lastModified:e.lastModified||Date.now()};return e.text&&s(e.text)&&(t.text={content:"string"===typeof e.text.content?e.text.content:"",fileName:e.text.fileName||"texto_manual",fileType:e.text.fileType||"text/plain",metadata:s(e.text.metadata)?e.text.metadata:{}}),e.completeAnalysis&&s(e.completeAnalysis)&&(t.completeAnalysis=e.completeAnalysis),e.rubricProgress&&s(e.rubricProgress)&&(t.rubricProgress=e.rubricProgress),e.activitiesProgress&&s(e.activitiesProgress)&&(t.activitiesProgress=e.activitiesProgress),e.savedCitations&&s(e.savedCitations)&&(t.savedCitations=e.savedCitations),e.artifactsDrafts&&s(e.artifactsDrafts)&&(t.artifactsDrafts=e.artifactsDrafts),e.settings&&s(e.settings)&&(t.settings=e.settings),t}(e);if(!n)return{valid:!1,session:null,errors:["No se pudo sanitizar la sesi\xf3n"]};const i=r(n);return{valid:i.valid,session:n,errors:i.errors}}const o="appLectura_sessions",l="appLectura_current_session_id",c=5;let u=null;function h(e){u=e,console.log("\ud83d\udc64 [SessionManager] Usuario establecido:",e||"ninguno")}function d(){try{const e=localStorage.getItem(o);if(!e)return[];return JSON.parse(e).sort(((e,t)=>(t.lastModified||0)-(e.lastModified||0)))}catch(e){return console.error("\u274c [SessionManager] Error cargando sesiones:",e),[]}}function p(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{const n=a(e);if(!n.valid)return console.error("\u274c [SessionManager] Sesi\xf3n inv\xe1lida, rechazada:",n.errors),!1;n.errors.length>0&&console.warn("\u26a0\ufe0f [SessionManager] Sesi\xf3n sanitizada con advertencias:",n.errors);const s={...n.session,lastModified:Date.now()};let r=d();const l=r.findIndex((e=>e.id===s.id));if(l>=0)r[l]={...r[l],...s};else if(r.unshift(s),r.length>c){const e=r.slice(c);r=r.slice(0,c),console.log(`\ud83d\uddd1\ufe0f [SessionManager] L\xedmite alcanzado (${c}). Eliminadas ${e.length} sesiones antiguas`),u&&t&&e.forEach((e=>{e.id&&(0,i.L0)(u,e.id).catch((e=>console.warn("\u26a0\ufe0f Error limpiando sesi\xf3n antigua:",e)))}))}return localStorage.setItem(o,JSON.stringify(r)),console.log("\u2705 [SessionManager] Sesi\xf3n guardada localmente:",s.id),t&&u?(0,i.e3)(u,s).then((()=>{console.log("\u2601\ufe0f [SessionManager] Sesi\xf3n sincronizada con Firestore:",e.id)})).catch((e=>{console.warn("\u26a0\ufe0f [SessionManager] Error sincronizando con Firestore:",e.message)})):t&&!u&&console.log("\u2139\ufe0f [SessionManager] Sin usuario autenticado, solo guardado local"),!0}catch(n){return console.error("\u274c [SessionManager] Error guardando sesi\xf3n:",n),!1}}function f(e){try{const t=d().filter((t=>t.id!==e));localStorage.setItem(o,JSON.stringify(t)),console.log("\u2705 [SessionManager] Sesi\xf3n eliminada localmente:",e);return localStorage.getItem(l)===e&&localStorage.removeItem(l),u&&(0,i.L0)(u,e).then((()=>{console.log("\u2601\ufe0f [SessionManager] Sesi\xf3n eliminada de Firestore:",e)})).catch((e=>{console.warn("\u26a0\ufe0f [SessionManager] Error eliminando de Firestore:",e.message)})),!0}catch(t){return console.error("\u274c [SessionManager] Error eliminando sesi\xf3n:",t),!1}}function g(){try{return localStorage.removeItem(o),localStorage.removeItem(l),console.log("\u2705 [SessionManager] Todas las sesiones eliminadas localmente"),u&&(0,i.z)(u).then((()=>{console.log("\u2601\ufe0f [SessionManager] Todas las sesiones eliminadas de Firestore")})).catch((e=>{console.warn("\u26a0\ufe0f [SessionManager] Error eliminando sesiones de Firestore:",e.message)})),!0}catch(e){return console.error("\u274c [SessionManager] Error eliminando todas las sesiones:",e),!1}}function m(e){var t,n,i,s,r,a,o;console.log("\ud83d\udd35 [SessionManager.createSessionFromState] Iniciando creaci\xf3n..."),console.log("\ud83d\udd35 [SessionManager] state.texto:",e.texto?`${e.texto.length} chars`:"NULL/UNDEFINED"),console.log("\ud83d\udd35 [SessionManager] state.texto preview:",(null===(t=e.texto)||void 0===t?void 0:t.substring(0,100))||"VAC\xcdO"),console.log("\ud83d\udd35 [SessionManager] state.archivoActual:",(null===(n=e.archivoActual)||void 0===n?void 0:n.name)||"sin archivo"),console.log("\ud83d\udd35 [SessionManager] state.completeAnalysis:",!!e.completeAnalysis);const l=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,c={id:l,title:(null===(i=e.text)||void 0===i?void 0:i.fileName)||`Sesi\xf3n ${(new Date).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}`,createdAt:Date.now(),lastModified:Date.now(),text:e.texto?{content:e.texto,fileName:(null===(s=e.archivoActual)||void 0===s?void 0:s.name)||"texto_manual",fileType:(null===(r=e.archivoActual)||void 0===r?void 0:r.type)||"text/plain",metadata:{length:e.texto.length,words:e.texto.split(/\s+/).length}}:null,completeAnalysis:e.completeAnalysis||null,tutorHistory:e.tutorHistory||[],highlights:e.highlights||[],annotations:e.annotations||[],savedCitations:e.savedCitations||{},rubricProgress:e.rubricProgress||{},activitiesProgress:e.activitiesProgress||{},notes:e.notes||[],artifactsDrafts:_(),settings:{modoOscuro:e.modoOscuro||!1}};return console.log("\u2705 [SessionManager] Sesi\xf3n creada con texto:",!!c.text,"length:",(null===(a=c.text)||void 0===a||null===(o=a.content)||void 0===o?void 0:o.length)||0),p(c),y(l),c}function v(e){const t=b();if(!t)return!1;const n=function(e){try{const t=d().find((t=>t.id===e));return t?(console.log("\u2705 [SessionManager] Sesi\xf3n cargada:",e),t):(console.warn("\u26a0\ufe0f [SessionManager] Sesi\xf3n no encontrada:",e),localStorage.getItem(l)===e&&(console.log("\ud83e\uddf9 [SessionManager] Limpiando referencia a sesi\xf3n inv\xe1lida:",e),localStorage.removeItem(l)),null)}catch(t){return console.error("\u274c [SessionManager] Error cargando sesi\xf3n:",t),null}}(t);if(!n)return!1;const i=_(),s={...n,...e,artifactsDrafts:e.artifactsDrafts||i,lastModified:Date.now()};return console.log("\ud83d\udcbe [SessionManager.updateCurrentSession] Guardando:",{sessionId:t,hasText:!!s.text,hasArtifacts:!!s.artifactsDrafts,hasRewards:!!s.rewardsState}),p(s)}function y(e){try{return localStorage.setItem(l,e),!0}catch(t){return console.error("\u274c [SessionManager] Error estableciendo sesi\xf3n actual:",t),!1}}function b(){try{return localStorage.getItem(l)}catch(e){return null}}function w(e,t){if(!e)return console.error("\u274c [restoreSessionToState] Sesi\xf3n inv\xe1lida:",e),!1;try{var n,i;return console.log("\ud83d\udd04 [SessionManager] Restaurando sesi\xf3n:",e.id),console.log("\ud83d\udcca Datos de sesi\xf3n:",{hasText:!(null===(n=e.text)||void 0===n||!n.content),hasAnalysis:!!e.completeAnalysis,hasRubrics:!!e.rubricProgress,hasCitations:!!e.savedCitations,hasActivities:!!e.activitiesProgress,hasDrafts:!!e.artifactsDrafts}),A(),null!==(i=e.text)&&void 0!==i&&i.content&&t.setTexto?(console.log("\ud83d\udcdd Restaurando texto..."),t.setTexto(e.text.content)):console.warn("\u26a0\ufe0f No hay texto para restaurar"),e.completeAnalysis&&t.setCompleteAnalysis&&(console.log("\ud83d\udd2c Restaurando an\xe1lisis..."),t.setCompleteAnalysis(e.completeAnalysis)),e.rubricProgress&&t.setRubricProgress&&(console.log("\ud83d\udcc8 Restaurando progreso de r\xfabricas..."),t.setRubricProgress(e.rubricProgress)),e.savedCitations&&t.setSavedCitations&&(console.log("\ud83d\udcda Restaurando citas guardadas..."),t.setSavedCitations(e.savedCitations)),e.activitiesProgress&&t.setActivitiesProgress&&(console.log("\ud83c\udfaf Restaurando progreso de actividades..."),t.setActivitiesProgress(e.activitiesProgress)),e.artifactsDrafts&&(console.log("\ud83d\udccb Restaurando borradores de artefactos..."),function(e){if(!e)return;try{var t;A(),null!==(t=e.resumenAcademico)&&void 0!==t&&t.draft&&sessionStorage.setItem("resumenAcademico_draft",e.resumenAcademico.draft),e.tablaACD&&(e.tablaACD.marcoIdeologico&&sessionStorage.setItem("tablaACD_marcoIdeologico",e.tablaACD.marcoIdeologico),e.tablaACD.estrategiasRetoricas&&sessionStorage.setItem("tablaACD_estrategiasRetoricas",e.tablaACD.estrategiasRetoricas),e.tablaACD.vocesPresentes&&sessionStorage.setItem("tablaACD_vocesPresentes",e.tablaACD.vocesPresentes),e.tablaACD.vocesSilenciadas&&sessionStorage.setItem("tablaACD_vocesSilenciadas",e.tablaACD.vocesSilenciadas)),e.mapaActores&&(e.mapaActores.actores&&sessionStorage.setItem("mapaActores_actores",e.mapaActores.actores),e.mapaActores.contextoHistorico&&sessionStorage.setItem("mapaActores_contextoHistorico",e.mapaActores.contextoHistorico),e.mapaActores.conexiones&&sessionStorage.setItem("mapaActores_conexiones",e.mapaActores.conexiones),e.mapaActores.consecuencias&&sessionStorage.setItem("mapaActores_consecuencias",e.mapaActores.consecuencias)),e.respuestaArgumentativa&&(e.respuestaArgumentativa.tesis&&sessionStorage.setItem("respuestaArgumentativa_tesis",e.respuestaArgumentativa.tesis),e.respuestaArgumentativa.evidencias&&sessionStorage.setItem("respuestaArgumentativa_evidencias",e.respuestaArgumentativa.evidencias),e.respuestaArgumentativa.contraargumento&&sessionStorage.setItem("respuestaArgumentativa_contraargumento",e.respuestaArgumentativa.contraargumento),e.respuestaArgumentativa.refutacion&&sessionStorage.setItem("respuestaArgumentativa_refutacion",e.respuestaArgumentativa.refutacion)),console.log("\u2705 [SessionManager] Borradores de artefactos restaurados")}catch(n){console.error("\u274c [SessionManager] Error restaurando borradores:",n)}}(e.artifactsDrafts)),y(e.id),window.dispatchEvent(new CustomEvent("session-restored",{detail:{sessionId:e.id}})),console.log("\u2705 [SessionManager] Sesi\xf3n restaurada exitosamente"),!0}catch(s){return console.error("\u274c [SessionManager] Error restaurando sesi\xf3n:",s),!1}}function _(){return{resumenAcademico:{draft:sessionStorage.getItem("resumenAcademico_draft")||""},tablaACD:{marcoIdeologico:sessionStorage.getItem("tablaACD_marcoIdeologico")||"",estrategiasRetoricas:sessionStorage.getItem("tablaACD_estrategiasRetoricas")||"",vocesPresentes:sessionStorage.getItem("tablaACD_vocesPresentes")||"",vocesSilenciadas:sessionStorage.getItem("tablaACD_vocesSilenciadas")||""},mapaActores:{actores:sessionStorage.getItem("mapaActores_actores")||"",contextoHistorico:sessionStorage.getItem("mapaActores_contextoHistorico")||"",conexiones:sessionStorage.getItem("mapaActores_conexiones")||"",consecuencias:sessionStorage.getItem("mapaActores_consecuencias")||""},respuestaArgumentativa:{tesis:sessionStorage.getItem("respuestaArgumentativa_tesis")||"",evidencias:sessionStorage.getItem("respuestaArgumentativa_evidencias")||"",contraargumento:sessionStorage.getItem("respuestaArgumentativa_contraargumento")||"",refutacion:sessionStorage.getItem("respuestaArgumentativa_refutacion")||""}}}function A(){try{sessionStorage.removeItem("resumenAcademico_draft"),sessionStorage.removeItem("tablaACD_marcoIdeologico"),sessionStorage.removeItem("tablaACD_estrategiasRetoricas"),sessionStorage.removeItem("tablaACD_vocesPresentes"),sessionStorage.removeItem("tablaACD_vocesSilenciadas"),sessionStorage.removeItem("mapaActores_actores"),sessionStorage.removeItem("mapaActores_contextoHistorico"),sessionStorage.removeItem("mapaActores_conexiones"),sessionStorage.removeItem("mapaActores_consecuencias"),sessionStorage.removeItem("respuestaArgumentativa_tesis"),sessionStorage.removeItem("respuestaArgumentativa_evidencias"),sessionStorage.removeItem("respuestaArgumentativa_contraargumento"),sessionStorage.removeItem("respuestaArgumentativa_refutacion"),console.log("\u2705 [SessionManager] Borradores de artefactos limpiados")}catch(e){console.error("\u274c [SessionManager] Error limpiando borradores:",e)}}function E(e){var t,n;const i=b(),s=_(),r={text:e.texto?{content:e.texto,fileName:(null===(t=e.archivoActual)||void 0===t?void 0:t.name)||"texto_manual",fileType:(null===(n=e.archivoActual)||void 0===n?void 0:n.type)||"text/plain",metadata:{length:e.texto.length,words:e.texto.split(/\s+/).length}}:null,completeAnalysis:e.completeAnalysis||null,rubricProgress:e.rubricProgress||{},savedCitations:e.savedCitations||{},activitiesProgress:e.activitiesProgress||{},artifactsDrafts:s,settings:{modoOscuro:e.modoOscuro||!1}};return i&&v(r),r}async function S(){try{const e=d();if(!u)return console.log("\u2139\ufe0f [SessionManager] Sin usuario autenticado, solo sesiones locales"),e.map((e=>({...e,source:"local",inCloud:!1,inLocal:!0})));console.log("\ud83d\udd04 [SessionManager] Obteniendo sesiones de Firestore...");const t=await(0,i.XF)(u),n=(0,i.Iq)(e,t);return console.log(`\u2705 [SessionManager] ${n.length} sesiones totales (${e.length} locales, ${t.length} en cloud)`),n}catch(e){return console.error("\u274c [SessionManager] Error obteniendo sesiones merged:",e),d().map((e=>({...e,source:"local",inCloud:!1,inLocal:!0})))}}async function C(){if(!u)return console.warn("\u26a0\ufe0f [SessionManager] No se puede sincronizar sin usuario autenticado"),{synced:0,errors:0};try{const t=d();console.log(`\ud83d\udd04 [SessionManager] Sincronizando ${t.length} sesiones con Firestore...`);let n=0,s=0;for(const r of t)try{await(0,i.e3)(u,r),n++}catch(e){console.error(`\u274c Error sincronizando sesi\xf3n ${r.id}:`,e),s++}return console.log(`\u2705 [SessionManager] Sincronizaci\xf3n completada: ${n} exitosas, ${s} errores`),{synced:n,errors:s}}catch(e){throw console.error("\u274c [SessionManager] Error en sincronizaci\xf3n masiva:",e),e}}async function T(){try{const e=await S();return{total:e.length,maxSessions:c,remaining:c-e.length,percentUsed:Math.round(e.length/c*100),localOnly:e.filter((e=>"local-only"===e.syncStatus)).length,cloudOnly:e.filter((e=>!e.inLocal)).length,synced:e.filter((e=>"synced"===e.syncStatus)).length,needsSync:e.filter((e=>"needs-sync"===e.syncStatus)).length,conflicts:e.filter((e=>"conflict"===e.syncStatus)).length}}catch(e){return console.error("\u274c [SessionManager] Error obteniendo estado de sincronizaci\xf3n:",e),{total:0,maxSessions:c,remaining:c,percentUsed:0,localOnly:0,cloudOnly:0,synced:0,needsSync:0,conflicts:0}}}function x(){const e=d().length;return{max:c,current:e,remaining:c-e,percentUsed:Math.round(e/c*100),isNearLimit:e>=.9*c,isFull:e>=c}}},8345:(e,t,n)=>{var i=n(9950),s=n(5340);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function g(e,t,n,i,s,r,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=a}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,i){var s=m.hasOwnProperty(t)?m[t]:null;(null!==s?0!==s.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,s,i)&&(n=null),i||null===s?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=null===n?3!==s.type&&"":n:(t=s.attributeName,i=s.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(s=s.type)||4===s&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var w=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),A=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),x=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var N=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=N&&e[N]||e["@@iterator"])?e:null}var O,F=Object.assign;function U(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var z=!1;function V(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var s=c.stack.split("\n"),r=i.stack.split("\n"),a=s.length-1,o=r.length-1;1<=a&&0<=o&&s[a]!==r[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==r[o]){if(1!==a||1!==o)do{if(a--,0>--o||s[a]!==r[o]){var l="\n"+s[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function B(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function j(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case E:return"Fragment";case A:return"Portal";case C:return"Profiler";case S:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case x:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:j(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return j(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function $(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){i=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=q(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=$(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Y(e,t);var n=$(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,$(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&i&&(e[n].defaultSelected=!0)}else{for(n=""+$(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(i&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(r(92));if(te(n)){if(1<n.length)throw Error(r(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:$(n)}}function re(e,t){var n=$(t.value),i=$(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),s=ge(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,s):e[n]=s}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ve=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(r(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function _e(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ae=null,Ee=null,Se=null;function Ce(e){if(e=bs(e)){if("function"!==typeof Ae)throw Error(r(280));var t=e.stateNode;t&&(t=_s(t),Ae(e.stateNode,e.type,t))}}function Te(e){Ee?Se?Se.push(e):Se=[e]:Ee=e}function xe(){if(Ee){var e=Ee,t=Se;if(Se=Ee=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function ke(e,t){return e(t)}function Ie(){}var Pe=!1;function Re(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return ke(e,t,n)}finally{Pe=!1,(null!==Ee||null!==Se)&&(Ie(),xe())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var i=_s(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(r(231,t,typeof n));return n}var Me=!1;if(u)try{var Ne={};Object.defineProperty(Ne,"passive",{get:function(){Me=!0}}),window.addEventListener("test",Ne,Ne),window.removeEventListener("test",Ne,Ne)}catch(ue){Me=!1}function Le(e,t,n,i,s,r,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Oe=!1,Fe=null,Ue=!1,ze=null,Ve={onError:function(e){Oe=!0,Fe=e}};function Be(e,t,n,i,s,r,a,o,l){Oe=!1,Fe=null,Le.apply(Ve,arguments)}function je(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function $e(e){if(je(e)!==e)throw Error(r(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=je(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,i=t;;){var s=n.return;if(null===s)break;var a=s.alternate;if(null===a){if(null!==(i=s.return)){n=i;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return $e(s),e;if(a===i)return $e(s),t;a=a.sibling}throw Error(r(188))}if(n.return!==i.return)n=s,i=a;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,i=a;break}if(l===i){o=!0,i=s,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,i=s;break}if(l===i){o=!0,i=a,n=s;break}l=l.sibling}if(!o)throw Error(r(189))}}if(n.alternate!==i)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ge=s.unstable_scheduleCallback,Ke=s.unstable_cancelCallback,Xe=s.unstable_shouldYield,Qe=s.unstable_requestPaint,Ye=s.unstable_now,Je=s.unstable_getCurrentPriorityLevel,Ze=s.unstable_ImmediatePriority,et=s.unstable_UserBlockingPriority,tt=s.unstable_NormalPriority,nt=s.unstable_LowPriority,it=s.unstable_IdlePriority,st=null,rt=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,s=e.suspendedLanes,r=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~s;0!==o?i=ht(o):0!==(r&=a)&&(i=ht(r))}else 0!==(a=n&~s)?i=ht(a):0!==r&&(i=ht(r));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&s)&&((s=i&-i)>=(r=t&-t)||16===s&&0!==(4194240&r)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)s=1<<(n=31-at(t)),i|=e[n],t&=~s;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),s=1<<i;s&t|e[i]&t&&(e[i]|=t),n&=~s}}var bt=0;function wt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var _t,At,Et,St,Ct,Tt=!1,xt=[],kt=null,It=null,Pt=null,Rt=new Map,Dt=new Map,Mt=[],Nt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":kt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Ot(e,t,n,i,s,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:r,targetContainers:[s]},null!==t&&(null!==(t=bs(t))&&At(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Ft(e){var t=ys(e.target);if(null!==t){var n=je(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void Ct(e.priority,(function(){Et(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bs(n))&&At(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);we=i,n.target.dispatchEvent(i),we=null,t.shift()}return!0}function zt(e,t,n){Ut(e)&&n.delete(t)}function Vt(){Tt=!1,null!==kt&&Ut(kt)&&(kt=null),null!==It&&Ut(It)&&(It=null),null!==Pt&&Ut(Pt)&&(Pt=null),Rt.forEach(zt),Dt.forEach(zt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Vt)))}function jt(e){function t(t){return Bt(t,e)}if(0<xt.length){Bt(xt[0],e);for(var n=1;n<xt.length;n++){var i=xt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==kt&&Bt(kt,e),null!==It&&Bt(It,e),null!==Pt&&Bt(Pt,e),Rt.forEach(t),Dt.forEach(t),n=0;n<Mt.length;n++)(i=Mt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Mt.length&&null===(n=Mt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Mt.shift()}var Ht=w.ReactCurrentBatchConfig,$t=!0;function qt(e,t,n,i){var s=bt,r=Ht.transition;Ht.transition=null;try{bt=1,Gt(e,t,n,i)}finally{bt=s,Ht.transition=r}}function Wt(e,t,n,i){var s=bt,r=Ht.transition;Ht.transition=null;try{bt=4,Gt(e,t,n,i)}finally{bt=s,Ht.transition=r}}function Gt(e,t,n,i){if($t){var s=Xt(e,t,n,i);if(null===s)$i(e,t,i,Kt,n),Lt(e,i);else if(function(e,t,n,i,s){switch(t){case"focusin":return kt=Ot(kt,e,t,n,i,s),!0;case"dragenter":return It=Ot(It,e,t,n,i,s),!0;case"mouseover":return Pt=Ot(Pt,e,t,n,i,s),!0;case"pointerover":var r=s.pointerId;return Rt.set(r,Ot(Rt.get(r)||null,e,t,n,i,s)),!0;case"gotpointercapture":return r=s.pointerId,Dt.set(r,Ot(Dt.get(r)||null,e,t,n,i,s)),!0}return!1}(s,e,t,n,i))i.stopPropagation();else if(Lt(e,i),4&t&&-1<Nt.indexOf(e)){for(;null!==s;){var r=bs(s);if(null!==r&&_t(r),null===(r=Xt(e,t,n,i))&&$i(e,t,i,Kt,n),r===s)break;s=r}null!==s&&i.stopPropagation()}else $i(e,t,i,null,n)}}var Kt=null;function Xt(e,t,n,i){if(Kt=null,null!==(e=ys(e=_e(i))))if(null===(t=je(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Yt=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,i=n.length,s="value"in Yt?Yt.value:Yt.textContent,r=s.length;for(e=0;e<i&&n[e]===s[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===s[r-t];t++);return Zt=s.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function sn(){return!1}function rn(e){function t(t,n,i,s,r){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?nn:sn,this.isPropagationStopped=sn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=rn(cn),hn=F({},cn,{view:0,detail:0}),dn=rn(hn),pn=F({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),fn=rn(pn),gn=rn(F({},pn,{dataTransfer:0})),mn=rn(F({},hn,{relatedTarget:0})),vn=rn(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=rn(yn),wn=rn(F({},cn,{data:0})),_n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},An={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},En={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=En[e])&&!!t[e]}function Cn(){return Sn}var Tn=F({},hn,{key:function(e){if(e.key){var t=_n[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?An[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),xn=rn(Tn),kn=rn(F({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=rn(F({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Pn=rn(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=F({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=rn(Rn),Mn=[9,13,27,32],Nn=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var On=u&&"TextEvent"in window&&!Ln,Fn=u&&(!Nn||Ln&&8<Ln&&11>=Ln),Un=String.fromCharCode(32),zn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Mn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $n(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function qn(e,t,n,i){Te(i),0<(t=Wi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Wn=null,Gn=null;function Kn(e){Ui(e,0)}function Xn(e){if(G(ws(e)))return e}function Qn(e,t){if("change"===e)return t}var Yn=!1;if(u){var Jn;if(u){var Zn="oninput"in document;if(!Zn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Zn="function"===typeof ei.oninput}Jn=Zn}else Jn=!1;Yn=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){Wn&&(Wn.detachEvent("onpropertychange",ni),Gn=Wn=null)}function ni(e){if("value"===e.propertyName&&Xn(Gn)){var t=[];qn(t,Gn,e,_e(e)),Re(Kn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Gn=n,(Wn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function si(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(Gn)}function ri(e,t){if("click"===e)return Xn(t)}function ai(e,t){if("input"===e||"change"===e)return Xn(t)}var oi="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(oi(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var s=n[i];if(!h.call(t,s)||!oi(e[s],t[s]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function di(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fi(e){var t=di(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=n.textContent.length,r=Math.min(i.start,s);i=void 0===i.end?r:Math.min(i.end,s),!e.extend&&r>i&&(s=i,i=r,r=s),s=ui(n,r);var a=ui(n,i);s&&a&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),r>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gi=u&&"documentMode"in document&&11>=document.documentMode,mi=null,vi=null,yi=null,bi=!1;function wi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==mi||mi!==K(i)||("selectionStart"in(i=mi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Wi(vi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=mi)))}function _i(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ai={animationend:_i("Animation","AnimationEnd"),animationiteration:_i("Animation","AnimationIteration"),animationstart:_i("Animation","AnimationStart"),transitionend:_i("Transition","TransitionEnd")},Ei={},Si={};function Ci(e){if(Ei[e])return Ei[e];if(!Ai[e])return e;var t,n=Ai[e];for(t in n)if(n.hasOwnProperty(t)&&t in Si)return Ei[e]=n[t];return e}u&&(Si=document.createElement("div").style,"AnimationEvent"in window||(delete Ai.animationend.animation,delete Ai.animationiteration.animation,delete Ai.animationstart.animation),"TransitionEvent"in window||delete Ai.transitionend.transition);var Ti=Ci("animationend"),xi=Ci("animationiteration"),ki=Ci("animationstart"),Ii=Ci("transitionend"),Pi=new Map,Ri="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Di(e,t){Pi.set(e,t),l(t,[e])}for(var Mi=0;Mi<Ri.length;Mi++){var Ni=Ri[Mi];Di(Ni.toLowerCase(),"on"+(Ni[0].toUpperCase()+Ni.slice(1)))}Di(Ti,"onAnimationEnd"),Di(xi,"onAnimationIteration"),Di(ki,"onAnimationStart"),Di("dblclick","onDoubleClick"),Di("focusin","onFocus"),Di("focusout","onBlur"),Di(Ii,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Li="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Li));function Fi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,s,a,o,l,c){if(Be.apply(this,arguments),Oe){if(!Oe)throw Error(r(198));var u=Fe;Oe=!1,Fe=null,Ue||(Ue=!0,ze=u)}}(i,t,void 0,e),e.currentTarget=null}function Ui(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],s=i.event;i=i.listeners;e:{var r=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==r&&s.isPropagationStopped())break e;Fi(s,o,c),r=l}else for(a=0;a<i.length;a++){if(l=(o=i[a]).instance,c=o.currentTarget,o=o.listener,l!==r&&s.isPropagationStopped())break e;Fi(s,o,c),r=l}}}if(Ue)throw e=ze,Ue=!1,ze=null,e}function zi(e,t){var n=t[gs];void 0===n&&(n=t[gs]=new Set);var i=e+"__bubble";n.has(i)||(Hi(t,e,2,!1),n.add(i))}function Vi(e,t,n){var i=0;t&&(i|=4),Hi(n,e,i,t)}var Bi="_reactListening"+Math.random().toString(36).slice(2);function ji(e){if(!e[Bi]){e[Bi]=!0,a.forEach((function(t){"selectionchange"!==t&&(Oi.has(t)||Vi(t,!1,e),Vi(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Bi]||(t[Bi]=!0,Vi("selectionchange",!1,t))}}function Hi(e,t,n,i){switch(Qt(t)){case 1:var s=qt;break;case 4:s=Wt;break;default:s=Gt}n=s.bind(null,t,n,e),s=void 0,!Me||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),i?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function $i(e,t,n,i,s){var r=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===s||8===o.nodeType&&o.parentNode===s)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;a=a.return}for(;null!==o;){if(null===(a=ys(o)))return;if(5===(l=a.tag)||6===l){i=r=a;continue e}o=o.parentNode}}i=i.return}Re((function(){var i=r,s=_e(n),a=[];e:{var o=Pi.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=xn;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Ti:case xi:case ki:l=vn;break;case Ii:l=Pn;break;case"scroll":l=dn;break;case"wheel":l=Dn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=kn}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==o?o+"Capture":null:o;u=[];for(var p,f=i;null!==f;){var g=(p=f).stateNode;if(5===p.tag&&null!==g&&(p=g,null!==d&&(null!=(g=De(f,d))&&u.push(qi(f,g,p)))),h)break;f=f.return}0<u.length&&(o=new l(o,c,null,n,s),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===we||!(c=n.relatedTarget||n.fromElement)||!ys(c)&&!c[fs])&&(l||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?ys(c):null)&&(c!==(h=je(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,g="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=kn,g="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?o:ws(l),p=null==c?o:ws(c),(o=new u(g,f+"leave",l,n,s)).target=h,o.relatedTarget=p,g=null,ys(s)===i&&((u=new u(d,f+"enter",c,n,s)).target=p,u.relatedTarget=h,g=u),h=g,l&&c)e:{for(d=c,f=0,p=u=l;p;p=Gi(p))f++;for(p=0,g=d;g;g=Gi(g))p++;for(;0<f-p;)u=Gi(u),f--;for(;0<p-f;)d=Gi(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Gi(u),d=Gi(d)}u=null}else u=null;null!==l&&Ki(a,o,l,u,!1),null!==c&&null!==h&&Ki(a,h,c,u,!0)}if("select"===(l=(o=i?ws(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var m=Qn;else if($n(o))if(Yn)m=ai;else{m=si;var v=ii}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=ri);switch(m&&(m=m(e,i))?qn(a,m,n,s):(v&&v(e,o,i),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=i?ws(i):window,e){case"focusin":($n(v)||"true"===v.contentEditable)&&(mi=v,vi=i,yi=null);break;case"focusout":yi=vi=mi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,wi(a,n,s);break;case"selectionchange":if(gi)break;case"keydown":case"keyup":wi(a,n,s)}var y;if(Nn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else jn?Vn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Fn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==b?"onCompositionEnd"===b&&jn&&(y=en()):(Jt="value"in(Yt=s)?Yt.value:Yt.textContent,jn=!0)),0<(v=Wi(i,b)).length&&(b=new wn(b,e,null,n,s),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=Bn(n))&&(b.data=y))),(y=On?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(zn=!0,Un);case"textInput":return(e=t.data)===Un&&zn?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!Nn&&Vn(e,t)?(e=en(),Zt=Jt=Yt=null,jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Wi(i,"onBeforeInput")).length&&(s=new wn("onBeforeInput","beforeinput",null,n,s),a.push({event:s,listeners:i}),s.data=y))}Ui(a,t)}))}function qi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wi(e,t){for(var n=t+"Capture",i=[];null!==e;){var s=e,r=s.stateNode;5===s.tag&&null!==r&&(s=r,null!=(r=De(e,n))&&i.unshift(qi(e,r,s)),null!=(r=De(e,t))&&i.push(qi(e,r,s))),e=e.return}return i}function Gi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ki(e,t,n,i,s){for(var r=t._reactName,a=[];null!==n&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===i)break;5===o.tag&&null!==c&&(o=c,s?null!=(l=De(n,r))&&a.unshift(qi(n,l,o)):s||null!=(l=De(n,r))&&a.push(qi(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Xi=/\r\n?/g,Qi=/\u0000|\uFFFD/g;function Yi(e){return("string"===typeof e?e:""+e).replace(Xi,"\n").replace(Qi,"")}function Ji(e,t,n){if(t=Yi(t),Yi(e)!==t&&n)throw Error(r(425))}function Zi(){}var es=null,ts=null;function ns(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var is="function"===typeof setTimeout?setTimeout:void 0,ss="function"===typeof clearTimeout?clearTimeout:void 0,rs="function"===typeof Promise?Promise:void 0,as="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof rs?function(e){return rs.resolve(null).then(e).catch(os)}:is;function os(e){setTimeout((function(){throw e}))}function ls(e,t){var n=t,i=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0===i)return e.removeChild(s),void jt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=s}while(n);jt(t)}function cs(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function us(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hs=Math.random().toString(36).slice(2),ds="__reactFiber$"+hs,ps="__reactProps$"+hs,fs="__reactContainer$"+hs,gs="__reactEvents$"+hs,ms="__reactListeners$"+hs,vs="__reactHandles$"+hs;function ys(e){var t=e[ds];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fs]||n[ds]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=us(e);null!==e;){if(n=e[ds])return n;e=us(e)}return t}n=(e=n).parentNode}return null}function bs(e){return!(e=e[ds]||e[fs])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ws(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function _s(e){return e[ps]||null}var As=[],Es=-1;function Ss(e){return{current:e}}function Cs(e){0>Es||(e.current=As[Es],As[Es]=null,Es--)}function Ts(e,t){Es++,As[Es]=e.current,e.current=t}var xs={},ks=Ss(xs),Is=Ss(!1),Ps=xs;function Rs(e,t){var n=e.type.contextTypes;if(!n)return xs;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var s,r={};for(s in n)r[s]=t[s];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Ds(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ms(){Cs(Is),Cs(ks)}function Ns(e,t,n){if(ks.current!==xs)throw Error(r(168));Ts(ks,t),Ts(Is,n)}function Ls(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var s in i=i.getChildContext())if(!(s in t))throw Error(r(108,H(e)||"Unknown",s));return F({},n,i)}function Os(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||xs,Ps=ks.current,Ts(ks,e),Ts(Is,Is.current),!0}function Fs(e,t,n){var i=e.stateNode;if(!i)throw Error(r(169));n?(e=Ls(e,t,Ps),i.__reactInternalMemoizedMergedChildContext=e,Cs(Is),Cs(ks),Ts(ks,e)):Cs(Is),Ts(Is,n)}var Us=null,zs=!1,Vs=!1;function Bs(e){null===Us?Us=[e]:Us.push(e)}function js(){if(!Vs&&null!==Us){Vs=!0;var e=0,t=bt;try{var n=Us;for(bt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Us=null,zs=!1}catch(s){throw null!==Us&&(Us=Us.slice(e+1)),Ge(Ze,js),s}finally{bt=t,Vs=!1}}return null}var Hs=[],$s=0,qs=null,Ws=0,Gs=[],Ks=0,Xs=null,Qs=1,Ys="";function Js(e,t){Hs[$s++]=Ws,Hs[$s++]=qs,qs=e,Ws=t}function Zs(e,t,n){Gs[Ks++]=Qs,Gs[Ks++]=Ys,Gs[Ks++]=Xs,Xs=e;var i=Qs;e=Ys;var s=32-at(i)-1;i&=~(1<<s),n+=1;var r=32-at(t)+s;if(30<r){var a=s-s%5;r=(i&(1<<a)-1).toString(32),i>>=a,s-=a,Qs=1<<32-at(t)+s|n<<s|i,Ys=r+e}else Qs=1<<r|n<<s|i,Ys=e}function er(e){null!==e.return&&(Js(e,1),Zs(e,1,0))}function tr(e){for(;e===qs;)qs=Hs[--$s],Hs[$s]=null,Ws=Hs[--$s],Hs[$s]=null;for(;e===Xs;)Xs=Gs[--Ks],Gs[Ks]=null,Ys=Gs[--Ks],Gs[Ks]=null,Qs=Gs[--Ks],Gs[Ks]=null}var nr=null,ir=null,sr=!1,rr=null;function ar(e,t){var n=Rc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function or(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,nr=e,ir=cs(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,nr=e,ir=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xs?{id:Qs,overflow:Ys}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Rc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,nr=e,ir=null,!0);default:return!1}}function lr(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cr(e){if(sr){var t=ir;if(t){var n=t;if(!or(e,t)){if(lr(e))throw Error(r(418));t=cs(n.nextSibling);var i=nr;t&&or(e,t)?ar(i,n):(e.flags=-4097&e.flags|2,sr=!1,nr=e)}}else{if(lr(e))throw Error(r(418));e.flags=-4097&e.flags|2,sr=!1,nr=e}}}function ur(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;nr=e}function hr(e){if(e!==nr)return!1;if(!sr)return ur(e),sr=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ns(e.type,e.memoizedProps)),t&&(t=ir)){if(lr(e))throw dr(),Error(r(418));for(;t;)ar(e,t),t=cs(t.nextSibling)}if(ur(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ir=cs(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ir=null}}else ir=nr?cs(e.stateNode.nextSibling):null;return!0}function dr(){for(var e=ir;e;)e=cs(e.nextSibling)}function pr(){ir=nr=null,sr=!1}function fr(e){null===rr?rr=[e]:rr.push(e)}var gr=w.ReactCurrentBatchConfig;function mr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(r(309));var i=n.stateNode}if(!i)throw Error(r(147,e));var s=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=s.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(r(284));if(!n._owner)throw Error(r(290,e))}return e}function vr(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yr(e){return(0,e._init)(e._payload)}function br(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Mc(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Fc(n,e.mode,i)).return=e,t):((t=s(t,n)).return=e,t)}function c(e,t,n,i){var r=n.type;return r===E?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===D&&yr(r)===t.type)?((i=s(t,n.props)).ref=mr(e,t,n),i.return=e,i):((i=Nc(n.type,n.key,n.props,null,e.mode,i)).ref=mr(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,i)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function h(e,t,n,i,r){return null===t||7!==t.tag?((t=Lc(n,e.mode,i,r)).return=e,t):((t=s(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case _:return(n=Nc(t.type,t.key,t.props,null,e.mode,n)).ref=mr(e,null,t),n.return=e,n;case A:return(t=Uc(t,e.mode,n)).return=e,t;case D:return d(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Lc(t,e.mode,n,null)).return=e,t;vr(e,t)}return null}function p(e,t,n,i){var s=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==s?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case _:return n.key===s?c(e,t,n,i):null;case A:return n.key===s?u(e,t,n,i):null;case D:return p(e,t,(s=n._init)(n._payload),i)}if(te(n)||L(n))return null!==s?null:h(e,t,n,i,null);vr(e,n)}return null}function f(e,t,n,i,s){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,s);if("object"===typeof i&&null!==i){switch(i.$$typeof){case _:return c(t,e=e.get(null===i.key?n:i.key)||null,i,s);case A:return u(t,e=e.get(null===i.key?n:i.key)||null,i,s);case D:return f(e,t,n,(0,i._init)(i._payload),s)}if(te(i)||L(i))return h(t,e=e.get(n)||null,i,s,null);vr(t,i)}return null}function g(s,r,o,l){for(var c=null,u=null,h=r,g=r=0,m=null;null!==h&&g<o.length;g++){h.index>g?(m=h,h=null):m=h.sibling;var v=p(s,h,o[g],l);if(null===v){null===h&&(h=m);break}e&&h&&null===v.alternate&&t(s,h),r=a(v,r,g),null===u?c=v:u.sibling=v,u=v,h=m}if(g===o.length)return n(s,h),sr&&Js(s,g),c;if(null===h){for(;g<o.length;g++)null!==(h=d(s,o[g],l))&&(r=a(h,r,g),null===u?c=h:u.sibling=h,u=h);return sr&&Js(s,g),c}for(h=i(s,h);g<o.length;g++)null!==(m=f(h,s,g,o[g],l))&&(e&&null!==m.alternate&&h.delete(null===m.key?g:m.key),r=a(m,r,g),null===u?c=m:u.sibling=m,u=m);return e&&h.forEach((function(e){return t(s,e)})),sr&&Js(s,g),c}function m(s,o,l,c){var u=L(l);if("function"!==typeof u)throw Error(r(150));if(null==(l=u.call(l)))throw Error(r(151));for(var h=u=null,g=o,m=o=0,v=null,y=l.next();null!==g&&!y.done;m++,y=l.next()){g.index>m?(v=g,g=null):v=g.sibling;var b=p(s,g,y.value,c);if(null===b){null===g&&(g=v);break}e&&g&&null===b.alternate&&t(s,g),o=a(b,o,m),null===h?u=b:h.sibling=b,h=b,g=v}if(y.done)return n(s,g),sr&&Js(s,m),u;if(null===g){for(;!y.done;m++,y=l.next())null!==(y=d(s,y.value,c))&&(o=a(y,o,m),null===h?u=y:h.sibling=y,h=y);return sr&&Js(s,m),u}for(g=i(s,g);!y.done;m++,y=l.next())null!==(y=f(g,s,m,y.value,c))&&(e&&null!==y.alternate&&g.delete(null===y.key?m:y.key),o=a(y,o,m),null===h?u=y:h.sibling=y,h=y);return e&&g.forEach((function(e){return t(s,e)})),sr&&Js(s,m),u}return function e(i,r,a,l){if("object"===typeof a&&null!==a&&a.type===E&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case _:e:{for(var c=a.key,u=r;null!==u;){if(u.key===c){if((c=a.type)===E){if(7===u.tag){n(i,u.sibling),(r=s(u,a.props.children)).return=i,i=r;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&yr(c)===u.type){n(i,u.sibling),(r=s(u,a.props)).ref=mr(i,u,a),r.return=i,i=r;break e}n(i,u);break}t(i,u),u=u.sibling}a.type===E?((r=Lc(a.props.children,i.mode,l,a.key)).return=i,i=r):((l=Nc(a.type,a.key,a.props,null,i.mode,l)).ref=mr(i,r,a),l.return=i,i=l)}return o(i);case A:e:{for(u=a.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(i,r.sibling),(r=s(r,a.children||[])).return=i,i=r;break e}n(i,r);break}t(i,r),r=r.sibling}(r=Uc(a,i.mode,l)).return=i,i=r}return o(i);case D:return e(i,r,(u=a._init)(a._payload),l)}if(te(a))return g(i,r,a,l);if(L(a))return m(i,r,a,l);vr(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==r&&6===r.tag?(n(i,r.sibling),(r=s(r,a)).return=i,i=r):(n(i,r),(r=Fc(a,i.mode,l)).return=i,i=r),o(i)):n(i,r)}}var wr=br(!0),_r=br(!1),Ar=Ss(null),Er=null,Sr=null,Cr=null;function Tr(){Cr=Sr=Er=null}function xr(e){var t=Ar.current;Cs(Ar),e._currentValue=t}function kr(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ir(e,t){Er=e,Cr=Sr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function Pr(e){var t=e._currentValue;if(Cr!==e)if(e={context:e,memoizedValue:t,next:null},null===Sr){if(null===Er)throw Error(r(308));Sr=e,Er.dependencies={lanes:0,firstContext:e}}else Sr=Sr.next=e;return t}var Rr=null;function Dr(e){null===Rr?Rr=[e]:Rr.push(e)}function Mr(e,t,n,i){var s=t.interleaved;return null===s?(n.next=n,Dr(t)):(n.next=s.next,s.next=n),t.interleaved=n,Nr(e,i)}function Nr(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Lr=!1;function Or(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ur(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zr(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&kl)){var s=i.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),i.pending=t,Nr(e,n)}return null===(s=i.interleaved)?(t.next=t,Dr(i)):(t.next=s.next,s.next=t),i.interleaved=t,Nr(e,n)}function Vr(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Br(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var s=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===r?s=r=a:r=r.next=a,n=n.next}while(null!==n);null===r?s=r=t:r=r.next=t}else s=r=t;return n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function jr(e,t,n,i){var s=e.updateQueue;Lr=!1;var r=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?r=c:a.next=c,a=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==r){var h=s.baseState;for(a=0,u=c=l=null,o=r;;){var d=o.lane,p=o.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,g=o;switch(d=t,p=n,g.tag){case 1:if("function"===typeof(f=g.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=g.payload)?f.call(p,h,d):f)||void 0===d)break e;h=F({},h,d);break e;case 2:Lr=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=s.effects)?s.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,a|=d;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(d=o).next,d.next=null,s.lastBaseUpdate=d,s.shared.pending=null}}if(null===u&&(l=h),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,null!==(t=s.shared.interleaved)){s=t;do{a|=s.lane,s=s.next}while(s!==t)}else null===r&&(s.shared.lanes=0);Ol|=a,e.lanes=a,e.memoizedState=h}}function Hr(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],s=i.callback;if(null!==s){if(i.callback=null,i=n,"function"!==typeof s)throw Error(r(191,s));s.call(i)}}}var $r={},qr=Ss($r),Wr=Ss($r),Gr=Ss($r);function Kr(e){if(e===$r)throw Error(r(174));return e}function Xr(e,t){switch(Ts(Gr,t),Ts(Wr,e),Ts(qr,$r),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Cs(qr),Ts(qr,t)}function Qr(){Cs(qr),Cs(Wr),Cs(Gr)}function Yr(e){Kr(Gr.current);var t=Kr(qr.current),n=le(t,e.type);t!==n&&(Ts(Wr,e),Ts(qr,n))}function Jr(e){Wr.current===e&&(Cs(qr),Cs(Wr))}var Zr=Ss(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function na(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ia=w.ReactCurrentDispatcher,sa=w.ReactCurrentBatchConfig,ra=0,aa=null,oa=null,la=null,ca=!1,ua=!1,ha=0,da=0;function pa(){throw Error(r(321))}function fa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!oi(e[n],t[n]))return!1;return!0}function ga(e,t,n,i,s,a){if(ra=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ia.current=null===e||null===e.memoizedState?Ja:Za,e=n(i,s),ua){a=0;do{if(ua=!1,ha=0,25<=a)throw Error(r(301));a+=1,la=oa=null,t.updateQueue=null,ia.current=eo,e=n(i,s)}while(ua)}if(ia.current=Ya,t=null!==oa&&null!==oa.next,ra=0,la=oa=aa=null,ca=!1,t)throw Error(r(300));return e}function ma(){var e=0!==ha;return ha=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(r(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function ba(e,t){return"function"===typeof t?t(e):t}function wa(e){var t=ya(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=oa,s=i.baseQueue,a=n.pending;if(null!==a){if(null!==s){var o=s.next;s.next=a.next,a.next=o}i.baseQueue=s=a,n.pending=null}if(null!==s){a=s.next,i=i.baseState;var l=o=null,c=null,u=a;do{var h=u.lane;if((ra&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=i):c=c.next=d,aa.lanes|=h,Ol|=h}u=u.next}while(null!==u&&u!==a);null===c?o=i:c.next=l,oi(i,t.memoizedState)||(bo=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){s=e;do{a=s.lane,aa.lanes|=a,Ol|=a,s=s.next}while(s!==e)}else null===s&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function _a(e){var t=ya(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,s=n.pending,a=t.memoizedState;if(null!==s){n.pending=null;var o=s=s.next;do{a=e(a,o.action),o=o.next}while(o!==s);oi(a,t.memoizedState)||(bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Aa(){}function Ea(e,t){var n=aa,i=ya(),s=t(),a=!oi(i.memoizedState,s);if(a&&(i.memoizedState=s,bo=!0),i=i.queue,La(Ta.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,Pa(9,Ca.bind(null,n,i,s,t),void 0,null),null===Il)throw Error(r(349));0!==(30&ra)||Sa(n,t,s)}return s}function Sa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ca(e,t,n,i){t.value=n,t.getSnapshot=i,xa(t)&&ka(e)}function Ta(e,t,n){return n((function(){xa(t)&&ka(e)}))}function xa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!oi(e,n)}catch(i){return!0}}function ka(e){var t=Nr(e,1);null!==t&&nc(t,e,1,-1)}function Ia(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:e},t.queue=e,e=e.dispatch=Ga.bind(null,aa,e),[t.memoizedState,e]}function Pa(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ra(){return ya().memoizedState}function Da(e,t,n,i){var s=va();aa.flags|=e,s.memoizedState=Pa(1|t,n,void 0,void 0===i?null:i)}function Ma(e,t,n,i){var s=ya();i=void 0===i?null:i;var r=void 0;if(null!==oa){var a=oa.memoizedState;if(r=a.destroy,null!==i&&fa(i,a.deps))return void(s.memoizedState=Pa(t,n,r,i))}aa.flags|=e,s.memoizedState=Pa(1|t,n,r,i)}function Na(e,t){return Da(8390656,8,e,t)}function La(e,t){return Ma(2048,8,e,t)}function Oa(e,t){return Ma(4,2,e,t)}function Fa(e,t){return Ma(4,4,e,t)}function Ua(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function za(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ma(4,4,Ua.bind(null,t,e),n)}function Va(){}function Ba(e,t){var n=ya();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&fa(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function ja(e,t){var n=ya();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&fa(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ha(e,t,n){return 0===(21&ra)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=n):(oi(n,t)||(n=gt(),aa.lanes|=n,Ol|=n,e.baseState=!0),t)}function $a(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var i=sa.transition;sa.transition={};try{e(!1),t()}finally{bt=n,sa.transition=i}}function qa(){return ya().memoizedState}function Wa(e,t,n){var i=tc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Ka(e))Xa(t,n);else if(null!==(n=Mr(e,t,n,i))){nc(n,e,i,ec()),Qa(n,t,i)}}function Ga(e,t,n){var i=tc(e),s={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ka(e))Xa(t,s);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=r(a,n);if(s.hasEagerState=!0,s.eagerState=o,oi(o,a)){var l=t.interleaved;return null===l?(s.next=s,Dr(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(c){}null!==(n=Mr(e,t,s,i))&&(nc(n,e,i,s=ec()),Qa(n,t,i))}}function Ka(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Xa(e,t){ua=ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Qa(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Ya={readContext:Pr,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},Ja={readContext:Pr,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:Pr,useEffect:Na,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Da(4194308,4,Ua.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Da(4194308,4,e,t)},useInsertionEffect:function(e,t){return Da(4,2,e,t)},useMemo:function(e,t){var n=va();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=va();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Wa.bind(null,aa,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Ia,useDebugValue:Va,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Ia(!1),t=e[0];return e=$a.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=aa,s=va();if(sr){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===Il)throw Error(r(349));0!==(30&ra)||Sa(i,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,Na(Ta.bind(null,i,a,e),[e]),i.flags|=2048,Pa(9,Ca.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=va(),t=Il.identifierPrefix;if(sr){var n=Ys;t=":"+t+"R"+(n=(Qs&~(1<<32-at(Qs)-1)).toString(32)+n),0<(n=ha++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=da++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Za={readContext:Pr,useCallback:Ba,useContext:Pr,useEffect:La,useImperativeHandle:za,useInsertionEffect:Oa,useLayoutEffect:Fa,useMemo:ja,useReducer:wa,useRef:Ra,useState:function(){return wa(ba)},useDebugValue:Va,useDeferredValue:function(e){return Ha(ya(),oa.memoizedState,e)},useTransition:function(){return[wa(ba)[0],ya().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Ea,useId:qa,unstable_isNewReconciler:!1},eo={readContext:Pr,useCallback:Ba,useContext:Pr,useEffect:La,useImperativeHandle:za,useInsertionEffect:Oa,useLayoutEffect:Fa,useMemo:ja,useReducer:_a,useRef:Ra,useState:function(){return _a(ba)},useDebugValue:Va,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:Ha(t,oa.memoizedState,e)},useTransition:function(){return[_a(ba)[0],ya().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Ea,useId:qa,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var io={isMounted:function(e){return!!(e=e._reactInternals)&&je(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=ec(),s=tc(e),r=Ur(i,s);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=zr(e,r,s))&&(nc(t,e,s,i),Vr(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=ec(),s=tc(e),r=Ur(i,s);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=zr(e,r,s))&&(nc(t,e,s,i),Vr(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),i=tc(e),s=Ur(n,i);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=zr(e,s,i))&&(nc(t,e,i,n),Vr(t,e,i))}};function so(e,t,n,i,s,r,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,r,a):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(s,r))}function ro(e,t,n){var i=!1,s=xs,r=t.contextType;return"object"===typeof r&&null!==r?r=Pr(r):(s=Ds(t)?Ps:ks.current,r=(i=null!==(i=t.contextTypes)&&void 0!==i)?Rs(e,s):xs),t=new t(n,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=io,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=r),t}function ao(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&io.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,i){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},Or(e);var r=t.contextType;"object"===typeof r&&null!==r?s.context=Pr(r):(r=Ds(t)?Ps:ks.current,s.context=Rs(e,r)),s.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(no(e,t,r,n),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&io.enqueueReplaceState(s,s.state,null),jr(e,n,s,i),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",i=t;do{n+=B(i),i=i.return}while(i);var s=n}catch(r){s="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:s,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ho="function"===typeof WeakMap?WeakMap:Map;function po(e,t,n){(n=Ur(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){$l||($l=!0,ql=i),uo(0,t)},n}function fo(e,t,n){(n=Ur(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var s=t.value;n.payload=function(){return i(s)},n.callback=function(){uo(0,t)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof i&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function go(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ho;var s=new Set;i.set(t,s)}else void 0===(s=i.get(t))&&(s=new Set,i.set(t,s));s.has(n)||(s.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function mo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,i,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ur(-1,1)).tag=2,zr(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var yo=w.ReactCurrentOwner,bo=!1;function wo(e,t,n,i){t.child=null===e?_r(t,null,n,i):wr(t,e.child,n,i)}function _o(e,t,n,i,s){n=n.render;var r=t.ref;return Ir(t,s),i=ga(e,t,n,i,r,s),n=ma(),null===e||bo?(sr&&n&&er(t),t.flags|=1,wo(e,t,i,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,$o(e,t,s))}function Ao(e,t,n,i,s){if(null===e){var r=n.type;return"function"!==typeof r||Dc(r)||void 0!==r.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Nc(n.type,null,i,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Eo(e,t,r,i,s))}if(r=e.child,0===(e.lanes&s)){var a=r.memoizedProps;if((n=null!==(n=n.compare)?n:li)(a,i)&&e.ref===t.ref)return $o(e,t,s)}return t.flags|=1,(e=Mc(r,i)).ref=t.ref,e.return=t,t.child=e}function Eo(e,t,n,i,s){if(null!==e){var r=e.memoizedProps;if(li(r,i)&&e.ref===t.ref){if(bo=!1,t.pendingProps=i=r,0===(e.lanes&s))return t.lanes=e.lanes,$o(e,t,s);0!==(131072&e.flags)&&(bo=!0)}}return To(e,t,n,i,s)}function So(e,t,n){var i=t.pendingProps,s=i.children,r=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ts(Ml,Dl),Dl|=n;else{if(0===(1073741824&n))return e=null!==r?r.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ts(Ml,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==r?r.baseLanes:n,Ts(Ml,Dl),Dl|=i}else null!==r?(i=r.baseLanes|n,t.memoizedState=null):i=n,Ts(Ml,Dl),Dl|=i;return wo(e,t,s,n),t.child}function Co(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function To(e,t,n,i,s){var r=Ds(n)?Ps:ks.current;return r=Rs(t,r),Ir(t,s),n=ga(e,t,n,i,r,s),i=ma(),null===e||bo?(sr&&i&&er(t),t.flags|=1,wo(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,$o(e,t,s))}function xo(e,t,n,i,s){if(Ds(n)){var r=!0;Os(t)}else r=!1;if(Ir(t,s),null===t.stateNode)Ho(e,t),ro(t,n,i),oo(t,n,i,s),i=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=Pr(c):c=Rs(t,c=Ds(n)?Ps:ks.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==i||l!==c)&&ao(t,a,i,c),Lr=!1;var d=t.memoizedState;a.state=d,jr(t,i,a,s),l=t.memoizedState,o!==i||d!==l||Is.current||Lr?("function"===typeof u&&(no(t,n,u,i),l=t.memoizedState),(o=Lr||so(t,n,o,i,d,l,c))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Fr(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,h=t.pendingProps,d=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=Pr(l):l=Rs(t,l=Ds(n)?Ps:ks.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==h||d!==l)&&ao(t,a,i,l),Lr=!1,d=t.memoizedState,a.state=d,jr(t,i,a,s);var f=t.memoizedState;o!==h||d!==f||Is.current||Lr?("function"===typeof p&&(no(t,n,p,i),f=t.memoizedState),(c=Lr||so(t,n,c,i,d,f,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,f,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),a.props=i,a.state=f,a.context=l,i=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return ko(e,t,n,i,r,s)}function ko(e,t,n,i,s,r){Co(e,t);var a=0!==(128&t.flags);if(!i&&!a)return s&&Fs(t,n,!1),$o(e,t,r);i=t.stateNode,yo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=wr(t,e.child,null,r),t.child=wr(t,null,o,r)):wo(e,t,o,r),t.memoizedState=i.state,s&&Fs(t,n,!0),t.child}function Io(e){var t=e.stateNode;t.pendingContext?Ns(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ns(0,t.context,!1),Xr(e,t.containerInfo)}function Po(e,t,n,i,s){return pr(),fr(s),t.flags|=256,wo(e,t,n,i),t.child}var Ro,Do,Mo,No,Lo={dehydrated:null,treeContext:null,retryLane:0};function Oo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fo(e,t,n){var i,s=t.pendingProps,a=Zr.current,o=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ts(Zr,1&a),null===e)return cr(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Oc(l,s,0,null),e=Lc(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Oo(n),t.memoizedState=Lo,e):Uo(t,l));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,s,a,o){if(n)return 256&t.flags?(t.flags&=-257,zo(e,t,o,i=co(Error(r(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,s=t.mode,i=Oc({mode:"visible",children:i.children},s,0,null),(a=Lc(a,s,o,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&wr(t,e.child,null,o),t.child.memoizedState=Oo(o),t.memoizedState=Lo,a);if(0===(1&t.mode))return zo(e,t,o,null);if("$!"===s.data){if(i=s.nextSibling&&s.nextSibling.dataset)var l=i.dgst;return i=l,zo(e,t,o,i=co(a=Error(r(419)),i,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(i=Il)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(i.suspendedLanes|o))?0:s)&&s!==a.retryLane&&(a.retryLane=s,Nr(e,s),nc(i,e,s,-1))}return gc(),zo(e,t,o,i=co(Error(r(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=xc.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,ir=cs(s.nextSibling),nr=t,sr=!0,rr=null,null!==e&&(Gs[Ks++]=Qs,Gs[Ks++]=Ys,Gs[Ks++]=Xs,Qs=e.id,Ys=e.overflow,Xs=t),t=Uo(t,i.children),t.flags|=4096,t)}(e,t,l,s,i,a,n);if(o){o=s.fallback,l=t.mode,i=(a=e.child).sibling;var c={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==a?((s=t.child).childLanes=0,s.pendingProps=c,t.deletions=null):(s=Mc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==i?o=Mc(i,o):(o=Lc(o,l,n,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=null===(l=e.child.memoizedState)?Oo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Lo,s}return e=(o=e.child).sibling,s=Mc(o,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=n),s.return=t,s.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Uo(e,t){return(t=Oc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function zo(e,t,n,i){return null!==i&&fr(i),wr(t,e.child,null,n),(e=Uo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Vo(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),kr(e.return,t,n)}function Bo(e,t,n,i,s){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=n,r.tailMode=s)}function jo(e,t,n){var i=t.pendingProps,s=i.revealOrder,r=i.tail;if(wo(e,t,i.children,n),0!==(2&(i=Zr.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Vo(e,n,t);else if(19===e.tag)Vo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Ts(Zr,i),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===ea(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),Bo(t,!1,s,n,r);break;case"backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===ea(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}Bo(t,!0,n,null,r);break;case"together":Bo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ho(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function $o(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ol|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Mc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Mc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function qo(e,t){if(!sr)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Wo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,i|=14680064&s.subtreeFlags,i|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Go(e,t,n){var i=t.pendingProps;switch(tr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wo(t),null;case 1:case 17:return Ds(t.type)&&Ms(),Wo(t),null;case 3:return i=t.stateNode,Qr(),Cs(Is),Cs(ks),na(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(hr(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==rr&&(ac(rr),rr=null))),Do(e,t),Wo(t),null;case 5:Jr(t);var s=Kr(Gr.current);if(n=t.type,null!==e&&null!=t.stateNode)Mo(e,t,n,i,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(r(166));return Wo(t),null}if(e=Kr(qr.current),hr(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[ds]=t,i[ps]=a,e=0!==(1&t.mode),n){case"dialog":zi("cancel",i),zi("close",i);break;case"iframe":case"object":case"embed":zi("load",i);break;case"video":case"audio":for(s=0;s<Li.length;s++)zi(Li[s],i);break;case"source":zi("error",i);break;case"img":case"image":case"link":zi("error",i),zi("load",i);break;case"details":zi("toggle",i);break;case"input":Q(i,a),zi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},zi("invalid",i);break;case"textarea":se(i,a),zi("invalid",i)}for(var l in ye(n,a),s=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,c,e),s=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,c,e),s=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&zi("scroll",i)}switch(n){case"input":W(i),Z(i,a,!0);break;case"textarea":W(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=Zi)}i=s,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[ds]=t,e[ps]=i,Ro(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,i),n){case"dialog":zi("cancel",e),zi("close",e),s=i;break;case"iframe":case"object":case"embed":zi("load",e),s=i;break;case"video":case"audio":for(s=0;s<Li.length;s++)zi(Li[s],e);s=i;break;case"source":zi("error",e),s=i;break;case"img":case"image":case"link":zi("error",e),zi("load",e),s=i;break;case"details":zi("toggle",e),s=i;break;case"input":Q(e,i),s=X(e,i),zi("invalid",e);break;case"option":default:s=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},s=F({},i,{value:void 0}),zi("invalid",e);break;case"textarea":se(e,i),s=ie(e,i),zi("invalid",e)}for(a in ye(n,s),c=s)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?me(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&zi("scroll",e):null!=u&&b(e,a,u,l))}switch(n){case"input":W(e),Z(e,i,!1);break;case"textarea":W(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+$(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=Zi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Wo(t),null;case 6:if(e&&null!=t.stateNode)No(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(r(166));if(n=Kr(Gr.current),Kr(qr.current),hr(t)){if(i=t.stateNode,n=t.memoizedProps,i[ds]=t,(a=i.nodeValue!==n)&&null!==(e=nr))switch(e.tag){case 3:Ji(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[ds]=t,t.stateNode=i}return Wo(t),null;case 13:if(Cs(Zr),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(sr&&null!==ir&&0!==(1&t.mode)&&0===(128&t.flags))dr(),pr(),t.flags|=98560,a=!1;else if(a=hr(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(r(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(r(317));a[ds]=t}else pr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wo(t),a=!1}else null!==rr&&(ac(rr),rr=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zr.current)?0===Nl&&(Nl=3):gc())),null!==t.updateQueue&&(t.flags|=4),Wo(t),null);case 4:return Qr(),Do(e,t),null===e&&ji(t.stateNode.containerInfo),Wo(t),null;case 10:return xr(t.type._context),Wo(t),null;case 19:if(Cs(Zr),null===(a=t.memoizedState))return Wo(t),null;if(i=0!==(128&t.flags),null===(l=a.rendering))if(i)qo(a,!1);else{if(0!==Nl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,qo(a,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ts(Zr,1&Zr.current|2),t.child}e=e.sibling}null!==a.tail&&Ye()>jl&&(t.flags|=128,i=!0,qo(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ea(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),qo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!sr)return Wo(t),null}else 2*Ye()-a.renderingStartTime>jl&&1073741824!==n&&(t.flags|=128,i=!0,qo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ye(),t.sibling=null,n=Zr.current,Ts(Zr,i?1&n|2:1&n),t):(Wo(t),null);case 22:case 23:return hc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Dl)&&(Wo(t),6&t.subtreeFlags&&(t.flags|=8192)):Wo(t),null;case 24:case 25:return null}throw Error(r(156,t.tag))}function Ko(e,t){switch(tr(t),t.tag){case 1:return Ds(t.type)&&Ms(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qr(),Cs(Is),Cs(ks),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Jr(t),null;case 13:if(Cs(Zr),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));pr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Cs(Zr),null;case 4:return Qr(),null;case 10:return xr(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Ro=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Do=function(){},Mo=function(e,t,n,i){var s=e.memoizedProps;if(s!==i){e=t.stateNode,Kr(qr.current);var r,a=null;switch(n){case"input":s=X(e,s),i=X(e,i),a=[];break;case"select":s=F({},s,{value:void 0}),i=F({},i,{value:void 0}),a=[];break;case"textarea":s=ie(e,s),i=ie(e,i),a=[];break;default:"function"!==typeof s.onClick&&"function"===typeof i.onClick&&(e.onclick=Zi)}for(u in ye(n,i),n=null,s)if(!i.hasOwnProperty(u)&&s.hasOwnProperty(u)&&null!=s[u])if("style"===u){var l=s[u];for(r in l)l.hasOwnProperty(r)&&(n||(n={}),n[r]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=s?s[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(r in l)!l.hasOwnProperty(r)||c&&c.hasOwnProperty(r)||(n||(n={}),n[r]="");for(r in c)c.hasOwnProperty(r)&&l[r]!==c[r]&&(n||(n={}),n[r]=c[r])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&zi("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},No=function(e,t,n,i){n!==i&&(t.flags|=4)};var Xo=!1,Qo=!1,Yo="function"===typeof WeakSet?WeakSet:Set,Jo=null;function Zo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Sc(e,t,i)}else n.current=null}function el(e,t,n){try{n()}catch(i){Sc(e,t,i)}}var tl=!1;function nl(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var s=i=i.next;do{if((s.tag&e)===e){var r=s.destroy;s.destroy=void 0,void 0!==r&&el(t,n,r)}s=s.next}while(s!==i)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function sl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function rl(e){var t=e.alternate;null!==t&&(e.alternate=null,rl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ds],delete t[ps],delete t[gs],delete t[ms],delete t[vs])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zi));else if(4!==i&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,hl=!1;function dl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(rt&&"function"===typeof rt.onCommitFiberUnmount)try{rt.onCommitFiberUnmount(st,n)}catch(o){}switch(n.tag){case 5:Qo||Zo(n,t);case 6:var i=ul,s=hl;ul=null,dl(e,t,n),hl=s,null!==(ul=i)&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?ls(e.parentNode,n):1===e.nodeType&&ls(e,n),jt(e)):ls(ul,n.stateNode));break;case 4:i=ul,s=hl,ul=n.stateNode.containerInfo,hl=!0,dl(e,t,n),ul=i,hl=s;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){s=i=i.next;do{var r=s,a=r.destroy;r=r.tag,void 0!==a&&(0!==(2&r)||0!==(4&r))&&el(n,t,a),s=s.next}while(s!==i)}dl(e,t,n);break;case 1:if(!Qo&&(Zo(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(o){Sc(n,t,o)}dl(e,t,n);break;case 21:dl(e,t,n);break;case 22:1&n.mode?(Qo=(i=Qo)||null!==n.memoizedState,dl(e,t,n),Qo=i):dl(e,t,n);break;default:dl(e,t,n)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Yo),t.forEach((function(t){var i=kc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function gl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var s=n[i];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,hl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===ul)throw Error(r(160));pl(a,o,s),ul=null,hl=!1;var c=s.alternate;null!==c&&(c.return=null),s.return=null}catch(u){Sc(s,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)ml(t,e),t=t.sibling}function ml(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),vl(e),4&i){try{nl(3,e,e.return),il(3,e)}catch(m){Sc(e,e.return,m)}try{nl(5,e,e.return)}catch(m){Sc(e,e.return,m)}}break;case 1:gl(t,e),vl(e),512&i&&null!==n&&Zo(n,n.return);break;case 5:if(gl(t,e),vl(e),512&i&&null!==n&&Zo(n,n.return),32&e.flags){var s=e.stateNode;try{de(s,"")}catch(m){Sc(e,e.return,m)}}if(4&i&&null!=(s=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&Y(s,a),be(l,o);var u=be(l,a);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];"style"===h?me(s,d):"dangerouslySetInnerHTML"===h?he(s,d):"children"===h?de(s,d):b(s,h,d,u)}switch(l){case"input":J(s,a);break;case"textarea":re(s,a);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ne(s,!!a.multiple,f,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(s,!!a.multiple,a.defaultValue,!0):ne(s,!!a.multiple,a.multiple?[]:"",!1))}s[ps]=a}catch(m){Sc(e,e.return,m)}}break;case 6:if(gl(t,e),vl(e),4&i){if(null===e.stateNode)throw Error(r(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(m){Sc(e,e.return,m)}}break;case 3:if(gl(t,e),vl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{jt(t.containerInfo)}catch(m){Sc(e,e.return,m)}break;case 4:default:gl(t,e),vl(e);break;case 13:gl(t,e),vl(e),8192&(s=e.child).flags&&(a=null!==s.memoizedState,s.stateNode.isHidden=a,!a||null!==s.alternate&&null!==s.alternate.memoizedState||(Bl=Ye())),4&i&&fl(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Qo=(u=Qo)||h,gl(t,e),Qo=u):gl(t,e),vl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(Jo=e,h=e.child;null!==h;){for(d=Jo=h;null!==Jo;){switch(f=(p=Jo).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Zo(p,p.return);var g=p.stateNode;if("function"===typeof g.componentWillUnmount){i=p,n=p.return;try{t=i,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(m){Sc(i,n,m)}}break;case 5:Zo(p,p.return);break;case 22:if(null!==p.memoizedState){_l(d);continue}}null!==f?(f.return=p,Jo=f):_l(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{s=d.stateNode,u?"function"===typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=d.stateNode,o=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=ge("display",o))}catch(m){Sc(e,e.return,m)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){Sc(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gl(t,e),vl(e),4&i&&fl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var i=n;break e}n=n.return}throw Error(r(160))}switch(i.tag){case 5:var s=i.stateNode;32&i.flags&&(de(s,""),i.flags&=-33),cl(e,ol(e),s);break;case 3:case 4:var a=i.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(r(161))}}catch(o){Sc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Jo=e,bl(e,t,n)}function bl(e,t,n){for(var i=0!==(1&e.mode);null!==Jo;){var s=Jo,r=s.child;if(22===s.tag&&i){var a=null!==s.memoizedState||Xo;if(!a){var o=s.alternate,l=null!==o&&null!==o.memoizedState||Qo;o=Xo;var c=Qo;if(Xo=a,(Qo=l)&&!c)for(Jo=s;null!==Jo;)l=(a=Jo).child,22===a.tag&&null!==a.memoizedState?Al(s):null!==l?(l.return=a,Jo=l):Al(s);for(;null!==r;)Jo=r,bl(r,t,n),r=r.sibling;Jo=s,Xo=o,Qo=c}wl(e)}else 0!==(8772&s.subtreeFlags)&&null!==r?(r.return=s,Jo=r):wl(e)}}function wl(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qo||il(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Qo)if(null===n)i.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);i.componentDidUpdate(s,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Hr(t,a,i);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Hr(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&jt(d)}}}break;default:throw Error(r(163))}Qo||512&t.flags&&sl(t)}catch(p){Sc(t,t.return,p)}}if(t===e){Jo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Jo=n;break}Jo=t.return}}function _l(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Jo=n;break}Jo=t.return}}function Al(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(l){Sc(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var s=t.return;try{i.componentDidMount()}catch(l){Sc(t,s,l)}}var r=t.return;try{sl(t)}catch(l){Sc(t,r,l)}break;case 5:var a=t.return;try{sl(t)}catch(l){Sc(t,a,l)}}}catch(l){Sc(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var El,Sl=Math.ceil,Cl=w.ReactCurrentDispatcher,Tl=w.ReactCurrentOwner,xl=w.ReactCurrentBatchConfig,kl=0,Il=null,Pl=null,Rl=0,Dl=0,Ml=Ss(0),Nl=0,Ll=null,Ol=0,Fl=0,Ul=0,zl=null,Vl=null,Bl=0,jl=1/0,Hl=null,$l=!1,ql=null,Wl=null,Gl=!1,Kl=null,Xl=0,Ql=0,Yl=null,Jl=-1,Zl=0;function ec(){return 0!==(6&kl)?Ye():-1!==Jl?Jl:Jl=Ye()}function tc(e){return 0===(1&e.mode)?1:0!==(2&kl)&&0!==Rl?Rl&-Rl:null!==gr.transition?(0===Zl&&(Zl=gt()),Zl):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function nc(e,t,n,i){if(50<Ql)throw Ql=0,Yl=null,Error(r(185));vt(e,n,i),0!==(2&kl)&&e===Il||(e===Il&&(0===(2&kl)&&(Fl|=n),4===Nl&&oc(e,Rl)),ic(e,i),1===n&&0===kl&&0===(1&t.mode)&&(jl=Ye()+500,zs&&js()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,s=e.expirationTimes,r=e.pendingLanes;0<r;){var a=31-at(r),o=1<<a,l=s[a];-1===l?0!==(o&n)&&0===(o&i)||(s[a]=pt(o,t)):l<=t&&(e.expiredLanes|=o),r&=~o}}(e,t);var i=dt(e,e===Il?Rl:0);if(0===i)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){zs=!0,Bs(e)}(lc.bind(null,e)):Bs(lc.bind(null,e)),as((function(){0===(6&kl)&&js()})),n=null;else{switch(wt(i)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Ic(n,sc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sc(e,t){if(Jl=-1,Zl=0,0!==(6&kl))throw Error(r(327));var n=e.callbackNode;if(Ac()&&e.callbackNode!==n)return null;var i=dt(e,e===Il?Rl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=mc(e,i);else{t=i;var s=kl;kl|=2;var a=fc();for(Il===e&&Rl===t||(Hl=null,jl=Ye()+500,dc(e,t));;)try{yc();break}catch(l){pc(e,l)}Tr(),Cl.current=a,kl=s,null!==Pl?t=0:(Il=null,Rl=0,t=Nl)}if(0!==t){if(2===t&&(0!==(s=ft(e))&&(i=s,t=rc(e,s))),1===t)throw n=Ll,dc(e,0),oc(e,i),ic(e,Ye()),n;if(6===t)oc(e,i);else{if(s=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var s=n[i],r=s.getSnapshot;s=s.value;try{if(!oi(r(),s))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=mc(e,i))&&(0!==(a=ft(e))&&(i=a,t=rc(e,a))),1===t))throw n=Ll,dc(e,0),oc(e,i),ic(e,Ye()),n;switch(e.finishedWork=s,e.finishedLanes=i,t){case 0:case 1:throw Error(r(345));case 2:case 5:_c(e,Vl,Hl);break;case 3:if(oc(e,i),(130023424&i)===i&&10<(t=Bl+500-Ye())){if(0!==dt(e,0))break;if(((s=e.suspendedLanes)&i)!==i){ec(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=is(_c.bind(null,e,Vl,Hl),t);break}_c(e,Vl,Hl);break;case 4:if(oc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,s=-1;0<i;){var o=31-at(i);a=1<<o,(o=t[o])>s&&(s=o),i&=~a}if(i=s,10<(i=(120>(i=Ye()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Sl(i/1960))-i)){e.timeoutHandle=is(_c.bind(null,e,Vl,Hl),i);break}_c(e,Vl,Hl);break;default:throw Error(r(329))}}}return ic(e,Ye()),e.callbackNode===n?sc.bind(null,e):null}function rc(e,t){var n=zl;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=Vl,Vl=n,null!==t&&ac(t)),e}function ac(e){null===Vl?Vl=e:Vl.push.apply(Vl,e)}function oc(e,t){for(t&=~Ul,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function lc(e){if(0!==(6&kl))throw Error(r(327));Ac();var t=dt(e,0);if(0===(1&t))return ic(e,Ye()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var i=ft(e);0!==i&&(t=i,n=rc(e,i))}if(1===n)throw n=Ll,dc(e,0),oc(e,t),ic(e,Ye()),n;if(6===n)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_c(e,Vl,Hl),ic(e,Ye()),null}function cc(e,t){var n=kl;kl|=1;try{return e(t)}finally{0===(kl=n)&&(jl=Ye()+500,zs&&js())}}function uc(e){null!==Kl&&0===Kl.tag&&0===(6&kl)&&Ac();var t=kl;kl|=1;var n=xl.transition,i=bt;try{if(xl.transition=null,bt=1,e)return e()}finally{bt=i,xl.transition=n,0===(6&(kl=t))&&js()}}function hc(){Dl=Ml.current,Cs(Ml)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ss(n)),null!==Pl)for(n=Pl.return;null!==n;){var i=n;switch(tr(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Ms();break;case 3:Qr(),Cs(Is),Cs(ks),na();break;case 5:Jr(i);break;case 4:Qr();break;case 13:case 19:Cs(Zr);break;case 10:xr(i.type._context);break;case 22:case 23:hc()}n=n.return}if(Il=e,Pl=e=Mc(e.current,null),Rl=Dl=t,Nl=0,Ll=null,Ul=Fl=Ol=0,Vl=zl=null,null!==Rr){for(t=0;t<Rr.length;t++)if(null!==(i=(n=Rr[t]).interleaved)){n.interleaved=null;var s=i.next,r=n.pending;if(null!==r){var a=r.next;r.next=s,i.next=a}n.pending=i}Rr=null}return e}function pc(e,t){for(;;){var n=Pl;try{if(Tr(),ia.current=Ya,ca){for(var i=aa.memoizedState;null!==i;){var s=i.queue;null!==s&&(s.pending=null),i=i.next}ca=!1}if(ra=0,la=oa=aa=null,ua=!1,ha=0,Tl.current=null,null===n||null===n.return){Nl=1,Ll=t,Pl=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Rl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=mo(o);if(null!==f){f.flags&=-257,vo(f,o,l,0,t),1&f.mode&&go(a,u,t),c=u;var g=(t=f).updateQueue;if(null===g){var m=new Set;m.add(c),t.updateQueue=m}else g.add(c);break e}if(0===(1&t)){go(a,u,t),gc();break e}c=Error(r(426))}else if(sr&&1&l.mode){var v=mo(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),fr(lo(c,l));break e}}a=c=lo(c,l),4!==Nl&&(Nl=2),null===zl?zl=[a]:zl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Br(a,po(0,c,t));break e;case 1:l=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Wl||!Wl.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,Br(a,fo(a,l,t));break e}}a=a.return}while(null!==a)}wc(n)}catch(w){t=w,Pl===n&&null!==n&&(Pl=n=n.return);continue}break}}function fc(){var e=Cl.current;return Cl.current=Ya,null===e?Ya:e}function gc(){0!==Nl&&3!==Nl&&2!==Nl||(Nl=4),null===Il||0===(268435455&Ol)&&0===(268435455&Fl)||oc(Il,Rl)}function mc(e,t){var n=kl;kl|=2;var i=fc();for(Il===e&&Rl===t||(Hl=null,dc(e,t));;)try{vc();break}catch(s){pc(e,s)}if(Tr(),kl=n,Cl.current=i,null!==Pl)throw Error(r(261));return Il=null,Rl=0,Nl}function vc(){for(;null!==Pl;)bc(Pl)}function yc(){for(;null!==Pl&&!Xe();)bc(Pl)}function bc(e){var t=El(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?wc(e):Pl=t,Tl.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Go(n,t,Dl)))return void(Pl=n)}else{if(null!==(n=Ko(n,t)))return n.flags&=32767,void(Pl=n);if(null===e)return Nl=6,void(Pl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pl=t);Pl=t=e}while(null!==t);0===Nl&&(Nl=5)}function _c(e,t,n){var i=bt,s=xl.transition;try{xl.transition=null,bt=1,function(e,t,n,i){do{Ac()}while(null!==Kl);if(0!==(6&kl))throw Error(r(327));n=e.finishedWork;var s=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-at(n),r=1<<s;t[s]=0,i[s]=-1,e[s]=-1,n&=~r}}(e,a),e===Il&&(Pl=Il=null,Rl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Gl||(Gl=!0,Ic(tt,(function(){return Ac(),null}))),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=xl.transition,xl.transition=null;var o=bt;bt=1;var l=kl;kl|=4,Tl.current=null,function(e,t){if(es=$t,pi(e=di())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var s=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(_){n=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==s&&3!==d.nodeType||(l=o+s),d!==a||0!==i&&3!==d.nodeType||(c=o+i),3===d.nodeType&&(o+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===s&&(l=o),p===a&&++h===i&&(c=o),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ts={focusedElem:e,selectionRange:n},$t=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,v=g.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:to(t.type,m),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(r(163))}}catch(_){Sc(t,t.return,_)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}g=tl,tl=!1}(e,n),ml(n,e),fi(ts),$t=!!es,ts=es=null,e.current=n,yl(n,e,s),Qe(),kl=l,bt=o,xl.transition=a}else e.current=n;if(Gl&&(Gl=!1,Kl=e,Xl=s),a=e.pendingLanes,0===a&&(Wl=null),function(e){if(rt&&"function"===typeof rt.onCommitFiberRoot)try{rt.onCommitFiberRoot(st,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ic(e,Ye()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],i(s.value,{componentStack:s.stack,digest:s.digest});if($l)throw $l=!1,e=ql,ql=null,e;0!==(1&Xl)&&0!==e.tag&&Ac(),a=e.pendingLanes,0!==(1&a)?e===Yl?Ql++:(Ql=0,Yl=e):Ql=0,js()}(e,t,n,i)}finally{xl.transition=s,bt=i}return null}function Ac(){if(null!==Kl){var e=wt(Xl),t=xl.transition,n=bt;try{if(xl.transition=null,bt=16>e?16:e,null===Kl)var i=!1;else{if(e=Kl,Kl=null,Xl=0,0!==(6&kl))throw Error(r(331));var s=kl;for(kl|=4,Jo=e.current;null!==Jo;){var a=Jo,o=a.child;if(0!==(16&Jo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Jo=u;null!==Jo;){var h=Jo;switch(h.tag){case 0:case 11:case 15:nl(8,h,a)}var d=h.child;if(null!==d)d.return=h,Jo=d;else for(;null!==Jo;){var p=(h=Jo).sibling,f=h.return;if(rl(h),h===u){Jo=null;break}if(null!==p){p.return=f,Jo=p;break}Jo=f}}}var g=a.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}Jo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(a=Jo).flags))switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Jo=y;break e}Jo=a.return}}var b=e.current;for(Jo=b;null!==Jo;){var w=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==w)w.return=o,Jo=w;else e:for(o=b;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(A){Sc(l,l.return,A)}if(l===o){Jo=null;break e}var _=l.sibling;if(null!==_){_.return=l.return,Jo=_;break e}Jo=l.return}}if(kl=s,js(),rt&&"function"===typeof rt.onPostCommitFiberRoot)try{rt.onPostCommitFiberRoot(st,e)}catch(A){}i=!0}return i}finally{bt=n,xl.transition=t}}return!1}function Ec(e,t,n){e=zr(e,t=po(0,t=lo(n,t),1),1),t=ec(),null!==e&&(vt(e,1,t),ic(e,t))}function Sc(e,t,n){if(3===e.tag)Ec(e,e,n);else for(;null!==t;){if(3===t.tag){Ec(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Wl||!Wl.has(i))){t=zr(t,e=fo(t,e=lo(n,e),1),1),e=ec(),null!==t&&(vt(t,1,e),ic(t,e));break}}t=t.return}}function Cc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(Rl&n)===n&&(4===Nl||3===Nl&&(130023424&Rl)===Rl&&500>Ye()-Bl?dc(e,0):Ul|=n),ic(e,t)}function Tc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Nr(e,t))&&(vt(e,t,n),ic(e,n))}function xc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tc(e,n)}function kc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(r(314))}null!==i&&i.delete(t),Tc(e,n)}function Ic(e,t){return Ge(e,t)}function Pc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,n,i){return new Pc(e,t,n,i)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mc(e,t){var n=e.alternate;return null===n?((n=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Nc(e,t,n,i,s,a){var o=2;if(i=e,"function"===typeof e)Dc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case E:return Lc(n.children,s,a,t);case S:o=8,s|=8;break;case C:return(e=Rc(12,n,t,2|s)).elementType=C,e.lanes=a,e;case I:return(e=Rc(13,n,t,s)).elementType=I,e.lanes=a,e;case P:return(e=Rc(19,n,t,s)).elementType=P,e.lanes=a,e;case M:return Oc(n,s,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:o=10;break e;case x:o=9;break e;case k:o=11;break e;case R:o=14;break e;case D:o=16,i=null;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=Rc(o,n,t,s)).elementType=e,t.type=i,t.lanes=a,t}function Lc(e,t,n,i){return(e=Rc(7,e,i,t)).lanes=n,e}function Oc(e,t,n,i){return(e=Rc(22,e,i,t)).elementType=M,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=Rc(6,e,null,t)).lanes=n,e}function Uc(e,t,n){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zc(e,t,n,i,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Vc(e,t,n,i,s,r,a,o,l){return e=new zc(e,t,n,o,l),1===t?(t=1,!0===r&&(t|=8)):t=0,r=Rc(3,null,null,t),e.current=r,r.stateNode=e,r.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Or(r),e}function Bc(e){if(!e)return xs;e:{if(je(e=e._reactInternals)!==e||1!==e.tag)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ds(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(r(171))}if(1===e.tag){var n=e.type;if(Ds(n))return Ls(e,n,t)}return t}function jc(e,t,n,i,s,r,a,o,l){return(e=Vc(n,i,!0,e,0,r,0,o,l)).context=Bc(null),n=e.current,(r=Ur(i=ec(),s=tc(n))).callback=void 0!==t&&null!==t?t:null,zr(n,r,s),e.current.lanes=s,vt(e,s,i),ic(e,i),e}function Hc(e,t,n,i){var s=t.current,r=ec(),a=tc(s);return n=Bc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ur(r,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=zr(s,t,a))&&(nc(e,s,a,r),Vr(e,s,a)),a}function $c(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function qc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){qc(e,t),(e=e.alternate)&&qc(e,t)}El=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Is.current)bo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bo=!1,function(e,t,n){switch(t.tag){case 3:Io(t),pr();break;case 5:Yr(t);break;case 1:Ds(t.type)&&Os(t);break;case 4:Xr(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,s=t.memoizedProps.value;Ts(Ar,i._currentValue),i._currentValue=s;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Ts(Zr,1&Zr.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fo(e,t,n):(Ts(Zr,1&Zr.current),null!==(e=$o(e,t,n))?e.sibling:null);Ts(Zr,1&Zr.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return jo(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ts(Zr,Zr.current),i)break;return null;case 22:case 23:return t.lanes=0,So(e,t,n)}return $o(e,t,n)}(e,t,n);bo=0!==(131072&e.flags)}else bo=!1,sr&&0!==(1048576&t.flags)&&Zs(t,Ws,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ho(e,t),e=t.pendingProps;var s=Rs(t,ks.current);Ir(t,n),s=ga(null,t,i,e,s,n);var a=ma();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ds(i)?(a=!0,Os(t)):a=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Or(t),s.updater=io,t.stateNode=s,s._reactInternals=t,oo(t,i,e,n),t=ko(null,t,i,!0,a,n)):(t.tag=0,sr&&a&&er(t),wo(null,t,s,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ho(e,t),e=t.pendingProps,i=(s=i._init)(i._payload),t.type=i,s=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===k)return 11;if(e===R)return 14}return 2}(i),e=to(i,e),s){case 0:t=To(null,t,i,e,n);break e;case 1:t=xo(null,t,i,e,n);break e;case 11:t=_o(null,t,i,e,n);break e;case 14:t=Ao(null,t,i,to(i.type,e),n);break e}throw Error(r(306,i,""))}return t;case 0:return i=t.type,s=t.pendingProps,To(e,t,i,s=t.elementType===i?s:to(i,s),n);case 1:return i=t.type,s=t.pendingProps,xo(e,t,i,s=t.elementType===i?s:to(i,s),n);case 3:e:{if(Io(t),null===e)throw Error(r(387));i=t.pendingProps,s=(a=t.memoizedState).element,Fr(e,t),jr(t,i,null,n);var o=t.memoizedState;if(i=o.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Po(e,t,i,n,s=lo(Error(r(423)),t));break e}if(i!==s){t=Po(e,t,i,n,s=lo(Error(r(424)),t));break e}for(ir=cs(t.stateNode.containerInfo.firstChild),nr=t,sr=!0,rr=null,n=_r(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pr(),i===s){t=$o(e,t,n);break e}wo(e,t,i,n)}t=t.child}return t;case 5:return Yr(t),null===e&&cr(t),i=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,o=s.children,ns(i,s)?o=null:null!==a&&ns(i,a)&&(t.flags|=32),Co(e,t),wo(e,t,o,n),t.child;case 6:return null===e&&cr(t),null;case 13:return Fo(e,t,n);case 4:return Xr(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=wr(t,null,i,n):wo(e,t,i,n),t.child;case 11:return i=t.type,s=t.pendingProps,_o(e,t,i,s=t.elementType===i?s:to(i,s),n);case 7:return wo(e,t,t.pendingProps,n),t.child;case 8:case 12:return wo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,s=t.pendingProps,a=t.memoizedProps,o=s.value,Ts(Ar,i._currentValue),i._currentValue=o,null!==a)if(oi(a.value,o)){if(a.children===s.children&&!Is.current){t=$o(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===a.tag){(c=Ur(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),kr(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(r(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),kr(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}wo(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,i=t.pendingProps.children,Ir(t,n),i=i(s=Pr(s)),t.flags|=1,wo(e,t,i,n),t.child;case 14:return s=to(i=t.type,t.pendingProps),Ao(e,t,i,s=to(i.type,s),n);case 15:return Eo(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:to(i,s),Ho(e,t),t.tag=1,Ds(i)?(e=!0,Os(t)):e=!1,Ir(t,n),ro(t,i,s),oo(t,i,s,n),ko(null,t,i,!0,e,n);case 19:return jo(e,t,n);case 22:return So(e,t,n)}throw Error(r(156,t.tag))};var Gc="function"===typeof reportError?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function Zc(e,t,n,i,s){var r=n._reactRootContainer;if(r){var a=r;if("function"===typeof s){var o=s;s=function(){var e=$c(a);o.call(e)}}Hc(t,a,e,s)}else a=function(e,t,n,i,s){if(s){if("function"===typeof i){var r=i;i=function(){var e=$c(a);r.call(e)}}var a=jc(t,i,e,0,null,!1,0,"",Jc);return e._reactRootContainer=a,e[fs]=a.current,ji(8===e.nodeType?e.parentNode:e),uc(),a}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof i){var o=i;i=function(){var e=$c(l);o.call(e)}}var l=Vc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[fs]=l.current,ji(8===e.nodeType?e.parentNode:e),uc((function(){Hc(t,l,n,i)})),l}(n,t,e,s,i);return $c(a)}Xc.prototype.render=Kc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));Hc(e,t,null,null)},Xc.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc((function(){Hc(null,e,null,null)})),t[fs]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Mt.length&&0!==t&&t<Mt[n].priority;n++);Mt.splice(n,0,e),0===n&&Ft(e)}},_t=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),ic(t,Ye()),0===(6&kl)&&(jl=Ye()+500,js()))}break;case 13:uc((function(){var t=Nr(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),Wc(e,1)}},At=function(e){if(13===e.tag){var t=Nr(e,134217728);if(null!==t)nc(t,e,134217728,ec());Wc(e,134217728)}},Et=function(e){if(13===e.tag){var t=tc(e),n=Nr(e,t);if(null!==n)nc(n,e,t,ec());Wc(e,t)}},St=function(){return bt},Ct=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Ae=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var s=_s(i);if(!s)throw Error(r(90));G(i),J(i,s)}}}break;case"textarea":re(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},ke=cc,Ie=uc;var eu={usingClientEntryPoint:!1,Events:[bs,ws,_s,Te,xe,cc]},tu={findFiberByHostInstance:ys,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{st=iu.inject(nu),rt=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(r(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:A,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(r(299));var n=!1,i="",s=Gc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Vc(e,1,!1,null,0,n,0,i,s),e[fs]=t.current,ji(8===e.nodeType?e.parentNode:e),new Kc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Yc(t))throw Error(r(200));return Zc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(r(405));var i=null!=n&&n.hydratedSources||null,s=!1,a="",o=Gc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=jc(t,null,e,1,null!=n?n:null,s,0,a,o),e[fs]=t.current,ji(e),i)for(e=0;e<i.length;e++)s=(s=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Xc(t)},t.render=function(e,t,n){if(!Yc(t))throw Error(r(200));return Zc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Yc(e))throw Error(r(40));return!!e._reactRootContainer&&(uc((function(){Zc(null,null,e,!1,(function(){e._reactRootContainer=null,e[fs]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Yc(n))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return Zc(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},8853:(e,t,n)=>{n.d(t,{XL:()=>l,_h:()=>o,gL:()=>h,ri:()=>c,xw:()=>u});var i=n(3096),s=n(306),r=n(5299);const a=new i.HF;async function o(e,t){try{console.log("\ud83d\udd11 Iniciando sesi\xf3n:",e);const n=(await(0,i.x9)(r.j2,e,t)).user,a=await(0,s.x7)((0,s.H9)(r.db,"users",n.uid));if(!a.exists())throw new Error("Usuario no encontrado en la base de datos");const o=a.data();return await(0,s.mZ)((0,s.H9)(r.db,"users",n.uid),{lastLogin:(0,s.O5)()}),console.log("\u2705 Sesi\xf3n iniciada exitosamente:",n.uid,"Rol:",o.role),{user:n,userData:o}}catch(n){console.error("\u274c Error en login:",n);throw new Error({"auth/user-not-found":"Usuario no encontrado","auth/wrong-password":"Contrase\xf1a incorrecta","auth/invalid-email":"Email inv\xe1lido","auth/user-disabled":"Usuario deshabilitado. Contacta al administrador","auth/too-many-requests":"Demasiados intentos fallidos. Intenta m\xe1s tarde"}[n.code]||n.message)}}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"estudiante";try{console.log("\ud83d\udd11 Iniciando sesi\xf3n con Google...");const t=(await(0,i.df)(r.j2,a)).user,n=(0,s.H9)(r.db,"users",t.uid),o=await(0,s.x7)(n);let l;return o.exists()?(l=o.data(),await(0,s.mZ)(n,{lastLogin:(0,s.O5)(),photoURL:t.photoURL})):(console.log("\ud83d\udcdd Primer login con Google. Creando usuario..."),l={uid:t.uid,email:t.email,nombre:t.displayName||"Usuario",role:e,photoURL:t.photoURL,createdAt:(0,s.O5)(),lastLogin:(0,s.O5)()},await(0,s.BN)(n,l)),console.log("\u2705 Sesi\xf3n con Google exitosa:",t.uid,"Rol:",l.role),{user:t,userData:l}}catch(t){console.error("\u274c Error en login con Google:",t);throw new Error({"auth/popup-closed-by-user":"Popup cerrado. Intenta de nuevo","auth/cancelled-popup-request":"Operaci\xf3n cancelada","auth/popup-blocked":"Popup bloqueado por el navegador. Permite popups para este sitio"}[t.code]||t.message)}}async function c(){try{console.log("\ud83d\udc4b Cerrando sesi\xf3n..."),await(0,i.CI)(r.j2),console.log("\u2705 Sesi\xf3n cerrada")}catch(e){throw console.error("\u274c Error cerrando sesi\xf3n:",e),e}}async function u(e){try{console.log("\ud83d\udce7 Enviando email de recuperaci\xf3n a:",e),await(0,i.J1)(r.j2,e),console.log("\u2705 Email enviado")}catch(t){console.error("\u274c Error enviando email:",t);throw new Error({"auth/user-not-found":"Usuario no encontrado","auth/invalid-email":"Email inv\xe1lido"}[t.code]||t.message)}}async function h(e){try{const t=await(0,s.x7)((0,s.H9)(r.db,"users",e));if(!t.exists())throw new Error("Usuario no encontrado");return t.data()}catch(t){throw console.error("\u274c Error obteniendo datos de usuario:",t),t}}},9916:(e,t,n)=>{n.d(t,{z:()=>m,L0:()=>g,getStudentProgress:()=>c,XF:()=>f,Iq:()=>v,RW:()=>u,e3:()=>p,saveStudentProgress:()=>l,subscribeToStudentProgress:()=>h});var i=n(306),s=n(2423),r=n(5299);function a(e){var t,n,i,s;if(!e)return"0";return function(e){if(!e)return"0";const t=JSON.stringify(e,Object.keys(e).sort());let n=0;for(let i=0;i<t.length;i++)n=(n<<5)-n+t.charCodeAt(i),n|=0;return Math.abs(n).toString(16)}({text:(null===(t=e.text)||void 0===t||null===(n=t.content)||void 0===n?void 0:n.substring(0,1e4))||"",analysisId:(null===(i=e.completeAnalysis)||void 0===i||null===(s=i.metadata)||void 0===s?void 0:s.document_id)||null,rubricScores:e.rubricProgress?Object.keys(e.rubricProgress).reduce(((t,n)=>{var i;return t[n]=(null===(i=e.rubricProgress[n].scores)||void 0===i?void 0:i.length)||0,t}),{}):{},activitiesCompleted:e.activitiesProgress?Object.keys(e.activitiesProgress).reduce(((t,n)=>{var i;return t[n]=(null===(i=e.activitiesProgress[n].preparation)||void 0===i?void 0:i.completed)||!1,t}),{}):{},citationsCount:e.savedCitations?Object.keys(e.savedCitations).reduce(((t,n)=>{var i;return t[n]=(null===(i=e.savedCitations[n])||void 0===i?void 0:i.length)||0,t}),{}):{}})}function o(e,t){var n,i,s,r,a,o;const l=[];((null===(n=e.text)||void 0===n?void 0:n.content)||"")!==((null===(i=t.text)||void 0===i?void 0:i.content)||"")&&l.push("text_content");(null===(s=e.completeAnalysis)||void 0===s||null===(r=s.metadata)||void 0===r?void 0:r.document_id)!==(null===(a=t.completeAnalysis)||void 0===a||null===(o=a.metadata)||void 0===o?void 0:o.document_id)&&l.push("analysis");const c=Object.keys(e.rubricProgress||{}).sort(),u=Object.keys(t.rubricProgress||{}).sort();if(JSON.stringify(c)!==JSON.stringify(u))l.push("rubric_progress_keys");else for(const C of c){var h,d,p,f;((null===(h=e.rubricProgress[C])||void 0===h||null===(d=h.scores)||void 0===d?void 0:d.length)||0)!==((null===(p=t.rubricProgress[C])||void 0===p||null===(f=p.scores)||void 0===f?void 0:f.length)||0)&&l.push(`rubric_${C}_scores`)}const g=Object.keys(e.activitiesProgress||{}).sort(),m=Object.keys(t.activitiesProgress||{}).sort();if(JSON.stringify(g)!==JSON.stringify(m))l.push("activities_progress_keys");else for(const C of g){var v,y,b,w;(null===(v=e.activitiesProgress[C])||void 0===v||null===(y=v.preparation)||void 0===y?void 0:y.completed)!==(null===(b=t.activitiesProgress[C])||void 0===b||null===(w=b.preparation)||void 0===w?void 0:w.completed)&&l.push(`activity_${C}_completion`)}const _=Object.keys(e.savedCitations||{}).sort(),A=Object.keys(t.savedCitations||{}).sort();if(JSON.stringify(_)!==JSON.stringify(A))l.push("citations_keys");else for(const C of _){var E,S;((null===(E=e.savedCitations[C])||void 0===E?void 0:E.length)||0)!==((null===(S=t.savedCitations[C])||void 0===S?void 0:S.length)||0)&&l.push(`citations_${C}_count`)}return{isDifferent:l.length>0,differences:l}}async function l(e,t,n){try{const s=(0,i.H9)(r.db,"students",e,"progress",t),a=await(0,i.x7)(s),o={...a.exists()?a.data():{}};n.rubricProgress&&(o.rubricProgress=o.rubricProgress||{},Object.keys(n.rubricProgress).forEach((e=>{const t=n.rubricProgress[e],i=o.rubricProgress[e];(!i||(t.lastUpdate||0)>(i.lastUpdate||0))&&(o.rubricProgress[e]=t)}))),n.activitiesProgress&&(o.activitiesProgress=o.activitiesProgress||{},Object.keys(n.activitiesProgress).forEach((e=>{var t,i;const s=n.activitiesProgress[e],r=o.activitiesProgress[e];(!r||((null===(t=s.preparation)||void 0===t?void 0:t.updatedAt)||0)>((null===(i=r.preparation)||void 0===i?void 0:i.updatedAt)||0))&&(o.activitiesProgress[e]=s)})));const l=Object.keys(o.rubricProgress||{}).filter((e=>e.startsWith("rubrica"))).map((e=>{var t;return(null===(t=o.rubricProgress[e])||void 0===t?void 0:t.average)||0})).filter((e=>e>0)),c=l.length>0?Math.round(l.reduce(((e,t)=>e+t),0)/l.length*10)/10:0,u={...o,textoId:t,estudianteUid:e,promedio_global:c,ultima_actividad:(0,i.O5)(),updatedAt:(0,i.O5)(),lastSync:n.lastSync||(new Date).toISOString(),syncType:n.syncType||"full"};a.exists()||(u.primera_actividad=(0,i.O5)(),u.total_intentos=0,u.tiempo_total_min=0,u.completado=!1,u.bloqueado=!1),await(0,i.BN)(s,u,{merge:!0}),console.log("\u2705 [Firestore] Progreso guardado con merge inteligente:",e,t)}catch(s){throw console.error("\u274c [Firestore] Error guardando progreso:",s),s}}async function c(e,t){try{var n,s,a,o;const l=(0,i.H9)(r.db,"students",e,"progress",t),c=await(0,i.x7)(l);if(!c.exists())return null;const u=c.data();return{...u,rubricProgress:u.rubricProgress||{},activitiesProgress:u.activitiesProgress||{},promedio_global:u.promedio_global||0,ultima_actividad:(null===(n=u.ultima_actividad)||void 0===n||null===(s=n.toDate)||void 0===s?void 0:s.call(n))||u.ultima_actividad,updatedAt:(null===(a=u.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||u.updatedAt}}catch(l){throw console.error("\u274c Error obteniendo progreso:",l),l}}async function u(e){try{const t=(0,i.H9)((0,i.rJ)(r.db,"evaluaciones")),n={...e,timestamp:(0,i.O5)()};return await(0,i.BN)(t,n),console.log("\u2705 Evaluaci\xf3n guardada:",t.id),t.id}catch(t){throw console.error("\u274c Error guardando evaluaci\xf3n:",t),t}}function h(e,t,n){const s=(0,i.H9)(r.db,"students",e,"progress",t);return(0,i.aQ)(s,(e=>{e.exists()?n(e.data()):n(null)}),(e=>{console.error("\u274c Error en listener de progreso:",e)}))}async function d(e){var t,n,i,s,r,a,o,l,c,u,h,d;const p=e.data();let f=p.textContent||(null===(t=p.text)||void 0===t?void 0:t.content)||null;if(p.textInStorage&&p.textStorageURL&&!f)try{console.log("\ud83d\udce5 [mapSessionDoc] Texto en Storage detectado, descargando..."),f=await async function(e){try{console.log("\ud83d\udce5 [Storage] Descargando texto desde URL...");const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.text();return console.log(`\u2705 [Storage] Texto descargado (${(n.length/1024).toFixed(2)} KB)`),n}catch(t){throw console.error("\u274c [Storage] Error descargando texto:",t),t}}(p.textStorageURL)}catch(y){console.error("\u274c [mapSessionDoc] Error descargando texto desde Storage:",y),f=p.textPreview||null}const g=p.textMetadata||(null===(n=p.text)||void 0===n?void 0:n.metadata)||{},m=f?{content:f,fileName:g.fileName||(null===(i=p.text)||void 0===i?void 0:i.fileName)||"texto_manual",fileType:g.fileType||(null===(s=p.text)||void 0===s?void 0:s.fileType)||"text/plain",metadata:{length:g.length||f.length,words:g.words||(f?f.split(/\s+/).length:0)}}:null,v=p.textPreview||(f?f.substring(0,200):"");return{id:e.id,...p,text:m,textPreview:v,activitiesProgress:p.activitiesProgress||{},createdAt:(null===(r=p.createdAt)||void 0===r||null===(a=r.toDate)||void 0===a?void 0:a.call(r))||p.createdAt,lastModified:(null===(o=p.lastModified)||void 0===o||null===(l=o.toDate)||void 0===l?void 0:l.call(o))||p.lastModified,lastAccess:(null===(c=p.lastAccess)||void 0===c||null===(u=c.toDate)||void 0===u?void 0:u.call(c))||p.lastAccess,updatedAt:(null===(h=p.updatedAt)||void 0===h||null===(d=h.toDate)||void 0===d?void 0:d.call(h))||p.updatedAt,source:"firestore",textInStorage:p.textInStorage||!1,textStorageURL:p.textStorageURL||null}}async function p(e,t){try{var n,a,o,l,c,u,h,d;console.log("\ud83d\udcbe [Firestore] Guardando sesi\xf3n:",t.id);const p=null!==(n=t.text)&&void 0!==n&&n.content?function(e){if(!e)return"empty";let t=0;for(let n=0;n<Math.min(e.length,1e3);n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return Math.abs(t).toString(36)}(t.text.content):"no-text",f=(null===(a=t.text)||void 0===a?void 0:a.content)||"",g=f.substring(0,200),m=1e6,v=f.length<m;let y=null;!v&&f.length>0&&(console.log(`\ud83d\udce6 [Firestore] Texto grande detectado (${(f.length/1024).toFixed(2)} KB), usando Storage...`),y=await async function(e,t,n){try{console.log(`\ud83d\udce4 [Storage] Subiendo texto grande (${(n.length/1024).toFixed(2)} KB)...`);const i=(0,s.KR)(r.IG,`users/${e}/sessions/${t}/text.txt`),a=new Blob([n],{type:"text/plain;charset=utf-8"}),o={contentType:"text/plain",customMetadata:{sessionId:t,userId:e,uploadedAt:(new Date).toISOString(),sizeBytes:n.length.toString()}},l=await(0,s.D)(i,a,o),c=await(0,s.qk)(l.ref);return console.log("\u2705 [Storage] Texto subido exitosamente. URL:",c.substring(0,50)+"..."),c}catch(i){throw console.error("\u274c [Storage] Error subiendo texto:",i),i}}(e,t.id,f));const b={localSessionId:t.id,title:t.title||"Sesi\xf3n sin t\xedtulo",createdAt:new Date(t.createdAt),lastModified:new Date(t.lastModified||t.createdAt),lastAccess:(0,i.O5)(),textHash:p,textPreview:g,textContent:v?f:null,textStorageURL:y||null,textInStorage:!v,textMetadata:{fileName:(null===(o=t.text)||void 0===o?void 0:o.fileName)||"texto_manual",fileType:(null===(l=t.text)||void 0===l?void 0:l.fileType)||"text/plain",length:(null===(c=t.text)||void 0===c||null===(u=c.metadata)||void 0===u?void 0:u.length)||f.length,words:(null===(h=t.text)||void 0===h||null===(d=h.metadata)||void 0===d?void 0:d.words)||0,sizeKB:Math.round(f.length/1024)},hasCompleteAnalysis:!!t.completeAnalysis,completeAnalysis:t.completeAnalysis||null,rubricProgress:t.rubricProgress||{},activitiesProgress:t.activitiesProgress||{},artifactsDrafts:t.artifactsDrafts||{},savedCitations:t.savedCitations||{},settings:t.settings||{},rewardsState:t.rewardsState||null,syncStatus:"synced",userId:e,updatedAt:(0,i.O5)()},w=(0,i.H9)(r.db,"users",e,"sessions",t.id);return await(0,i.BN)(w,b,{merge:!0}),console.log("\u2705 [Firestore] Sesi\xf3n guardada exitosamente:",t.id),t.id}catch(p){throw console.error("\u274c [Firestore] Error guardando sesi\xf3n:",p),p}}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{orderBy:n="lastModified",orderDirection:s="desc",limitCount:a=50,where:o=null}=t;console.log("\ud83d\udce5 [Firestore] Obteniendo sesiones del usuario:",e);const l=(0,i.rJ)(r.db,"users",e,"sessions");let c=(0,i.P)(l,(0,i.My)(n,s));a&&(c=(0,i.P)(c,(0,i.AB)(a)));const u=await(0,i.GG)(c),h=await Promise.all(u.docs.map(d));return console.log(`\u2705 [Firestore] ${h.length} sesiones obtenidas`),h}catch(n){throw console.error("\u274c [Firestore] Error obteniendo sesiones:",n),n}}async function g(e,t){try{const n=(0,i.H9)(r.db,"users",e,"sessions",t),a=await(0,i.x7)(n);a.exists()&&a.data().textInStorage&&(console.log("\ud83d\uddd1\ufe0f [Firestore] Eliminando texto de Storage..."),await async function(e,t){try{const n=(0,s.KR)(r.IG,`users/${e}/sessions/${t}/text.txt`);await(0,s.XR)(n),console.log("\u2705 [Storage] Texto eliminado de Storage")}catch(n){if("storage/object-not-found"!==n.code)throw console.error("\u274c [Storage] Error eliminando texto:",n),n;console.log("\u2139\ufe0f [Storage] Archivo no encontrado (ya eliminado)")}}(e,t)),await(0,i.kd)(n),console.log("\u2705 [Firestore] Sesi\xf3n eliminada:",t)}catch(n){throw console.error("\u274c [Firestore] Error eliminando sesi\xf3n:",n),n}}async function m(e){try{const t=(0,i.rJ)(r.db,"users",e,"sessions"),n=await(0,i.GG)(t),s=(0,i.wP)(r.db);n.docs.forEach((e=>{s.delete(e.ref)})),await s.commit(),console.log(`\u2705 [Firestore] ${n.docs.length} sesiones eliminadas`)}catch(t){throw console.error("\u274c [Firestore] Error eliminando sesiones:",t),t}}function v(e,t){const n=new Map;return t.forEach((e=>{n.set(e.localSessionId||e.id,{...e,source:"firestore",inCloud:!0,inLocal:!1})})),e.forEach((e=>{const t=n.get(e.id);if(t){const i=a(e);if(i===a(t)){const s=new Date(e.lastModified||e.createdAt).getTime(),r=new Date(t.lastModified||t.createdAt).getTime();n.set(e.id,{...s>r?e:t,source:"both",inCloud:!0,inLocal:!0,syncStatus:"synced",contentHash:i})}else{console.log(`\u26a0\ufe0f [mergeSessions] Conflicto en sesi\xf3n ${e.id}, resolviendo...`);const i=o(e,t);console.log("\ud83d\udcca [mergeSessions] Diferencias:",i.differences);const s=function(e,t){const n=o(e,t);if(!n.isDifferent)return new Date(e.lastModified||e.createdAt).getTime()>new Date(t.lastModified||t.createdAt).getTime()?e:t;console.log("\u26a0\ufe0f [SessionHash] Conflicto detectado, mergeando:",n.differences);const i={...t,id:e.id,localSessionId:e.id};if(new Date(e.lastModified||e.createdAt).getTime()>new Date(t.lastModified||t.createdAt).getTime()&&(i.lastModified=e.lastModified),n.differences.includes("text_content")){var s,r,a,l;const n=(null===(s=e.text)||void 0===s||null===(r=s.content)||void 0===r?void 0:r.length)||0,o=(null===(a=t.text)||void 0===a||null===(l=a.content)||void 0===l?void 0:l.length)||0;i.text=n>o?e.text:t.text}n.differences.includes("analysis")&&(i.completeAnalysis=e.completeAnalysis||t.completeAnalysis),n.differences.some((e=>e.startsWith("rubric")))&&(i.rubricProgress={},new Set([...Object.keys(e.rubricProgress||{}),...Object.keys(t.rubricProgress||{})]).forEach((n=>{var s,r,a,o,l,c,u,h;const d=[...(null===(s=e.rubricProgress)||void 0===s||null===(r=s[n])||void 0===r?void 0:r.scores)||[],...(null===(a=t.rubricProgress)||void 0===a||null===(o=a[n])||void 0===o?void 0:o.scores)||[]].filter(((e,t,n)=>t===n.findIndex((t=>t.timestamp===e.timestamp)))).sort(((e,t)=>e.timestamp-t.timestamp)),p=d.slice(-3),f=p.length>0?p.reduce(((e,t)=>e+t.score),0)/p.length:0;i.rubricProgress[n]={scores:d,average:Math.round(10*f)/10,lastUpdate:Math.max(...d.map((e=>e.timestamp))),artefactos:[...new Set([...(null===(l=e.rubricProgress)||void 0===l||null===(c=l[n])||void 0===c?void 0:c.artefactos)||[],...(null===(u=t.rubricProgress)||void 0===u||null===(h=u[n])||void 0===h?void 0:h.artefactos)||[]])]}})));n.differences.some((e=>e.startsWith("activity")))&&(i.activitiesProgress={},new Set([...Object.keys(e.activitiesProgress||{}),...Object.keys(t.activitiesProgress||{})]).forEach((n=>{var s,r,a,o;const l=null===(s=e.activitiesProgress)||void 0===s||null===(r=s[n])||void 0===r?void 0:r.preparation,c=null===(a=t.activitiesProgress)||void 0===a||null===(o=a[n])||void 0===o?void 0:o.preparation;i.activitiesProgress[n]={preparation:{mcqPassed:(null===l||void 0===l?void 0:l.mcqPassed)||(null===c||void 0===c?void 0:c.mcqPassed)||!1,mcqResults:(null===l||void 0===l?void 0:l.mcqResults)||(null===c||void 0===c?void 0:c.mcqResults)||null,completed:(null===l||void 0===l?void 0:l.completed)||(null===c||void 0===c?void 0:c.completed)||!1,synthesisAnswers:(null===l||void 0===l?void 0:l.synthesisAnswers)||(null===c||void 0===c?void 0:c.synthesisAnswers)||null,updatedAt:Math.max((null===l||void 0===l?void 0:l.updatedAt)||0,(null===c||void 0===c?void 0:c.updatedAt)||0)}}})));n.differences.some((e=>e.startsWith("citations")))&&(i.savedCitations={},new Set([...Object.keys(e.savedCitations||{}),...Object.keys(t.savedCitations||{})]).forEach((n=>{var s,r;const a=[...(null===(s=e.savedCitations)||void 0===s?void 0:s[n])||[],...(null===(r=t.savedCitations)||void 0===r?void 0:r[n])||[]].filter(((e,t,n)=>t===n.findIndex((t=>t.id===e.id))));i.savedCitations[n]=a})));return i.syncStatus="merged",i.mergedAt=Date.now(),i}(e,t);n.set(e.id,{...s,source:"both",inCloud:!0,inLocal:!0,syncStatus:"needs-sync",contentHash:a(s),hasConflict:!0,conflictResolved:!0,resolvedAt:Date.now()})}}else n.set(e.id,{...e,source:"local",inCloud:!1,inLocal:!0,syncStatus:"local-only",contentHash:a(e)})})),Array.from(n.values()).sort(((e,t)=>{const n=new Date(e.lastModified||e.createdAt).getTime();return new Date(t.lastModified||t.createdAt).getTime()-n}))}},9950:(e,t,n)=>{e.exports=n(2049)}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"===typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"===typeof i.then)return i}var r=Object.create(null);n.r(r);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&s&&i;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>a[e]=()=>i[e]));return a.default=()=>i,n.d(r,a),r}})(),n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,i)=>(n.f[i](e,t),t)),[])),n.u=e=>"static/js/"+e+"."+{30:"53e68efa",52:"5d7d29e7",61:"1092909a",82:"9fe857d9",179:"d58ef743",190:"c63f68f3",206:"4a078b76",221:"968de29f",234:"323a3130",265:"c9219205",275:"bb2aaf4d",304:"352833db",305:"c1c85023",315:"943b9846",403:"3b1d1c8b",465:"f90d8fa5",526:"693f8d15",528:"a72b7516",562:"9e8618ff",631:"3d889ac8",654:"afbeb1d9",770:"96d7704c",797:"9a37817f",933:"755c5664"}[e]+".chunk.js",n.miniCssF=e=>"static/css/"+e+"."+{61:"771e7670",234:"771e7670",403:"346df0e1"}[e]+".chunk.css",n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="mi-app-lectura:";n.l=(i,s,r,a)=>{if(e[i])e[i].push(s);else{var o,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+r){o=h;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+r),o.src=i),e[i]=[s];var d=(t,n)=>{o.onerror=o.onload=null,clearTimeout(p);var s=e[i];if(delete e[i],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((e=>e(n))),t)return t(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{if("undefined"!==typeof document){var e=e=>new Promise(((t,i)=>{var s=n.miniCssF(e),r=n.p+s;if(((e,t)=>{for(var n=document.getElementsByTagName("link"),i=0;i<n.length;i++){var s=(a=n[i]).getAttribute("data-href")||a.getAttribute("href");if("stylesheet"===a.rel&&(s===e||s===t))return a}var r=document.getElementsByTagName("style");for(i=0;i<r.length;i++){var a;if((s=(a=r[i]).getAttribute("data-href"))===e||s===t)return a}})(s,r))return t();((e,t,i,s,r)=>{var a=document.createElement("link");a.rel="stylesheet",a.type="text/css",n.nc&&(a.nonce=n.nc),a.onerror=a.onload=n=>{if(a.onerror=a.onload=null,"load"===n.type)s();else{var i=n&&n.type,o=n&&n.target&&n.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+i+": "+o+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=i,l.request=o,a.parentNode&&a.parentNode.removeChild(a),r(l)}},a.href=t,i?i.parentNode.insertBefore(a,i.nextSibling):document.head.appendChild(a)})(e,r,null,t,i)})),t={792:0};n.f.miniCss=(n,i)=>{t[n]?i.push(t[n]):0!==t[n]&&{61:1,234:1,403:1}[n]&&i.push(t[n]=e(n).then((()=>{t[n]=0}),(e=>{throw delete t[n],e})))}}})(),(()=>{var e={792:0};n.f.j=(t,i)=>{var s=n.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var r=new Promise(((n,i)=>s=e[t]=[n,i]));i.push(s[2]=r);var a=n.p+n.u(t),o=new Error;n.l(a,(i=>{if(n.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var r=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",o.name="ChunkLoadError",o.type=r,o.request=a,s[1](o)}}),"chunk-"+t,t)}};var t=(t,i)=>{var s,r,a=i[0],o=i[1],l=i[2],c=0;if(a.some((t=>0!==e[t]))){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(l)l(n)}for(t&&t(i);c<a.length;c++)r=a[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0},i=self.webpackChunkmi_app_lectura=self.webpackChunkmi_app_lectura||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),n.nc=void 0;var i=n(9950),s=n(1352);const r=e=>{e&&e instanceof Function&&n.e(206).then(n.bind(n,8206)).then((t=>{let{getCLS:n,getFID:i,getFCP:s,getLCP:r,getTTFB:a}=t;n(e),i(e),s(e),r(e),a(e)}))};var a=n(387),o=n(3759),l=(n(2726),n(4414));const c=i.lazy((()=>Promise.all([n.e(528),n.e(403)]).then(n.bind(n,4403))));s.createRoot(document.getElementById("root")).render((0,l.jsx)(i.StrictMode,{children:(0,l.jsx)(o.A,{children:(0,l.jsx)(a.QG,{children:(0,l.jsx)(i.Suspense,{fallback:(0,l.jsx)("div",{children:"Cargando aplicaci\xf3n..."}),children:(0,l.jsx)(c,{})})})})})),r(console.log)})();